<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title class=title>Synchronized in Python | ¬¨ just serendipity üçÄ</title><meta name=title content="Synchronized in Python">
<meta name=description content="
In Java, you can make a variable thread safe by just adding the synchronized
keyword. Is there anything that can achieve the same results in
Python?

Without having prior knowledge of any python libraries to do so, the primitive interface
I would expect resembles the following:
class Foo(object):
  def __init__(self):
    self.lock = Lock()

  def perform_mutation(self, bytes):
    print(bytes)

  def write(self, bytes):
    self.lock.acquire()
    self.perform_mutation(bytes)
    self.lock.release()
This isn&rsquo;t robust: if an exception happens in perform_mutation the lock would
never be released. A small improvement we can make is to wrap it with
try/finally:"><meta name=keywords content="dev,bestof,"><meta property="og:url" content="https://perrotta.dev/2024/01/synchronized-in-python/"><meta property="og:site_name" content="¬¨ just serendipity üçÄ"><meta property="og:title" content="Synchronized in Python"><meta property="og:description" content="In Java, you can make a variable thread safe by just adding the synchronized keyword. Is there anything that can achieve the same results in Python?
Without having prior knowledge of any python libraries to do so, the primitive interface I would expect resembles the following:
class Foo(object): def __init__(self): self.lock = Lock() def perform_mutation(self, bytes): print(bytes) def write(self, bytes): self.lock.acquire() self.perform_mutation(bytes) self.lock.release() This isn‚Äôt robust: if an exception happens in perform_mutation the lock would never be released. A small improvement we can make is to wrap it with try/finally:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-15T14:42:51-03:00"><meta property="article:modified_time" content="2024-01-15T14:42:51-03:00"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Bestof"><meta name=twitter:card content="summary"><meta name=twitter:title content="Synchronized in Python"><meta name=twitter:description content="In Java, you can make a variable thread safe by just adding the synchronized keyword. Is there anything that can achieve the same results in Python?
Without having prior knowledge of any python libraries to do so, the primitive interface I would expect resembles the following:
class Foo(object): def __init__(self): self.lock = Lock() def perform_mutation(self, bytes): print(bytes) def write(self, bytes): self.lock.acquire() self.perform_mutation(bytes) self.lock.release() This isn‚Äôt robust: if an exception happens in perform_mutation the lock would never be released. A small improvement we can make is to wrap it with try/finally:"><meta itemprop=name content="Synchronized in Python"><meta itemprop=description content="In Java, you can make a variable thread safe by just adding the synchronized keyword. Is there anything that can achieve the same results in Python?
Without having prior knowledge of any python libraries to do so, the primitive interface I would expect resembles the following:
class Foo(object): def __init__(self): self.lock = Lock() def perform_mutation(self, bytes): print(bytes) def write(self, bytes): self.lock.acquire() self.perform_mutation(bytes) self.lock.release() This isn‚Äôt robust: if an exception happens in perform_mutation the lock would never be released. A small improvement we can make is to wrap it with try/finally:"><meta itemprop=datePublished content="2024-01-15T14:42:51-03:00"><meta itemprop=dateModified content="2024-01-15T14:42:51-03:00"><meta itemprop=wordCount content="553"><meta itemprop=keywords content="Dev,Bestof"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/2024/01/synchronized-in-python/><link rel=stylesheet href=https://perrotta.dev/theme.css><style>body{text-align:left;margin:auto}h1,h2,h3,h4,h5,h6,footer,nav{font-family:var(--font-title)}footer{font-size:smaller;padding:8px;text-align:center}a{color:var(--link-color)}a.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.4}table{width:100%}img{max-width:100%}code{background-color:var(--code-bg)}li code,p code{font-size:.9em}pre code{color:var(--heading-color);display:block;padding:25px;white-space:pre;font-size:17px;overflow-x:auto}code,pre{font-family:var(--font-code)}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:2px solid #999;color:var(--heading-color);padding-left:25px;padding-right:15px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex;gap:8px;margin-bottom:8px}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}.pubdate-list{color:var(--color-gray);font-style:italic}.pubdate-single{color:var(--color-gray);font-style:italic}.social-link-wrapper{display:flex;justify-content:center;align-items:center;gap:8px;margin-top:8px}.social-link{text-decoration:none;font-size:1.4em}sup.gray{color:var(--color-gray)}.title{font-size:38px}@media(prefers-color-scheme:dark){blockquote{color:#ccc}textarea,input{background-color:#252525;color:var(--text-color)}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.png alt="thiagowfx's avatar" width=32 height=32><h1 class=title>¬¨ just serendipity üçÄ</h1></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/coding/>Coding</a>
<a href=/tags/bestof/>‚òÖ</a></nav></header><main><h2><span>‚òÖ</span> Synchronized in Python</h2><p><span class=pubdate-single><time datetime=2024-01-15 pubdate>15 Jan, 2024
</time>‚Ä¢ 553 words ‚Ä¢ 3 min</span></p><content><blockquote><p><a href=https://stackoverflow.com/questions/53026622/python-equivalent-of-java-synchronized>In Java, you can make a variable thread safe by just adding the <code>synchronized</code>
keyword. Is there anything that can achieve the same results in
Python?</a></p></blockquote><p>Without having prior knowledge of any python libraries to do so, the primitive interface
I would expect resembles the following:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>Foo</span>(<span style=color:#e5c07b>object</span>):
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#56b6c2;font-weight:700>__init__</span>(<span style=color:#e06c75>self</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Lock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>perform_mutation</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>print</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>write</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>acquire</span>()
</span></span><span style=display:flex><span>    <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>perform_mutation</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>    <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>release</span>()
</span></span></code></pre></div><p>This isn&rsquo;t robust: if an exception happens in <code>perform_mutation</code> the lock would
never be released. A small improvement we can make is to wrap it with
<code>try/finally</code>:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>Foo</span>(<span style=color:#e5c07b>object</span>):
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#56b6c2;font-weight:700>__init__</span>(<span style=color:#e06c75>self</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Lock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>perform_mutation</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>print</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>write</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>acquire</span>()
</span></span><span style=display:flex><span>    <span style=color:#c678dd>try</span>:
</span></span><span style=display:flex><span>      <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>perform_mutation</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>    <span style=color:#c678dd>finally</span>:
</span></span><span style=display:flex><span>      <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>release</span>()
</span></span></code></pre></div><p>However it turns out there&rsquo;s a more pythonic way to do so:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>threading</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>Lock</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>Foo</span>(<span style=color:#e5c07b>object</span>):
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#56b6c2;font-weight:700>__init__</span>(<span style=color:#e06c75>self</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Lock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>perform_mutation</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>print</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>write</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#c678dd>with</span> <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span>:
</span></span><span style=display:flex><span>      <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>perform_mutation</span>(<span style=color:#e5c07b>bytes</span>)
</span></span></code></pre></div><p>How can we test this? First, let&rsquo;s use a single thread.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#e06c75>__name__</span> <span style=color:#56b6c2>==</span> <span style=color:#98c379>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>foo</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Foo</span>()
</span></span><span style=display:flex><span>  <span style=color:#e06c75>foo</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>write</span>(<span style=color:#98c379>&#34;hello from the main thread&#34;</span>)
</span></span></code></pre></div><p>Now let&rsquo;s use multiple threads:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#e06c75>__name__</span> <span style=color:#56b6c2>==</span> <span style=color:#98c379>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>foo</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Foo</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>threads</span> <span style=color:#56b6c2>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#c678dd>for</span> <span style=color:#e06c75>i</span> <span style=color:#56b6c2>in</span> <span style=color:#e5c07b>range</span>(<span style=color:#d19a66>10</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thread</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Thread</span>(<span style=color:#e06c75>target</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>foo</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>write</span>, <span style=color:#e06c75>args</span><span style=color:#56b6c2>=</span>(<span style=color:#98c379>f</span><span style=color:#98c379>&#34;hello from thread </span><span style=color:#98c379>{</span><span style=color:#e06c75>i</span><span style=color:#98c379>}</span><span style=color:#98c379>&#34;</span>,))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>threads</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>append</span>(<span style=color:#e06c75>thread</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#7f848e># Start all threads</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>for</span> <span style=color:#e06c75>thread</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>threads</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thread</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>start</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#7f848e># Wait for all threads to finish</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>for</span> <span style=color:#e06c75>thread</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>threads</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thread</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>join</span>()
</span></span></code></pre></div><p>Without the lock this is one of the results I get locally:</p><pre tabindex=0><code>% python3 lock.py
hello from thread 0
hello from thread 1
hello from thread 2
hello from thread 3
hello from thread 4
hello from thread 6
hello from thread 8
hello from thread 7
hello from thread 5
hello from thread 9
</code></pre><p>With the lock I always get the following, as you would predict:</p><pre tabindex=0><code>% python3 lock.py
hello from thread 0
hello from thread 1
hello from thread 2
hello from thread 3
hello from thread 4
hello from thread 5
hello from thread 6
hello from thread 7
hello from thread 8
hello from thread 9
</code></pre><p>We could go one level deeper in the abstraction by using a <code>@synchronized</code> decorator:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>Foo</span>(<span style=color:#e5c07b>object</span>):
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>perform_mutation</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>print</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#61afef>@synchronized</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>write</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>perform_mutation</span>(<span style=color:#e5c07b>bytes</span>)
</span></span></code></pre></div><p>How do we implement it?</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>synchronized</span>(<span style=color:#e06c75>member</span>):
</span></span><span style=display:flex><span>    <span style=color:#61afef>@wraps</span>(<span style=color:#e06c75>member</span>)
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>wrapper</span>(<span style=color:#56b6c2>*</span><span style=color:#e06c75>args</span>, <span style=color:#56b6c2>**</span><span style=color:#e06c75>kwargs</span>):
</span></span><span style=display:flex><span>        <span style=color:#e06c75>lock</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>vars</span>(<span style=color:#e06c75>member</span>)<span style=color:#56b6c2>.</span><span style=color:#e06c75>get</span>(<span style=color:#98c379>&#34;_synchronized_lock&#34;</span>, <span style=color:#e5c07b>None</span>)
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span> <span style=color:#e06c75>lock</span> <span style=color:#56b6c2>is</span> <span style=color:#e5c07b>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#e06c75>lock</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>vars</span>(<span style=color:#e06c75>member</span>)<span style=color:#56b6c2>.</span><span style=color:#e06c75>setdefault</span>(<span style=color:#98c379>&#34;_synchronized_lock&#34;</span>, <span style=color:#e06c75>Lock</span>())
</span></span><span style=display:flex><span>        <span style=color:#c678dd>with</span> <span style=color:#e06c75>lock</span>:
</span></span><span style=display:flex><span>          <span style=color:#c678dd>return</span> <span style=color:#e06c75>member</span>(<span style=color:#56b6c2>*</span><span style=color:#e06c75>args</span>, <span style=color:#56b6c2>**</span><span style=color:#e06c75>kwargs</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e06c75>wrapper</span>
</span></span></code></pre></div><p>One last concept to learn: <code>RLock</code> a.k.a. reentrant lock.</p><p>Consider the following program:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>threading</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>Lock</span>, <span style=color:#e06c75>Thread</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>Foo</span>:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#56b6c2;font-weight:700>__init__</span>(<span style=color:#e06c75>self</span>):
</span></span><span style=display:flex><span>        <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Lock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>changeA</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>        <span style=color:#c678dd>with</span> <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span>:
</span></span><span style=display:flex><span>            <span style=color:#e5c07b>print</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>changeB</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>        <span style=color:#c678dd>with</span> <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span>:
</span></span><span style=display:flex><span>            <span style=color:#e5c07b>print</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>changeAandB</span>(<span style=color:#e06c75>self</span>, <span style=color:#e5c07b>bytes</span>):
</span></span><span style=display:flex><span>        <span style=color:#c678dd>with</span> <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>lock</span>:
</span></span><span style=display:flex><span>            <span style=color:#e5c07b>print</span>(<span style=color:#e5c07b>bytes</span>)
</span></span><span style=display:flex><span>            <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>changeA</span>(<span style=color:#e5c07b>bytes</span>) <span style=color:#7f848e># a usual lock would block here</span>
</span></span><span style=display:flex><span>            <span style=color:#e06c75>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>changeB</span>(<span style=color:#e5c07b>bytes</span>)
</span></span></code></pre></div><p>Invoked as follows:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#e06c75>foo</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Foo</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>threads</span> <span style=color:#56b6c2>=</span> []
</span></span><span style=display:flex><span><span style=color:#c678dd>for</span> <span style=color:#e06c75>i</span> <span style=color:#56b6c2>in</span> <span style=color:#e5c07b>range</span>(<span style=color:#d19a66>5</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thread</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Thread</span>(<span style=color:#e06c75>target</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>foo</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>changeA</span>, <span style=color:#e06c75>args</span><span style=color:#56b6c2>=</span>(<span style=color:#98c379>f</span><span style=color:#98c379>&#34;hello from thread </span><span style=color:#98c379>{</span><span style=color:#e06c75>i</span><span style=color:#98c379>}</span><span style=color:#98c379> A&#34;</span>,))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>threads</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>append</span>(<span style=color:#e06c75>thread</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thread</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Thread</span>(<span style=color:#e06c75>target</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>foo</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>changeB</span>, <span style=color:#e06c75>args</span><span style=color:#56b6c2>=</span>(<span style=color:#98c379>f</span><span style=color:#98c379>&#34;hello from thread </span><span style=color:#98c379>{</span><span style=color:#e06c75>i</span><span style=color:#98c379>}</span><span style=color:#98c379> B&#34;</span>,))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>threads</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>append</span>(<span style=color:#e06c75>thread</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thread</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Thread</span>(<span style=color:#e06c75>target</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>foo</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>changeAandB</span>, <span style=color:#e06c75>args</span><span style=color:#56b6c2>=</span>(<span style=color:#98c379>f</span><span style=color:#98c379>&#34;hello from thread </span><span style=color:#98c379>{</span><span style=color:#e06c75>i</span><span style=color:#98c379>}</span><span style=color:#98c379> AB&#34;</span>,))
</span></span><span style=display:flex><span>    <span style=color:#e06c75>threads</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>append</span>(<span style=color:#e06c75>thread</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e># Start all threads</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>for</span> <span style=color:#e06c75>thread</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>threads</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thread</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>start</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e># Wait for all threads to finish</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>for</span> <span style=color:#e06c75>thread</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>threads</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>thread</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>join</span>()
</span></span></code></pre></div><p>It will not work as expected. As soon as the first <code>changeAandB</code> gets called, its inner
<code>self.changeA</code> call will block. This is because the lock can only be acquired once.</p><p>In this specific example, the straightforward way to fix the issue is to use an <code>RLock</code>:
<code>self.lock = RLock()</code>. The reentrant lock can be locked multiple times.</p><h2 id=references>References</h2><ul><li><a href=https://theorangeduck.com/page/synchronized-python>https://theorangeduck.com/page/synchronized-python</a></li><li><a href=https://stackoverflow.com/questions/29158282/how-to-create-a-synchronized-function-across-all-instances>https://stackoverflow.com/questions/29158282/how-to-create-a-synchronized-function-across-all-instances</a></li><li><a href=https://stackoverflow.com/questions/53026622/python-equivalent-of-java-synchronized>https://stackoverflow.com/questions/53026622/python-equivalent-of-java-synchronized</a></li><li><a href=https://stackoverflow.com/questions/16567958/when-and-how-to-use-pythons-rlock>https://stackoverflow.com/questions/16567958/when-and-how-to-use-pythons-rlock</a></li></ul></content><div style=display:flex;justify-content:space-between><p>Reply via
<a href="mailto:serendipity@perrotta.dev?subject=Reply to: Synchronized%20in%20Python">email</a></p><p><a href=https://perrotta.dev/tags/dev/>#dev</a>
<a href=https://perrotta.dev/tags/bestof/>#bestof</a></p></div></main><hr><footer><span>¬© 2021 - 2025 Thiago Perrotta ¬∑
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ¬∑
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo  ï‚Ä¢·¥•‚Ä¢ î bear</a></span><div class=social-link-wrapper><a target=_blank rel=noopener class=social-link href=mailto:serendipity@perrotta.dev title="Email address"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 24 24" height="1.3em" width="1.3em"><g transform="translate(0.000000,24.000000) scale(0.100000,-0.100000)"><path d="M26 191c-4-5 16-23 44-40l50-31 50 31c28 17 48 35 44 40-7 12-181 12-188 0z"/><path d="M22 103l3-58 93-3c104-3 105-3 1e2 71l-3 46-48-29-47-30-38 23c-20 13-43 27-50 31-10 6-12-5-10-51z"/></g></svg>
</a><a target=_blank rel=noopener class=social-link href=https://perrotta.dev/index.xml title="RSS feed"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 56.693 56.693" height="1em" width="1em"><path d="M3.428 31.085c6.19.0 12.009 2.418 16.382 6.816 4.381 4.398 6.793 10.256 6.793 16.492h9.539c0-18.113-14.676-32.848-32.714-32.848v9.54zM3.443 14.174c22.061.0 40.01 18.047 40.01 40.231h9.539c0-27.445-22.229-49.77-49.549-49.77v9.539zM16.634 47.741c0 3.648-2.959 6.607-6.607 6.607S3.42 51.39 3.42 47.741c0-3.65 2.958-6.607 6.606-6.607s6.608 2.957 6.608 6.607z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://github.com/thiagowfx title="Github profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://goodreads.com/user/show/7873832-thiago title="Goodreads profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 50 50" height="1em" width="1em"><path d="M25 2c-4.541.0-8.41336 1.9082151-11.017578 4.9453125C11.378203 9.9824099 10 14.07975 10 18.5s1.378203 8.517589 3.982422 11.554688C16.58664 33.091785 20.459 35 25 35c4.531588.0 8.395936-1.901605 11-4.927734V35c0 2.598543-.818503 4.764071-2.451172 6.339844C31.91616 42.915616 29.363725 44 25.5 44 17.784314 44 15 39.933333 15 36H11c0 6.066667 5.215686 12 14.5 12 4.636275.0 8.33384-1.377726 10.826172-3.783203C38.818503 41.811319 40 38.476457 40 35V18.5 3H36V6.9277344C33.395936 3.9016049 29.531588 2 25 2zm0 4c3.459.0 6.08664 1.3379255 7.982422 3.5488281C34.878203 11.759731 36 14.91225 36 18.5s-1.121797 6.740269-3.017578 8.951172C31.08664 29.662074 28.459 31 25 31s-6.08664-1.337926-7.982422-3.548828C15.121797 25.240269 14 22.08775 14 18.5s1.121797-6.740269 3.017578-8.9511719C18.91336 7.3379255 21.541 6 25 6z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://linkedin.com/in/thiagoperrotta title="LinkedIn profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 30 30" height="1.2em" width="1.2em"><path d="M24 4H6C4.895 4 4 4.895 4 6v18c0 1.105.895 2 2 2h18c1.105.0 2-.895 2-2V6c0-1.105-.895-2-2-2zM10.954 22h-2.95v-9.492h2.95V22zM9.449 11.151c-.951.0-1.72-.771-1.72-1.72s.77-1.719 1.72-1.719c.948.0 1.719.771 1.719 1.719C11.168 10.38 10.397 11.151 9.449 11.151zM22.004 22h-2.948v-4.616c0-1.101-.02-2.517-1.533-2.517-1.535.0-1.771 1.199-1.771 2.437V22h-2.948v-9.492h2.83v1.297h.04c.394-.746 1.356-1.533 2.791-1.533 2.987.0 3.539 1.966 3.539 4.522V22z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://stackoverflow.com/users/1745064/thiagowfx title="StackOverflow profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em"><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 3e2zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-2e2v39.7h2e2zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg></a></div><a target=_blank href=https://512kb.club title="512kb.club badge"><img src=https://perrotta.dev/green-team.gif alt="a proud member of the green team of 512KB club"></a></footer></body></html>