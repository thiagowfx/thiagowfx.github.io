<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>★ (Google) Chrome for Testing: reliable downloads for browser automation | Not Just Serendipity</title>
<meta name=keywords content="dev,bestof,web"><meta name=description content="Let&rsquo;s discuss the raison d&rsquo;etre of Google Chrome for
Testing, a project I was
the Tech Lead of during my tenure on the Chrome Tooling / Browser Automation team
at Google."><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://thiagowfx.github.io/2024/01/google-chrome-for-testing-reliable-downloads-for-browser-automation/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://thiagowfx.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://thiagowfx.github.io/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://thiagowfx.github.io/favicon.ico><link rel=apple-touch-icon href=https://thiagowfx.github.io/apple-touch-icon.png><link rel=mask-icon href=https://thiagowfx.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:title" content="★ (Google) Chrome for Testing: reliable downloads for browser automation"><meta property="og:description" content="Let&rsquo;s discuss the raison d&rsquo;etre of Google Chrome for
Testing, a project I was
the Tech Lead of during my tenure on the Chrome Tooling / Browser Automation team
at Google."><meta property="og:type" content="article"><meta property="og:url" content="https://thiagowfx.github.io/2024/01/google-chrome-for-testing-reliable-downloads-for-browser-automation/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-25T18:27:04-03:00"><meta property="article:modified_time" content="2024-01-25T18:27:04-03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="★ (Google) Chrome for Testing: reliable downloads for browser automation"><meta name=twitter:description content="Let&rsquo;s discuss the raison d&rsquo;etre of Google Chrome for
Testing, a project I was
the Tech Lead of during my tenure on the Chrome Tooling / Browser Automation team
at Google."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://thiagowfx.github.io/posts/"},{"@type":"ListItem","position":2,"name":"★ (Google) Chrome for Testing: reliable downloads for browser automation","item":"https://thiagowfx.github.io/2024/01/google-chrome-for-testing-reliable-downloads-for-browser-automation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"★ (Google) Chrome for Testing: reliable downloads for browser automation","name":"★ (Google) Chrome for Testing: reliable downloads for browser automation","description":"Let\u0026rsquo;s discuss the raison d\u0026rsquo;etre of Google Chrome for Testing, a project I was the Tech Lead of during my tenure on the Chrome Tooling / Browser Automation team at Google.\n","keywords":["dev","bestof","web"],"articleBody":"Let’s discuss the raison d’etre of Google Chrome for Testing, a project I was the Tech Lead of during my tenure on the Chrome Tooling / Browser Automation team at Google.\nOnce upon a time, a few (debugging) mistakes ago, web developers would run (web) integration tests with WebDriver Classic using Google Chrome (or Chromium)1. This was a chaotic era.\n“Why?”, you may rightfully ask.\nThe web browser and/or its components / extensions / etc could auto-update in-between successive test runs, yielding different test results, i.e. tests were not guaranteed to be hermetic / deterministic due to their (potentially) changing environment, yielding test flakiness Chrome adds an info bar whenever it is controlled in an automated fashion, which changes the CSS viewport, resulting in changes compared to a production environment. For example: an automated test that takes a screenshot would have a slightly smaller height whenever an infobar is present. There are no versioned Chrome builds for download. There’s no browser pinning. As a developer you always download the latest version. This makes it hard to reason about invariants, especially when new browser versions introduce breaking changes, even seemingly small ones. Corollary: The lack of versioned Chrome builds makes it hard to obtain a corresponding matching Chromedriver version for Chrome. The mismatch (delta) could provoke testing inconsistencies if browser APIs diverge In order to address these (and other) issues, Chrome for Testing (hereafter “CfT”) was born.\nThere are other niceties that Chrome for Testing accomplishes as of today:\nThe CDP (Chrome DevTools Protocol) experiment (“Protocol Monitor”) is enabled by default, out-of-the-box. This kind of experiment, which enriches your debugging toolbox, is exactly the sensible state you want during the development cycle. Mechanisms such as self-XSS confirmation prompts are disabled by default, which is the desired behavior for automation. Consider an analogy with setting DEBIAN_FRONTEND=noninteractive when running apt in dockerfiles. You don’t want prompts (even benign ones) to suddenly get in the way of your tests and end up interrupting their execution flow. Completely agnostic to the concept of “Stable” / “Beta” / “Dev”. If you have pinned versions, you don’t need to care about any of that. CfT releases are made available alongside a subset of corresponding Google Chrome releases Something important to note:\nWarning: Chrome for Testing has been created purely for browser automation and testing purposes, and is not suitable for daily browsing.\nThe main reason for that is the fact that it does not auto-update. You could argue that it doesn’t matter: Chrome for most linux distributions also does not auto-update by itself. The updates are normally deferred to the distribution’s package manager (e.g. apt, dnf, pacman, etc). Why should it be different for Chrome for Testing?\nAn additional point to consider here is that Chrome for Testing could have new features in the future that would be optimized for developers, not for end users. You don’t want end users to shoot themselves on the foot, therefore it’s easier, better and safer to do a blanket anti-recommendation of CfT for non-developers2.\nBecause of that, CfT cannot be made the default system browser.\nThe easiest way to obtain CfT is via its public API, which is documented here: https://googlechromelabs.github.io/chrome-for-testing/, or through the official CLI utility that is part of Puppeteer.\nToday, for all the reasons above (and more to come!), CfT is the de-facto recommended solution for browser automation for all things web applications and web platform testing. If you’re currently using either Chromium or Google Chrome for these purposes, you should switch to it.\nReferences Chrome for Testing Design Document: https://goo.gle/chrome-for-testing How Chrome DevTools helps to defend against self-XSS attacks For simplicity, referred to as just Chrome hereafter. ↩︎\nThe same way you wouldn’t recommend Arch Linux for linux newbies. ↩︎\n","wordCount":"622","inLanguage":"en","datePublished":"2024-01-25T18:27:04-03:00","dateModified":"2024-01-25T18:27:04-03:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://thiagowfx.github.io/2024/01/google-chrome-for-testing-reliable-downloads-for-browser-automation/"},"publisher":{"@type":"Person","name":"Not Just Serendipity","logo":{"@type":"ImageObject","url":"https://thiagowfx.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://thiagowfx.github.io/ accesskey=h title="Not Just Serendipity (Alt + H)"><img src=https://thiagowfx.github.io/apple-touch-icon.png alt aria-label=logo height=32>Not Just Serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://thiagowfx.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://thiagowfx.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://thiagowfx.github.io/tags/bestof/ title=bestof><span>bestof</span></a></li><li><a href=https://thiagowfx.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://thiagowfx.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>★ (Google) Chrome for Testing: reliable downloads for browser automation</h1><div class=post-meta><span title='2024-01-25 18:27:04 -0300 -0300'>January 25, 2024</span>&nbsp;·&nbsp;622 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p>Let&rsquo;s discuss the <em>raison d&rsquo;etre</em> of <a href=https://developer.chrome.com/blog/chrome-for-testing>Google Chrome for
Testing</a>, a project I was
the Tech Lead of during my tenure on the Chrome Tooling / Browser Automation team
at Google.</p><p><a href="https://www.youtube.com/watch?v=9y4A15WCGdc">Once upon a time, a few (debugging) mistakes
ago</a>, web developers would run
(web) integration tests with <a href=https://www.w3.org/TR/webdriver2/>WebDriver
Classic</a> using Google Chrome (or Chromium)<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.
This was a <a href=https://three-body-problem.fandom.com/wiki/Chaotic_Era>chaotic
era</a>.</p><p><em>&ldquo;Why?&rdquo;</em>, you may rightfully ask.</p><ul><li>The web browser and/or its components / extensions / etc could
<strong>auto-update</strong> in-between successive test runs, yielding different test
results, i.e. tests were not guaranteed to be hermetic / deterministic due to
their (potentially) changing environment, yielding test flakiness</li><li>Chrome adds an <strong>info bar</strong> whenever it is controlled in an automated
fashion, which changes the CSS viewport, resulting in changes compared to a
production environment. For example: an automated test that takes a
screenshot would have a slightly smaller height whenever an infobar is
present.</li><li>There are no versioned Chrome builds for download. There&rsquo;s no <strong>browser
pinning</strong>. As a developer you always download the latest version. This makes
it hard to reason about invariants, especially when new browser versions
introduce breaking changes, even seemingly small ones.<ul><li><strong>Corollary</strong>: The lack of versioned Chrome builds makes it hard to obtain
a corresponding matching
<a href=https://chromedriver.chromium.org/downloads>Chromedriver</a> version for
Chrome. The mismatch (delta) could provoke testing inconsistencies if
browser APIs diverge</li></ul></li></ul><p>In order to address these (and other) issues, <a href=https://goo.gle/chrome-for-testing>Chrome for
Testing</a> (hereafter &ldquo;CfT&rdquo;) was born.</p><p>There are other <em>niceties</em> that Chrome for Testing accomplishes as of today:</p><ul><li>The <a href=https://chromedevtools.github.io/devtools-protocol/>CDP (Chrome DevTools
Protocol)</a> experiment
(&ldquo;Protocol Monitor&rdquo;) is enabled by default, out-of-the-box. This kind of
experiment, which enriches your debugging toolbox, is exactly the sensible
state you want during the development cycle.</li><li>Mechanisms such as <a href=https://developer.chrome.com/blog/self-xss>self-XSS confirmation
prompts</a> are disabled by default,
which is the desired behavior for automation. Consider an analogy with
setting
<a href=https://askubuntu.com/questions/972516/debian-frontend-environment-variable><code>DEBIAN_FRONTEND=noninteractive</code></a>
when running <code>apt</code> in dockerfiles. You don&rsquo;t want prompts (even benign ones)
to suddenly get in the way of your tests and end up interrupting their
execution flow.</li><li>Completely agnostic to the concept of &ldquo;Stable&rdquo; / &ldquo;Beta&rdquo; / &ldquo;Dev&rdquo;. If you have
pinned versions, you don&rsquo;t need to care about any of that.</li><li>CfT releases are made available alongside a subset of corresponding Google
Chrome releases</li></ul><p>Something important to note:</p><blockquote><p><strong>Warning</strong>: Chrome for Testing has been created purely for browser
automation and testing purposes, and is not suitable for daily browsing.</p></blockquote><p>The main reason for that is the fact that it does not auto-update. You could
argue that it doesn&rsquo;t matter: Chrome for most linux distributions also does not
auto-update by itself. The updates are normally deferred to the distribution&rsquo;s
package manager (e.g. <code>apt</code>, <code>dnf</code>, <code>pacman</code>, etc). Why should it be different
for Chrome for Testing?</p><p>An additional point to consider here is that Chrome for Testing could have new
features in the future that would be optimized for developers, not for end
users. You don&rsquo;t want end users to shoot themselves on the foot, therefore it&rsquo;s
easier, better and safer to do a blanket anti-recommendation of CfT for
non-developers<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><p>Because of that, CfT cannot be made the default system browser.</p><p>The easiest way to obtain CfT is via its public API, which is documented here:
<a href=https://googlechromelabs.github.io/chrome-for-testing/>https://googlechromelabs.github.io/chrome-for-testing/</a>, or through the official
<a href=https://pptr.dev/browsers-api>CLI utility</a> that is part of Puppeteer.</p><p>Today, for all the reasons above (and more to come!), CfT is the de-facto
recommended solution for browser automation for all things web applications and
web platform testing. If you&rsquo;re currently using either Chromium or Google
Chrome for these purposes, you should switch to it.</p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li>Chrome for Testing Design Document: <a href=https://goo.gle/chrome-for-testing>https://goo.gle/chrome-for-testing</a></li><li><a href=https://developer.chrome.com/blog/self-xss#can_you_disable_it_for_test_automation>How Chrome DevTools helps to defend against self-XSS attacks</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>For simplicity, referred to as just <em>Chrome</em> hereafter.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>The same way you wouldn&rsquo;t recommend Arch Linux for linux newbies.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://thiagowfx.github.io/tags/dev/>dev</a></li><li><a href=https://thiagowfx.github.io/tags/bestof/>bestof</a></li><li><a href=https://thiagowfx.github.io/tags/web/>web</a></li></ul><nav class=paginav><a class=next href=https://thiagowfx.github.io/2024/01/terraforming-a-linode-hello-world/><span class=title>Next »</span><br><span>★ Terraforming a Linode: hello world</span></a></nav></footer><div style=text-align:center><a href="mailto:tbperrotta@gmail.com?subject=RE: Not%20Just%20Serendipity comment for '%e2%98%85%20%28Google%29%20Chrome%20for%20Testing%3a%20reliable%20downloads%20for%20browser%20automation'" target=_blank><button>Reply via email</button></a></div></article></main><footer class=footer><span>Copyright © 2021 - 2024 Thiago Perrotta • <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> • <a href=/index.xml>RSS</a> •</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>