<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>★ prodaccess | not just serendipity</title>
<meta name=keywords content="dev,devops,bestof"><meta name=description content="At Google we had a prodaccess command used to log in and authenticate in all
sorts of internal corp systems1 for 20 hours. It became a daily ritual to run
prodaccess first thing in the morning when logging in upon unlocking our
physical workstations2.
During the pandemic, when heavily using our virtual workstations (dubbed
cloudtops, think of an EC2 instance or a VPS) it was common to hook
prodaccess into ssh. There was a prodcertstatus command that would tell
you when prodaccess would expire. A common pattern was to modify your ssh
startup command to automatically run prodaccess whenever prodcertstatus
indicated that access would expire within 2-4 hours, depending on the user&rsquo;s
preference.
Given my trained muscle memory, I wanted to continue to use this alias even in
environments other than Google:"><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://www.perrotta.dev/2024/10/prodaccess/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://www.perrotta.dev/favicon.ico><link rel=apple-touch-icon href=https://www.perrotta.dev/apple-touch-icon.png><link rel=mask-icon href=https://www.perrotta.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.perrotta.dev/2024/10/prodaccess/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:title" content="★ prodaccess"><meta property="og:description" content="At Google we had a prodaccess command used to log in and authenticate in all
sorts of internal corp systems1 for 20 hours. It became a daily ritual to run
prodaccess first thing in the morning when logging in upon unlocking our
physical workstations2.
During the pandemic, when heavily using our virtual workstations (dubbed
cloudtops, think of an EC2 instance or a VPS) it was common to hook
prodaccess into ssh. There was a prodcertstatus command that would tell
you when prodaccess would expire. A common pattern was to modify your ssh
startup command to automatically run prodaccess whenever prodcertstatus
indicated that access would expire within 2-4 hours, depending on the user&rsquo;s
preference.
Given my trained muscle memory, I wanted to continue to use this alias even in
environments other than Google:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.perrotta.dev/2024/10/prodaccess/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-18T14:57:27+02:00"><meta property="article:modified_time" content="2024-10-18T14:57:27+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="★ prodaccess"><meta name=twitter:description content="At Google we had a prodaccess command used to log in and authenticate in all
sorts of internal corp systems1 for 20 hours. It became a daily ritual to run
prodaccess first thing in the morning when logging in upon unlocking our
physical workstations2.
During the pandemic, when heavily using our virtual workstations (dubbed
cloudtops, think of an EC2 instance or a VPS) it was common to hook
prodaccess into ssh. There was a prodcertstatus command that would tell
you when prodaccess would expire. A common pattern was to modify your ssh
startup command to automatically run prodaccess whenever prodcertstatus
indicated that access would expire within 2-4 hours, depending on the user&rsquo;s
preference.
Given my trained muscle memory, I wanted to continue to use this alias even in
environments other than Google:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.perrotta.dev/posts/"},{"@type":"ListItem","position":2,"name":"★ prodaccess","item":"https://www.perrotta.dev/2024/10/prodaccess/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"★ prodaccess","name":"★ prodaccess","description":"At Google we had a prodaccess command used to log in and authenticate in all sorts of internal corp systems1 for 20 hours. It became a daily ritual to run prodaccess first thing in the morning when logging in upon unlocking our physical workstations2.\nDuring the pandemic, when heavily using our virtual workstations (dubbed cloudtops, think of an EC2 instance or a VPS) it was common to hook prodaccess into ssh. There was a prodcertstatus command that would tell you when prodaccess would expire. A common pattern was to modify your ssh startup command to automatically run prodaccess whenever prodcertstatus indicated that access would expire within 2-4 hours, depending on the user\u0026rsquo;s preference.\nGiven my trained muscle memory, I wanted to continue to use this alias even in environments other than Google:\n","keywords":["dev","devops","bestof"],"articleBody":"At Google we had a prodaccess command used to log in and authenticate in all sorts of internal corp systems1 for 20 hours. It became a daily ritual to run prodaccess first thing in the morning when logging in upon unlocking our physical workstations2.\nDuring the pandemic, when heavily using our virtual workstations (dubbed cloudtops, think of an EC2 instance or a VPS) it was common to hook prodaccess into ssh. There was a prodcertstatus command that would tell you when prodaccess would expire. A common pattern was to modify your ssh startup command to automatically run prodaccess whenever prodcertstatus indicated that access would expire within 2-4 hours, depending on the user’s preference.\nGiven my trained muscle memory, I wanted to continue to use this alias even in environments other than Google:\n% cat ~/.profile.d/functions_corp.sh [...] prodaccess() { echo \"--\u003e VPN\" vpn_login echo \"--\u003e Teleport\" teleport_login echo \"--\u003e AWS\" aws_login echo \"--\u003e Azure\" azure_login case \"$1\" in -u|--update) echo \"--\u003e mr\" # Update all well-known corp repositories (cd ~/Corp \u0026\u0026 mr update \u0026\u0026 mr run git world) # Package manager upgrade echo \"--\u003e sd-world\" sd-world shift ;; -a|--all) echo \"--\u003e Atlas Mongo\" atlas_login shift ;; esac } [...] Notes:\nmr is https://myrepos.branchable.com/ (“a tool to manage all your version control repositories”)3 sd-world was introduced in a previous post: it performs a full system upgrade --all holds services I only need / use from time to time. shift is not really needed, but IMHO it’s a good practice (and another ingrained habit of mine), especially when inside for loops git world is an alias in my ~/.gitconfig that runs git fetch --all \u0026\u0026 git remote prune origin Every morning I invoke prodaccess -u when starting my work day. A few password prompts and touch IDs later and I do not need to worry about logging in anymore during the middle of the day, which reduces overall context switching and stress.\nUntil someone in CorpEng decided it was a good idea to deprecate it in favour of a new gcert command, destroying many SWE-years of developed muscle memory. ↩︎\nAh, the good ol’ times. ↩︎\nI should write a post about it sometime. ↩︎\n","wordCount":"359","inLanguage":"en","datePublished":"2024-10-18T14:57:27+02:00","dateModified":"2024-10-18T14:57:27+02:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.perrotta.dev/2024/10/prodaccess/"},"publisher":{"@type":"Person","name":"not just serendipity","logo":{"@type":"ImageObject","url":"https://www.perrotta.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.perrotta.dev/ accesskey=h title="not just serendipity (Alt + H)"><img src=https://www.perrotta.dev/apple-touch-icon.png alt aria-label=logo height=32>not just serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.perrotta.dev/posts/ title=posts><span>posts</span></a></li><li><a href=https://www.perrotta.dev/tags/bestof/ title="★ bestof"><span>★ bestof</span></a></li><li><a href=https://www.perrotta.dev/tags/serenity/ title=serenity><span>serenity</span></a></li><li><a href=https://www.perrotta.dev/archives/ title=archives><span>archives</span></a></li><li><a href=https://www.perrotta.dev/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://www.perrotta.dev/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">★ prodaccess</h1><div class=post-meta><span title='2024-10-18 14:57:27 +0200 +0200'>October 18, 2024</span>&nbsp;·&nbsp;359 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p>At Google we had a <code>prodaccess</code> command used to log in and authenticate in all
sorts of internal corp systems<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> for 20 hours. It became a daily ritual to run
<code>prodaccess</code> first thing in the morning when logging in upon unlocking our
physical workstations<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><p>During the pandemic, when heavily using our virtual workstations (dubbed
<em>cloudtops</em>, think of an EC2 instance or a VPS) it was common to hook
<code>prodaccess</code> into <code>ssh</code>. There was a <code>prodcertstatus</code> command that would tell
you when <code>prodaccess</code> would expire. A common pattern was to modify your <code>ssh</code>
startup command to automatically run <code>prodaccess</code> whenever <code>prodcertstatus</code>
indicated that access would expire within 2-4 hours, depending on the user&rsquo;s
preference.</p><p>Given my trained muscle memory, I wanted to continue to use this alias even in
environments other than Google:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% cat ~/.profile.d/functions_corp.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>prodaccess<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	echo <span style=color:#e6db74>&#34;--&gt; VPN&#34;</span>
</span></span><span style=display:flex><span>	vpn_login
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	echo <span style=color:#e6db74>&#34;--&gt; Teleport&#34;</span>
</span></span><span style=display:flex><span>	teleport_login
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	echo <span style=color:#e6db74>&#34;--&gt; AWS&#34;</span>
</span></span><span style=display:flex><span>	aws_login
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;--&gt; Azure&#34;</span>
</span></span><span style=display:flex><span>    azure_login
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> in
</span></span><span style=display:flex><span>		-u|--update<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>			echo <span style=color:#e6db74>&#34;--&gt; mr&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e># Update all well-known corp repositories</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>(</span>cd ~/Corp <span style=color:#f92672>&amp;&amp;</span> mr update <span style=color:#f92672>&amp;&amp;</span> mr run git world<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e># Package manager upgrade</span>
</span></span><span style=display:flex><span>			echo <span style=color:#e6db74>&#34;--&gt; sd-world&#34;</span>
</span></span><span style=display:flex><span>			sd-world
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			shift
</span></span><span style=display:flex><span>			;;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		-a|--all<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>			echo <span style=color:#e6db74>&#34;--&gt; Atlas Mongo&#34;</span>
</span></span><span style=display:flex><span>			atlas_login
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			shift
</span></span><span style=display:flex><span>			;;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Notes:</p><ul><li><code>mr</code> is <a href=https://myrepos.branchable.com/>https://myrepos.branchable.com/</a> (&ldquo;a tool to manage all your version
control repositories&rdquo;)<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></li><li><code>sd-world</code> was introduced in a <a href=https://www.perrotta.dev/2024/01/sd-world-perform-a-full-system-upgrade/>previous post</a>: it performs a full system upgrade</li><li><code>--all</code> holds services I only need / use from time to time.</li><li><code>shift</code> is not really needed, but IMHO it&rsquo;s a good practice (and another
ingrained habit of mine), especially when inside <code>for</code> loops</li><li><code>git world</code> is an alias in my <code>~/.gitconfig</code> that runs <code>git fetch --all && git remote prune origin</code></li></ul><p>Every morning I invoke <code>prodaccess -u</code> when starting my work day. A few password
prompts and touch IDs later and I do not need to worry about logging in anymore
during the middle of the day, which reduces overall context switching and
stress.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Until someone in CorpEng decided it was a good idea to
<a href=https://killedbygoogle.com/>deprecate</a> it in favour of a new <code>gcert</code>
command, destroying many SWE-years of developed muscle memory.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Ah, the <em>good ol&rsquo; times</em>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>I should write a post about it sometime.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.perrotta.dev/tags/dev/>Dev</a></li><li><a href=https://www.perrotta.dev/tags/devops/>Devops</a></li><li><a href=https://www.perrotta.dev/tags/bestof/>Bestof</a></li></ul></footer></article></main><footer class=footer><span>Copyright © 2021 - 2024 Thiago Perrotta · <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> · <a href=/index.xml>RSS</a> · Made with ♥ in 🇨🇦</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>