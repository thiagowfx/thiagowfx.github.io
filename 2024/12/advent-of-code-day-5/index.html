<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Advent of Code: Day 5 | not just serendipity</title>
<meta name=keywords content="dev"><meta name=description content="Link to Day #5 puzzle."><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://www.perrotta.dev/2024/12/advent-of-code-day-5/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://www.perrotta.dev/favicon.ico><link rel=apple-touch-icon href=https://www.perrotta.dev/apple-touch-icon.png><link rel=mask-icon href=https://www.perrotta.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.perrotta.dev/2024/12/advent-of-code-day-5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:url" content="https://www.perrotta.dev/2024/12/advent-of-code-day-5/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="Advent of Code: Day 5"><meta property="og:description" content="Link to Day #5 puzzle."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-08T23:24:27+01:00"><meta property="article:modified_time" content="2024-12-08T23:24:27+01:00"><meta property="article:tag" content="Dev"><meta name=twitter:card content="summary"><meta name=twitter:title content="Advent of Code: Day 5"><meta name=twitter:description content="Link to Day #5 puzzle."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.perrotta.dev/posts/"},{"@type":"ListItem","position":2,"name":"Advent of Code: Day 5","item":"https://www.perrotta.dev/2024/12/advent-of-code-day-5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Advent of Code: Day 5","name":"Advent of Code: Day 5","description":"Link to Day #5 puzzle.\n","keywords":["dev"],"articleBody":"Link to Day #5 puzzle.\nIt is a topological sort problem, plain and simple.\nIn part one all we care about is whether certain input sequences are valid, within the sort constraints. It’s very straightforward to verify that by exhaustively checking all constraints (“edges”):\nimport sys def is_correct(update, edges): position = defaultdict(lambda: sys.maxsize, {node: i for (i, node) in enumerate(update)}) for (first, second) in edges: if first in update and second in update and position[first] \u003e position[second]: return False return True position is a dictionary representing in which index (position) each element occurs. I make use of a defaultdict with a very large value set by default (instead of a vanilla dict) to avoid the need to explicitly check for element presence.\nIn part two we need to perform the actual topological sort. Or…do we? Doing toposort would be the most efficient way to resolve it, however, in this case, plain brute force is good enough:\ndef toposort(update, edges): position = defaultdict(lambda: sys.maxsize, {node: i for (i, node) in enumerate(update)}) change = True while change: change = False for (first, second) in edges: if first in update and second in update and position[first] \u003e= position[second]: position[first] = position[second] - 1 change = True return sorted(update, key=lambda x: position[x]) Once again, we iterate through all the input constraints until we find a violation. Whenever we find one, we fix the position of the element in the wrong order by updating it to occur before the other element. We repeat this procedure until there are no more violations.\nThe full source:\n#!/usr/bin/env python3 from collections import defaultdict import sys def is_correct(update, edges): position = defaultdict(lambda: sys.maxsize, {node: i for (i, node) in enumerate(update)}) for (first, second) in edges: if first in update and second in update and position[first] \u003e position[second]: return False return True def toposort(update, edges): position = defaultdict(lambda: sys.maxsize, {node: i for (i, node) in enumerate(update)}) change = True while change: change = False for (first, second) in edges: if first in update and second in update and position[first] \u003e= position[second]: position[first] = position[second] - 1 change = True return sorted(update, key=lambda x: position[x]) def main(): with open(sys.argv[1]) as input: lines = input.read().splitlines() edges = [] updates = [] for line in lines: if \"|\" in line: edges.append(list(map(int, line.split(\"|\")))) elif len(line) == 0: continue else: updates.append(list(map(int, line.split(\",\")))) total_one = total_two = 0 for update in updates: if is_correct(update, edges): total_one += update[len(update) // 2] else: sorted_update = toposort(update, edges) total_two += sorted_update[len(sorted_update) // 2] # part one print(total_one) # part two print(total_two) if __name__ == '__main__': main() ","wordCount":"427","inLanguage":"en","datePublished":"2024-12-08T23:24:27+01:00","dateModified":"2024-12-08T23:24:27+01:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.perrotta.dev/2024/12/advent-of-code-day-5/"},"publisher":{"@type":"Person","name":"not just serendipity","logo":{"@type":"ImageObject","url":"https://www.perrotta.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.perrotta.dev/ accesskey=h title="not just serendipity (Alt + H)"><img src=https://www.perrotta.dev/apple-touch-icon.png alt aria-label=logo height=32>not just serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.perrotta.dev/posts/ title=posts><span>posts</span></a></li><li><a href=https://www.perrotta.dev/tags/bestof/ title="bestof ★"><span>bestof ★</span></a></li><li><a href=https://www.perrotta.dev/tags/serenity/ title=serenity><span>serenity</span></a></li><li><a href=https://www.perrotta.dev/archives/ title=archives><span>archives</span></a></li><li><a href=https://www.perrotta.dev/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://www.perrotta.dev/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Advent of Code: Day 5</h1><div class=post-meta><span title='2024-12-08 23:24:27 +0100 +0100'>December 8, 2024</span>&nbsp;·&nbsp;427 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p>Link to <a href=https://adventofcode.com/2024/day/5>Day #5</a> puzzle.</p><p>It is a topological sort problem, plain and simple.</p><p>In part one all we care about is whether certain input sequences are valid,
within the sort constraints. It&rsquo;s very straightforward to verify that by
exhaustively checking all constraints (&ldquo;edges&rdquo;):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_correct</span>(update, edges):
</span></span><span style=display:flex><span>    position <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: sys<span style=color:#f92672>.</span>maxsize, {node: i <span style=color:#66d9ef>for</span> (i, node) <span style=color:#f92672>in</span> enumerate(update)})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (first, second) <span style=color:#f92672>in</span> edges:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> first <span style=color:#f92672>in</span> update <span style=color:#f92672>and</span> second <span style=color:#f92672>in</span> update <span style=color:#f92672>and</span> position[first] <span style=color:#f92672>&gt;</span> position[second]:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span></code></pre></div><p><code>position</code> is a dictionary representing in which index (position) each element
occurs. I make use of a <code>defaultdict</code> with a very large value set by default
(instead of a vanilla <code>dict</code>) to avoid the need to explicitly check for element
presence.</p><p>In part two we need to perform the actual topological sort. Or&mldr;do we? Doing
toposort would be the most efficient way to resolve it, however, in this case,
plain brute force is good enough:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>toposort</span>(update, edges):
</span></span><span style=display:flex><span>    position <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: sys<span style=color:#f92672>.</span>maxsize, {node: i <span style=color:#66d9ef>for</span> (i, node) <span style=color:#f92672>in</span> enumerate(update)})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    change <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> change:
</span></span><span style=display:flex><span>        change <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (first, second) <span style=color:#f92672>in</span> edges:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> first <span style=color:#f92672>in</span> update <span style=color:#f92672>and</span> second <span style=color:#f92672>in</span> update <span style=color:#f92672>and</span> position[first] <span style=color:#f92672>&gt;=</span> position[second]:
</span></span><span style=display:flex><span>                position[first] <span style=color:#f92672>=</span> position[second] <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                change <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sorted(update, key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: position[x])
</span></span></code></pre></div><p>Once again, we iterate through all the input constraints until we find a
violation. Whenever we find one, we fix the position of the element in the wrong
order by updating it to occur before the other element. We repeat this procedure
until there are no more violations.</p><p>The full source:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> defaultdict
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_correct</span>(update, edges):
</span></span><span style=display:flex><span>    position <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: sys<span style=color:#f92672>.</span>maxsize, {node: i <span style=color:#66d9ef>for</span> (i, node) <span style=color:#f92672>in</span> enumerate(update)})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (first, second) <span style=color:#f92672>in</span> edges:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> first <span style=color:#f92672>in</span> update <span style=color:#f92672>and</span> second <span style=color:#f92672>in</span> update <span style=color:#f92672>and</span> position[first] <span style=color:#f92672>&gt;</span> position[second]:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>toposort</span>(update, edges):
</span></span><span style=display:flex><span>    position <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: sys<span style=color:#f92672>.</span>maxsize, {node: i <span style=color:#66d9ef>for</span> (i, node) <span style=color:#f92672>in</span> enumerate(update)})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    change <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> change:
</span></span><span style=display:flex><span>        change <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (first, second) <span style=color:#f92672>in</span> edges:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> first <span style=color:#f92672>in</span> update <span style=color:#f92672>and</span> second <span style=color:#f92672>in</span> update <span style=color:#f92672>and</span> position[first] <span style=color:#f92672>&gt;=</span> position[second]:
</span></span><span style=display:flex><span>                position[first] <span style=color:#f92672>=</span> position[second] <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                change <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sorted(update, key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: position[x])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]) <span style=color:#66d9ef>as</span> input:
</span></span><span style=display:flex><span>        lines <span style=color:#f92672>=</span> input<span style=color:#f92672>.</span>read()<span style=color:#f92672>.</span>splitlines()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    edges <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    updates <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;|&#34;</span> <span style=color:#f92672>in</span> line:
</span></span><span style=display:flex><span>            edges<span style=color:#f92672>.</span>append(list(map(int, line<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;|&#34;</span>))))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> len(line) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            updates<span style=color:#f92672>.</span>append(list(map(int, line<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;,&#34;</span>))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    total_one <span style=color:#f92672>=</span> total_two <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> update <span style=color:#f92672>in</span> updates:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> is_correct(update, edges):
</span></span><span style=display:flex><span>            total_one <span style=color:#f92672>+=</span> update[len(update) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            sorted_update <span style=color:#f92672>=</span> toposort(update, edges)
</span></span><span style=display:flex><span>            total_two <span style=color:#f92672>+=</span> sorted_update[len(sorted_update) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># part one</span>
</span></span><span style=display:flex><span>    print(total_one)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># part two</span>
</span></span><span style=display:flex><span>    print(total_two)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.perrotta.dev/tags/dev/>Dev</a></li></ul></footer></article></main><footer class=footer><span>Copyright © 2021 - 2025 Thiago Perrotta · <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> · <a href=/index.xml>RSS</a> · Made with ♥ in 🇨🇦</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>