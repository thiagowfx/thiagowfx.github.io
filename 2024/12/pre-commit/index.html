<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Pre-commit | not just serendipity</title><meta name=title content="Pre-commit">
<meta name=description content="pre-commit is a CI framework for git.
For those who are used to google3 tooling: it&rsquo;s akin to the configuration part of TAP Presubmit.
You can plug in linters, formatters, code analyzers&mldr;pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.
Once properly configured the whole pipeline can be run locally with pre-commit run. By default, only the stashed files are inspected. In order to consider every file in the repository, pass --all-files. Modified files that were not yet git added are not included."><meta name=keywords content="bestof★,dev,"><meta property="og:url" content="https://perrotta.dev/2024/12/pre-commit/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="Pre-commit"><meta property="og:description" content="pre-commit is a CI framework for git. For those who are used to google3 tooling: it’s akin to the configuration part of TAP Presubmit.
You can plug in linters, formatters, code analyzers…pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.
Once properly configured the whole pipeline can be run locally with pre-commit run. By default, only the stashed files are inspected. In order to consider every file in the repository, pass --all-files. Modified files that were not yet git added are not included."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-21T23:24:23-03:00"><meta property="article:modified_time" content="2024-12-21T23:24:23-03:00"><meta property="article:tag" content="Bestof★"><meta property="article:tag" content="Dev"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pre-commit"><meta name=twitter:description content="pre-commit is a CI framework for git. For those who are used to google3 tooling: it’s akin to the configuration part of TAP Presubmit.
You can plug in linters, formatters, code analyzers…pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.
Once properly configured the whole pipeline can be run locally with pre-commit run. By default, only the stashed files are inspected. In order to consider every file in the repository, pass --all-files. Modified files that were not yet git added are not included."><meta itemprop=name content="Pre-commit"><meta itemprop=description content="pre-commit is a CI framework for git. For those who are used to google3 tooling: it’s akin to the configuration part of TAP Presubmit.
You can plug in linters, formatters, code analyzers…pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.
Once properly configured the whole pipeline can be run locally with pre-commit run. By default, only the stashed files are inspected. In order to consider every file in the repository, pass --all-files. Modified files that were not yet git added are not included."><meta itemprop=datePublished content="2024-12-21T23:24:23-03:00"><meta itemprop=dateModified content="2024-12-21T23:24:23-03:00"><meta itemprop=wordCount content="548"><meta itemprop=keywords content="Bestof★,Dev"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/><style>body{font-family:crimson pro,vollkorn,alegreya,iowan old style,apple garamond,baskerville,times new roman,noto serif,droid serif,times,source serif pro,serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fffcf0;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}h1,h2,h3,h4,h5,h6,footer,nav{font-family:inter,fira sans,lato,system-ui,-apple-system,BlinkMacSystemFont,avenir next,avenir,segoe ui,helvetica neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}footer{font-size:small;padding:8px;text-align:center}a{color:#3273dc}.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}li code,p code{font-size:small}pre code{color:#222;display:block;padding:20px;white-space:pre;font-size:14px;overflow-x:auto}code,pre{font-family:fira code,pt mono,ibm plex mono,Menlo,Consolas,Monaco,liberation mono,ubuntu mono,lucida console,monospace}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 110px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#01242e;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#444}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.png alt="thiagowfx's avatar" width=32 height=32><h2>not just serendipity</h2></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/bestof/>★</a></nav></header><main><h1><span>★</span>
Pre-commit</h1><p><i><time datetime=2024-12-21 pubdate>21 Dec, 2024
</time>• 548 words
• 3 minutes</i></p><content><p><a href=https://pre-commit.com/>pre-commit</a> is a CI framework for <code>git</code>.
For those who are used to google3 tooling: it&rsquo;s akin to the configuration part of <code>TAP Presubmit</code>.</p><p>You can plug in linters, formatters, code analyzers&mldr;pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.</p><p>Once properly configured the whole pipeline can be run locally with <code>pre-commit run</code>. By default, only the stashed files are inspected. In order to consider every file in the repository, pass <code>--all-files</code>. Modified files that were not yet <code>git add</code>ed are not included.</p><p>When configuring CI, the same command is used in cloud pipelines: it&rsquo;s a single configuration for both local and CI runs.</p><p>All the configuration lives in a single YAML file, <code>.pre-commit-config.yaml</code>, in the repository root.</p><p>Because it is written in Python, the whole ecosystem around the language is very well supported, first-class. That said, many other languages are also supported. For the ones that are not, there is a escape hatch – the &ldquo;system&rdquo; language.</p><p>Here is an example <code>.pre-commit-config.yaml</code> file – the one for this blog:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>repos</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/pre-commit/pre-commit-hooks</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>v5.0.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hooks</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># keep-sorted start</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>check-executables-have-shebangs</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>check-symlinks</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>check-yaml</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>detect-private-key</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>pretty-format-json</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span>          - --<span style=color:#ae81ff>autofix</span>
</span></span><span style=display:flex><span>          - --<span style=color:#66d9ef>no</span>-<span style=color:#ae81ff>sort-keys</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>sort-simple-yaml</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>trailing-whitespace</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># keep-sorted end</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/google/keep-sorted</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>v0.5.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hooks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>keep-sorted</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/google/yamlfmt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>v0.14.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hooks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>yamlfmt</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/codespell-project/codespell</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>v2.3.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hooks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>codespell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>exclude</span>: <span style=color:#ae81ff>^content/posts/(2014|2015|2016)|content/posts/2024-07-09-kubectl-get-secret-with-jsonpath-add-newline.md|content/posts/2024-06-27-a-little.md</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span>          <span style=color:#75715e># keep-sorted start</span>
</span></span><span style=display:flex><span>          - -<span style=color:#ae81ff>L=DeVault</span>
</span></span><span style=display:flex><span>          - -<span style=color:#ae81ff>L=als</span>
</span></span><span style=display:flex><span>          - -<span style=color:#ae81ff>L=ist</span>
</span></span><span style=display:flex><span>          - -<span style=color:#ae81ff>L=sive</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># keep-sorted end</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/jmlrt/check-yamlschema</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>v0.0.4</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hooks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>check-yamlschema</span>
</span></span></code></pre></div><p>Repository versions are always pinned. You would think this is tedious, but it&rsquo;s highly desirable for reproducibility, and they can all be automatically updated with <code>pre-commit autoupdate</code>.</p><p>To run only a single hook: <code>pre-commit run [--all-files] codespell</code>.</p><p>How do you install <code>pre-commit</code> in the first place? Use <code>pip</code>, or <code>brew</code> (macOS), or your favorite package manager.</p><p>Hooks are configured in <code>.pre-commit-hooks.yaml</code> files in their respective repositories. <a href=https://github.com/codespell-project/codespell/blob/main/.pre-commit-hooks.yaml>Here</a> is an example, from <code>codespell</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>id</span>: <span style=color:#ae81ff>codespell</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>codespell</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Checks for common misspellings in text files.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>entry</span>: <span style=color:#ae81ff>codespell</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>language</span>: <span style=color:#ae81ff>python</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>types</span>: [<span style=color:#ae81ff>text]</span>
</span></span></code></pre></div><p>&mldr;it&rsquo;s just metadata that teaches the framework to run the <code>codespell</code> python file, and that it should only run in text files.</p><p>The definition of what a text file is lives in the <a href=https://github.com/pre-commit/identify>identify</a> pre-commit library, <a href=https://github.com/pre-commit/identify/blob/main/identify/extensions.py>this</a> file has all the mappings. You could also specify <code>shell</code>, for example.</p><p>What if an extension isn&rsquo;t supported? Instead of using <code>types:</code>, use <code>file:</code> with a regex pattern to match, such as <code>\.sh$</code>.</p><p>What if an upstream tool does not have a <code>.pre-commit-hooks.yaml</code> file? I wrote a <a href=https://perrotta.dev/2024/12/pre-commit-create-hooks-for-unsupported-tools/>post</a> with a workaround wherein you can define your own.</p><p>How do you try out new hooks? One way is to use <a href=https://perrotta.dev/2024/11/pre-commit-try-repo/><code>pre-commit try-repo</code></a>. Another way is to add them to your config and then run each hook individually.</p><p>Are there similar tools? There&rsquo;s <a href=https://typicode.github.io/husky/><code>husky</code></a>, but it&rsquo;s too nodejs / web centric. I like <code>pre-commit.com</code> better.</p><p>Any git repository that is owned my multiple people and need to follow well-defined practices and conventions should, in general, adopt a pre-commit framework. <code>pre-commit.com</code> is one possible solution that is great at its job.</p><h2 id=references>References</h2><ul><li><a href=https://whynothugo.nl/journal/2023/01/12/notes-on-pre-commit/>https://whynothugo.nl/journal/2023/01/12/notes-on-pre-commit/</a></li></ul></content><p><a href=https://perrotta.dev/tags/bestof/>#bestof★</a>
<a href=https://perrotta.dev/tags/dev/>#dev</a></p></main><hr><footer><span>© 2021 - 2025
<a href=mailto:tbperrotta@gmail.com>Thiago Perrotta
</a>·
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ·
<a href=/index.xml>RSS</a> ·
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo ʕ•ᴥ•ʔ bear</a></span></footer></body></html>