<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title class=title>Pre-commit | ¬¨ just serendipity üçÄ</title><meta name=title content="Pre-commit">
<meta name=description content="pre-commit is a CI framework for git.
For those who are used to google3 tooling: it&rsquo;s akin to the configuration part of TAP Presubmit.
You can plug in linters, formatters, code analyzers&mldr;pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.
Once properly configured the whole pipeline can be run locally with pre-commit run. By default, only the stashed files are inspected. In order to consider every file in the repository, pass --all-files. Modified files that were not yet git added are not included."><meta name=keywords content="bestof,dev,"><meta property="og:url" content="https://perrotta.dev/2024/12/pre-commit/"><meta property="og:site_name" content="¬¨ just serendipity üçÄ"><meta property="og:title" content="Pre-commit"><meta property="og:description" content="pre-commit is a CI framework for git. For those who are used to google3 tooling: it‚Äôs akin to the configuration part of TAP Presubmit.
You can plug in linters, formatters, code analyzers‚Ä¶pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.
Once properly configured the whole pipeline can be run locally with pre-commit run. By default, only the stashed files are inspected. In order to consider every file in the repository, pass --all-files. Modified files that were not yet git added are not included."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-21T23:24:23-03:00"><meta property="article:modified_time" content="2024-12-21T23:24:23-03:00"><meta property="article:tag" content="Bestof"><meta property="article:tag" content="Dev"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pre-commit"><meta name=twitter:description content="pre-commit is a CI framework for git. For those who are used to google3 tooling: it‚Äôs akin to the configuration part of TAP Presubmit.
You can plug in linters, formatters, code analyzers‚Ä¶pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.
Once properly configured the whole pipeline can be run locally with pre-commit run. By default, only the stashed files are inspected. In order to consider every file in the repository, pass --all-files. Modified files that were not yet git added are not included."><meta itemprop=name content="Pre-commit"><meta itemprop=description content="pre-commit is a CI framework for git. For those who are used to google3 tooling: it‚Äôs akin to the configuration part of TAP Presubmit.
You can plug in linters, formatters, code analyzers‚Ä¶pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.
Once properly configured the whole pipeline can be run locally with pre-commit run. By default, only the stashed files are inspected. In order to consider every file in the repository, pass --all-files. Modified files that were not yet git added are not included."><meta itemprop=datePublished content="2024-12-21T23:24:23-03:00"><meta itemprop=dateModified content="2024-12-21T23:24:23-03:00"><meta itemprop=wordCount content="550"><meta itemprop=keywords content="Bestof,Dev"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/2024/12/pre-commit/><link rel=stylesheet href=https://perrotta.dev/theme.css><style>body{text-align:left;margin:auto}h1,h2,h3,h4,h5,h6,footer,nav{font-family:var(--font-title)}footer{font-size:smaller;padding:8px;text-align:center}a{color:var(--link-color)}a.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.4}table{width:100%}img{max-width:100%}code{background-color:var(--code-bg)}li code,p code{font-size:.9em}pre code{color:var(--heading-color);display:block;padding:25px;white-space:pre;font-size:17px;overflow-x:auto}code,pre{font-family:var(--font-code)}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:2px solid #999;color:var(--heading-color);padding-left:25px;padding-right:15px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex;gap:8px;margin-bottom:8px}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}.pubdate-list{color:var(--color-gray);font-style:italic}.pubdate-single{color:var(--color-gray);font-style:italic}.social-link-wrapper{display:flex;justify-content:center;align-items:center;gap:8px;margin-top:8px}.social-link{text-decoration:none;font-size:1.4em}sup.gray{color:var(--color-gray)}.title{font-size:38px}@media(prefers-color-scheme:dark){blockquote{color:#ccc}textarea,input{background-color:#252525;color:var(--text-color)}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.png alt="thiagowfx's avatar" width=32 height=32><h1 class=title>¬¨ just serendipity üçÄ</h1></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/coding/>Coding (new!)</a>
<a href=/tags/bestof/>‚òÖ</a></nav></header><main><h2><span>‚òÖ</span> Pre-commit</h2><p><span class=pubdate-single><time datetime=2024-12-21 pubdate>21 Dec, 2024
</time>‚Ä¢ 550 words ‚Ä¢ 3 min</span></p><content><p><a href=https://pre-commit.com/>pre-commit</a> is a CI framework for <code>git</code>.
For those who are used to google3 tooling: it&rsquo;s akin to the configuration part of <code>TAP Presubmit</code>.</p><p>You can plug in linters, formatters, code analyzers&mldr;pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.</p><p>Once properly configured the whole pipeline can be run locally with <code>pre-commit run</code>. By default, only the stashed files are inspected. In order to consider every file in the repository, pass <code>--all-files</code>. Modified files that were not yet <code>git add</code>ed are not included.</p><p>When configuring CI, the same command is used in cloud pipelines: it&rsquo;s a single configuration for both local and CI runs.</p><p>All the configuration lives in a single YAML file, <code>.pre-commit-config.yaml</code>, in the repository root.</p><p>Because it is written in Python, the whole ecosystem around the language is very well supported, first-class. That said, many other languages are also supported. For the ones that are not, there is a escape hatch ‚Äì the &ldquo;system&rdquo; language.</p><p>Here is an example <code>.pre-commit-config.yaml</code> file ‚Äì the one for this blog:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>repos</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e06c75>repo</span>: https://github.com/pre-commit/pre-commit-hooks
</span></span><span style=display:flex><span>    <span style=color:#e06c75>rev</span>: v5.0.0
</span></span><span style=display:flex><span>    <span style=color:#e06c75>hooks</span>:
</span></span><span style=display:flex><span>      <span style=color:#7f848e># keep-sorted start</span>
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: check-executables-have-shebangs
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: check-symlinks
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: check-yaml
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: detect-private-key
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: pretty-format-json
</span></span><span style=display:flex><span>        <span style=color:#e06c75>args</span>:
</span></span><span style=display:flex><span>          - --autofix
</span></span><span style=display:flex><span>          - --<span style=color:#e5c07b>no</span>-sort-keys
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: sort-simple-yaml
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: trailing-whitespace
</span></span><span style=display:flex><span>        <span style=color:#7f848e># keep-sorted end</span>
</span></span><span style=display:flex><span>  - <span style=color:#e06c75>repo</span>: https://github.com/google/keep-sorted
</span></span><span style=display:flex><span>    <span style=color:#e06c75>rev</span>: v0.5.1
</span></span><span style=display:flex><span>    <span style=color:#e06c75>hooks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: keep-sorted
</span></span><span style=display:flex><span>  - <span style=color:#e06c75>repo</span>: https://github.com/google/yamlfmt
</span></span><span style=display:flex><span>    <span style=color:#e06c75>rev</span>: v0.14.0
</span></span><span style=display:flex><span>    <span style=color:#e06c75>hooks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: yamlfmt
</span></span><span style=display:flex><span>  - <span style=color:#e06c75>repo</span>: https://github.com/codespell-project/codespell
</span></span><span style=display:flex><span>    <span style=color:#e06c75>rev</span>: v2.3.0
</span></span><span style=display:flex><span>    <span style=color:#e06c75>hooks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: codespell
</span></span><span style=display:flex><span>        <span style=color:#e06c75>exclude</span>: ^content/posts/(2014|2015|2016)|content/posts/2024-07-09-kubectl-get-secret-with-jsonpath-add-newline.md|content/posts/2024-06-27-a-little.md
</span></span><span style=display:flex><span>        <span style=color:#e06c75>args</span>:
</span></span><span style=display:flex><span>          <span style=color:#7f848e># keep-sorted start</span>
</span></span><span style=display:flex><span>          - -L=DeVault
</span></span><span style=display:flex><span>          - -L=als
</span></span><span style=display:flex><span>          - -L=ist
</span></span><span style=display:flex><span>          - -L=sive
</span></span><span style=display:flex><span>          <span style=color:#7f848e># keep-sorted end</span>
</span></span><span style=display:flex><span>  - <span style=color:#e06c75>repo</span>: https://github.com/jmlrt/check-yamlschema
</span></span><span style=display:flex><span>    <span style=color:#e06c75>rev</span>: v0.0.4
</span></span><span style=display:flex><span>    <span style=color:#e06c75>hooks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>id</span>: check-yamlschema
</span></span></code></pre></div><p>Repository versions are always pinned. You would think this is tedious, but it&rsquo;s highly desirable for reproducibility, and they can all be automatically updated with <code>pre-commit autoupdate</code>.</p><p>To run only a single hook: <code>pre-commit run [--all-files] codespell</code>.</p><p>How do you install <code>pre-commit</code> in the first place? Use <code>pip</code>, or <code>brew</code> (macOS), or your favorite package manager.</p><p>Hooks are configured in <code>.pre-commit-hooks.yaml</code> files in their respective repositories. <a href=https://github.com/codespell-project/codespell/blob/main/.pre-commit-hooks.yaml>The codespell configuration</a> is an example, from <code>codespell</code>:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#e06c75>id</span>: codespell
</span></span><span style=display:flex><span>  <span style=color:#e06c75>name</span>: codespell
</span></span><span style=display:flex><span>  <span style=color:#e06c75>description</span>: Checks for common misspellings in text files.
</span></span><span style=display:flex><span>  <span style=color:#e06c75>entry</span>: codespell
</span></span><span style=display:flex><span>  <span style=color:#e06c75>language</span>: python
</span></span><span style=display:flex><span>  <span style=color:#e06c75>types</span>: [text]
</span></span></code></pre></div><p>&mldr;it&rsquo;s just metadata that teaches the framework to run the <code>codespell</code> python file, and that it should only run in text files.</p><p>The definition of what a text file is lives in the <a href=https://github.com/pre-commit/identify>identify</a> pre-commit library, <a href=https://github.com/pre-commit/identify/blob/main/identify/extensions.py>this</a> file has all the mappings. You could also specify <code>shell</code>, for example.</p><p>What if an extension isn&rsquo;t supported? Instead of using <code>types:</code>, use <code>file:</code> with a regex pattern to match, such as <code>\.sh$</code>.</p><p>What if an upstream tool does not have a <code>.pre-commit-hooks.yaml</code> file? I wrote a <a href=https://perrotta.dev/2024/12/pre-commit-create-hooks-for-unsupported-tools/>post</a> with a workaround wherein you can define your own.</p><p>How do you try out new hooks? One way is to use <a href=https://perrotta.dev/2024/11/pre-commit-try-repo/><code>pre-commit try-repo</code></a>. Another way is to add them to your config and then run each hook individually.</p><p>Are there similar tools? There&rsquo;s <a href=https://typicode.github.io/husky/><code>husky</code></a>, but it&rsquo;s too nodejs / web centric. I like <code>pre-commit.com</code> better.</p><p>Any git repository that is owned my multiple people and need to follow well-defined practices and conventions should, in general, adopt a pre-commit framework. <code>pre-commit.com</code> is one possible solution that is great at its job.</p><h2 id=references>References</h2><ul><li><a href=https://whynothugo.nl/journal/2023/01/12/notes-on-pre-commit/>https://whynothugo.nl/journal/2023/01/12/notes-on-pre-commit/</a></li></ul></content><div style=display:flex;justify-content:space-between><p>Reply via
<a href="mailto:serendipity@perrotta.dev?subject=Reply to: Pre-commit">email</a></p><p><a href=https://perrotta.dev/tags/bestof/>#bestof</a>
<a href=https://perrotta.dev/tags/dev/>#dev</a></p></div></main><hr><footer><span>¬© 2021 - 2025 Thiago Perrotta ¬∑
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ¬∑
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo  ï‚Ä¢·¥•‚Ä¢ î bear</a></span><div class=social-link-wrapper><a target=_blank rel=noopener class=social-link href=mailto:serendipity@perrotta.dev title="Email address"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 24 24" height="1.3em" width="1.3em"><g transform="translate(0.000000,24.000000) scale(0.100000,-0.100000)"><path d="M26 191c-4-5 16-23 44-40l50-31 50 31c28 17 48 35 44 40-7 12-181 12-188 0z"/><path d="M22 103l3-58 93-3c104-3 105-3 1e2 71l-3 46-48-29-47-30-38 23c-20 13-43 27-50 31-10 6-12-5-10-51z"/></g></svg>
</a><a target=_blank rel=noopener class=social-link href=https://perrotta.dev/index.xml title="RSS feed"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 56.693 56.693" height="1em" width="1em"><path d="M3.428 31.085c6.19.0 12.009 2.418 16.382 6.816 4.381 4.398 6.793 10.256 6.793 16.492h9.539c0-18.113-14.676-32.848-32.714-32.848v9.54zM3.443 14.174c22.061.0 40.01 18.047 40.01 40.231h9.539c0-27.445-22.229-49.77-49.549-49.77v9.539zM16.634 47.741c0 3.648-2.959 6.607-6.607 6.607S3.42 51.39 3.42 47.741c0-3.65 2.958-6.607 6.606-6.607s6.608 2.957 6.608 6.607z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://github.com/thiagowfx title="Github profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://goodreads.com/user/show/7873832-thiago title="Goodreads profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 50 50" height="1em" width="1em"><path d="M25 2c-4.541.0-8.41336 1.9082151-11.017578 4.9453125C11.378203 9.9824099 10 14.07975 10 18.5s1.378203 8.517589 3.982422 11.554688C16.58664 33.091785 20.459 35 25 35c4.531588.0 8.395936-1.901605 11-4.927734V35c0 2.598543-.818503 4.764071-2.451172 6.339844C31.91616 42.915616 29.363725 44 25.5 44 17.784314 44 15 39.933333 15 36H11c0 6.066667 5.215686 12 14.5 12 4.636275.0 8.33384-1.377726 10.826172-3.783203C38.818503 41.811319 40 38.476457 40 35V18.5 3H36V6.9277344C33.395936 3.9016049 29.531588 2 25 2zm0 4c3.459.0 6.08664 1.3379255 7.982422 3.5488281C34.878203 11.759731 36 14.91225 36 18.5s-1.121797 6.740269-3.017578 8.951172C31.08664 29.662074 28.459 31 25 31s-6.08664-1.337926-7.982422-3.548828C15.121797 25.240269 14 22.08775 14 18.5s1.121797-6.740269 3.017578-8.9511719C18.91336 7.3379255 21.541 6 25 6z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://linkedin.com/in/thiagoperrotta title="LinkedIn profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 30 30" height="1.2em" width="1.2em"><path d="M24 4H6C4.895 4 4 4.895 4 6v18c0 1.105.895 2 2 2h18c1.105.0 2-.895 2-2V6c0-1.105-.895-2-2-2zM10.954 22h-2.95v-9.492h2.95V22zM9.449 11.151c-.951.0-1.72-.771-1.72-1.72s.77-1.719 1.72-1.719c.948.0 1.719.771 1.719 1.719C11.168 10.38 10.397 11.151 9.449 11.151zM22.004 22h-2.948v-4.616c0-1.101-.02-2.517-1.533-2.517-1.535.0-1.771 1.199-1.771 2.437V22h-2.948v-9.492h2.83v1.297h.04c.394-.746 1.356-1.533 2.791-1.533 2.987.0 3.539 1.966 3.539 4.522V22z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://stackoverflow.com/users/1745064/thiagowfx title="StackOverflow profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em"><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 3e2zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-2e2v39.7h2e2zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg></a></div><a target=_blank href=https://512kb.club title="512kb.club badge"><img src=https://perrotta.dev/green-team.gif alt="a proud member of the green team of 512KB club"></a></footer></body></html>