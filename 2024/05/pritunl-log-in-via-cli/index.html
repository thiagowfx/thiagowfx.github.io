<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Pritunl log in via CLI | not just serendipity</title>
<meta name=keywords content="dev,macos"><meta name=description content="Pritunl is an Enterprise Distributed OpenVPN server.
In order to run its client on macOS, an .app is provided. However, using it to
log in every day is quite tedious.
Let&rsquo;s automate it so that we can connect to the VPN with a single command."><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://www.perrotta.dev/2024/05/pritunl-log-in-via-cli/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://www.perrotta.dev/favicon.ico><link rel=apple-touch-icon href=https://www.perrotta.dev/apple-touch-icon.png><link rel=mask-icon href=https://www.perrotta.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.perrotta.dev/2024/05/pritunl-log-in-via-cli/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:url" content="https://www.perrotta.dev/2024/05/pritunl-log-in-via-cli/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="Pritunl log in via CLI"><meta property="og:description" content="Pritunl is an Enterprise Distributed OpenVPN server.
In order to run its client on macOS, an .app is provided. However, using it to log in every day is quite tedious.
Let’s automate it so that we can connect to the VPN with a single command."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-07T16:03:27+02:00"><meta property="article:modified_time" content="2024-05-07T16:03:27+02:00"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Macos"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pritunl log in via CLI"><meta name=twitter:description content="Pritunl is an Enterprise Distributed OpenVPN server.
In order to run its client on macOS, an .app is provided. However, using it to
log in every day is quite tedious.
Let&rsquo;s automate it so that we can connect to the VPN with a single command."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.perrotta.dev/posts/"},{"@type":"ListItem","position":2,"name":"Pritunl log in via CLI","item":"https://www.perrotta.dev/2024/05/pritunl-log-in-via-cli/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Pritunl log in via CLI","name":"Pritunl log in via CLI","description":"Pritunl is an Enterprise Distributed OpenVPN server.\nIn order to run its client on macOS, an .app is provided. However, using it to log in every day is quite tedious.\nLet\u0026rsquo;s automate it so that we can connect to the VPN with a single command.\n","keywords":["dev","macos"],"articleBody":"Pritunl is an Enterprise Distributed OpenVPN server.\nIn order to run its client on macOS, an .app is provided. However, using it to log in every day is quite tedious.\nLet’s automate it so that we can connect to the VPN with a single command.\nIn order to fetch the credentials in this example in a secure manner, we’ll be using 1password. pass would have worked just as fine.\nFirst, configure Pritunl via its app UI, creating a profile for your corp credentials.\nThen figure out what the profile ID you just created is:\nprofile_id=$(/Applications/Pritunl.app/Contents/Resources/pritunl-client list --json | jq -r '.[0].id') Now, create an entry in 1Password for your Pritunl credentials associated with the profile above.\nLet’s use the op official CLI tool from 1Password to fetch the password and the OTP (one-time password) for the “Pritunl (VPN)” entry (change it accordingly).\nop_id=\"$(op item get 'Pritunl (VPN)' --format json | jq -r '.id')\" password=\"$(op read \"op://private/$op_id/password\")\" otp=\"$(op item get \"$op_id\" --totp)\" Now we can use the pritunl-client to log in programmatically:\npritunl-client start \"$profile_id\" --password \"$password$otp\" Then verify it has indeed connected:\npritunl-client list The trick is that it accepts the concatenation of the password with the OTP as the password. There’s not a separate --otp flag.\nPutting everything together, we can create a function for our favorite shell:\n# Log into corp VPN pritunl_login() { local profile_id=$(/Applications/Pritunl.app/Contents/Resources/pritunl-client list --json | jq -r '.[0].id') local op_id=\"$(op item get 'Pritunl (VPN)' --format json | jq -r '.id')\" local password=\"$(op read \"op://private/$op_id/password\")\" local otp=\"$(op item get \"$op_id\" --totp)\" pritunl-client start \"$profile_id\" --password \"$password$otp\" pritunl-client list } ","wordCount":"264","inLanguage":"en","datePublished":"2024-05-07T16:03:27+02:00","dateModified":"2024-05-07T16:03:27+02:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.perrotta.dev/2024/05/pritunl-log-in-via-cli/"},"publisher":{"@type":"Person","name":"not just serendipity","logo":{"@type":"ImageObject","url":"https://www.perrotta.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.perrotta.dev/ accesskey=h title="not just serendipity (Alt + H)"><img src=https://www.perrotta.dev/apple-touch-icon.png alt aria-label=logo height=32>not just serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.perrotta.dev/posts/ title=posts><span>posts</span></a></li><li><a href=https://www.perrotta.dev/tags/bestof/ title="★ bestof"><span>★ bestof</span></a></li><li><a href=https://www.perrotta.dev/tags/serenity/ title=serenity><span>serenity</span></a></li><li><a href=https://www.perrotta.dev/archives/ title=archives><span>archives</span></a></li><li><a href=https://www.perrotta.dev/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://www.perrotta.dev/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Pritunl log in via CLI</h1><div class=post-meta><span title='2024-05-07 16:03:27 +0200 +0200'>May 7, 2024</span>&nbsp;·&nbsp;264 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p><a href=https://pritunl.com/>Pritunl</a> is an Enterprise Distributed OpenVPN server.</p><p>In order to run its client on macOS, an <code>.app</code> is provided. However, using it to
log in every day is quite tedious.</p><p>Let&rsquo;s automate it so that we can connect to the VPN with a single command.</p><p>In order to fetch the credentials in this example in a secure manner, we&rsquo;ll be
using 1password. <a href=https://www.passwordstore.org/><code>pass</code></a> would have worked just
as fine.</p><p>First, configure Pritunl via its app UI, creating a profile for your corp
credentials.</p><p>Then figure out what the profile ID you just created is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>profile_id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/Applications/Pritunl.app/Contents/Resources/pritunl-client list --json | jq -r <span style=color:#e6db74>&#39;.[0].id&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>Now, create an entry in 1Password for your Pritunl credentials associated with
the profile above.</p><p>Let&rsquo;s use the <code>op</code> official CLI tool from 1Password to fetch the password and
the OTP (one-time password) for the &ldquo;Pritunl (VPN)&rdquo; entry (change it
accordingly).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>op_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>op item get <span style=color:#e6db74>&#39;Pritunl (VPN)&#39;</span> --format json | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>password<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>op read <span style=color:#e6db74>&#34;op://private/</span>$op_id<span style=color:#e6db74>/password&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>otp<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>op item get <span style=color:#e6db74>&#34;</span>$op_id<span style=color:#e6db74>&#34;</span> --totp<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>Now we can use the <code>pritunl-client</code> to log in programmatically:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pritunl-client start <span style=color:#e6db74>&#34;</span>$profile_id<span style=color:#e6db74>&#34;</span> --password <span style=color:#e6db74>&#34;</span>$password$otp<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>Then verify it has indeed connected:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pritunl-client list
</span></span></code></pre></div><p>The trick is that it accepts the concatenation of the password with the OTP as
the password. There&rsquo;s not a separate <code>--otp</code> flag.</p><p>Putting everything together, we can create a function for our favorite shell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Log into corp VPN</span>
</span></span><span style=display:flex><span>pritunl_login<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	local profile_id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/Applications/Pritunl.app/Contents/Resources/pritunl-client list --json | jq -r <span style=color:#e6db74>&#39;.[0].id&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	local op_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>op item get <span style=color:#e6db74>&#39;Pritunl (VPN)&#39;</span> --format json | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>	local password<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>op read <span style=color:#e6db74>&#34;op://private/</span>$op_id<span style=color:#e6db74>/password&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>	local otp<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>op item get <span style=color:#e6db74>&#34;</span>$op_id<span style=color:#e6db74>&#34;</span> --totp<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	pritunl-client start <span style=color:#e6db74>&#34;</span>$profile_id<span style=color:#e6db74>&#34;</span> --password <span style=color:#e6db74>&#34;</span>$password$otp<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>	pritunl-client list
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.perrotta.dev/tags/dev/>Dev</a></li><li><a href=https://www.perrotta.dev/tags/macos/>Macos</a></li></ul></footer></article></main><footer class=footer><span>Copyright © 2021 - 2024 Thiago Perrotta · <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> · <a href=/index.xml>RSS</a> · Made with ♥ in 🇨🇦</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>