<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>not just serendipity</title><link>https://www.perrotta.dev/</link><description>Recent content on not just serendipity</description><generator>Hugo -- 0.124.0</generator><language>en-us</language><copyright>Copyright ¬© 2021 - 2024 Thiago Perrotta ¬∑ CC BY-NC-SA 4.0 ¬∑ RSS ¬∑ Made with ‚ô• in üá®üá¶</copyright><lastBuildDate>Mon, 04 Nov 2024 11:34:36 +0100</lastBuildDate><atom:link href="https://www.perrotta.dev/index.xml" rel="self" type="application/rss+xml"/><item><title>VSCode: auto restart extensions</title><link>https://www.perrotta.dev/2024/11/vscode-auto-restart-extensions/</link><pubDate>Mon, 04 Nov 2024 11:34:36 +0100</pubDate><guid>https://www.perrotta.dev/2024/11/vscode-auto-restart-extensions/</guid><description>&lt;p>Whenever I open VSCode, there are some extension updates. Every time, I need to
manually click &amp;ldquo;Extensions&amp;rdquo; in the left-side navigation bar and then &amp;ldquo;Restart&amp;rdquo;
so that the upgrades take effect.&lt;/p>
&lt;p>This should be automated.&lt;/p></description><content:encoded><![CDATA[<p>Whenever I open VSCode, there are some extension updates. Every time, I need to
manually click &ldquo;Extensions&rdquo; in the left-side navigation bar and then &ldquo;Restart&rdquo;
so that the upgrades take effect.</p>
<p>This should be automated.</p>
<p>There is a solution: add the following to your <code>settings.json</code> (<code>Cmd + ,</code>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;extensions.autoRestart&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>Documentation:</p>
<blockquote>
<p>// If activated, extensions will automatically restart following an update if
the window is not in focus.</p>
</blockquote>
<p><strong>Source</strong>: <a href="https://code.visualstudio.com/docs/getstarted/settings">https://code.visualstudio.com/docs/getstarted/settings</a></p>]]></content:encoded></item><item><title>Jellyfin Trakt plug-in</title><link>https://www.perrotta.dev/2024/11/jellyfin-trakt-plug-in/</link><pubDate>Fri, 01 Nov 2024 20:38:19 +0100</pubDate><guid>https://www.perrotta.dev/2024/11/jellyfin-trakt-plug-in/</guid><description>&lt;p>&lt;a href="https://github.com/jellyfin/jellyfin-plugin-trakt">Trakt for Jellyfin Plugin&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Available for install through the plugin catalog, Trakt for Jellyfin allows you to synchronize your watch states with ease.&lt;/p>
&lt;/blockquote></description><content:encoded><![CDATA[<p><a href="https://github.com/jellyfin/jellyfin-plugin-trakt">Trakt for Jellyfin Plugin</a>:</p>
<blockquote>
<p>Available for install through the plugin catalog, Trakt for Jellyfin allows you to synchronize your watch states with ease.</p>
</blockquote>
<p>I‚Äôve been enjoying this free plug-in.
When watching content in Jellyfin (e.g. via Android TV, or via your laptop), it automatically scrobbles<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> TV shows and movies to your Jellyfin account.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Perhaps only we millennials peruse this term, which comes from <a href="https://last.fm/">LastFM</a>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>]]></content:encoded></item><item><title>Mermaid: rich diagrams in markdown</title><link>https://www.perrotta.dev/2024/10/mermaid-rich-diagrams-in-markdown/</link><pubDate>Mon, 28 Oct 2024 15:58:39 +0100</pubDate><guid>https://www.perrotta.dev/2024/10/mermaid-rich-diagrams-in-markdown/</guid><description>&lt;p>When writing documentation in markdown e.g. for projects stored in git, adding
a system architecture or design diagram is a great way to boost its readability,
especially to unfamiliar readers.&lt;/p>
&lt;p>My favorite way to generate diagrams is with &lt;a href="https://graphviz.org/">GraphViz&lt;/a>.
It is widely available and easy to use.&lt;/p>
&lt;p>That said, &lt;a href="https://mermaid.js.org/">MermaidJS&lt;/a> has native integration with
&lt;a href="https://github.blog/developer-skills/github/include-diagrams-markdown-files-mermaid/">GitHub&lt;/a>
and &lt;a href="https://docs.gitlab.com/ee/user/markdown.html#mermaid">GitLab&lt;/a> circa &lt;a href="https://github.com/github/roadmap/issues/372">2
years ago&lt;/a>, and that&amp;rsquo;s hard to
beat. Graphviz, sadly, &lt;a href="https://forum.graphviz.org/t/github-adding-support-for-mermaid-diagrams/998">does
not&lt;/a>.&lt;/p></description><content:encoded><![CDATA[<p>When writing documentation in markdown e.g. for projects stored in git, adding
a system architecture or design diagram is a great way to boost its readability,
especially to unfamiliar readers.</p>
<p>My favorite way to generate diagrams is with <a href="https://graphviz.org/">GraphViz</a>.
It is widely available and easy to use.</p>
<p>That said, <a href="https://mermaid.js.org/">MermaidJS</a> has native integration with
<a href="https://github.blog/developer-skills/github/include-diagrams-markdown-files-mermaid/">GitHub</a>
and <a href="https://docs.gitlab.com/ee/user/markdown.html#mermaid">GitLab</a> circa <a href="https://github.com/github/roadmap/issues/372">2
years ago</a>, and that&rsquo;s hard to
beat. Graphviz, sadly, <a href="https://forum.graphviz.org/t/github-adding-support-for-mermaid-diagrams/998">does
not</a>.</p>
<p>There is a live editor for quick prototyping and iteration: <a href="https://mermaid.live/">https://mermaid.live/</a></p>
<p>Once you are happy with the result, you can easily embed it in markdown<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>:</p>
<pre><code>```mermaid
flowchart TD
A[Christmas] --&gt;|Get money| B(Go shopping)
B --&gt; C{Let me think}
C --&gt;|One| D[Laptop]
C --&gt;|Two| E[iPhone]
C --&gt;|Three| F[fa:fa-car Car]
```
</code></pre>
<p>&hellip;and it will get automatically rendered in the aforementioned git forges.</p>
<p>MermaidJS is quite intuitive to use. There is plenty of documentation for it<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>,
e.g. for graphs / flowcharts: <a href="https://mermaid.js.org/syntax/flowchart.html">https://mermaid.js.org/syntax/flowchart.html</a>.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>This is one of the examples in the official documentation.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>And, as increasingly common these days, you can always resort to GenAI for
an extra push.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>]]></content:encoded></item><item><title>Board games</title><link>https://www.perrotta.dev/2024/10/board-games/</link><pubDate>Fri, 25 Oct 2024 15:02:46 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/board-games/</guid><description>Me: Would you like to play board games next week?
Acquaintance 1: What kind of board games?
Acquaintance 2: Which board games?
Acquaintance 3: What games are you playing?
People, have some room for serendipity and spontaneity, come on. Just say yes!</description><content:encoded><![CDATA[<blockquote>
<p><strong>Me</strong>: Would you like to play board games next week?</p>
<p><strong>Acquaintance 1</strong>: What kind of board games?</p>
<p><strong>Acquaintance 2</strong>: Which board games?</p>
<p><strong>Acquaintance 3</strong>: What games are you playing?</p>
</blockquote>
<p>People, have some room for serendipity and spontaneity, <em>come on</em>. <a href="https://www.youtube.com/watch?v=8xg3vE8Ie_E"><strong>Just say
yes</strong></a>!</p>
]]></content:encoded></item><item><title>Conventional commits</title><link>https://www.perrotta.dev/2024/10/conventional-commits/</link><pubDate>Fri, 25 Oct 2024 14:43:55 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/conventional-commits/</guid><description>&lt;p>Conventional commits: &lt;a href="https://www.conventionalcommits.org/">https://www.conventionalcommits.org/&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>A specification for adding human and machine readable meaning to commit
messages&lt;/p>
&lt;p>[&amp;hellip;] a lightweight convention on top of commit messages. It provides an easy
set of rules for creating an explicit commit history; which makes it easier to
write automated tools on top of. This convention dovetails with SemVer, by
describing the features, fixes, and breaking changes made in commit messages.&lt;/p>
&lt;/blockquote></description><content:encoded><![CDATA[<p>Conventional commits: <a href="https://www.conventionalcommits.org/">https://www.conventionalcommits.org/</a>:</p>
<blockquote>
<p>A specification for adding human and machine readable meaning to commit
messages</p>
<p>[&hellip;] a lightweight convention on top of commit messages. It provides an easy
set of rules for creating an explicit commit history; which makes it easier to
write automated tools on top of. This convention dovetails with SemVer, by
describing the features, fixes, and breaking changes made in commit messages.</p>
</blockquote>
<p>It looks like the following:</p>
<pre tabindex="0"><code>&lt;type&gt;[optional scope]: &lt;description&gt;

[optional body]

[optional footer(s)]
</code></pre><p>In practice, it looks like the following:</p>
<pre tabindex="0"><code>feat(sessions): add integration with github sso

So that developers no longer need to log in with the shared admin account.

Follow-up-of: #4242
Tested: `make test`
</code></pre><p>One way to enforce it in a <code>git</code> project is with its <a href="https://pre-commit.com/">pre-commit.com</a> integration:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">repos</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">repo</span>: <span style="color:#ae81ff">https://github.com/compilerla/conventional-pre-commit</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rev</span>: <span style="color:#ae81ff">v3.4.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hooks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># https://conventionalcommits.org</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">conventional-pre-commit</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">stages</span>: [<span style="color:#ae81ff">commit-msg]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># keep-sorted start</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">base</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">chore</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">ci</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">docs</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">feat</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">fix</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">meta</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">refactor</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">test</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># keep-sorted end</span>
</span></span></code></pre></div><p>The above hook only runs in the <code>commit-msg</code> stage, which is not installed by
default via <code>pre-commit install</code>. You&rsquo;ll need to pass <code>-t commit-msg</code> to it.</p>
<p>I have mixed experiences and opinions with conventional commits in a team
setting.</p>
<p>In a <a href="https://github.com/GoogleChromeLabs/chromium-bidi">previous team</a>, it was
successfully
<a href="https://github.com/GoogleChromeLabs/chromium-bidi/pull/900">adopted</a>. It was
very easy to generate changelogs this way.</p>
<p>In other teams, only a handful of members adopted it. In this setting there
isn&rsquo;t much value in enforcing a half-adopted convention, it must be all or
nothing.</p>
<p>In repositories that I own, I tend to adopt something in-between, writing a
prefix in the commit message title.</p>]]></content:encoded></item><item><title>Check if docker image exists in registry</title><link>https://www.perrotta.dev/2024/10/check-if-docker-image-exists-in-registry/</link><pubDate>Fri, 25 Oct 2024 14:11:14 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/check-if-docker-image-exists-in-registry/</guid><description>&lt;p>Given a docker registry, image and tag, run the following command:&lt;/p></description><content:encoded><![CDATA[<p>Given a docker registry, image and tag, run the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% docker manifest inspect 9876543210.foo.ecr.us-east-1.amazonaws.com/org/image:123456789
</span></span></code></pre></div><p>If it does not exist, you&rsquo;ll see:</p>
<pre tabindex="0"><code>no such manifest: 9876543210.foo.ecr.us-east-1.amazonaws.com/org/image:123456789
</code></pre><p>Ensure you are authenticated and/or connected to the VPN in case of a private registry.</p>
<p>When using ECR (AWS&rsquo;s registry), you can authenticate this way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% which docker_login
</span></span><span style="display:flex;"><span>docker_login <span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 9876543210.foo.ecr.us-east-1.amazonaws.com
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div>]]></content:encoded></item><item><title>Performance reviews</title><link>https://www.perrotta.dev/2024/10/performance-reviews/</link><pubDate>Sun, 20 Oct 2024 12:15:14 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/performance-reviews/</guid><description>&lt;p>During performance reviews&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>, it&amp;rsquo;s handy to obtain an overview of your
accomplishments that are stored as artifacts in source control systems.&lt;/p></description><content:encoded><![CDATA[<p>During performance reviews<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, it&rsquo;s handy to obtain an overview of your
accomplishments that are stored as artifacts in source control systems.</p>
<p>Usually accomplishments for a software engineer span more than just code: design
documents, documentation, bug triage and fixes, product health initiatives,
tackling of technical debt, processes&hellip;the list is endless.</p>
<p>Nonetheless in this post I&rsquo;ll focus only in contributions in the form of code.</p>
<p>99.999% of the time this means <code>git</code> commits (and/or pull requests, if you will).</p>
<p>Other than <code>git</code>, and the <em>very very very</em> occasional mercurial (<code>hg</code>), the only
other VCS I used significantly was Google&rsquo;s Perforce / Piper.</p>
<h2 id="piper">Piper</h2>
<p>Although there are command-line tools to summarize your accomplishments, I
find the easiest way to do so is via Critique.</p>
<h3 id="your-cl-submissions">Your CL submissions</h3>
<p>Use a query like:</p>
<pre tabindex="0"><code>(author:me OR pair:me) is:submitted since:2024-01-03 to:2024-01-09
</code></pre><p>Update <code>since</code> and <code>to</code> according to the current PERF / GRAD cycle.</p>
<p>If you are a high-performer and/or send lots of LSCs (large-scale changes), the
output can be noisy. Filter it out with <code>d:{description}</code> as needed.</p>
<p>For example, to call out LSC changes in a separate section in your packet, you
may want to exclude them from your overall contributions with <code>-d:LSC</code> or
<code>-d:Rosie</code> or similar.</p>
<p><code>pair</code> is for crediting pair programming.</p>
<p><strong>Disclaimer</strong>: There is a possibility the syntax is incorrect, as I am not able
to test it at the moment.</p>
<h3 id="your-cl-reviews">Your CL reviews</h3>
<pre tabindex="0"><code>r:me is:submitted since:2024-01-03 to:2024-01-09
</code></pre><p>You&rsquo;ll likely want to call out readability reviews separately. Use something
like <code>-cc:typescript-readability-approvers</code>.</p>
<h2 id="git"><code>git</code></h2>
<p>One option is to use the web UI of your forge (GitHub, GitLab, etc).</p>
<p>I strive for a forge-agnostic solution though.</p>
<h3 id="your-pull-requests--commits">Your pull requests / commits</h3>
<p><a href="https://git-scm.com/docs/git-shortlog"><code>git shortlog</code></a> is your friend!</p>
<p>Example for this blog:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% git shortlog --author<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Thiago Perrotta&#34;</span> --since<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;6 months ago&#34;</span>  <span style="color:#75715e"># alt: --since=&#34;2024-03-01&#34;</span>
</span></span><span style="display:flex;"><span>Thiago Perrotta <span style="color:#f92672">(</span>499<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>      Initial commit
</span></span><span style="display:flex;"><span>      add gitignore: go,hugo,vim
</span></span><span style="display:flex;"><span>      hugo: add config.toml and default archetype
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>If there are multiple repositories, combine the command with <a href="https://myrepos.branchable.com/"><code>myrepos</code></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% mr run git shortlog --author<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Thiago Perrotta&#34;</span>
</span></span></code></pre></div><p>To filter out irrelevant commits, use <code>grep -v</code>. Example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% git shortlog --author<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Thiago Perrotta&#34;</span> | grep -Ev <span style="color:#e6db74">&#39;^\s*ci|^.*pre-commit&#39;</span>
</span></span></code></pre></div><p>&hellip;filters out commits that contain &ldquo;ci&rdquo; or &ldquo;pre-commit&rdquo; in the message summary.</p>
<h3 id="your-pr-reviews">Your PR reviews</h3>
<p>PR reviews are a concept from forges. From a <code>git</code> CLI perspective it would only
be possible to do so when automation adds git tags to commits e.g. <code>Reviewed-by: Thiago Perrotta &lt;thiago@example.com&gt;</code>.</p>
<p><a href="https://www.gerritcodereview.com/">Gerrit</a> does that.
<a href="https://chromium-review.googlesource.com/c/chromium/src/+/5012895">Here</a> is an
example in Chromium. In this case, one could just <code>grep</code> for <code>Reviewed-by</code> in
<code>git log</code>.</p>
<p>Otherwise: on GitHub, use a query such as <code>is:pr reviewed-by:@me</code> in the Pull
Request search tab.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>PERF, GRAD, TPG: there are all sorts of naming schemes for them.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>]]></content:encoded></item><item><title>‚òÖ prodaccess</title><link>https://www.perrotta.dev/2024/10/prodaccess/</link><pubDate>Fri, 18 Oct 2024 14:57:27 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/prodaccess/</guid><description>&lt;p>At Google we had a &lt;code>prodaccess&lt;/code> command used to log in and authenticate in all
sorts of internal corp systems&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> for 20 hours. It became a daily ritual to run
&lt;code>prodaccess&lt;/code> first thing in the morning when logging in upon unlocking our
physical workstations&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>During the pandemic, when heavily using our virtual workstations (dubbed
&lt;em>cloudtops&lt;/em>, think of an EC2 instance or a VPS) it was common to hook
&lt;code>prodaccess&lt;/code> into &lt;code>ssh&lt;/code>. There was a &lt;code>prodcertstatus&lt;/code> command that would tell
you when &lt;code>prodaccess&lt;/code> would expire. A common pattern was to modify your &lt;code>ssh&lt;/code>
startup command to automatically run &lt;code>prodaccess&lt;/code> whenever &lt;code>prodcertstatus&lt;/code>
indicated that access would expire within 2-4 hours, depending on the user&amp;rsquo;s
preference.&lt;/p>
&lt;p>Given my trained muscle memory, I wanted to continue to use this alias even in
environments other than Google:&lt;/p></description><content:encoded><![CDATA[<p>At Google we had a <code>prodaccess</code> command used to log in and authenticate in all
sorts of internal corp systems<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> for 20 hours. It became a daily ritual to run
<code>prodaccess</code> first thing in the morning when logging in upon unlocking our
physical workstations<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</p>
<p>During the pandemic, when heavily using our virtual workstations (dubbed
<em>cloudtops</em>, think of an EC2 instance or a VPS) it was common to hook
<code>prodaccess</code> into <code>ssh</code>. There was a <code>prodcertstatus</code> command that would tell
you when <code>prodaccess</code> would expire. A common pattern was to modify your <code>ssh</code>
startup command to automatically run <code>prodaccess</code> whenever <code>prodcertstatus</code>
indicated that access would expire within 2-4 hours, depending on the user&rsquo;s
preference.</p>
<p>Given my trained muscle memory, I wanted to continue to use this alias even in
environments other than Google:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% cat ~/.profile.d/functions_corp.sh
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>prodaccess<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;--&gt; VPN&#34;</span>
</span></span><span style="display:flex;"><span>	vpn_login
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;--&gt; Teleport&#34;</span>
</span></span><span style="display:flex;"><span>	teleport_login
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;--&gt; AWS&#34;</span>
</span></span><span style="display:flex;"><span>	aws_login
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;--&gt; Azure&#34;</span>
</span></span><span style="display:flex;"><span>    azure_login
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> in
</span></span><span style="display:flex;"><span>		-u|--update<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>			echo <span style="color:#e6db74">&#34;--&gt; mr&#34;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># Update all well-known corp repositories</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">(</span>cd ~/Corp <span style="color:#f92672">&amp;&amp;</span> mr update <span style="color:#f92672">&amp;&amp;</span> mr run git world<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># Package manager upgrade</span>
</span></span><span style="display:flex;"><span>			echo <span style="color:#e6db74">&#34;--&gt; sd-world&#34;</span>
</span></span><span style="display:flex;"><span>			sd-world
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			shift
</span></span><span style="display:flex;"><span>			;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		-a|--all<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>			echo <span style="color:#e6db74">&#34;--&gt; Atlas Mongo&#34;</span>
</span></span><span style="display:flex;"><span>			atlas_login
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			shift
</span></span><span style="display:flex;"><span>			;;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">esac</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Notes:</p>
<ul>
<li><code>mr</code> is <a href="https://myrepos.branchable.com/">https://myrepos.branchable.com/</a> (&ldquo;a tool to manage all your version
control repositories&rdquo;)<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></li>
<li><code>sd-world</code> was introduced in a <a href="https://www.perrotta.dev/2024/01/sd-world-perform-a-full-system-upgrade/">previous post</a>: it performs a full system upgrade</li>
<li><code>--all</code> holds services I only need / use from time to time.</li>
<li><code>shift</code> is not really needed, but IMHO it&rsquo;s a good practice (and another
ingrained habit of mine), especially when inside <code>for</code> loops</li>
<li><code>git world</code> is an alias in my <code>~/.gitconfig</code> that runs <code>git fetch --all &amp;&amp; git remote prune origin</code></li>
</ul>
<p>Every morning I invoke <code>prodaccess -u</code> when starting my work day. A few password
prompts and touch IDs later and I do not need to worry about logging in anymore
during the middle of the day, which reduces overall context switching and
stress.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Until someone in CorpEng decided it was a good idea to
<a href="https://killedbygoogle.com/">deprecate</a> it in favour of a new <code>gcert</code>
command, destroying many SWE-years of developed muscle memory.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Ah, the <em>good ol&rsquo; times</em>.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>I should write a post about it sometime.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>]]></content:encoded></item><item><title>Makefile: path to root dir</title><link>https://www.perrotta.dev/2024/10/makefile-path-to-root-dir/</link><pubDate>Fri, 18 Oct 2024 14:52:44 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/makefile-path-to-root-dir/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given a &lt;code>Makefile&lt;/code> within &lt;code>~/git/scaffolding/Makefile&lt;/code>,
and a command that needs to run from the &lt;code>scaffolding/&lt;/code> directory, create an
&lt;code>all&lt;/code> target that works from any directory.&lt;/p></description><content:encoded><![CDATA[<p><strong>Problem statement</strong>: Given a <code>Makefile</code> within <code>~/git/scaffolding/Makefile</code>,
and a command that needs to run from the <code>scaffolding/</code> directory, create an
<code>all</code> target that works from any directory.</p>
<p><strong>Solution</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-make" data-lang="make"><span style="display:flex;"><span><span style="color:#75715e"># The directory wherein the Makefile resides.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ROOT_DIR <span style="color:#f92672">:=</span> <span style="color:#66d9ef">$(</span>patsubst %/,%,<span style="color:#66d9ef">$(</span>dir <span style="color:#66d9ef">$(</span>realpath <span style="color:#66d9ef">$(</span>lastword <span style="color:#66d9ef">$(</span>MAKEFILE_LIST<span style="color:#66d9ef">)))))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">all</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    @echo <span style="color:#66d9ef">$(</span>ROOT_DIR<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	kickstart <span style="color:#66d9ef">$(</span>ROOT_DIR<span style="color:#66d9ef">)</span>/app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> all
</span></span></code></pre></div><p><strong>Explanation</strong>:</p>
<ul>
<li>The <code>echo</code> is used only for debugging, therefore it should be removed in prod.</li>
<li>The <code>kickstart</code> command will properly run having <code>~/git/scaffolding</code> as <code>$PWD</code>
whether you invoke it from <code>~/git/scaffolding</code> or from <code>~/git</code> (via <code>make -C</code>).</li>
<li><code>pathsubst</code> is needed to remove the trailing slash (<code>/</code>) from the directory,
so that <code>$(ROOT_DIR)/</code> does not yield a double slash, which works but it is
ugly.</li>
</ul>
<p><strong>Source</strong> (adapted): <a href="https://stackoverflow.com/questions/18136918/how-to-get-current-relative-directory-of-your-makefile">https://stackoverflow.com/questions/18136918/how-to-get-current-relative-directory-of-your-makefile</a></p>]]></content:encoded></item><item><title>kubectl: list all node pods</title><link>https://www.perrotta.dev/2024/10/kubectl-list-all-node-pods/</link><pubDate>Wed, 16 Oct 2024 12:26:24 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/kubectl-list-all-node-pods/</guid><description>&lt;p>Recipe to list all pods that belong to a given node:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ kubectl get pod -o wide --field-selector spec.nodeName&lt;span style="color:#f92672">={&lt;/span>node_name&lt;span style="color:#f92672">}&lt;/span> -A
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description><content:encoded><![CDATA[<p>Recipe to list all pods that belong to a given node:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get pod -o wide --field-selector spec.nodeName<span style="color:#f92672">={</span>node_name<span style="color:#f92672">}</span> -A
</span></span></code></pre></div><p><strong>Source</strong>: <a href="https://stackoverflow.com/questions/39231880/kubernetes-api-get-pods-on-specific-nodes">https://stackoverflow.com/questions/39231880/kubernetes-api-get-pods-on-specific-nodes</a></p>
<p>This <em>ought to</em> be easier to remember&hellip;</p>]]></content:encoded></item><item><title>kubectl: force delete pods</title><link>https://www.perrotta.dev/2024/10/kubectl-force-delete-pods/</link><pubDate>Tue, 15 Oct 2024 13:14:40 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/kubectl-force-delete-pods/</guid><description>&lt;p>Our installation of &lt;code>traefik&lt;/code> via &lt;code>helm&lt;/code> got stuck today in such a way that its
pods did not terminate, even with successive &lt;code>kubectl delete&lt;/code>.&lt;/p>
&lt;p>&lt;code>--force&lt;/code> did not work either :mildshock:&lt;/p></description><content:encoded><![CDATA[<p>Our installation of <code>traefik</code> via <code>helm</code> got stuck today in such a way that its
pods did not terminate, even with successive <code>kubectl delete</code>.</p>
<p><code>--force</code> did not work either :mildshock:</p>
<p><code>--grace-period=0</code> (alongside <code>--force</code>) did the trick:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl delete pod traefik-<span style="color:#f92672">{</span>...<span style="color:#f92672">}</span> --grace-period<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> --force --namespace kube-system
</span></span></code></pre></div><p><strong>Source</strong>: <a href="https://stackoverflow.com/questions/35453792/pods-stuck-in-terminating-status">https://stackoverflow.com/questions/35453792/pods-stuck-in-terminating-status</a></p>]]></content:encoded></item><item><title>‚òÖ New series: Raspberry Pi fun with DevOps</title><link>https://www.perrotta.dev/2024/10/new-series-raspberry-pi-fun-with-devops/</link><pubDate>Sun, 13 Oct 2024 11:31:13 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/new-series-raspberry-pi-fun-with-devops/</guid><description>&lt;h2 id="intro">Intro&lt;/h2>
&lt;p>I have two raspberry pi&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> units sitting idle at home, a 3B and a 4.&lt;/p>
&lt;p>For a long time I‚Äôve been wanting to do something useful with them,
while increasing my DevOps toolkit knowledge.&lt;/p></description><content:encoded><![CDATA[<h2 id="intro">Intro</h2>
<p>I have two raspberry pi<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> units sitting idle at home, a 3B and a 4.</p>
<p>For a long time I‚Äôve been wanting to do something useful with them,
while increasing my DevOps toolkit knowledge.</p>
<p>The roadblock to do so was the most classic excuse: lack of non-interrupted time.</p>
<p>There‚Äôs plenty of motivation, and ideas. These will likely <em>never</em> run out, any time soon.</p>
<p>That said: It‚Äôs very easy to get distracted and lose focus.
There is so much information today, in the form of
YouTube videos,
blog posts,
forums and communities (e.g. the likes of Hacker News and Reddit),
podcasts,
books‚Ä¶the list goes on, and it does not end.</p>
<p>Therefore, for the sake of fixing a North Star path,
I wanted to make an initial blog post with some of the ideas that are currently in my head.</p>
<p>There‚Äôs no guarantee I will follow up on all of these ideas but,
as long as their spirit is ingrained in semi-permanent written form,
I figured that shall be enough to make me accountable to myself.</p>
<h2 id="guiding-principles">Guiding principles</h2>
<p><em>a.k.a. rules of engagement</em></p>
<ol>
<li>It must run Unix</li>
</ol>
<p>No Windows. No macOS. Anything else is fair game. Corollary: It must run either Linux or BSD.</p>
<ol start="2">
<li>It must be vanilla / upstream</li>
</ol>
<p>No spin-offs. For example: for Ubuntu, no Xubuntu. For Arch Linux, no Manjaro. For Gentoo, no Funtoo.
And so on. Stick to the <em>core</em> / base Linux distributions.
For BSD, this is a non-issue.</p>
<ol start="3">
<li>Every software installation <em>must</em> come from a package</li>
</ol>
<p>If there is no package, I will create one myself.
This is easier if I use Arch Linux or Alpine Linux, but I am willing to contribute to other distributions as well.</p>
<ol start="4">
<li>It must have no X11 nor Wayland nor a graphical system</li>
</ol>
<p>It should be a pure server.
In the past I ran RaspberryPi OS (ne√© Raspbian) and it wasn‚Äôt very useful, besides being super slow and sluggish.</p>
<ol start="5">
<li>Software updates must happen with a single command</li>
</ol>
<p>There is no need for auto-updates (these are often not well-supported anyways), but a human operator should be able to upgrade
<em>everything</em> in a single shot. It doesn‚Äôt have to be a single command (e.g. <code>apt update</code> + <code>apt upgrade</code> is acceptable), but it
should be contained within a short script.</p>
<ol start="6">
<li>It should be reasonably popular and well-supported</li>
</ol>
<p>No obscure distributions.
I don‚Äôt particularly care about a sizeable community (I won‚Äôt join their Discord server nor Reddit community anyway),
but there should be at least one official support channel, and it would be preferred that it is old-school (BBS / Discourse / forums, mailing lists, IRC / Matrix).
Stack Exchange is also acceptable to an extent.
The problem with the modern stuff (Discord, Reddit) is that it is too proprietary, can / will disappear at any moment, and will be heavily used to train LLMs with no scrutiny.
Commercial support is fine. For example, Red Hat backing Fedora, Canonical backing Ubuntu, and SUSE backing openSUSE is a non-issue.
I would just avoid commercial enterprises that suffocate their open counterparts.</p>
<ol start="7">
<li>It should support Raspberry Pi (the ARM architecture, for that matter) as a first-class citizen</li>
</ol>
<p>If Raspberry Pi support is considered experimental, I would avoid the trouble at this time.</p>
<p>Stopping briefly here for a moment, the following list comes to mind, using <a href="https://distrowatch.com/">DistroWatch</a> and <a href="https://en.m.wikipedia.org/wiki/File:Linux_Distribution_Timeline.svg">Linux Distribution timeline</a> as an aid:</p>
<ul>
<li>Debian
<ul>
<li>RaspberryPi OS</li>
</ul>
</li>
<li>Ubuntu</li>
<li>Fedora</li>
<li>openSUSE</li>
<li>Alpine Linux</li>
<li>Arch Linux (Arch Linux ARM)</li>
<li>Void Linux</li>
<li>Gentoo</li>
<li>NixOS</li>
<li>FreeBSD</li>
<li>OpenBSD</li>
<li>Slackware Linux</li>
</ul>
<p>This list is still quite large.
I will need to trim it down further in the following days. Stay tuned.</p>
<p>Some observations before I make a final decision:</p>
<ul>
<li>I have two units, so one decision to make is whether to choose the same distribution for both or distinct distributions for each. One Linux and one BSD, for example.</li>
<li>I never used the following distros: Void Linux, NixOS, OpenBSD, Slackware Linux. There‚Äôs always an appeal to trying out something new, even if just ephemerally.</li>
<li>I am heavily experienced in Debian / Ubuntu, Arch and Alpine (with a tad of Gentoo as well). There‚Äôs an appeal to using something I am already familiar with to get the OS out of the way, and thus focus more on DevOps.</li>
<li>NixOS is very tempting for the purposes of reproducibility, but every time I look at it I feel lost in its sea of complexity. And it oftentimes feels bloated. Reproducibility comes with a non-trivial upfront cost.</li>
<li>OpenBSD feels very tempting as a self-contained, ‚Äúdo one thing and do it well‚Äù, KISS &amp; secure system. It lacks on integration with third-party software, but perhaps that‚Äôs a feature.</li>
<li>Let‚Äôs be honest, as much as Slackware has its charm, realistically I am not choosing it. Its ecosystem is too small today. It doesn‚Äôt provide any value when compared to the rest of the list. Between Slack and Alpine, I‚Äôd easily pick Alpine with no effort.</li>
</ul>
<p>Hence we can already eliminate one: <del>Slackware Linux</del>.</p>
<p>To be continued ‚ñ†</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><em>Two units</em> is a safer choice than ‚Äúraspberry pies‚Äù or ‚Äúraspberry pis‚Äù.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>]]></content:encoded></item><item><title>cdg: change directory to the git root</title><link>https://www.perrotta.dev/2024/10/cdg-change-directory-to-the-git-root/</link><pubDate>Fri, 11 Oct 2024 12:01:48 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/cdg-change-directory-to-the-git-root/</guid><description>&lt;p>Shell:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>alias cdg&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;cd &amp;#34;$(git root)&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>~/.gitconfig&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>[alias]
root = rev-parse --show-toplevel
&lt;/code>&lt;/pre></description><content:encoded><![CDATA[<p>Shell:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>alias cdg<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cd &#34;$(git root)&#34;&#39;</span>
</span></span></code></pre></div><p><code>~/.gitconfig</code>:</p>
<pre tabindex="0"><code>[alias]
  root = rev-parse --show-toplevel
</code></pre><p>Sadly it is not possible to do so with a git alias, c.f. <a href="https://stackoverflow.com/questions/19032372/git-alias-for-shell-command-to-cd-into-git-root-not-working-as-expected">https://stackoverflow.com/questions/19032372/git-alias-for-shell-command-to-cd-into-git-root-not-working-as-expected</a>:</p>
<blockquote>
<p>Your shell is invoking Git, and Git is invoking another shell in which to run
your cd command. This command is successful, and this changes the working
directory of the child shell, but it does not change the working directory of
Git, nor of the parent shell.</p>
<p>In order to do this you need to run the command in your current shell, which
means that invoking Git will not be able to accomplish this. You will have to
continue using a shell alias.</p>
</blockquote>
<p>Since we cannot change directory with a git alias, then at least we can use one
to print the repository root.</p>]]></content:encoded></item><item><title>Convert JSON to YAML</title><link>https://www.perrotta.dev/2024/10/convert-json-to-yaml/</link><pubDate>Fri, 11 Oct 2024 11:47:50 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/convert-json-to-yaml/</guid><description>&lt;p>Given a YAML file that is effectively JSON, convert it to YAML format.&lt;/p></description><content:encoded><![CDATA[<p>Given a YAML file that is effectively JSON, convert it to YAML format.</p>
<h2 id="input">Input</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% cat file.yaml
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;The Big Bang Theory&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;characters&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Sheldon&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Leonard&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="output">Output</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% yq -i -P file.yaml
</span></span><span style="display:flex;"><span>% cat file.yaml
</span></span><span style="display:flex;"><span>title: The Big Bang Theory
</span></span><span style="display:flex;"><span>characters:
</span></span><span style="display:flex;"><span>  - name: Sheldon
</span></span><span style="display:flex;"><span>  - name: Leonard
</span></span></code></pre></div><p><a href="https://github.com/mikefarah/yq"><code>yq</code></a> is like <code>jq</code> for YAML.</p>
<p><code>-i</code> is for in-place modification<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, <code>-P</code> is for pretty-printing.</p>
<p>If you don‚Äôt know about <code>-i</code>, you can always use <a href="https://joeyh.name/code/moreutils/"><code>sponge</code></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% yq -P file.yaml | sponge file.yaml
</span></span></code></pre></div><p>Happy YAML‚Äôing!</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>In this context avoid using <code>&gt;</code> output redirection because it would mangle the input file. Unless you redirect to another file, of course.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>]]></content:encoded></item><item><title>git misspellings</title><link>https://www.perrotta.dev/2024/10/git-misspellings/</link><pubDate>Thu, 10 Oct 2024 13:26:57 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/git-misspellings/</guid><description>Buried into a ~/.bashrc far away&amp;hellip;1
# misspellings for git alias t=git alias it=git alias gi=git alias gt=git alias gti=git History makes no mistake: all these have occurred at least once.&amp;#160;&amp;#x21a9;&amp;#xfe0e;</description><content:encoded><![CDATA[<p>Buried into a <code>~/.bashrc</code> far away&hellip;<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<pre tabindex="0"><code># misspellings for git
alias t=git
alias it=git
alias gi=git
alias gt=git
alias gti=git
</code></pre><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>History makes <em>no mistake</em>: all these have occurred at least once.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded></item><item><title>New APKBUILD: argocd</title><link>https://www.perrotta.dev/2024/10/new-apkbuild-argocd/</link><pubDate>Wed, 09 Oct 2024 23:03:32 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/new-apkbuild-argocd/</guid><description>&lt;p>&lt;a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD&lt;/a> is a widely used GitOps
software for Kubernetes Continuous Delivery (see
&lt;a href="https://github.com/argoproj/argo-cd/blob/master/USERS.md">USERS.md&lt;/a>).&lt;/p>
&lt;p>I am quite surprised no one bothered to create an Alpine Linux package for it.&lt;/p>
&lt;p>Until&amp;hellip;&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/73305">now&lt;/a>,
by yours truly.&lt;/p></description><content:encoded><![CDATA[<p><a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD</a> is a widely used GitOps
software for Kubernetes Continuous Delivery (see
<a href="https://github.com/argoproj/argo-cd/blob/master/USERS.md">USERS.md</a>).</p>
<p>I am quite surprised no one bothered to create an Alpine Linux package for it.</p>
<p>Until&hellip;<a href="https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/73305">now</a>,
by yours truly.</p>
<p>This <code>APKBUILD</code> took a bit longer to create than the usual.
There were a couple of issues with <code>-buildmode=pie</code>, addressed with
<code>export CGO_ENABLED=1</code> (via <code>make CGO_FLAG=1</code>).</p>
<p>Also, not every architecture is compatible with it. The following error message
appears in ARM builds:</p>
<pre tabindex="0"><code>cannot use math.MaxInt64 (untyped int constant 9223372036854775807) as int value in argument to env.ParseNumFromEnv (overflows)
</code></pre><p>Anyway, once it is merged upstream, enjoy!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% doas apk add argocd
</span></span></code></pre></div>]]></content:encoded></item><item><title>Exponential Idle</title><link>https://www.perrotta.dev/2024/10/exponential-idle/</link><pubDate>Mon, 07 Oct 2024 23:26:14 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/exponential-idle/</guid><description>&lt;p>&lt;a href="https://conicgames.github.io/exponentialidle/">Exponential Idle&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Exponential Idle is a math-inspired incremental game available on Android and iOS. Your goal is to stack up money by taking advantage of exponential growth. To do so, you have to step through time by tapping the equation or simply let the time follow its course. You can perform change of variables to accelerate the process, buy upgrades, get rewards, and unlock achievements while earning virtual money.&lt;/p>
&lt;/blockquote></description><content:encoded><![CDATA[<p><a href="https://conicgames.github.io/exponentialidle/">Exponential Idle</a>:</p>
<blockquote>
<p>Exponential Idle is a math-inspired incremental game available on Android and iOS. Your goal is to stack up money by taking advantage of exponential growth. To do so, you have to step through time by tapping the equation or simply let the time follow its course. You can perform change of variables to accelerate the process, buy upgrades, get rewards, and unlock achievements while earning virtual money.</p>
</blockquote>
<p>I‚Äôve been in love with this game, it is very fun and chill.
The typography is beautiful, with LaTeX equations all over the place.</p>
<p>It‚Äôs very similar to <a href="https://www.decisionproblem.com/paperclips/index2.html">Universal Paperclips</a>, but with an academic<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> tad.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>As of the time of this post I am a Master‚Äôs student, and my thesis proposal has just been accepted!&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>]]></content:encoded></item><item><title>bash built-in date</title><link>https://www.perrotta.dev/2024/10/bash-built-in-date/</link><pubDate>Mon, 07 Oct 2024 15:12:20 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/bash-built-in-date/</guid><description>&lt;p>To format dates &lt;a href="https://www.gnu.org/software/coreutils/manual/html_node/Examples-of-date.html">GNU
date&lt;/a>
is often used:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ date &lt;span style="color:#e6db74">&amp;#39;+%Y-%m-%d&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2024-10-07
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It turns out bash (&amp;gt;=4.2) has this feature built-in as part of &lt;code>printf&lt;/code>:&lt;/p></description><content:encoded><![CDATA[<p>To format dates <a href="https://www.gnu.org/software/coreutils/manual/html_node/Examples-of-date.html">GNU
date</a>
is often used:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ date <span style="color:#e6db74">&#39;+%Y-%m-%d&#39;</span>
</span></span><span style="display:flex;"><span>2024-10-07
</span></span></code></pre></div><p>It turns out bash (&gt;=4.2) has this feature built-in as part of <code>printf</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ printf <span style="color:#e6db74">&#39;%(%Y-%m-%d)T\n&#39;</span>
</span></span><span style="display:flex;"><span>2024-10-07
</span></span></code></pre></div><p>It does not work on <code>zsh</code> though:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% printf <span style="color:#e6db74">&#39;%(%Y-%m-%d)T\n&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>printf: %<span style="color:#f92672">(</span>: invalid directive
</span></span></code></pre></div><p><strong>Source</strong>: <a href="https://blog.marco.ninja/notes/technology/linux/working-with-dates-in-bash-and-other-shells/">https://blog.marco.ninja/notes/technology/linux/working-with-dates-in-bash-and-other-shells/</a></p>]]></content:encoded></item><item><title>cdtmp: change to a temporary directory</title><link>https://www.perrotta.dev/2024/10/cdtmp-change-to-a-temporary-directory/</link><pubDate>Mon, 07 Oct 2024 10:40:37 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/cdtmp-change-to-a-temporary-directory/</guid><description>&lt;p>Sometimes I need to do random experimentation in a throwaway directory.&lt;/p>
&lt;p>For that, I have the following &lt;code>cdtmp&lt;/code> function in my shell:&lt;/p></description><content:encoded><![CDATA[<p>Sometimes I need to do random experimentation in a throwaway directory.</p>
<p>For that, I have the following <code>cdtmp</code> function in my shell:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cdtmp <span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	builtin cd <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>mktemp -d <span style="color:#e6db74">&#34;/tmp/</span>$USER<span style="color:#e6db74">-</span><span style="color:#e6db74">${</span>1:+$1-<span style="color:#e6db74">}</span><span style="color:#66d9ef">$(</span>date +%Y-%m-%d<span style="color:#66d9ef">)</span><span style="color:#e6db74">-XXXXXX&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	builtin pwd
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Here are two example usages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% cdtmp
</span></span><span style="display:flex;"><span>/tmp/thiago-2024-10-07-V3c3Na
</span></span><span style="display:flex;"><span>thiago@thiagoperrotta-MacBook-Pro /tmp/thiago-2024-10-07-V3c3Na
</span></span><span style="display:flex;"><span>% cdtmp devops
</span></span><span style="display:flex;"><span>/tmp/thiago-devops-2024-10-07-P4W1fh
</span></span></code></pre></div><p>This idea was built upon <a href="https://frantic.im/cdtmp/">Alex Kotliarskyi&rsquo;s</a>, which
he describes as:</p>
<blockquote>
<p>It‚Äôs a super simple alias that creates a temporary directory and then jumps
into it. Here are a few examples of what I use it for:</p>
<ul>
<li>Clone a random interesting git repo to experiment with</li>
</ul>
</blockquote>
<p>I also use it for testing one-off bash, C++, golang or python scripts, for
example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>% cdtmp
</span></span><span style="display:flex;"><span>/tmp/thiago-2024-10-07-F5aFrJ
</span></span><span style="display:flex;"><span>thiago@thiagoperrotta-MacBook-Pro /tmp/thiago-2024-10-07-F5aFrJ
</span></span><span style="display:flex;"><span>% vim main.sh
</span></span><span style="display:flex;"><span>thiago@thiagoperrotta-MacBook-Pro /tmp/thiago-2024-10-07-F5aFrJ
</span></span><span style="display:flex;"><span>% bash main.sh
</span></span><span style="display:flex;"><span>hello world
</span></span></code></pre></div><p><a href="https://github.com/thiagowfx/.dotfiles/blob/3645ea5811d07c9f4be3cea91c0ffaf43ba4071c/profile/.profile.d/functions.sh#L5">Here</a>
is the definition my dotfiles.</p>]]></content:encoded></item><item><title>Tracking cheap flights from Munich</title><link>https://www.perrotta.dev/2024/10/tracking-cheap-flights-from-munich/</link><pubDate>Sun, 06 Oct 2024 00:31:23 +0200</pubDate><guid>https://www.perrotta.dev/2024/10/tracking-cheap-flights-from-munich/</guid><description>&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>I wanted to be notified whenever a flight deal from Munich&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> appeared. The
destination doesn&amp;rsquo;t really matter.&lt;/p></description><content:encoded><![CDATA[<h2 id="overview">Overview</h2>
<p>I wanted to be notified whenever a flight deal from Munich<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> appeared. The
destination doesn&rsquo;t really matter.</p>
<p>There are several ways to do so semi-automatically, I tried all of them at least
once:</p>
<ul>
<li>follow travel blogs</li>
<li>sign up for newsletters</li>
<li>follow instagram pages or influencers that relay promos</li>
<li>visit the websites from airlines directly</li>
<li>use bots / scraping</li>
<li>ask friends periodically</li>
<li>date a flight attendant</li>
</ul>
<p>The list above is overwhelming, and I have no time for all of it. Furthermore, I
have zero desire to inundate myself with (even) more social media posts, that
are often empty in nature.</p>
<p>Moreover I wanted to build a permanent and long-lasting solution on top of my
personal infrastructure.</p>
<p>Hence the only real options were: (i) travel blogs, (ii) newsletters, (iii)
scraping.</p>
<p>The first phase is implemented as a Telegram channel:
<a href="https://t.me/bavariabudgetbirds">https://t.me/bavariabudgetbirds</a>.</p>
<p>Whenever there are new deals my server pushes an update to the Telegram channel
above for each of them. The deals<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> are tracked via a list of curated RSS feed
subscriptions, which is filtered to only match keywords that are pertaining to
Munich. It is not perfect, but it is good enough for my purposes, virtually
marginally free to run, and needs zero maintenance.</p>
<h2 id="technical-details">Technical Details</h2>
<p>I have a VPS that runs <a href="https://www.alpinelinux.org/">Alpine Linux</a>. The VPS
provider is not important.</p>
<p>The OS runs the excellent <a href="https://miniflux.app/">Miniflux</a> app, managed via
OpenRC. In this specific deployment, there is no <code>systemd</code>, and there is no
virtualization (<code>docker</code>, <code>kubernetes</code>, etc). It is 100%
<a href="https://en.wikipedia.org/wiki/KISS_principle">KISS</a>. Miniflux is actively
developed and Alpine Linux package releases happen frequently and quickly. Even
if they do not, I have the means to create <code>APKBUILD</code>s myself when needed
(see previous posts).</p>
<p>Miniflux is populated with the list of travel blogs I follow, filtering out
non-relevant posts, polled roughly every 2 hours. There is a separate Miniflux
user for this purpose, so that my own subscriptions do not get mingled
in-between.</p>
<p>I use the Miniflux integration with Telegram to ensure that new posts are
immediately pushed to the aforementioned channel with my Telegram bot.</p>
<p>Wishlist for the future:</p>
<ol>
<li>Add the ability to integrate with websites that do not support
RSS directly and/or that block RSS readers. Examples:</li>
</ol>
<ul>
<li><a href="https://lowcost.pro/route/MUC/XXX/EN/">https://lowcost.pro/route/MUC/XXX/EN/</a></li>
<li><a href="https://www.secretflying.com/posts/category/cities-countries/germany/">https://www.secretflying.com/posts/category/cities-countries/germany/</a></li>
<li><a href="https://www.trabber.de/en/flights-from-germany-de/">https://www.trabber.de/en/flights-from-germany-de/</a></li>
</ul>
<ol start="2">
<li>Convert newsletters-only sources to RSS feeds.</li>
</ol>
<p>This solution can easily be generalized for any location; there is absolutely
nothing special about Munich in this context.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Munich, Memmingen or Nuremberg (N√ºrnberg)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Blog posts, really.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>]]></content:encoded></item></channel></rss>