# See https://prek.j178.dev for more information
# Migrated from pre-commit to prek: https://prek.j178.dev/benchmark/
#
# Install prek itself:
#   $ cargo install prek
#     OR
#   $ brew install prek
#
# Update all prek hooks to latest version:
#   $ prek auto-update
#
# Install all default prek hooks locally:
#   $ prek install
#
# Apply a given prek hook to all files:
#   $ prek run --all-files <id>
#
# Apply all prek hooks to all files:
#   $ prek run --all-files
exclude: ^(layouts/partials/openring.html$|schemas|static/vendor|vendor)/ # vendored files
ci:
  autoupdate_schedule: monthly
  skip:
    # missing deps: just, hugo
    - check-yamlschema
    - hugo
    - just-format
repos:
  - repo: meta
    hooks:
      - id: check-hooks-apply
      - id: check-useless-excludes
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: 3e8a8703264a2f4a69428a0aa4dcb512790b2c8c # frozen: v6.0.0
    hooks:
      # keep-sorted start
      - id: check-added-large-files
      - id: check-case-conflict
      - id: check-executables-have-shebangs
      - id: check-json
        exclude: ^layouts/
      - id: check-merge-conflict
      - id: check-yaml
      - id: destroyed-symlinks
      - id: detect-aws-credentials
        args:
          - --allow-missing-credentials
      - id: detect-private-key
      - id: end-of-file-fixer
      - id: trailing-whitespace
        exclude: ^\.gitignore$
        # keep-sorted end
  - repo: https://github.com/codespell-project/codespell
    rev: 63c8f8312b7559622c0d82815639671ae42132ac # frozen: v2.4.1
    hooks:
      - id: codespell
        exclude: ^(content/posts/(2014|2015|2016)|content/posts/2024-07-09-kubectl-get-secret-with-jsonpath-add-newline.md|content/posts/2024-06-27-a-little.md|content/posts/2024-12-22-new-post-workflow.md|content/posts/2025-01-13-pare-de-receber-telemarketing-não-me-perturbe.md)
        args:
          - -D .codespell-dictionary.txt
          - -I .codespell-ignore-words.txt
  - repo: https://github.com/golangci/misspell
    rev: e78f9b6cd537559a24525b6ea7e182794edfd31f # frozen: v0.7.0
    hooks:
      - id: misspell
        exclude: ^content/posts/201.*
        stages:
          # False positives in posts in Portuguese.
          - manual
  - repo: https://github.com/danielhoherd/pre-commit-hooks
    rev: cd52caebd1b25fedf9dda95e4e33dcac37e146e8
    hooks:
      - id: remove-unicode-left-to-right-mark
        exclude: ^content/posts/2024-01-16-why-do-you-need-to-know-my-last-name.md$
      - id: remove-unicode-zero-width-non-breaking-spaces
      - id: remove-unicode-zero-width-space
        exclude: ^content/posts/2024-01-16-why-do-you-need-to-know-my-last-name.md$
      - id: replace-greek-question-mark
      - id: replace-unicode-non-breaking-spaces
  - repo: https://github.com/gitleaks/gitleaks
    rev: 6eaad039603a4de39fddd1cf5f727391efe9974e # frozen: v8.30.0
    hooks:
      - id: gitleaks
  - repo: https://github.com/google/keep-sorted
    rev: c71803fd297b5736f3bfab1cfd84424ca52e961a # frozen: v0.7.1
    hooks:
      - id: keep-sorted
  - repo: https://github.com/google/yamlfmt
    rev: 21ca5323a9c87ee37a434e0ca908efc0a89daa07 # frozen: v0.21.0
    hooks:
      - id: yamlfmt
  - repo: https://github.com/oxipng/oxipng
    rev: d54e7c04ea58170167d95d9b2b2ec07571602fe2 # frozen: v10.1.0
    hooks:
      - id: oxipng
  - repo: https://github.com/boidolr/pre-commit-images
    rev: 203f8ddffb198e5f9db147ebc2563b395013ab7f # frozen: v1.11.0
    hooks:
      - id: optimize-png
      - id: optimize-webp
        args:
          - --lossless
  - repo: https://github.com/stefmolin/exif-stripper
    rev: d4bae089d2e34eff041e79fee6e3385a54b08ee2 # frozen: 1.2.0
    hooks:
      - id: strip-exif
  - repo: https://github.com/sirosen/texthooks
    rev: 869eecde9a62460e123fa60b83858fac426163e8 # frozen: 0.7.1
    hooks:
      - id: fix-ligatures
      - id: fix-smartquotes
  # Only run it every once in a while.
  - repo: https://github.com/tcort/markdown-link-check
    rev: 3a8992dcbb083a248671812c7027b6995ef88523 # frozen: v3.14.2
    hooks:
      - id: markdown-link-check
        files: "^content/posts/2025-.*"
        args:
          - -q
        stages:
          # It's an expensive hook. Only run it occasionally.
          - manual
  - repo: https://github.com/thiagowfx/pre-commit-hooks
    rev: 528e165cff8a11bc4f9f49a9b25f3249e09e4237 # frozen: v0.0.22
    hooks:
      - id: forbid-colon-filenames
      - id: just-format
  - repo: https://github.com/rbubley/mirrors-prettier
    rev: c2bc67fe8f8f549cc489e00ba8b45aa18ee713b1 # frozen: v3.8.1
    hooks:
      - id: prettier
        types_or:
          - html
          - javascript
          - yaml
        exclude: ^layouts/
  - repo: https://github.com/thoughtworks/talisman
    rev: 12fab7055d7e640d5dae43209bafc48bf5ef1fd7 # frozen: v1.37.0
    hooks:
      - id: talisman-commit
        entry: cmd --githook pre-commit
      - id: talisman-push
        entry: cmd --githook pre-push
  - repo: https://github.com/jmlrt/check-yamlschema
    rev: a45841f016eaecf72b3434f0687866b62bc3c3d4 # frozen: v0.0.7
    hooks:
      - id: check-yamlschema
  - repo: https://github.com/zimbatm/mdsh
    rev: 4b8fb1e7b52a65d6ea875ede3272ac3571f5d015 # frozen: v0.9.2
    hooks:
      - id: mdsh
        files: ^README\.md$
  - repo: local
    hooks:
      # keep-sorted start
      - id: check-broken-internal-links
        name: Check for broken Hugo ref shortcode links
        entry: ci/check_broken_internal_links.py
        language: system
        types:
          - markdown
        files: ^content/posts/.*\.md$
      - id: check-coding-titles
        name: Enforce LeetCode and ByteByteGo title format
        entry: ci/check_post_titles.py
        language: system
        types:
          - markdown
        files: ^content/posts/.*(leetcode|bytebytego).*\.md$
        exclude: ^content/posts/2025-12-30-kagi-add-leetcode-bang.md$
      - id: check-duplicate-coding
        name: Detect duplicate coding problem posts
        entry: ci/check_duplicate_coding_posts.py
        language: system
        files: ^content/posts/.*(leetcode|bytebytego).*\.md$
        pass_filenames: false
      - id: check-required-frontmatter
        name: Enforce required frontmatter fields (date, title)
        entry: ci/check_required_frontmatter.py
        language: python
        types:
          - markdown
        files: ^content/posts/.*\.md$
        exclude: _index\.md$
        additional_dependencies:
          - PyYAML
      - id: check-single-category
        name: Enforce single category per post
        entry: ci/check_single_category.py
        language: python
        types:
          - markdown
        files: ^content/posts/.*\.md$
        additional_dependencies:
          - PyYAML
      - id: forbid-double-more
        name: Forbid <!--more--> in blog posts
        entry: "<!--more-->"
        language: pygrep
        types:
          - markdown
        files: ^content/posts/.*\.md$
      - id: forbid-double-parens-in-shortcodes
        name: Forbid double parentheses around Hugo shortcodes
        entry: '\(\(\{\{[<|%]'
        language: pygrep
        types:
          - markdown
      - id: forbid-external-images
        name: Forbid external image URLs in layouts
        entry: ci/forbid-external-images.py
        language: system
        files: ^layouts/.*\.html$
      - id: forbid-md-extension-in-hugo-internal-links
        name: Forbid .md extension in hugo internal links
        entry: '.*\.md\" >\}\}'
        language: pygrep
        types:
          - markdown
      - id: forbid-old-perrotta-dev
        name: Forbid old domains
        entry: '\\b(https://thiagowfx\.github\.io|www\.perrotta\.dev|blog\.perrotta\.dev)\\b'
        language: pygrep
        types_or:
          - markdown
          - yaml
        exclude: ^(content/posts/2024-02-04-new-domain.md|content/posts/2025-01-01-scan-for-markdown-broken-links-in-your-blog.md)$
      - id: forbid-personal-emails
        name: Forbid personal emails
        entry: "(@perrotta\\.dev|\\w*perrotta\\d*@gmail\\.com)"
        language: pygrep
        types:
          - markdown
      - id: forbid-tulip
        name: Forbid Tulip terms
        entry: "(?i)(\\btulip\\b|@garden)"
        language: pygrep
        types:
          - markdown
      - id: forbid-utm-analytics
        name: Forbid UTM analytics / tracking
        entry: '\\b(utm_source)\\b'
        language: pygrep
        types:
          - markdown
      - id: hugo
        name: Hugo build (quick)
        language: system
        entry: just build-quick
        pass_filenames: false
        priority: 0
      - id: replace-em-dashes
        name: Replace ' - ' with em dashes in prose
        entry: ci/replace_em_dashes.py
        language: python
        types:
          - markdown
        files: ^content/posts/.*\.md$
      - id: replace-shell-prompt
        name: Replace ❯ with % in shell prompts
        entry: ci/replace_shell_prompt.py
        language: python
        types:
          - markdown
      - id: sort-blog-tags
        name: Sort blog post tags alphabetically
        entry: ci/sort_tags.py
        language: python
        types:
          - markdown
        files: ^content/posts/.*\.md$
        additional_dependencies:
          - PyYAML
      - id: strip-content-posts-prefix
        name: Strip content/posts/ prefix from Hugo ref links
        entry: ci/strip_content_posts_prefix.py
        language: python
        types:
          - markdown
        files: ^content/posts/.*\.md$
      - id: update-json-schemas
        name: Update local JSON schemas
        language: system
        entry: |
          bash -c '
          set -e
          curl -sL -o schemas/hugo.json https://json.schemastore.org/hugo.json &&
          curl -sL -o schemas/markdownlint-config-schema.json https://raw.githubusercontent.com/DavidAnson/markdownlint/main/schema/markdownlint-config-schema.json &&
          curl -sL -o schemas/talismanrc.json https://raw.githubusercontent.com/thoughtworks/talisman/main/examples/schema-store-talismanrc.json
          '
        pass_filenames: false
        stages:
          - manual
          # keep-sorted end
  - repo: https://github.com/DavidAnson/markdownlint-cli2
    rev: 7339935a3036f096ee0d7f1f047a9ec41707d4c1 # frozen: v0.20.0
    hooks:
      - id: markdownlint-cli2
        alias: markdownlint
        exclude: ^(archetypes|plans)/
  - repo: https://github.com/adrienverge/yamllint
    rev: cba56bcde1fdd01c1deb3f945e69764c291a6530 # frozen: v1.38.0
    hooks:
      - id: yamllint
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: 745eface02aef23e168a8afb6b5737818efbea95 # frozen: v0.11.0.1
    hooks:
      - id: shellcheck
  - repo: https://github.com/woodruffw/zizmor-pre-commit
    rev: b546b77c44c466a54a42af5499dcc0dcc1a3193f # frozen: v1.22.0
    hooks:
      - id: zizmor
