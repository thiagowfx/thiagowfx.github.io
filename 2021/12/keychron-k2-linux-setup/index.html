<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><title>★ Keychron K2: Linux Setup | not just serendipity</title>
<meta name=title content="★ Keychron K2: Linux Setup"><meta name=description content="I recently purchased a Keychron K2 mechanical keyboard. It is a 75% keyboard that has bluetooth. This article describes some quality-of-life improvements to use it with a Linux system.
Note: Tested on Arch Linux only.
Kernel Module
Keychron keyboards are recognized out-of-the-box as Apple keyboards on Linux systems.
The corresponding kernel module is hid_apple.
$ modinfo hid_apple
Ensure the module is loaded within the initram for setups that use LUKS:
$ grep MODULES -B 1 /etc/mkinitcpio.conf
# hid_apple for Keychron K2
MODULES=(hid_apple)
This works for wired mode but alas it&rsquo;s not possible to use the keyboard wirelessly to type in your LUKS password unless extra steps are taken:"><meta name=keywords content="bestof★,dev,linux,"><meta property="og:url" content="https://perrotta.dev/2021/12/keychron-k2-linux-setup/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="★ Keychron K2: Linux Setup"><meta property="og:description" content="I recently purchased a Keychron K2 mechanical keyboard. It is a 75% keyboard that has bluetooth. This article describes some quality-of-life improvements to use it with a Linux system.
Note: Tested on Arch Linux only.
Kernel Module Keychron keyboards are recognized out-of-the-box as Apple keyboards on Linux systems.
The corresponding kernel module is hid_apple.
$ modinfo hid_apple Ensure the module is loaded within the initram for setups that use LUKS:
$ grep MODULES -B 1 /etc/mkinitcpio.conf # hid_apple for Keychron K2 MODULES=(hid_apple) This works for wired mode but alas it’s not possible to use the keyboard wirelessly to type in your LUKS password unless extra steps are taken:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-11T20:59:21-05:00"><meta property="article:modified_time" content="2022-01-03T00:00:00+00:00"><meta property="article:tag" content="Bestof★"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="★ Keychron K2: Linux Setup"><meta name=twitter:description content="I recently purchased a Keychron K2 mechanical keyboard. It is a 75% keyboard that has bluetooth. This article describes some quality-of-life improvements to use it with a Linux system.
Note: Tested on Arch Linux only.
Kernel Module Keychron keyboards are recognized out-of-the-box as Apple keyboards on Linux systems.
The corresponding kernel module is hid_apple.
$ modinfo hid_apple Ensure the module is loaded within the initram for setups that use LUKS:
$ grep MODULES -B 1 /etc/mkinitcpio.conf # hid_apple for Keychron K2 MODULES=(hid_apple) This works for wired mode but alas it’s not possible to use the keyboard wirelessly to type in your LUKS password unless extra steps are taken:"><meta itemprop=name content="★ Keychron K2: Linux Setup"><meta itemprop=description content="I recently purchased a Keychron K2 mechanical keyboard. It is a 75% keyboard that has bluetooth. This article describes some quality-of-life improvements to use it with a Linux system.
Note: Tested on Arch Linux only.
Kernel Module Keychron keyboards are recognized out-of-the-box as Apple keyboards on Linux systems.
The corresponding kernel module is hid_apple.
$ modinfo hid_apple Ensure the module is loaded within the initram for setups that use LUKS:
$ grep MODULES -B 1 /etc/mkinitcpio.conf # hid_apple for Keychron K2 MODULES=(hid_apple) This works for wired mode but alas it’s not possible to use the keyboard wirelessly to type in your LUKS password unless extra steps are taken:"><meta itemprop=datePublished content="2021-12-11T20:59:21-05:00"><meta itemprop=dateModified content="2022-01-03T00:00:00+00:00"><meta itemprop=wordCount content="673"><meta itemprop=keywords content="Bestof★,Dev,Linux"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}h1,h2,h3,h4,h5,h6,footer,nav{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}footer{font-size:small}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><h2>not just serendipity</h2></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/bestof/>★</a></nav></header><main><h1>★ Keychron K2: Linux Setup</h1><p><i><time datetime=2021-12-11 pubdate>11 Dec, 2021</time></i></p><content><p>I recently purchased a <a href=https://www.keychron.com/products/keychron-k2-wireless-mechanical-keyboard>Keychron K2</a> mechanical keyboard. It is a 75% keyboard that has bluetooth. This article describes some quality-of-life improvements to use it with a Linux system.</p><p><strong>Note</strong>: Tested on Arch Linux only.</p><h2 id=kernel-module>Kernel Module</h2><p>Keychron keyboards are recognized out-of-the-box as Apple keyboards on Linux systems.</p><p>The corresponding kernel module is <code>hid_apple</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ modinfo hid_apple
</span></span></code></pre></div><p>Ensure the module is loaded within the initram for setups that use LUKS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ grep MODULES -B <span style=color:#ae81ff>1</span> /etc/mkinitcpio.conf
</span></span><span style=display:flex><span><span style=color:#75715e># hid_apple for Keychron K2</span>
</span></span><span style=display:flex><span>MODULES<span style=color:#f92672>=(</span>hid_apple<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>This works for wired mode but alas it&rsquo;s not possible to use the keyboard wirelessly to type in your LUKS password unless extra steps are taken:</p><ul><li>Install the <a href=https://aur.archlinux.org/packages/mkinitcpio-bluetooth/><code>mkinitcpio-bluetooth</code></a> package, currently available in the AUR.</li><li>Add the <code>bluetooth</code> hook to your mkinitcpio, ensuring it comes before <code>encrypt</code>.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ grep HOOKS -B <span style=color:#ae81ff>1</span> /etc/mkinitcpio.conf
</span></span><span style=display:flex><span><span style=color:#75715e># bluetooth for Keychron K2</span>
</span></span><span style=display:flex><span>HOOKS<span style=color:#f92672>=(</span>base udev autodetect keyboard bluetooth modconf block encrypt filesystems resume fsck<span style=color:#f92672>)</span>
</span></span></code></pre></div><ul><li>Regenerate it: <code>% mkinitcpio -P</code>.</li></ul><h2 id=bluetooth>Bluetooth</h2><p>There are 3 bluetooth slots, corresponding to the <code>1</code>, <code>2</code> and <code>3</code> keys.</p><p>To put the keyboard in pairing mode, hold <code>Fn + &lt;n></code> for a few seconds. The key will persistently blink.
From the computer, connect to the device named <code>Keychron K2</code>. Trust the keyboard.</p><p>Switch slots by pressing <code>Fn + &lt;n></code> once. There is some light feedback to indicate the switch.</p><p>Bluetooth works well out-of-the-box, but the keyboard automatically sleeps after 10 minutes of inactivity to save energy.
While it is possible to disable this behavior, I find it welcome. It is a hassle though because the bluetooth device refuses to reconnect once the keyboard is awaken. The naive solution is to pair it again from scratch, but a better user experience is to change bluetooth settings:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat /etc/bluetooth/main.conf
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>General<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>FastConnectable<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Policy<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>UserspaceHID<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>And then restart bluetooth to apply them:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% systemctl restart bluetooth
</span></span></code></pre></div><p>This way the keyboard always automatically reconnects to the computer.</p><p>I also find it convenient to leave bluetooth enabled on startup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Enable the bluetooth daemon.</span>
</span></span><span style=display:flex><span>% systemctl enable bluetooth
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable the bluetooth adapter.</span>
</span></span><span style=display:flex><span>$ cat /etc/bluetooth/main.conf
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Policy<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>AutoEnable<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Finally, another tweak is to make the bluetooth adapter stay awake otherwise it may periodically disconnect:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat /etc/modprobe.d/btusb.conf
</span></span><span style=display:flex><span><span style=color:#75715e># Turn off bluetooth autosuspend.</span>
</span></span><span style=display:flex><span>options btusb enable_autosuspend<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h2 id=function-keys-and-multimedia-keys>Function Keys and Multimedia Keys</h2><p>The default <code>fnmode</code> is set to multimedia keys:</p><pre tabindex=0><code>0 = disabled
1 = normally media keys, switchable to function keys by holding Fn key (Default)
2 = normally function keys, switchable to media keys by holding Fn key
</code></pre><p>I prefer to set it to function keys. One of the reasons for that is to make
switching TTYs (Ctrl+Alt+Fn) possible. For some reason, Fn doesn&rsquo;t seem to work
in TTYs.</p><p>Change it in the current session only:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% echo <span style=color:#ae81ff>2</span> &gt;&gt; /sys/module/hid_apple/parameters/fnmode
</span></span></code></pre></div><p>If you do not have a root shell, use <code>sudo</code> / <code>doas</code> + <code>tee</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% echo <span style=color:#ae81ff>2</span> | sudo tee /sys/module/hid_apple/parameters/fnmode
</span></span></code></pre></div><p>Change it permanently:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat /etc/modprobe.d/hid_apple.conf
</span></span><span style=display:flex><span><span style=color:#75715e># Use function keys by default. Press Fn to use multimedia keys.</span>
</span></span><span style=display:flex><span>options hid_apple fnmode<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>And then reload the kernel module:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% modprobe -r hid_apple <span style=color:#f92672>&amp;&amp;</span> modprobe hid_apple
</span></span></code></pre></div><h2 id=insert-key>Insert Key</h2><p>By default there is no native <code>Insert</code> key. Use <code>Fn + Del</code> to trigger <code>Insert</code>. For example, <code>Fn + Shift + Del</code> works like <code>Shift + Insert</code> in X11, yielding paste selection.</p><h2 id=battery>Battery</h2><p>Check the battery level programmatically:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% pacman -S upower
</span></span><span style=display:flex><span>$ upower --dump | grep -i keyboard -A <span style=color:#ae81ff>7</span> | grep percentage
</span></span><span style=display:flex><span>    percentage:          71%
</span></span></code></pre></div><p>This only works in bluetooth mode (not in wired mode).</p><h2 id=shortcuts>Shortcuts</h2><ul><li>Hold <code>Fn + [1 | 2 | 3]</code> for a few seconds: Put bluetooth slot in pairing mode. The corresponding LED will persistently blink until pairing is complete.</li><li><code>Fn + [1 | 2 | 3]</code>: Toggle bluetooth slot. The corresponding LED will briefly blink.</li><li><code>Fn + b</code>: Check battery level visually. Green is more than 70%, blue is more than 30%, otherwise it will flash.</li><li><code>Fn + Light</code>: Toggle keyboard lights on/off.</li><li><code>Fn + [Left | Right]</code>: Browse keyboard light color schemes.</li></ul><h2 id=references>References</h2><ul><li><a href=https://wiki.archlinux.org/title/Apple_Keyboard>https://wiki.archlinux.org/title/Apple_Keyboard</a></li><li><a href=https://github.com/kurgol/keychron>https://github.com/kurgol/keychron</a></li><li><a href=https://gist.github.com/andrebrait/961cefe730f4a2c41f57911e6195e444>https://gist.github.com/andrebrait/961cefe730f4a2c41f57911e6195e444</a></li><li><a href=https://mikeshade.com/posts/keychron-linux-function-keys/>https://mikeshade.com/posts/keychron-linux-function-keys/</a></li><li><a href=https://github.com/kurgol/keychron/blob/master/k2.md>https://github.com/kurgol/keychron/blob/master/k2.md</a></li></ul></content><p><a href=https://perrotta.dev/tags/bestof/>#bestof★</a>
<a href=https://perrotta.dev/tags/dev/>#dev</a>
<a href=https://perrotta.dev/tags/linux/>#linux</a></p></main><footer><span>Copyright © 2021 - 2025 Thiago Perrotta · <a href=/index.xml>RSS</a> · a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo ʕ•ᴥ•ʔ bear</a></span></footer></body></html>