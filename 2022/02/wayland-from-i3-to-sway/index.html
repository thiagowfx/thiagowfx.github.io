<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><title>★ Wayland: from i3 to sway | not just serendipity</title>
<meta name=title content="★ Wayland: from i3 to sway"><meta name=description content="I&rsquo;ve been giving Wayland a try. My window manager of choice in X11/Xorg is i3, so the natural choice in Wayland is sway."><meta name=keywords content="linux,bestof★,"><meta property="og:url" content="https://perrotta.dev/2022/02/wayland-from-i3-to-sway/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="★ Wayland: from i3 to sway"><meta property="og:description" content="I’ve been giving Wayland a try. My window manager of choice in X11/Xorg is i3, so the natural choice in Wayland is sway."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-19T19:18:25-05:00"><meta property="article:modified_time" content="2022-02-19T19:18:25-05:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Bestof★"><meta name=twitter:card content="summary"><meta name=twitter:title content="★ Wayland: from i3 to sway"><meta name=twitter:description content="I’ve been giving Wayland a try. My window manager of choice in X11/Xorg is i3, so the natural choice in Wayland is sway."><meta itemprop=name content="★ Wayland: from i3 to sway"><meta itemprop=description content="I’ve been giving Wayland a try. My window manager of choice in X11/Xorg is i3, so the natural choice in Wayland is sway."><meta itemprop=datePublished content="2022-02-19T19:18:25-05:00"><meta itemprop=dateModified content="2022-02-19T19:18:25-05:00"><meta itemprop=wordCount content="1200"><meta itemprop=keywords content="Linux,Bestof★"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style></head><body><header><a href=/ class=title><h2>not just serendipity</h2></a><nav><a href=/>Home</a>
<a href=/posts/>Posts</a>
<a href=/tags/bestof/>★</a></nav></header><main><content><p>I&rsquo;ve been giving Wayland a try. My window manager of choice in X11/Xorg is <a href=https://i3wm.org/><code>i3</code></a>, so the natural choice in Wayland is <a href=https://swaywm.org/><code>sway</code></a>.</p><h2 id=intro>Intro</h2><p><code>sway</code> works well with the <code>i3</code> config out-of-the-box. A few adjustments were necessary for full compatibility. To maximize code reuse, I went with the following structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tree ~/.config/<span style=color:#f92672>{</span>i3,sway<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>/home/typhoon/.config/i3
</span></span><span style=display:flex><span>├── conf.d
</span></span><span style=display:flex><span>│   └── i3.conf
</span></span><span style=display:flex><span>└── config
</span></span><span style=display:flex><span>/home/typhoon/.config/sway
</span></span><span style=display:flex><span>├── conf.d
</span></span><span style=display:flex><span>│   └── sway.conf
</span></span><span style=display:flex><span>└── config -&gt; ../../../i3/.config/i3/config
</span></span></code></pre></div><ul><li>The master config is
<a href=https://github.com/thiagowfx/.dotfiles/blob/master/i3/.config/i3/config><code>~/.config/i3/config</code></a>.
It is pretty standard, generated by
<a href=https://build.i3wm.org/docs/i3-config-wizard.html><code>i3-config-wizard</code></a> with
a few tweaks on top for my own workflow. It works for both <code>i3</code> and <code>sway</code>.
The config contains this snippet:</li></ul><pre tabindex=0><code># Load user configs if existing. Order is important.
include conf.d/*.conf
</code></pre><p>The snippet allows drop-in customizations to live in <code>conf.d</code>. The <code>include</code> directive is a relatively <a href=https://github.com/i3/i3/pull/4420>new</a> addition to the i3config syntax and it&rsquo;s the main reason this setup is elegant and minimalist.</p><ul><li>i3-only config options live in <a href=https://github.com/thiagowfx/.dotfiles/blob/master/i3/.config/i3/conf.d/i3.conf><code>~/.config/i3/conf.d/i3.conf</code></a>. To give you an idea of what it looks like and which options aren&rsquo;t compatible with <code>sway</code>, here&rsquo;s a snapshot of my config in early 2022:</li></ul><pre tabindex=0><code class=language-conf data-lang=conf># i3(1) only config file
# Commands herein are not compatible or interoperable with sway(1)
# Reference: https://i3wm.org/docs/userguide.html

# Autostart XDG applications (.desktop files).
# https://wiki.archlinux.org/title/XDG_Autostart
#
# Troubleshooting:
#   dex -ade i3
exec dex --autostart --environment i3

# lock screen, Ctrl+Alt+l (systemd)
exec --no-startup-id xss-lock -l -- i3lock -c 222222
bindsym Ctrl+Mod1+l exec loginctl lock-session

# XF86AudioPlayPause is not recognized by sway, add it only to i3
# https://github.com/swaywm/sway/issues/4783
bindsym XF86AudioPlayPause exec playerctl play-pause

# show window title icon
for_window [all] title_window_icon on

set $bgcolor #526532
set_from_resource $black i3.color0
set_from_resource $red i3.color1
set_from_resource $green i3.color2
set_from_resource $white i3.color7
set_from_resource $gray i3.color8

# Theme colors
client.focused $bgcolor $bgcolor $white $green
client.focused_inactive $gray $gray $black $gray
client.unfocused $black $black $gray $black
client.urgent $red $red $white $red

# Start i3bar to display a workspace and status bar
bar {
    status_command i3status
    position top
    workspace_min_width 25

    colors {
        background $black
        statusline $white

        focused_workspace $bgcolor $bgcolor $white $black
        active_workspace $gray $gray $black $gray
        inactive_workspace $black $black $gray $gray
        urgent_workspace $red $red $white $green
    }
}

# restart i3 inplace (preserves layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart

# vim: ft=i3config
</code></pre><p>It&rsquo;s possible some of these configs will become compatible with <code>sway</code> over time, but at the time of this writing they are not.</p><ul><li>sway-only config options live in <a href=https://github.com/thiagowfx/.dotfiles/blob/master/sway/.config/sway/conf.d/sway.conf><code>~/.config/sway/conf.d/sway.conf</code></a>. To give you an idea of what it looks like and which options aren&rsquo;t compatible with i3, here&rsquo;s a snapshot of my config in early 2022:</li></ul><pre tabindex=0><code class=language-conf data-lang=conf># sway(1) only config file
# Commands herein are not compatible or interoperable with i3(1)
# References:
#   sway(5)
#   https://github.com/swaywm/sway/wiki
#   https://github.com/swaywm/sway/wiki/Useful-add-ons-for-sway

# HiDPI
output &#34;*&#34; scale 1.5

# Wallpaper
output &#34;*&#34; bg ~/.wallpaper fill

# Gaps a la i3-gaps
gaps inner 10

# XF86AudioPlayPause is not recognized by sway: xmodmap -pke | grep XF86AudioPlay
# https://github.com/swaywm/sway/issues/4783
bindcode 172 exec playerctl play-pause

# Start i3bar to display a workspace and status bar
bar {
    status_command i3status
    position top
    workspace_min_width 25
}

# restart i3 inplace (preserves layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r exec sway reload

# vim: ft=i3config
</code></pre><p>Most of those are wayland-specific options.</p><h2 id=quirks>Quirks</h2><p><code>gaps</code> is available in <code>i3</code> as well but only if you use
<a href=https://github.com/Airblader/i3><code>i3-gaps</code></a>, which generally I refuse to in
order to stay closer to vanilla/upstream <code>i3</code>.</p><p>The <code>play-pause</code> multimedia key is
a <a href=https://github.com/swaywm/sway/issues/4783>bug</a> I found on <code>sway</code>. It&rsquo;s quite
annoying, the workaround as you can see above is to use <code>bindcode</code> instead of
<code>bindsym</code>. For more details see the bug.</p><p>In general <code>sway</code> works very well out-of-the-box so long as you install
<a href=https://wayland.freedesktop.org/xserver.html>XWayland</a> (<code>xorg-xwayland</code> on
Arch Linux). XWayland <strong>transparently</strong> proxies X11 apps to a X11 server that
runs inside wayland.</p><p>It&rsquo;s possible to detect those apps by running
<a href=https://www.x.org/releases/X11R7.5/doc/man/man1/xprop.1.html><code>xprop</code></a> and
trying to click a window: If you cannot do it, then the window is not a X11
app. Alternatively
<a href=https://unix.stackexchange.com/questions/162769/what-is-the-purpose-of-xeyes><code>xeyes</code></a>
is another way to detect them.</p><p>To achieve a 100% Xorg/X11-free experience with pure wayland, just add
<code>xwayland disable</code> to the <code>sway</code> config. I wouldn&rsquo;t recommend that though, most
Linux GUI apps aren&rsquo;t Wayland ready and will probably never be. To put it
another way, X11/Xorg will take a long time (if ever) to disappear the same way
that IPv4 will take a long time (if ever) to let IPv6 completely replace it.
That&rsquo;s life.</p><p>X11 apps look a bit blurry in a 4K monitor with scaled DPI (>96) when they run
inside Wayland with XWayland. I am not particularly bothered by that, but it&rsquo;s
noticeable.</p><p>There&rsquo;s no need to replace all of your small <code>i3</code> Xorg utilities with wayland
ones. For example, <a href=https://github.com/davatorium/rofi><code>rofi</code></a> (application
launcher) works just fine (no need for <code>wofi</code>). The stock <code>i3</code> bar (<code>sway</code> bar?)
works just fine, there&rsquo;s no need for <code>polybar</code> or <code>waybar</code>.</p><p>Some utilities need to be replaced though. For example, <code>dunst</code> (notification
daemon) does not seem to work with <code>sway</code> out-of-the-box, <code>mako</code> seems to be a
recommended replacement. <code>i3lock</code> (lock screen) also does not work, <code>sway</code>
comes with its own screen lock directives. Screenshotters (e.g. <code>scrot</code>) will
also need to be replaced.</p><p>The system tray does not seem to work fine out-of-the-box. I haven&rsquo;t
investigated much to figure out what&rsquo;s wrong with it.</p><p>I was looking for a display manager that works well with both X11 and Xorg and
ended up trying <a href=https://git.sr.ht/~kennylevinsen/greetd><code>greetd</code></a>,
<a href=https://github.com/tvrzna/emptty/><code>emptty</code></a> and
<a href=https://github.com/fairyglade/ly><code>ly</code></a>, in that order. <code>ly</code> is in my opinion
the best one in terms of balancing simplicity and usefulness.</p><p><code>sway</code> / <code>XWayland</code> doesn&rsquo;t source <code>~/.Xresources</code>. This is an issue if you
rely on customizations therein. It does source <code>~/.Xdefaults</code> though!
Leveraging this, I did the following changes:</p><ul><li>(i) <code>~/.Xresources</code> sources <code>~/.Xdefaults</code>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat ~/.Xresources
</span></span><span style=display:flex><span>! These settings apply to X11 only.
</span></span><span style=display:flex><span>! Use ~/.Xdefaults <span style=color:#66d9ef>for</span> settings that apply to both X11 and Wayland <span style=color:#f92672>(</span>xorg-xwayland<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span><span style=color:#75715e>#include &#34;.Xdefaults&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>! Source:
</span></span><span style=display:flex><span>!   xrdb -merge ~/.Xresources
</span></span><span style=display:flex><span>!
</span></span><span style=display:flex><span>! Dump all properties:
</span></span><span style=display:flex><span>!   xrdb -q
</span></span><span style=display:flex><span>!
</span></span><span style=display:flex><span>! Check <span style=color:#66d9ef>if</span> DPI is set:
</span></span><span style=display:flex><span>!   xrdb -q | grep -i dpi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>! HiDPI
</span></span><span style=display:flex><span>! Common values:
</span></span><span style=display:flex><span>!   <span style=color:#ae81ff>96</span>  <span style=color:#f92672>(</span>x1.0, baseline<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>!   <span style=color:#ae81ff>144</span> <span style=color:#f92672>(</span>x1.5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>!   <span style=color:#ae81ff>192</span> <span style=color:#f92672>(</span>x2.0, HiDPI<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>*.dpi: <span style=color:#ae81ff>144</span>
</span></span></code></pre></div><ul><li>(ii) <code>~/.Xdefaults</code> holds my customizations that originally lived in <code>~/.Xresources</code>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat ~/.Xdefaults
</span></span><span style=display:flex><span>! These settings apply to both X11 and Wayland <span style=color:#f92672>(</span>xorg-xwayland<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>! Use ~/.Xresources <span style=color:#66d9ef>for</span> X11-only settings.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Xft.antialias: true
</span></span><span style=display:flex><span>Xft.hinting: true
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>In principle I could just have symlinked them:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ln -s ~/.Xresources ~/.Xdefaults
</span></span></code></pre></div><p>The reason why I didn&rsquo;t do it is to avoid double scaling (DPI). You see, my
<code>sway</code> config already sets DPI / scaling to 1.5x. If we do that in
<code>~/.Xdefaults</code> as well then Xorg applications would have been scaled twice.</p><h2 id=closing-remarks>Closing remarks</h2><p>In general Wayland / <code>sway</code> works reasonably well out-of-the-box in 2022, but
tiny adjustments are still necessary, and it isn&rsquo;t as polished as it could have
been. Furthermore, my workflow is very simple. Try sharing your screen in a
video call in Wayland and you&rsquo;ll run into other quirks. I have mixed feelings
and wouldn&rsquo;t necessarily recommend it. I wouldn&rsquo;t give an anti recommendation
either. It&rsquo;s complicated&mldr;even though Wayland is supposed to overcome some X11
/ Xorg limitations, as a client and without knowing its internals I fail to see
its advantages.</p></content><p><a href=https://perrotta.dev/tags/linux/>#linux</a>
<a href=https://perrotta.dev/tags/bestof/>#bestof★</a></p></main><footer></footer><footer><span>Copyright © 2021 - 2025 Thiago Perrotta · <a href=/index.xml>RSS</a> · <a href=https://github.com/janraasch/hugo-bearblog/>hugo ʕ•ᴥ•ʔ bear</a></span></footer></body></html>