<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Transfer bash history to zsh | not just serendipity</title><meta name=title content="Transfer bash history to zsh">
<meta name=description content="After years of using bash as my default interactive shell at $DAYJOB,
I decided to switch to zsh. I didn&rsquo;t want to start from scratch and lose all
my history though:
$ wc -l ~/.bash_history | cut -f1 -d' '
64002
Thus my goal was to first migrate all my history from bash to zsh.
The bash-to-zsh-hist.py python script in this
gist
did most of the job:
#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# This is how I used it:
# $ cat ~/.bash_history | python bash-to-zsh-hist.py >> ~/.zsh_history

import sys
import time

def main():
    timestamp = None
    for line in sys.stdin.readlines():
        line = line.rstrip('\n')
        if line.startswith('#') and timestamp is None:
            t = line[1:]
            if t.isdigit():
                timestamp = t
                continue
        else:
            sys.stdout.write(': %s:0;%s\n' % (timestamp or time.time(), line))
            timestamp = None

if __name__ == '__main__':
    main()
To use it:"><meta name=keywords content="dev,linux,"><meta property="og:url" content="https://perrotta.dev/2022/02/transfer-bash-history-to-zsh/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="Transfer bash history to zsh"><meta property="og:description" content="After years of using bash as my default interactive shell at $DAYJOB, I decided to switch to zsh. I didn’t want to start from scratch and lose all my history though:
$ wc -l ~/.bash_history | cut -f1 -d' ' 64002 Thus my goal was to first migrate all my history from bash to zsh.
The bash-to-zsh-hist.py python script in this gist did most of the job:
#!/usr/bin/env python # -*- coding: utf-8 -*- # # This is how I used it: # $ cat ~/.bash_history | python bash-to-zsh-hist.py >> ~/.zsh_history import sys import time def main(): timestamp = None for line in sys.stdin.readlines(): line = line.rstrip('\n') if line.startswith('#') and timestamp is None: t = line[1:] if t.isdigit(): timestamp = t continue else: sys.stdout.write(': %s:0;%s\n' % (timestamp or time.time(), line)) timestamp = None if __name__ == '__main__': main() To use it:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-04T21:58:50-05:00"><meta property="article:modified_time" content="2022-02-04T21:58:50-05:00"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Transfer bash history to zsh"><meta name=twitter:description content="After years of using bash as my default interactive shell at $DAYJOB, I decided to switch to zsh. I didn’t want to start from scratch and lose all my history though:
$ wc -l ~/.bash_history | cut -f1 -d' ' 64002 Thus my goal was to first migrate all my history from bash to zsh.
The bash-to-zsh-hist.py python script in this gist did most of the job:
#!/usr/bin/env python # -*- coding: utf-8 -*- # # This is how I used it: # $ cat ~/.bash_history | python bash-to-zsh-hist.py >> ~/.zsh_history import sys import time def main(): timestamp = None for line in sys.stdin.readlines(): line = line.rstrip('\n') if line.startswith('#') and timestamp is None: t = line[1:] if t.isdigit(): timestamp = t continue else: sys.stdout.write(': %s:0;%s\n' % (timestamp or time.time(), line)) timestamp = None if __name__ == '__main__': main() To use it:"><meta itemprop=name content="Transfer bash history to zsh"><meta itemprop=description content="After years of using bash as my default interactive shell at $DAYJOB, I decided to switch to zsh. I didn’t want to start from scratch and lose all my history though:
$ wc -l ~/.bash_history | cut -f1 -d' ' 64002 Thus my goal was to first migrate all my history from bash to zsh.
The bash-to-zsh-hist.py python script in this gist did most of the job:
#!/usr/bin/env python # -*- coding: utf-8 -*- # # This is how I used it: # $ cat ~/.bash_history | python bash-to-zsh-hist.py >> ~/.zsh_history import sys import time def main(): timestamp = None for line in sys.stdin.readlines(): line = line.rstrip('\n') if line.startswith('#') and timestamp is None: t = line[1:] if t.isdigit(): timestamp = t continue else: sys.stdout.write(': %s:0;%s\n' % (timestamp or time.time(), line)) timestamp = None if __name__ == '__main__': main() To use it:"><meta itemprop=datePublished content="2022-02-04T21:58:50-05:00"><meta itemprop=dateModified content="2022-02-04T21:58:50-05:00"><meta itemprop=wordCount content="208"><meta itemprop=keywords content="Dev,Linux"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/><style>body{font-family:crimson pro,vollkorn,alegreya,iowan old style,apple garamond,baskerville,times new roman,noto serif,droid serif,times,source serif pro,serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fffcf0;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}h1,h2,h3,h4,h5,h6,footer,nav{font-family:inter,fira sans,lato,system-ui,-apple-system,BlinkMacSystemFont,avenir next,avenir,segoe ui,helvetica neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}footer{font-size:small;padding:25px;text-align:center}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}li code,p code{font-size:small}pre code{color:#222;display:block;padding:20px;white-space:pre;font-size:14px;overflow-x:auto}code,pre{font-family:fira code,pt mono,ibm plex mono,Menlo,Consolas,Monaco,liberation mono,ubuntu mono,lucida console,monospace}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 110px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#01242e;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#444}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><h2>not just serendipity</h2></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/bestof/>★</a></nav></header><main><h1>Transfer bash history to zsh</h1><p><i><time datetime=2022-02-04 pubdate>04 Feb, 2022
</time>• 208 words</i></p><content><p>After years of using <code>bash</code> as my default interactive shell at $DAYJOB,
I decided to switch to <code>zsh</code>. I didn&rsquo;t want to start from scratch and lose all
my history though:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ wc -l ~/.bash_history | cut -f1 -d<span style=color:#e6db74>&#39; &#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>64002</span>
</span></span></code></pre></div><p>Thus my goal was to first migrate all my history from <code>bash</code> to <code>zsh</code>.</p><p>The <code>bash-to-zsh-hist.py</code> python script in this
<a href=https://gist.github.com/muendelezaji/c14722ab66b505a49861b8a74e52b274>gist</a>
did most of the job:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This is how I used it:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># $ cat ~/.bash_history | python bash-to-zsh-hist.py &gt;&gt; ~/.zsh_history</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    timestamp <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> sys<span style=color:#f92672>.</span>stdin<span style=color:#f92672>.</span>readlines():
</span></span><span style=display:flex><span>        line <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> line<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#39;#&#39;</span>) <span style=color:#f92672>and</span> timestamp <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            t <span style=color:#f92672>=</span> line[<span style=color:#ae81ff>1</span>:]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> t<span style=color:#f92672>.</span>isdigit():
</span></span><span style=display:flex><span>                timestamp <span style=color:#f92672>=</span> t
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            sys<span style=color:#f92672>.</span>stdout<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#39;: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>:0;</span><span style=color:#e6db74>%s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> (timestamp <span style=color:#f92672>or</span> time<span style=color:#f92672>.</span>time(), line))
</span></span><span style=display:flex><span>            timestamp <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p>To use it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ wget https://gist.githubusercontent.com/muendelezaji/c14722ab66b505a49861b8a74e52b274/raw/49f0fb7f661bdf794742257f58950d209dd6cb62/bash-to-zsh-hist.py
</span></span><span style=display:flex><span>$ chmod +x ./bash-to-zsh-hist.py
</span></span><span style=display:flex><span>$ cat .bash_history | ./bash-to-zsh-hist.py &gt;&gt; ~/.zsh_history
</span></span></code></pre></div><p>However, that didn&rsquo;t fully work. Upon running <code>zsh</code>, there was an error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ zsh
</span></span><span style=display:flex><span>zsh: corrupt history file /usr/local/google/home/tperrotta/.zsh_history
</span></span></code></pre></div><p>A quick google search led me to <a href=https://shapeshed.com/zsh-corrupt-history-file/>a blog post</a>. I adapted the command suggest therein<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ strings -eS .zsh_history | sponge .zsh_history
</span></span></code></pre></div><p>And that fixed the issue!</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><code>sponge</code> comes from the <a href=https://joeyh.name/code/moreutils/>moreutils</a> package.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></content><p><a href=https://perrotta.dev/tags/dev/>#dev</a>
<a href=https://perrotta.dev/tags/linux/>#linux</a></p></main><footer><span>© 2021 - 2025 <a href=mailto:tbperrotta@gmail.com>Thiago Perrotta</a> <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Some Rights Reserved</a> · <a href=/index.xml>RSS</a> · a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo ʕ•ᴥ•ʔ bear</a></span></footer></body></html>