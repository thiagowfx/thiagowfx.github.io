<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>nix-env in a nutshell for basic usage in macOS | not just serendipity</title><meta name=title content="nix-env in a nutshell for basic usage in macOS">
<meta name=description content="I am currently evaluating Nix as a
replacement for Homebrew CLI apps in macOS1.
Others
have
previously written about this.
My goal is to keep a sane learning curve and learn things on-the-fly, only as
needed. Nix is a massive ecosystem and has so many batteries included and
components (NixOS, NixPkgs, NixOps, Nix programming language, nix-shell,
nix-env, nix-darwin, home-manager, &mldr;). The good news is that those components
are for the most part modular, there&rsquo;s no need to adopt them all in order to
reap the benefits that Nix provides."><meta name=keywords content="dev,linux,macos,bestof★,"><meta property="og:url" content="https://perrotta.dev/2022/02/nix-env-in-a-nutshell-for-basic-usage-in-macos/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="nix-env in a nutshell for basic usage in macOS"><meta property="og:description" content="I am currently evaluating Nix as a replacement for Homebrew CLI apps in macOS1. Others have previously written about this.
My goal is to keep a sane learning curve and learn things on-the-fly, only as needed. Nix is a massive ecosystem and has so many batteries included and components (NixOS, NixPkgs, NixOps, Nix programming language, nix-shell, nix-env, nix-darwin, home-manager, …). The good news is that those components are for the most part modular, there’s no need to adopt them all in order to reap the benefits that Nix provides."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-16T20:48:02-05:00"><meta property="article:modified_time" content="2022-02-16T20:48:02-05:00"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Macos"><meta property="article:tag" content="Bestof★"><meta name=twitter:card content="summary"><meta name=twitter:title content="nix-env in a nutshell for basic usage in macOS"><meta name=twitter:description content="I am currently evaluating Nix as a replacement for Homebrew CLI apps in macOS1. Others have previously written about this.
My goal is to keep a sane learning curve and learn things on-the-fly, only as needed. Nix is a massive ecosystem and has so many batteries included and components (NixOS, NixPkgs, NixOps, Nix programming language, nix-shell, nix-env, nix-darwin, home-manager, …). The good news is that those components are for the most part modular, there’s no need to adopt them all in order to reap the benefits that Nix provides."><meta itemprop=name content="nix-env in a nutshell for basic usage in macOS"><meta itemprop=description content="I am currently evaluating Nix as a replacement for Homebrew CLI apps in macOS1. Others have previously written about this.
My goal is to keep a sane learning curve and learn things on-the-fly, only as needed. Nix is a massive ecosystem and has so many batteries included and components (NixOS, NixPkgs, NixOps, Nix programming language, nix-shell, nix-env, nix-darwin, home-manager, …). The good news is that those components are for the most part modular, there’s no need to adopt them all in order to reap the benefits that Nix provides."><meta itemprop=datePublished content="2022-02-16T20:48:02-05:00"><meta itemprop=dateModified content="2022-02-16T20:48:02-05:00"><meta itemprop=wordCount content="733"><meta itemprop=keywords content="Dev,Linux,Macos,Bestof★"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/><style>body{font-family:crimson pro,vollkorn,alegreya,iowan old style,apple garamond,baskerville,times new roman,noto serif,droid serif,times,source serif pro,serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fffcf0;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}h1,h2,h3,h4,h5,h6,footer,nav{font-family:inter,fira sans,lato,system-ui,-apple-system,BlinkMacSystemFont,avenir next,avenir,segoe ui,helvetica neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}footer{font-size:small;padding:25px;text-align:center}a{color:#3273dc}.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}li code,p code{font-size:small}pre code{color:#222;display:block;padding:20px;white-space:pre;font-size:14px;overflow-x:auto}code,pre{font-family:fira code,pt mono,ibm plex mono,Menlo,Consolas,Monaco,liberation mono,ubuntu mono,lucida console,monospace}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 110px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#01242e;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#444}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.png alt="not just serendipity" style=height:2em><h2>not just serendipity</h2></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/bestof/>★</a></nav></header><main><h1><span>★</span>
nix-env in a nutshell for basic usage in macOS</h1><p><i><time datetime=2022-02-16 pubdate>16 Feb, 2022
</time>• 733 words
• 4 minutes</i></p><content><p>I am currently evaluating <a href=https://nixos.org/download.html>Nix</a> as a
replacement for <a href=https://brew.sh>Homebrew</a> CLI apps in macOS<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.
<a href=https://wickedchicken.github.io/post/macos-nix-setup/>Others</a>
<a href=https://ianthehenry.com/posts/how-to-learn-nix/switching-from-homebrew-to-nix/>have</a>
<a href=https://ghedam.at/15490/so-tell-me-about-nix>previously</a> written about this.</p><p>My goal is to keep a sane learning curve and learn things on-the-fly, only as
needed. Nix is a massive ecosystem and has so many batteries included and
components (NixOS, NixPkgs, NixOps, Nix programming language, nix-shell,
nix-env, nix-darwin, home-manager, &mldr;). The good news is that those components
are for the most part modular, there&rsquo;s no need to adopt them all in order to
reap the benefits that Nix provides.</p><p>For now, I am only adopting <code>nix-env</code> and <code>nix-shell</code>, with no <code>*.nix</code> config
files. This post covers <code>nix-env</code>.</p><p>For simplicity, think of <code>nix-env</code> as a package manager, akin to <code>apk</code>,
<code>pacman</code>, <code>brew</code>, <code>apt</code>, <code>pkg</code>, etc.</p><h2 id=install-a-package>Install a package</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -i moreutils
</span></span><span style=display:flex><span>installing <span style=color:#e6db74>&#39;moreutils-0.67&#39;</span>
</span></span><span style=display:flex><span>building <span style=color:#e6db74>&#39;/nix/store/jsp0l5ny3kx8p9lx9w9r0x159i9jjnn6-user-environment.drv&#39;</span>...
</span></span></code></pre></div><p>I see some guides using <code>nix-env -iA</code> but <code>-i</code> seems to suffice. We could
optionally specify the <code>nixpkgs.</code> prefix:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -i nixpkgs.moreutils
</span></span><span style=display:flex><span>error: selector <span style=color:#e6db74>&#39;nixpkgs.moreutils&#39;</span> matches no derivations
</span></span></code></pre></div><p>Oh no! Maybe that&rsquo;s what the <code>-A</code> is for?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -iA nixpkgs.moreutils
</span></span><span style=display:flex><span>replacing old <span style=color:#e6db74>&#39;moreutils-0.67&#39;</span>
</span></span><span style=display:flex><span>installing <span style=color:#e6db74>&#39;moreutils-0.67&#39;</span>
</span></span></code></pre></div><p>Indeed! Apparently that <code>-A</code> thing stands for attribute. The only thing I know
is that there are both <code>nixpkgs.*</code> and <code>nixos.*</code>. But I don&rsquo;t care about NixOS
at this point. I&rsquo;ll just ignore <code>-A</code> from now on, for the time being.</p><h2 id=list-installed-packages>List installed packages</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -q
</span></span><span style=display:flex><span>moreutils-0.67
</span></span></code></pre></div><p>Easy! This actually gets displayed in my <code>less</code> pager.</p><h2 id=upgrade-installed-packages>Upgrade installed packages</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -u
</span></span></code></pre></div><p>Easy! At this point, I am not super confident whether that works as intended
though. We will find out in a few days when there&rsquo;s some update to one of my
installed CLI applications. I&rsquo;ve heard there&rsquo;s something called nix channel to
control that. Leaving it for another day though.</p><p><strong>Update(2022-02-18)</strong>: I learned that <code>nix-env -u</code> is akin to <code>apt upgrade</code> or
<code>apk upgrade</code>. It upgrades installed packages to newer versions but only if it
is aware there are newer versions. To actually refresh the repositories à la
<code>apt update</code> or <code>apk update</code>, use <code>nix-channel --update</code>.</p><p><strong>Note</strong>: On macOS this needs to be <code>sudo -i nix-channel --update</code>. See
<a href=https://github.com/NixOS/nix/issues/3595>issue</a>.</p><h2 id=uninstall-a-package>Uninstall a package</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env --uninstall moreutils
</span></span><span style=display:flex><span>uninstalling <span style=color:#e6db74>&#39;moreutils-0.67&#39;</span>
</span></span><span style=display:flex><span>building <span style=color:#e6db74>&#39;/nix/store/5k8rsf4cxg4iz7cqnqirpww6r97bwnqr-user-environment.drv&#39;</span>...
</span></span></code></pre></div><p>Easy!</p><h2 id=search-for-packages>Search for packages</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -qaP <span style=color:#e6db74>&#39;.*moreutils.*&#39;</span>
</span></span></code></pre></div><p>The <code>.*</code> seems to be needed. It works if I omit them, but only if I write the exact package name (apparently called &lsquo;derivation&rsquo; in Nix):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -qaP moreutils
</span></span><span style=display:flex><span>nixpkgs.moreutils  moreutils-0.67
</span></span></code></pre></div><p>If I write the wrong package name, the following happens:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -qaP moreutil
</span></span><span style=display:flex><span>error: selector <span style=color:#e6db74>&#39;moreutil&#39;</span> matches no derivations, maybe you meant:
</span></span><span style=display:flex><span>       moreutils
</span></span></code></pre></div><p>It was helpful in this case, but I wouldn&rsquo;t always count on that. It is a bit
annoying that there&rsquo;s no <code>nix search moreutils</code> command, but it seems that
<code>nix-env</code> is very heavily tailored to use short flags, just like <code>pacman</code> in
Arch Linux. I got used to <code>pacman</code>, hopefully I can get used to the <code>nix-env</code>
short flags at some point.</p><p>Actually I tried it out and there is a <code>nix search</code> command!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix search moreutils
</span></span><span style=display:flex><span>error: experimental Nix feature <span style=color:#e6db74>&#39;nix-command&#39;</span> is disabled; use <span style=color:#e6db74>&#39;--extra-experimental-features nix-command&#39;</span> to override
</span></span></code></pre></div><p>This isn&rsquo;t very promising though. How come searching is experimental?! Anyway, I can live with the <code>nix-env</code> form for now.</p><p>These are the 5 basic package management operations that I needed to bootstrap
my dev environment. Without putting much effort on it, my initial list of package
looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nix-env -q
</span></span><span style=display:flex><span>atool-0.39.0
</span></span><span style=display:flex><span>bash-interactive-5.1-p12
</span></span><span style=display:flex><span>coreutils-9.0
</span></span><span style=display:flex><span>exa-0.10.1
</span></span><span style=display:flex><span>fpp-0.9.2
</span></span><span style=display:flex><span>fzf-0.29.0
</span></span><span style=display:flex><span>git-2.34.1
</span></span><span style=display:flex><span>htop-3.1.2
</span></span><span style=display:flex><span>hugo-0.92.0
</span></span><span style=display:flex><span>jq-1.6
</span></span><span style=display:flex><span>less-600
</span></span><span style=display:flex><span>moreutils-0.67
</span></span><span style=display:flex><span>ncdu-1.16
</span></span><span style=display:flex><span>perl5.34.0-ack-3.5.0
</span></span><span style=display:flex><span>ranger-1.9.3
</span></span><span style=display:flex><span>stow-2.3.1
</span></span><span style=display:flex><span>tmux-3.2a
</span></span><span style=display:flex><span>tree-1.8.0
</span></span><span style=display:flex><span>vim-8.2.4186
</span></span><span style=display:flex><span>watch-procps-3.3.16
</span></span><span style=display:flex><span>wget-1.21.2
</span></span><span style=display:flex><span>zoxide-0.8.0
</span></span></code></pre></div><p>Those were very intuitive to find, with the exception of <code>ack</code> and <code>bash-interactive</code>:</p><ul><li><code>bash</code> is a bit odd because Nix splits it into two packages:
a non-interactive version and an interactive version. I have no idea why. My
<code>~/.bashrc</code> wrecked havoc with the non-interactive version.</li><li><code>ack</code> is very oddly named. Really. Also: <code>nix-env -i ack</code> doesn&rsquo;t work, but
<code>nix-env -iA nixpkgs.ack</code> does. I suspect it will be hard to ignore <code>-A</code> in
the future.</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Strictly speaking there&rsquo;s nothing special about macOS in this context.
The same setup can also be used in Linux distributions, for example, <a href=https://ariya.io/2020/05/nix-package-manager-on-ubuntu-or-debian>Debian
or Ubuntu</a>.
In fact, this is what I did at $DAYJOB, because relying solely on Debian for
package management is a very big limitation. I find that Nix complements the
Debian repositories very well, the same way that it does for macOS.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></content><p><a href=https://perrotta.dev/tags/dev/>#dev</a>
<a href=https://perrotta.dev/tags/linux/>#linux</a>
<a href=https://perrotta.dev/tags/macos/>#macos</a>
<a href=https://perrotta.dev/tags/bestof/>#bestof★</a></p></main><footer><span>© 2021 - 2025 <a href=mailto:tbperrotta@gmail.com>Thiago Perrotta</a> <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Some Rights Reserved</a> · <a href=/index.xml>RSS</a> · a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo ʕ•ᴥ•ʔ bear</a></span></footer></body></html>