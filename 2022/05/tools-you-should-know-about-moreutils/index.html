<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>★ Tools you should know about: moreutils | not just serendipity</title>
<meta name=keywords content="linux,bestof"><meta name=description content="moreutils has previously been covered elsewhere, multiple times. It&rsquo;s a collection of small unix tools that follow the unix philosophy1 very strongly.
Here are some of my favorites with example usages. Obviously this post isn&rsquo;t a manual which would have been a disservice to the community; refer to the upstream man pages for detailed instructions."><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://www.perrotta.dev/2022/05/tools-you-should-know-about-moreutils/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://www.perrotta.dev/favicon.ico><link rel=apple-touch-icon href=https://www.perrotta.dev/apple-touch-icon.png><link rel=mask-icon href=https://www.perrotta.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.perrotta.dev/2022/05/tools-you-should-know-about-moreutils/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:title" content="★ Tools you should know about: moreutils"><meta property="og:description" content="moreutils has previously been covered elsewhere, multiple times. It&rsquo;s a collection of small unix tools that follow the unix philosophy1 very strongly.
Here are some of my favorites with example usages. Obviously this post isn&rsquo;t a manual which would have been a disservice to the community; refer to the upstream man pages for detailed instructions."><meta property="og:type" content="article"><meta property="og:url" content="https://www.perrotta.dev/2022/05/tools-you-should-know-about-moreutils/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-01T13:02:51-04:00"><meta property="article:modified_time" content="2022-05-01T13:02:51-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="★ Tools you should know about: moreutils"><meta name=twitter:description content="moreutils has previously been covered elsewhere, multiple times. It&rsquo;s a collection of small unix tools that follow the unix philosophy1 very strongly.
Here are some of my favorites with example usages. Obviously this post isn&rsquo;t a manual which would have been a disservice to the community; refer to the upstream man pages for detailed instructions."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.perrotta.dev/posts/"},{"@type":"ListItem","position":2,"name":"★ Tools you should know about: moreutils","item":"https://www.perrotta.dev/2022/05/tools-you-should-know-about-moreutils/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"★ Tools you should know about: moreutils","name":"★ Tools you should know about: moreutils","description":"moreutils has previously been covered elsewhere, multiple times. It\u0026rsquo;s a collection of small unix tools that follow the unix philosophy1 very strongly.\nHere are some of my favorites with example usages. Obviously this post isn\u0026rsquo;t a manual which would have been a disservice to the community; refer to the upstream man pages for detailed instructions.\n","keywords":["linux","bestof"],"articleBody":"moreutils has previously been covered elsewhere, multiple times. It’s a collection of small unix tools that follow the unix philosophy1 very strongly.\nHere are some of my favorites with example usages. Obviously this post isn’t a manual which would have been a disservice to the community; refer to the upstream man pages for detailed instructions.\nsponge sponge(1) - soak up standard input and write to a file\nHere’s a typical workflow sponge(1) is great at:\n# Given a file $ cat myfile a b c # Imagine that for whatever reason we want to replace 'a' with 'b' # Naively, we could try this: $ cat myfile | tr 'a' 'b' \u003e myfile $ cat myfile # However the file becomes empty! # It got clobbered when we tried to simultenaously read from and write to it # sponge comes to the rescue! $ cat myfile | tr 'a' 'b' | sponge myfile $ cat myfile b b c It is great to use sponge in lieu of \u003e (shell output redirection) in shell pipelines when trying to both read from and write to the same file.\nvidir vidir(1) - edit directories and filenames\nvidir(1) is great to bulk rename files/directories within a given directory, one level at a time. For example, if I open vidir at the top-level directory of this blog repository, it opens up vim (although it doesn’t need to be vim, your $EDITOR is honoured) with the following content:\n1\t./.git 2\t./.github 3\t./.gitignore 4\t./.gitmodules 5\t./.hugo_build.lock 6\t./LICENSE 7\t./Makefile 8\t./README.md 9\t./archetypes 10\t./config.yml 11\t./content 12\t./layouts 13\t./public 14\t./resources 15\t./static 16\t./themes If I make, say, the following modifications (lines 7 and 8):\n1\t./.git 2\t./.github 3\t./.gitignore 4\t./.gitmodules 5\t./.hugo_build.lock 6\t./LICENSE 7\t./GNUMakefile 8\t./README.rst 9\t./archetypes 10\t./config.yml 11\t./content 12\t./layouts 13\t./public 14\t./resources 15\t./static 16\t./themes And then save and quit vim (:wq), then the effect would have been the same as:\n$ mv Makefile GNUMakefile $ mv README.md README.rst If I changed my mind and decided not to save the modifications, I could just do :cq.\nIt’s possible to leverage vim features such as . (repeat command) and :%s/ (find and replace) to perform those mass file renames quickly and effectively. vidir is a breeze to use!\nifne ifne(1) - Run command if the standard input is not empty\nifne(1) is effective when used with find or fd to keep shell pipes “happy”. Here’s one simple example:\n$ find . -name '*.cpp' | xargs clang-format This should work as expected, but it’s cleaner to do:\n$ find . -name '*.cpp' | ifne xargs clang-format The added ifne ensures the xargs command is only executed if and only if find yields at least one result in its output.\nThis wasn’t a very practical example though: a more realistic way to use ifne is with prototypical on-the-fly manipulation of shell pipes wherein initially you just do whatever, but then whenever you notice some command in the middle of the pipe has failed because its input was empty (=the previous pipe command output was empty) you just prepend ifne to it:\n$ this | is | a | complicated | pipe # assume \"complicated\" fails because it has no input # so we iterate and do: $ this | is | a | ifne complicated | pipe combine combine(1) - combine sets of lines from two files using boolean operations\ncombine(1) is pretty much comm(1), but much more user-friendly. Given two files file1 and file2 it makes it easy to query which lines are {unique, common} to {each, both} files, using boolean operations (or, and, not, xor). Here’s one example to find the common lines in both files, compare combine and comm:\n$ combine file1 and file2 $ comm -12 file1 file2 # flags are harder to remember The Unix philosophy emphasizes building simple, short, clear, modular, and extensible code that can be easily maintained and repurposed by developers other than its creators. The Unix philosophy favors composability as opposed to monolithic design. ↩︎\n","wordCount":"683","inLanguage":"en","datePublished":"2022-05-01T13:02:51-04:00","dateModified":"2022-05-01T13:02:51-04:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.perrotta.dev/2022/05/tools-you-should-know-about-moreutils/"},"publisher":{"@type":"Person","name":"not just serendipity","logo":{"@type":"ImageObject","url":"https://www.perrotta.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.perrotta.dev/ accesskey=h title="not just serendipity (Alt + H)"><img src=https://www.perrotta.dev/apple-touch-icon.png alt aria-label=logo height=32>not just serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.perrotta.dev/posts/ title=posts><span>posts</span></a></li><li><a href=https://www.perrotta.dev/archives/ title=archives><span>archives</span></a></li><li><a href=https://www.perrotta.dev/tags/bestof/ title=bestof><span>bestof</span></a></li><li><a href=https://www.perrotta.dev/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://www.perrotta.dev/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">★ Tools you should know about: moreutils</h1><div class=post-meta><span title='2022-05-01 13:02:51 -0400 -0400'>May 1, 2022</span>&nbsp;·&nbsp;683 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p><a href=https://joeyh.name/code/moreutils/><code>moreutils</code></a> has previously been covered <a href="https://news.ycombinator.com/item?id=31043655">elsewhere</a>, multiple times. It&rsquo;s a collection of small unix tools that follow the <a href=https://en.wikipedia.org/wiki/Unix_philosophy>unix philosophy</a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> very strongly.</p><p>Here are some of my favorites with example usages. Obviously this post isn&rsquo;t a manual which would have been a disservice to the community; refer to the upstream man pages for detailed instructions.</p><h2 id=sponge>sponge<a hidden class=anchor aria-hidden=true href=#sponge>#</a></h2><blockquote><p>sponge(1) - soak up standard input and write to a file</p></blockquote><p>Here&rsquo;s a typical workflow <code>sponge(1)</code> is great at:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Given a file</span>
</span></span><span style=display:flex><span>$ cat myfile
</span></span><span style=display:flex><span>a
</span></span><span style=display:flex><span>b
</span></span><span style=display:flex><span>c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Imagine that for whatever reason we want to replace &#39;a&#39; with &#39;b&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Naively, we could try this:</span>
</span></span><span style=display:flex><span>$ cat myfile | tr <span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#e6db74>&#39;b&#39;</span> &gt; myfile
</span></span><span style=display:flex><span>$ cat myfile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># However the file becomes empty!</span>
</span></span><span style=display:flex><span><span style=color:#75715e># It got clobbered when we tried to simultenaously read from and write to it</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sponge comes to the rescue!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat myfile | tr <span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#e6db74>&#39;b&#39;</span> | sponge myfile
</span></span><span style=display:flex><span>$ cat myfile
</span></span><span style=display:flex><span>b
</span></span><span style=display:flex><span>b
</span></span><span style=display:flex><span>c
</span></span></code></pre></div><p>It is great to use <code>sponge</code> in lieu of <code>></code> (shell output redirection) in shell pipelines when trying to both read from and write to the same file.</p><h2 id=vidir>vidir<a hidden class=anchor aria-hidden=true href=#vidir>#</a></h2><blockquote><p>vidir(1) - edit directories and filenames</p></blockquote><p><code>vidir(1)</code> is great to bulk rename files/directories within a given directory, one level at a time. For example, if I open <code>vidir</code> at the top-level directory of this blog repository, it opens up <code>vim</code> (although it doesn&rsquo;t need to be <code>vim</code>, your <code>$EDITOR</code> is honoured) with the following content:</p><pre tabindex=0><code>1	./.git
2	./.github
3	./.gitignore
4	./.gitmodules
5	./.hugo_build.lock
6	./LICENSE
7	./Makefile
8	./README.md
9	./archetypes
10	./config.yml
11	./content
12	./layouts
13	./public
14	./resources
15	./static
16	./themes
</code></pre><p>If I make, say, the following modifications (lines 7 and 8):</p><pre tabindex=0><code>1	./.git
2	./.github
3	./.gitignore
4	./.gitmodules
5	./.hugo_build.lock
6	./LICENSE
7	./GNUMakefile
8	./README.rst
9	./archetypes
10	./config.yml
11	./content
12	./layouts
13	./public
14	./resources
15	./static
16	./themes
</code></pre><p>And then save and quit <code>vim</code> (<code>:wq</code>), then the effect would have been the same as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mv Makefile GNUMakefile
</span></span><span style=display:flex><span>$ mv README.md README.rst
</span></span></code></pre></div><p>If I changed my mind and decided not to save the modifications, I could just do <code>:cq</code>.</p><p>It&rsquo;s possible to leverage vim features such as <code>.</code> (repeat command) and <code>:%s/</code> (find and replace) to perform those mass file renames quickly and effectively. <code>vidir</code> is a breeze to use!</p><h2 id=ifne>ifne<a hidden class=anchor aria-hidden=true href=#ifne>#</a></h2><blockquote><p>ifne(1) - Run command if the standard input is not empty</p></blockquote><p><code>ifne(1)</code> is effective when used with <code>find</code> or <code>fd</code> to keep shell pipes &ldquo;happy&rdquo;. Here&rsquo;s one simple example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ find . -name <span style=color:#e6db74>&#39;*.cpp&#39;</span> | xargs clang-format
</span></span></code></pre></div><p>This should work as expected, but it&rsquo;s cleaner to do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ find . -name <span style=color:#e6db74>&#39;*.cpp&#39;</span> | ifne xargs clang-format
</span></span></code></pre></div><p>The added <code>ifne</code> ensures the <code>xargs</code> command is only executed if and only if <code>find</code> yields at least one result in its output.</p><p>This wasn&rsquo;t a very practical example though: a more realistic way to use <code>ifne</code> is with prototypical on-the-fly manipulation of shell pipes wherein initially you just do whatever, but then whenever you notice some command in the middle of the pipe has failed because its input was empty (=the previous pipe command output was empty) you just prepend <code>ifne</code> to it:</p><pre tabindex=0><code>$ this | is | a | complicated | pipe
# assume &#34;complicated&#34; fails because it has no input
# so we iterate and do:
$ this | is | a | ifne complicated | pipe
</code></pre><h2 id=combine>combine<a hidden class=anchor aria-hidden=true href=#combine>#</a></h2><blockquote><p>combine(1) - combine sets of lines from two files using boolean operations</p></blockquote><p><code>combine(1)</code> is pretty much <code>comm(1)</code>, but much more user-friendly. Given two files <code>file1</code> and <code>file2</code> it makes it easy to query which lines are {unique, common} to {each, both} files, using boolean operations (or, and, not, xor). Here&rsquo;s one example to find the <em>common lines</em> in <em>both</em> files, compare <code>combine</code> and <code>comm</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ combine file1 and file2
</span></span><span style=display:flex><span>$ comm -12 file1 file2     <span style=color:#75715e># flags are harder to remember</span>
</span></span></code></pre></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>The Unix philosophy emphasizes building simple, short, clear, modular, and extensible code that can be easily maintained and repurposed by developers other than its creators. The Unix philosophy favors composability as opposed to monolithic design.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.perrotta.dev/tags/linux/>Linux</a></li><li><a href=https://www.perrotta.dev/tags/bestof/>Bestof</a></li></ul></footer><div style=text-align:center><a href="mailto:tbperrotta@gmail.com?subject=RE: not%20just%20serendipity comment for '%e2%98%85%20Tools%20you%20should%20know%20about%3a%20moreutils'" target=_blank><button>Reply via email</button></a></div></article></main><footer class=footer><span>Copyright © 2021 - 2024 Thiago Perrotta · <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> • <a href=/index.xml>RSS</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>