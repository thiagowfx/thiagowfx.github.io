<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title class=title>Alpine Linux: apk command not found hook | ¬¨ just serendipity üçÄ</title><meta name=title content="Alpine Linux: apk command not found hook">
<meta name=description content="In this post we will learn how to define a command-not-found hook to the apk(8) package manager in Alpine Linux.
Sneak peek
Before:
$ podman
zsh: correct 'podman' to 'pod2man' [nyae]? n
zsh: command not found: podman
After:
$ podman
zsh: correct 'podman' to 'pod2man' [nyae]? n
podman may be found in the following packages:
  <cmd:podman> podman-3.4.4-r1 x86_64 {podman} (Apache-2.0)
Preamble
Whenever you type a command that is not in your $PATH, usually your shell
will yell at you that it wasn&rsquo;t found."><meta name=keywords content="dev,bestof,"><meta property="og:url" content="https://perrotta.dev/2022/01/alpine-linux-apk-command-not-found-hook/"><meta property="og:site_name" content="¬¨ just serendipity üçÄ"><meta property="og:title" content="Alpine Linux: apk command not found hook"><meta property="og:description" content="In this post we will learn how to define a command-not-found hook to the apk(8) package manager in Alpine Linux.
Sneak peek Before:
$ podman zsh: correct 'podman' to 'pod2man' [nyae]? n zsh: command not found: podman After:
$ podman zsh: correct 'podman' to 'pod2man' [nyae]? n podman may be found in the following packages: <cmd:podman> podman-3.4.4-r1 x86_64 {podman} (Apache-2.0) Preamble Whenever you type a command that is not in your $PATH, usually your shell will yell at you that it wasn‚Äôt found."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-04T16:25:51-05:00"><meta property="article:modified_time" content="2025-09-05T18:20:12+02:00"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Bestof"><meta name=twitter:card content="summary"><meta name=twitter:title content="Alpine Linux: apk command not found hook"><meta name=twitter:description content="In this post we will learn how to define a command-not-found hook to the apk(8) package manager in Alpine Linux.
Sneak peek Before:
$ podman zsh: correct 'podman' to 'pod2man' [nyae]? n zsh: command not found: podman After:
$ podman zsh: correct 'podman' to 'pod2man' [nyae]? n podman may be found in the following packages: <cmd:podman> podman-3.4.4-r1 x86_64 {podman} (Apache-2.0) Preamble Whenever you type a command that is not in your $PATH, usually your shell will yell at you that it wasn‚Äôt found."><meta itemprop=name content="Alpine Linux: apk command not found hook"><meta itemprop=description content="In this post we will learn how to define a command-not-found hook to the apk(8) package manager in Alpine Linux.
Sneak peek Before:
$ podman zsh: correct 'podman' to 'pod2man' [nyae]? n zsh: command not found: podman After:
$ podman zsh: correct 'podman' to 'pod2man' [nyae]? n podman may be found in the following packages: <cmd:podman> podman-3.4.4-r1 x86_64 {podman} (Apache-2.0) Preamble Whenever you type a command that is not in your $PATH, usually your shell will yell at you that it wasn‚Äôt found."><meta itemprop=datePublished content="2022-01-04T16:25:51-05:00"><meta itemprop=dateModified content="2025-09-05T18:20:12+02:00"><meta itemprop=wordCount content="779"><meta itemprop=keywords content="Dev,Bestof"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/2022/01/alpine-linux-apk-command-not-found-hook/><link rel=stylesheet href=https://perrotta.dev/theme.css><style>body{text-align:left;margin:auto}h1,h2,h3,h4,h5,h6,footer,nav{font-family:var(--font-title)}footer{font-size:smaller;text-align:center;display:flex;flex-direction:column;gap:6px}footer>a{text-decoration:none}a{color:var(--link-color)}a.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:12px;display:inline-block}hr{border:none;border-top:1px dashed var(--border-color)}nav a.has-emoji .nav-emoji{display:none}nav a.has-emoji:hover .nav-emoji,nav a.active-star .nav-emoji{display:inline}nav a.has-emoji:hover .nav-text,nav a.active-star .nav-text{display:none}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.4}table{width:100%}img{max-width:100%}code{background-color:var(--code-bg)}li code,p code{font-size:.9em}pre code{color:var(--heading-color);display:block;padding:25px;white-space:pre;font-size:17px;overflow-x:auto}code,pre{font-family:var(--font-code)}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:2px solid #999;color:var(--heading-color);padding-left:25px;padding-right:15px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex;gap:8px;margin-bottom:8px}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}.pubdate-list{color:var(--color-gray);font-style:italic}.pubdate-single{color:var(--color-gray);font-style:italic}.social-link-wrapper{display:flex;justify-content:center;align-items:center;gap:8px}.social-link{text-decoration:none;font-size:1.4em}.badge-wrapper{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap}.badge-wrapper a{display:inline-block;text-decoration:none;transition:transform .2s ease}.badge-wrapper a:hover{transform:translateY(-2px)}.badge-wrapper img{display:block;height:auto}sup.gray{color:var(--color-gray)}.tag-cloud{display:flex;flex-wrap:wrap;gap:12px;margin-top:16px}.tag-pill{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;background:var(--code-bg);border-radius:6px;text-decoration:none;transition:all .2s ease}.tag-pill:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.tag-count{color:var(--color-gray);font-size:.9em}.year-group{margin:20px 0;padding:16px 0;transition:all .2s ease}.year-group summary{cursor:pointer;user-select:none;padding:8px 0;font-size:1.5rem;transition:color .2s ease;list-style:none;position:relative;padding-left:32px}.year-group summary::-webkit-details-marker{display:none}.year-group summary::before{content:'‚ñ∂';position:absolute;left:0;transition:transform .3s ease;color:var(--link-color);font-size:.8em}.year-group[open] summary::before{transform:rotate(90deg)}.year-group summary:hover{color:var(--link-color)}.year-group summary strong{font-weight:600}.year-group ul.blog-posts{margin-top:16px;padding-left:32px}.year-group ul.blog-posts li{margin-bottom:12px;transition:transform .15s ease}.year-group ul.blog-posts li:hover{transform:translateX(4px)}.year-group ul.blog-posts li a{text-decoration:none;border-bottom:1px solid transparent;transition:all .2s ease}.year-group ul.blog-posts li a:hover{border-bottom-color:var(--link-color)}@media(min-width:601px){.title{font-size:38px}}@media(max-width:600px){.title{font-size:2rem}.year-group{margin:16px 0;padding:12px 0}.year-group summary{font-size:1.3rem;padding-left:28px}.year-group summary::before{font-size:.75em}.year-group ul.blog-posts{padding-left:0;margin-top:12px}.year-group ul.blog-posts li{flex-direction:column;gap:4px;margin-bottom:16px}.year-group ul.blog-posts li span{flex:unset}ul.blog-posts li span{flex:unset}}@media(prefers-color-scheme:dark){blockquote{color:#ccc}textarea,input{background-color:#252525;color:var(--text-color)}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.png alt="thiagowfx's avatar" width=32 height=32><h1 class=title>¬¨ just serendipity üçÄ</h1></a><nav><a href=/tags/bestof/ class="has-emoji active-star"><span class=nav-emoji>‚≠ê</span>
<span class=nav-text>‚òÖ</span>
</a><a href=/posts/><span class=nav-text>Blog</span>
</a><a href=/tags/coding/><span class=nav-text>Coding</span></a></nav></header><main><h2><span>‚òÖ</span> Alpine Linux: apk command not found hook</h2><p><span class=pubdate-single><time datetime=2022-01-04 pubdate>04 Jan, 2022
</time>‚Ä¢ 779 words ‚Ä¢ 4 min
‚Ä¢ updated <time datetime=2025-09-05>05 Sep, 2025</time></span></p><content><p>In this post we will learn how to define a command-not-found hook to the <code>apk(8)</code> package manager in Alpine Linux.</p><h2 id=sneak-peek>Sneak peek</h2><p>Before:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ podman
</span></span><span style=display:flex><span>zsh: correct <span style=color:#98c379>&#39;podman&#39;</span> to <span style=color:#98c379>&#39;pod2man&#39;</span> <span style=color:#56b6c2>[</span>nyae<span style=color:#56b6c2>]</span>? n
</span></span><span style=display:flex><span>zsh: <span style=color:#e5c07b>command</span> not found: podman
</span></span></code></pre></div><p>After:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ podman
</span></span><span style=display:flex><span>zsh: correct <span style=color:#98c379>&#39;podman&#39;</span> to <span style=color:#98c379>&#39;pod2man&#39;</span> <span style=color:#56b6c2>[</span>nyae<span style=color:#56b6c2>]</span>? n
</span></span><span style=display:flex><span>podman may be found in the following packages:
</span></span><span style=display:flex><span>  &lt;cmd:podman&gt; podman-3.4.4-r1 x86_64 <span style=color:#56b6c2>{</span>podman<span style=color:#56b6c2>}</span> <span style=color:#56b6c2>(</span>Apache-2.0<span style=color:#56b6c2>)</span>
</span></span></code></pre></div><h2 id=preamble>Preamble</h2><p>Whenever you type a command that is not in your <code>$PATH</code>, usually your shell
will yell at you that it wasn&rsquo;t found.</p><p>The typical workflow in this scenario is to use the search functionality of your package manager in order to find which package provides the binary you&rsquo;re interested in.</p><p>In Alpine Linux, one would do:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ apk search podman
</span></span><span style=display:flex><span>podman-doc-3.4.4-r1
</span></span><span style=display:flex><span>podman-remote-3.4.4-r1
</span></span><span style=display:flex><span>podman-docker-3.4.4-r1
</span></span><span style=display:flex><span>openscap-1.3.5-r3
</span></span><span style=display:flex><span>podman-3.4.4-r1
</span></span><span style=display:flex><span>podman-compose-0.1.5-r4
</span></span><span style=display:flex><span>podman-bash-completion-3.4.4-r1
</span></span><span style=display:flex><span>podman-zsh-completion-3.4.4-r1
</span></span><span style=display:flex><span>py3-podman-3.2.1-r1
</span></span><span style=display:flex><span>podman-docker-doc-3.4.4-r1
</span></span><span style=display:flex><span>podman-openrc-3.4.4-r1
</span></span><span style=display:flex><span>podman-fish-completion-3.4.4-r1
</span></span></code></pre></div><p>The output is a bit noisy, but with a bit of experience you could easily figure out the package you&rsquo;re looking for is simply called <code>podman</code>, given the output above.</p><p>Surely this was an easy example, what if we tried something less obvious?</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ vidir
</span></span><span style=display:flex><span>zsh: correct <span style=color:#98c379>&#39;vidir&#39;</span> to <span style=color:#98c379>&#39;vdir&#39;</span> <span style=color:#56b6c2>[</span>nyae<span style=color:#56b6c2>]</span>? n
</span></span><span style=display:flex><span>zsh: <span style=color:#e5c07b>command</span> not found: vidir
</span></span></code></pre></div><p>There&rsquo;s no <code>vidir</code> binary, then surely there&rsquo;s a <code>vidir</code> package, right?</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ doas apk add vidir
</span></span><span style=display:flex><span>ERROR: unable to <span style=color:#c678dd>select</span> packages:
</span></span><span style=display:flex><span>  vidir <span style=color:#56b6c2>(</span>no such package<span style=color:#56b6c2>)</span>:
</span></span><span style=display:flex><span>    required by: world<span style=color:#56b6c2>[</span>vidir<span style=color:#56b6c2>]</span>
</span></span></code></pre></div><p>Er, no. You&rsquo;ll need to use search again:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ apk search vidir
</span></span><span style=display:flex><span>moreutils-0.67-r0
</span></span></code></pre></div><p>There it is, <code>moreutils</code>. Great piece of software, by the way<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><p>What if we could automate this?</p><h2 id=automating-command-not-found-1st-try>Automating command-not-found: 1st try</h2><p>In bash, one can define a <code>command_not_found_handle</code> function. In zsh, one can define a <code>command_not_found_handler</code> function. I know, why can&rsquo;t it be the same function, right? Just one <code>r</code> in the way. Regardless of whichever shell you use, the point is that the function is invoked whenever you run a command that is not in the <code>$PATH</code> (or that isn&rsquo;t a shell built-in).</p><p>In principle, you could do:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>command_not_found_handle<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>local</span> <span style=color:#e06c75>cmd</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;</span><span style=color:#e06c75>$1</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>  apk search <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$cmd</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>It&rsquo;s a good first try, and it surely works as expected, but it can be a bit noisy sometimes. Look at the podman output above, it outputs several unrelated packages, none of which provide the <code>podman</code> binary other than its homonym.</p><h2 id=automating-command-not-found-2nd-try>Automating command-not-found: 2nd try</h2><p>In Alpine, we can do slightly better. <code>apk(8)</code> has the concept of providers:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ apk list -P | awk <span style=color:#98c379>&#39;{print $1}&#39;</span> | egrep <span style=color:#98c379>&#39;&lt;\w+:&#39;</span> | cut -f <span style=color:#d19a66>1</span> -d <span style=color:#98c379>&#39;:&#39;</span> | cut -c 2- | sort -u
</span></span><span style=display:flex><span>cmd
</span></span><span style=display:flex><span>dbus
</span></span><span style=display:flex><span>pc
</span></span><span style=display:flex><span>so
</span></span></code></pre></div><p><code>-P</code> above stands for <code>--providers</code>. This roughly means one can search for a package that provides a given shared library (<code>so</code>), or a package that provides a given binary (<code>cmd</code>), and so on. We&rsquo;re interested in the <code>cmd:</code> provider.</p><p>If we tried it with <code>podman</code>, we would get the following output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ apk list -P -- <span style=color:#98c379>&#34;cmd:podman&#34;</span>
</span></span><span style=display:flex><span>&lt;cmd:podman&gt; podman-3.4.4-r1 x86_64 <span style=color:#56b6c2>{</span>podman<span style=color:#56b6c2>}</span> <span style=color:#56b6c2>(</span>Apache-2.0<span style=color:#56b6c2>)</span>
</span></span></code></pre></div><p>Look at how much shorter and direct it is, compared to the 1st approach!</p><p>Here&rsquo;s what it looks like if we try it with a binary provided by multiple packages:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ apk list -P -- <span style=color:#98c379>&#34;cmd:docker&#34;</span>
</span></span><span style=display:flex><span>&lt;cmd:docker&gt; docker-cli-20.10.11-r0 x86_64 <span style=color:#56b6c2>{</span>docker<span style=color:#56b6c2>}</span> <span style=color:#56b6c2>(</span>Apache-2.0<span style=color:#56b6c2>)</span> <span style=color:#56b6c2>[</span>installed<span style=color:#56b6c2>]</span>
</span></span><span style=display:flex><span>&lt;cmd:docker&gt; podman-docker-3.4.4-r1 x86_64 <span style=color:#56b6c2>{</span>podman<span style=color:#56b6c2>}</span> <span style=color:#56b6c2>(</span>Apache-2.0<span style=color:#56b6c2>)</span>
</span></span></code></pre></div><p>It&rsquo;s very easy to see that both <code>docker-cli</code> and <code>podman-docker</code> provide <code>docker</code>. If you just did a simple search, you&rsquo;d get a lot of noise:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ apk search docker
</span></span><span style=display:flex><span>docker-bash-completion-20.10.11-r0
</span></span><span style=display:flex><span>docker-cli-20.10.11-r0
</span></span><span style=display:flex><span>docker-machine-driver-kvm2-1.24.0-r0
</span></span><span style=display:flex><span>x11docker-6.9.0-r2
</span></span><span style=display:flex><span>docker-volume-local-persist-1.3.0-r5
</span></span><span style=display:flex><span>podman-docker-3.4.4-r1
</span></span><span style=display:flex><span>openvswitch-2.12.3-r4
</span></span><span style=display:flex><span>docker-engine-20.10.11-r0
</span></span><span style=display:flex><span>docker-openrc-20.10.11-r0
</span></span><span style=display:flex><span>dockerize-0.6.1-r9
</span></span><span style=display:flex><span>docker-fish-completion-20.10.11-r0
</span></span><span style=display:flex><span>openscap-1.3.5-r3
</span></span><span style=display:flex><span>docker-py-5.0.3-r1
</span></span><span style=display:flex><span>openvswitch-ovn-2.12.3-r4
</span></span><span style=display:flex><span>docker-registry-openrc-2.7.1-r5
</span></span><span style=display:flex><span>docker-doc-20.10.11-r0
</span></span><span style=display:flex><span>rsyslog-imdocker-8.2108.0-r0
</span></span><span style=display:flex><span>lazydocker-0.12-r2
</span></span><span style=display:flex><span>docker-compose-bash-completion-1.29.2-r2
</span></span><span style=display:flex><span>docker-compose-1.29.2-r2
</span></span><span style=display:flex><span>py3-dockerpty-0.4.1-r4
</span></span><span style=display:flex><span>docker-compose-zsh-completion-1.29.2-r2
</span></span><span style=display:flex><span>docker-registry-2.7.1-r5
</span></span><span style=display:flex><span>docker-credential-ecr-login-0.5.0-r2
</span></span><span style=display:flex><span>dockerpy-creds-0.4.0-r3
</span></span><span style=display:flex><span>docker-cli-compose-2.1.1-r0
</span></span><span style=display:flex><span>docker-credential-ecr-login-doc-0.5.0-r2
</span></span><span style=display:flex><span>podman-docker-doc-3.4.4-r1
</span></span><span style=display:flex><span>docker-20.10.11-r0
</span></span><span style=display:flex><span>docker-compose-fish-completion-1.29.2-r2
</span></span><span style=display:flex><span>flannel-contrib-cni-0.15.1-r0
</span></span><span style=display:flex><span>docker-zsh-completion-20.10.11-r0
</span></span><span style=display:flex><span>docker-volume-local-persist-openrc-1.3.0-r5
</span></span><span style=display:flex><span>docker-cli-buildx-0.7.1-r0
</span></span></code></pre></div><h2 id=packagingpackaging-it-all-together>Packaging<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> it all together</h2><p>I wrote the following scripts, which I source in my respective interactive shells, to achieve this behavior out-of-the-box:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat apk-command-not-found.bash
</span></span><span style=display:flex><span><span style=color:#7f848e>#!/bin/bash</span>
</span></span><span style=display:flex><span><span style=color:#7f848e># apk(8) from Alpine Linux command not found hook for bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>command_not_found_handle <span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>local</span> <span style=color:#e06c75>cmd</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;</span><span style=color:#e06c75>$1</span><span style=color:#98c379>&#34;</span> pkgs
</span></span><span style=display:flex><span>        mapfile -t pkgs &lt; &lt;<span style=color:#56b6c2>(</span>apk list -P -- <span style=color:#98c379>&#34;cmd:</span><span style=color:#e06c75>$cmd</span><span style=color:#98c379>&#34;</span> 2&gt;/dev/null<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span> <span style=color:#56b6c2>((</span> <span style=color:#98c379>${#</span><span style=color:#e06c75>pkgs</span>[*]<span style=color:#98c379>}</span> <span style=color:#56b6c2>))</span>; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>                <span style=color:#e5c07b>echo</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$cmd</span><span style=color:#98c379> may be found in the following packages:&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#e5c07b>printf</span> <span style=color:#98c379>&#39;  %s\n&#39;</span> <span style=color:#98c379>&#34;</span><span style=color:#98c379>${</span><span style=color:#e06c75>pkgs</span>[@]<span style=color:#98c379>}</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>                <span style=color:#e5c07b>echo</span> <span style=color:#98c379>&#34;bash: command not found: </span><span style=color:#e06c75>$cmd</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>fi</span> 1&gt;&amp;<span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#d19a66>127</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat apk-command-not-found.zsh
</span></span><span style=display:flex><span><span style=color:#7f848e>#!/bin/zsh</span>
</span></span><span style=display:flex><span><span style=color:#7f848e># apk(8) from Alpine Linux command not found hook for zsh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>command_not_found_handler<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>local</span> <span style=color:#e06c75>cmd</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;</span><span style=color:#e06c75>$1</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>local</span> <span style=color:#e06c75>pkgs</span><span style=color:#56b6c2>=(</span><span style=color:#98c379>${</span>(f)<span style=color:#98c379>&#34;</span><span style=color:#c678dd>$(</span>apk list -P -- <span style=color:#98c379>&#34;cmd:</span><span style=color:#e06c75>$cmd</span><span style=color:#98c379>&#34;</span> 2&gt;/dev/null<span style=color:#c678dd>)</span><span style=color:#98c379>&#34;</span><span style=color:#98c379>}</span><span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[[</span> -n <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$pkgs</span><span style=color:#98c379>&#34;</span> <span style=color:#56b6c2>]]</span>; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>                <span style=color:#e5c07b>echo</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$cmd</span><span style=color:#98c379> may be found in the following packages:&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#e5c07b>printf</span> <span style=color:#98c379>&#39;  %s\n&#39;</span> <span style=color:#98c379>&#34;</span><span style=color:#98c379>${</span><span style=color:#e06c75>pkgs</span>[@]<span style=color:#98c379>}</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>                <span style=color:#e5c07b>echo</span> <span style=color:#98c379>&#34;zsh: command not found: </span><span style=color:#e06c75>$cmd</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>fi</span> 1&gt;&amp;<span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#d19a66>127</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>The snippets above are snapshots intended for this post.
I keep up-to-date versions of these files in my dotfiles repository, <a href="https://github.com/thiagowfx/.dotfiles/search?q=filename%3Aapk-command-not-found&amp;type=code">try out this query</a> in case I ever move them elsewhere.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://joeyh.name/code/moreutils/>https://joeyh.name/code/moreutils/</a>: moreutils is a collection of the unix tools that nobody thought to write long ago when unix was young.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>pun intended&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></content><div style=display:flex;justify-content:space-between><p>Reply via
<a href="mailto:serendipity@perrotta.dev?subject=Reply to: Alpine%20Linux%3a%20apk%20command%20not%20found%20hook">email</a></p><p><a href=https://perrotta.dev/tags/dev/>#dev</a>
<a href=https://perrotta.dev/tags/bestof/>#bestof</a></p></div></main><hr><footer><span>¬© 2021 - 2025 Thiago Perrotta ¬∑
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ¬∑
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo  ï‚Ä¢·¥•‚Ä¢ î bear</a></span><div class=social-link-wrapper><a target=_blank rel=noopener class=social-link href=mailto:serendipity@perrotta.dev title="Email address"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 24 24" height="1.3em" width="1.3em"><g transform="translate(0.000000,24.000000) scale(0.100000,-0.100000)"><path d="M26 191c-4-5 16-23 44-40l50-31 50 31c28 17 48 35 44 40-7 12-181 12-188 0z"/><path d="M22 103l3-58 93-3c104-3 105-3 1e2 71l-3 46-48-29-47-30-38 23c-20 13-43 27-50 31-10 6-12-5-10-51z"/></g></svg>
</a><a target=_blank rel=noopener class=social-link href=https://perrotta.dev/index.xml title="RSS feed"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 56.693 56.693" height="1em" width="1em"><path d="M3.428 31.085c6.19.0 12.009 2.418 16.382 6.816 4.381 4.398 6.793 10.256 6.793 16.492h9.539c0-18.113-14.676-32.848-32.714-32.848v9.54zM3.443 14.174c22.061.0 40.01 18.047 40.01 40.231h9.539c0-27.445-22.229-49.77-49.549-49.77v9.539zM16.634 47.741c0 3.648-2.959 6.607-6.607 6.607S3.42 51.39 3.42 47.741c0-3.65 2.958-6.607 6.606-6.607s6.608 2.957 6.608 6.607z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://github.com/thiagowfx title="Github profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://goodreads.com/user/show/7873832-thiago title="Goodreads profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 50 50" height="1em" width="1em"><path d="M25 2c-4.541.0-8.41336 1.9082151-11.017578 4.9453125C11.378203 9.9824099 10 14.07975 10 18.5s1.378203 8.517589 3.982422 11.554688C16.58664 33.091785 20.459 35 25 35c4.531588.0 8.395936-1.901605 11-4.927734V35c0 2.598543-.818503 4.764071-2.451172 6.339844C31.91616 42.915616 29.363725 44 25.5 44 17.784314 44 15 39.933333 15 36H11c0 6.066667 5.215686 12 14.5 12 4.636275.0 8.33384-1.377726 10.826172-3.783203C38.818503 41.811319 40 38.476457 40 35V18.5 3H36V6.9277344C33.395936 3.9016049 29.531588 2 25 2zm0 4c3.459.0 6.08664 1.3379255 7.982422 3.5488281C34.878203 11.759731 36 14.91225 36 18.5s-1.121797 6.740269-3.017578 8.951172C31.08664 29.662074 28.459 31 25 31s-6.08664-1.337926-7.982422-3.548828C15.121797 25.240269 14 22.08775 14 18.5s1.121797-6.740269 3.017578-8.9511719C18.91336 7.3379255 21.541 6 25 6z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://linkedin.com/in/thiagoperrotta title="LinkedIn profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 30 30" height="1.2em" width="1.2em"><path d="M24 4H6C4.895 4 4 4.895 4 6v18c0 1.105.895 2 2 2h18c1.105.0 2-.895 2-2V6c0-1.105-.895-2-2-2zM10.954 22h-2.95v-9.492h2.95V22zM9.449 11.151c-.951.0-1.72-.771-1.72-1.72s.77-1.719 1.72-1.719c.948.0 1.719.771 1.719 1.719C11.168 10.38 10.397 11.151 9.449 11.151zM22.004 22h-2.948v-4.616c0-1.101-.02-2.517-1.533-2.517-1.535.0-1.771 1.199-1.771 2.437V22h-2.948v-9.492h2.83v1.297h.04c.394-.746 1.356-1.533 2.791-1.533 2.987.0 3.539 1.966 3.539 4.522V22z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://stackoverflow.com/users/1745064/thiagowfx title="StackOverflow profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em"><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 3e2zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-2e2v39.7h2e2zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg></a></div><div class=badge-wrapper><a target=_blank href=https://512kb.club title="512kb.club badge"><img src=https://perrotta.dev/green-team.gif alt="a proud member of the green team of 512KB club">
</a><a target=_blank href=https://www.vim.org/ title="Vim text editor"><img src=https://perrotta.dev/vim.gif alt="Vim text editor">
</a><a target=_blank href=https://edleeman.co.uk/cookie-zero/ title="Cookie Zero"><img src=https://perrotta.dev/cookiezero.webp alt="Cookie Zero"></a></div></footer></body></html>