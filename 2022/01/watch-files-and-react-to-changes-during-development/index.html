<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Watch files and react to changes during development | not just serendipity</title><meta name=title content="Watch files and react to changes during development">
<meta name=description content="This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen.
Context
I am contributing to miniflux, a minimalist and opinionated RSS reader. Miniflux&rsquo;s stack is as minimalist as the app itself: It&rsquo;s a Golang application that connects to a local PostgreSQL database. It has a well-documented and comprehensive Makefile.
In order to achieve an edit-and-preview workflow for quick prototyping and local iteration, all that it&rsquo;s needed is to execute make run whenever any1 file in the repository is changed."><meta name=keywords content="dev,linux,bestof,"><meta property="og:url" content="https://perrotta.dev/2022/01/watch-files-and-react-to-changes-during-development/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="Watch files and react to changes during development"><meta property="og:description" content="This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen.
Context I am contributing to miniflux, a minimalist and opinionated RSS reader. Miniflux’s stack is as minimalist as the app itself: It’s a Golang application that connects to a local PostgreSQL database. It has a well-documented and comprehensive Makefile.
In order to achieve an edit-and-preview workflow for quick prototyping and local iteration, all that it’s needed is to execute make run whenever any1 file in the repository is changed."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-30T21:32:17-05:00"><meta property="article:modified_time" content="2022-01-30T21:32:17-05:00"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Bestof"><meta name=twitter:card content="summary"><meta name=twitter:title content="Watch files and react to changes during development"><meta name=twitter:description content="This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen.
Context I am contributing to miniflux, a minimalist and opinionated RSS reader. Miniflux’s stack is as minimalist as the app itself: It’s a Golang application that connects to a local PostgreSQL database. It has a well-documented and comprehensive Makefile.
In order to achieve an edit-and-preview workflow for quick prototyping and local iteration, all that it’s needed is to execute make run whenever any1 file in the repository is changed."><meta itemprop=name content="Watch files and react to changes during development"><meta itemprop=description content="This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen.
Context I am contributing to miniflux, a minimalist and opinionated RSS reader. Miniflux’s stack is as minimalist as the app itself: It’s a Golang application that connects to a local PostgreSQL database. It has a well-documented and comprehensive Makefile.
In order to achieve an edit-and-preview workflow for quick prototyping and local iteration, all that it’s needed is to execute make run whenever any1 file in the repository is changed."><meta itemprop=datePublished content="2022-01-30T21:32:17-05:00"><meta itemprop=dateModified content="2022-01-30T21:32:17-05:00"><meta itemprop=wordCount content="511"><meta itemprop=keywords content="Dev,Linux,Bestof"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/><style>:root{--color-gray:#888;--color-grayer:#666;--font-title:'Inter', 'Fira Sans', 'Lato', system-ui, -apple-system, BlinkMacSystemFont, 'Avenir Next', 'Avenir', 'Segoe UI', 'Helvetica Neue', Helvetica, Ubuntu, Roboto, Noto, Cantarell, Arial, sans-serif;--font-body:'Crimson Pro', 'Vollkorn', 'Alegreya', 'Iowan Old Style', 'Apple Garamond', 'Baskerville', 'Times New Roman', 'Noto Serif', 'Droid Serif', 'Times', 'Source Serif Pro', serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';--font-code:'Fira Code', 'PT Mono', 'IBM Plex Mono', Menlo, Consolas, Monaco, 'Liberation Mono', 'Ubuntu Mono', 'Lucida Console', monospace}body{font-family:var(--font-body);margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fffcf0;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444;-webkit-text-size-adjust:100%}h1,h2,h3,h4,h5,h6,strong,b{color:#222}h1,h2,h3,h4,h5,h6,footer,nav{font-family:var(--font-title)}footer{font-size:small;padding:8px;text-align:center}a{color:#3273dc}a.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}li code,p code{font-size:small}pre code{color:#222;display:block;padding:20px;white-space:pre;font-size:14px;overflow-x:auto}code,pre{font-family:var(--font-code)}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 110px}ul.blog-posts li a:visited{color:#8b6fcb}.pubdate-list{color:var(--color-gray);font-style:italic}.pubdate-single{color:var(--color-grayer);font-style:italic}sup.gray{color:var(--color-grayer)}@media(prefers-color-scheme:dark){body{background-color:#01242e;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#444}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.png alt="thiagowfx's avatar" width=32 height=32><h2>not just serendipity</h2></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/bestof/>★</a></nav></header><main><h1><span>★</span>
Watch files and react to changes during development</h1><p><span class=pubdate-single><time datetime=2022-01-30 pubdate>30 Jan, 2022
</time>• 511 words
• 3 min</span></p><content><p>This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen.</p><h2 id=context>Context</h2><p>I am contributing to <a href=https://github.com/miniflux/v2>miniflux</a>, a minimalist and opinionated RSS reader. Miniflux&rsquo;s stack is as minimalist as the app itself: It&rsquo;s a Golang application that connects to a local PostgreSQL database. It has a well-documented and comprehensive <a href=https://github.com/miniflux/v2/blob/master/Makefile><code>Makefile</code></a>.</p><p>In order to achieve an edit-and-preview workflow for quick prototyping and local iteration, all that it&rsquo;s needed is to execute <code>make run</code> whenever any<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> file in the repository is changed.</p><p>My goal was to achieve that workflow with the least amount of friction, and with an application that is widely available in most package managers / linux distributions out there.</p><h2 id=option-1-entr-recommended>Option #1: entr (recommended)</h2><p><a href=https://eradman.com/entrproject/><code>entr(1)</code></a>:</p><blockquote><p>Run arbitrary commands when files change</p></blockquote><p>The following invocation does the job:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ fd | entr -r -- make run
</span></span></code></pre></div><p>However, we could do better. From the upstream docs:</p><blockquote><p>» ag and ack offer many advantages over utilities such as find(1) or ls(1) in that they recognize files by their contents and are smart enough to skip directories such as .git</p></blockquote><p>I am happy with <code>fd</code> for this use case though. To limit <code>entr</code> to <code>.go</code> files only, we could do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ fd -e go | entr -r -- make run
</span></span></code></pre></div><p>It took me less than 5 minutes to install and figure out how to use <code>entr</code>.</p><p><a href=https://schauderbasis.de/posts/entr/>This blog post</a> covers it in more detail.</p><h2 id=option-2-watchman>Option #2: watchman</h2><p><a href=https://facebook.github.io/watchman/><code>watchman</code></a> from Facebook Open Source:</p><blockquote><p>Watchman exists to watch files and record when they change. It can also trigger actions (such as rebuilding assets) when matching files change.</p></blockquote><p>Watchman&rsquo;s workflow doesn&rsquo;t seem to be very suited for this job though. It&rsquo;s much more centered on subscribing to <code>inotify</code> events:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd &lt;repository root&gt;
</span></span><span style=display:flex><span>watchman watch .
</span></span></code></pre></div><p>&mldr;and then adding predefined actions to recompile parts of the application as they change. The official docs give an example with CSS minification:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># set up a trigger named &#39;buildme&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># will run &#39;minify-css&#39; whenever a CSS file is changed</span>
</span></span><span style=display:flex><span>watchman -- trigger . buildme <span style=color:#e6db74>&#39;*.css&#39;</span> -- minify-css
</span></span></code></pre></div><p>In this regard it seems to be more modular, and I could easily see a scenario where I would kick off several specialized triggers in a webdev project: for example, one for CSS minification, one for JS minification, another one for TypeScript compilation, etc.</p><p>That said, for the simple use case of triggering (and reloading) <code>make run</code>, it seems overkill. I also found its <a href=https://facebook.github.io/watchman/docs/install.html>official docs</a> too verbose and lacking sample usages for simple <code>Makefile</code>-based projects like miniflux.</p><p>One caveat of <a href=https://repology.org/project/watchman/versions><code>watchman</code></a> is that it&rsquo;s less widely available than <a href=https://repology.org/project/entr/versions><code>entr</code></a>. Another caveat is that recently official distributions of watchman seem to be binary only, even though watchman itself is open source.</p><p>It took me several minutes to figure out what&rsquo;s the gist of watchman, only to realize it is more bloated than warranted.</p><h2 id=conclusion>Conclusion</h2><p>For simple projects, <code>entr</code> is the way to go, hands down. For complex webdev projects, I would look into <code>watchman</code> more deeply.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>To be truly strict, only changes to <code>.go</code> files matter.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></content><p><a href=https://perrotta.dev/tags/dev/>#dev</a>
<a href=https://perrotta.dev/tags/linux/>#linux</a>
<a href=https://perrotta.dev/tags/bestof/>#bestof</a></p></main><hr><footer><span>© 2021 - 2025
<a href=mailto:notjustserendipity@perrotta.dev>Thiago Perrotta
</a>·
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ·
<a href=/index.xml>RSS</a> ·
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo ʕ•ᴥ•ʔ bear</a></span></footer></body></html>