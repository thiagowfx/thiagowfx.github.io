<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>★ Watch files and react to changes during development | not just serendipity</title>
<meta name=keywords content="dev,linux,bestof"><meta name=description content="This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen."><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://www.perrotta.dev/2022/01/watch-files-and-react-to-changes-during-development/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://www.perrotta.dev/favicon.ico><link rel=apple-touch-icon href=https://www.perrotta.dev/apple-touch-icon.png><link rel=mask-icon href=https://www.perrotta.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.perrotta.dev/2022/01/watch-files-and-react-to-changes-during-development/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:title" content="★ Watch files and react to changes during development"><meta property="og:description" content="This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen."><meta property="og:type" content="article"><meta property="og:url" content="https://www.perrotta.dev/2022/01/watch-files-and-react-to-changes-during-development/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-30T21:32:17-05:00"><meta property="article:modified_time" content="2022-01-30T21:32:17-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="★ Watch files and react to changes during development"><meta name=twitter:description content="This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.perrotta.dev/posts/"},{"@type":"ListItem","position":2,"name":"★ Watch files and react to changes during development","item":"https://www.perrotta.dev/2022/01/watch-files-and-react-to-changes-during-development/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"★ Watch files and react to changes during development","name":"★ Watch files and react to changes during development","description":"This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen.\n","keywords":["dev","linux","bestof"],"articleBody":"This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen.\nContext I am contributing to miniflux, a minimalist and opinionated RSS reader. Miniflux’s stack is as minimalist as the app itself: It’s a Golang application that connects to a local PostgreSQL database. It has a well-documented and comprehensive Makefile.\nIn order to achieve an edit-and-preview workflow for quick prototyping and local iteration, all that it’s needed is to execute make run whenever any1 file in the repository is changed.\nMy goal was to achieve that workflow with the least amount of friction, and with an application that is widely available in most package managers / linux distributions out there.\nOption #1: entr (recommended) entr(1):\nRun arbitrary commands when files change\nThe following invocation does the job:\n$ fd | entr -r -- make run However, we could do better. From the upstream docs:\n» ag and ack offer many advantages over utilities such as find(1) or ls(1) in that they recognize files by their contents and are smart enough to skip directories such as .git\nI am happy with fd for this use case though. To limit entr to .go files only, we could do:\n$ fd -e go | entr -r -- make run It took me less than 5 minutes to install and figure out how to use entr.\nThis blog post covers it in more detail.\nOption #2: watchman watchman from Facebook Open Source:\nWatchman exists to watch files and record when they change. It can also trigger actions (such as rebuilding assets) when matching files change.\nWatchman’s workflow doesn’t seem to be very suited for this job though. It’s much more centered on subscribing to inotify events:\ncd watchman watch . …and then adding predefined actions to recompile parts of the application as they change. The official docs give an example with CSS minification:\n# set up a trigger named 'buildme' # will run 'minify-css' whenever a CSS file is changed watchman -- trigger . buildme '*.css' -- minify-css In this regard it seems to be more modular, and I could easily see a scenario where I would kick off several specialized triggers in a webdev project: for example, one for CSS minification, one for JS minification, another one for TypeScript compilation, etc.\nThat said, for the simple use case of triggering (and reloading) make run, it seems overkill. I also found its official docs too verbose and lacking sample usages for simple Makefile-based projects like miniflux.\nOne caveat of watchman is that it’s less widely available than entr. Another caveat is that recently official distributions of watchman seem to be binary only, even though watchman itself is open source.\nIt took me several minutes to figure out what’s the gist of watchman, only to realize it is more bloated than warranted.\nConclusion For simple projects, entr is the way to go, hands down. For complex webdev projects, I would look into watchman more deeply.\nTo be truly strict, only changes to .go files matter. ↩︎\n","wordCount":"511","inLanguage":"en","datePublished":"2022-01-30T21:32:17-05:00","dateModified":"2022-01-30T21:32:17-05:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.perrotta.dev/2022/01/watch-files-and-react-to-changes-during-development/"},"publisher":{"@type":"Person","name":"not just serendipity","logo":{"@type":"ImageObject","url":"https://www.perrotta.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.perrotta.dev/ accesskey=h title="not just serendipity (Alt + H)"><img src=https://www.perrotta.dev/apple-touch-icon.png alt aria-label=logo height=32>not just serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.perrotta.dev/posts/ title=posts><span>posts</span></a></li><li><a href=https://www.perrotta.dev/tags/bestof/ title="★ bestof"><span>★ bestof</span></a></li><li><a href=https://www.perrotta.dev/tags/serenity/ title=serenity><span>serenity</span></a></li><li><a href=https://www.perrotta.dev/archives/ title=archives><span>archives</span></a></li><li><a href=https://www.perrotta.dev/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://www.perrotta.dev/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">★ Watch files and react to changes during development</h1><div class=post-meta><span title='2022-01-30 21:32:17 -0500 -0500'>January 30, 2022</span>&nbsp;·&nbsp;511 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p>This post describes some tooling usages to watch for file changes and run or reload a command whenever they happen.</p><h2 id=context>Context<a hidden class=anchor aria-hidden=true href=#context>#</a></h2><p>I am contributing to <a href=https://github.com/miniflux/v2>miniflux</a>, a minimalist and opinionated RSS reader. Miniflux&rsquo;s stack is as minimalist as the app itself: It&rsquo;s a Golang application that connects to a local PostgreSQL database. It has a well-documented and comprehensive <a href=https://github.com/miniflux/v2/blob/master/Makefile><code>Makefile</code></a>.</p><p>In order to achieve an edit-and-preview workflow for quick prototyping and local iteration, all that it&rsquo;s needed is to execute <code>make run</code> whenever any<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> file in the repository is changed.</p><p>My goal was to achieve that workflow with the least amount of friction, and with an application that is widely available in most package managers / linux distributions out there.</p><h2 id=option-1-entr-recommended>Option #1: entr (recommended)<a hidden class=anchor aria-hidden=true href=#option-1-entr-recommended>#</a></h2><p><a href=https://eradman.com/entrproject/><code>entr(1)</code></a>:</p><blockquote><p>Run arbitrary commands when files change</p></blockquote><p>The following invocation does the job:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ fd | entr -r -- make run
</span></span></code></pre></div><p>However, we could do better. From the upstream docs:</p><blockquote><p>» ag and ack offer many advantages over utilities such as find(1) or ls(1) in that they recognize files by their contents and are smart enough to skip directories such as .git</p></blockquote><p>I am happy with <code>fd</code> for this use case though. To limit <code>entr</code> to <code>.go</code> files only, we could do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ fd -e go | entr -r -- make run
</span></span></code></pre></div><p>It took me less than 5 minutes to install and figure out how to use <code>entr</code>.</p><p><a href=https://schauderbasis.de/posts/entr/>This blog post</a> covers it in more detail.</p><h2 id=option-2-watchman>Option #2: watchman<a hidden class=anchor aria-hidden=true href=#option-2-watchman>#</a></h2><p><a href=https://facebook.github.io/watchman/><code>watchman</code></a> from Facebook Open Source:</p><blockquote><p>Watchman exists to watch files and record when they change. It can also trigger actions (such as rebuilding assets) when matching files change.</p></blockquote><p>Watchman&rsquo;s workflow doesn&rsquo;t seem to be very suited for this job though. It&rsquo;s much more centered on subscribing to <code>inotify</code> events:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd &lt;repository root&gt;
</span></span><span style=display:flex><span>watchman watch .
</span></span></code></pre></div><p>&mldr;and then adding predefined actions to recompile parts of the application as they change. The official docs give an example with CSS minification:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># set up a trigger named &#39;buildme&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># will run &#39;minify-css&#39; whenever a CSS file is changed</span>
</span></span><span style=display:flex><span>watchman -- trigger . buildme <span style=color:#e6db74>&#39;*.css&#39;</span> -- minify-css
</span></span></code></pre></div><p>In this regard it seems to be more modular, and I could easily see a scenario where I would kick off several specialized triggers in a webdev project: for example, one for CSS minification, one for JS minification, another one for TypeScript compilation, etc.</p><p>That said, for the simple use case of triggering (and reloading) <code>make run</code>, it seems overkill. I also found its <a href=https://facebook.github.io/watchman/docs/install.html>official docs</a> too verbose and lacking sample usages for simple <code>Makefile</code>-based projects like miniflux.</p><p>One caveat of <a href=https://repology.org/project/watchman/versions><code>watchman</code></a> is that it&rsquo;s less widely available than <a href=https://repology.org/project/entr/versions><code>entr</code></a>. Another caveat is that recently official distributions of watchman seem to be binary only, even though watchman itself is open source.</p><p>It took me several minutes to figure out what&rsquo;s the gist of watchman, only to realize it is more bloated than warranted.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>For simple projects, <code>entr</code> is the way to go, hands down. For complex webdev projects, I would look into <code>watchman</code> more deeply.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>To be truly strict, only changes to <code>.go</code> files matter.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.perrotta.dev/tags/dev/>Dev</a></li><li><a href=https://www.perrotta.dev/tags/linux/>Linux</a></li><li><a href=https://www.perrotta.dev/tags/bestof/>Bestof</a></li></ul></footer><div style=text-align:center><a href="mailto:tbperrotta@gmail.com?subject=RE: not%20just%20serendipity comment for '%e2%98%85%20Watch%20files%20and%20react%20to%20changes%20during%20development'" target=_blank><button>Reply via email</button></a></div></article></main><footer class=footer><span>Copyright © 2021 - 2024 Thiago Perrotta · <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> · <a href=/index.xml>RSS</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>