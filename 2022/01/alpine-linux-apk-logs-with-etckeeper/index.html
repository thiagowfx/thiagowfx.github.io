<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Alpine Linux: apk logs with etckeeper | Not Just Serendipity</title>
<meta name=keywords content="linux"><meta name=description content="apk(8) is the Alpine Linux package manager. Surprisingly, it lacks native
logs. In this post we will learn how to work around this limitation."><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://thiagowfx.github.io/2022/01/alpine-linux-apk-logs-with-etckeeper/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://thiagowfx.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://thiagowfx.github.io/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://thiagowfx.github.io/favicon.ico><link rel=apple-touch-icon href=https://thiagowfx.github.io/apple-touch-icon.png><link rel=mask-icon href=https://thiagowfx.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:title" content="Alpine Linux: apk logs with etckeeper"><meta property="og:description" content="apk(8) is the Alpine Linux package manager. Surprisingly, it lacks native
logs. In this post we will learn how to work around this limitation."><meta property="og:type" content="article"><meta property="og:url" content="https://thiagowfx.github.io/2022/01/alpine-linux-apk-logs-with-etckeeper/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-10T23:14:43-05:00"><meta property="article:modified_time" content="2022-01-10T23:14:43-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Alpine Linux: apk logs with etckeeper"><meta name=twitter:description content="apk(8) is the Alpine Linux package manager. Surprisingly, it lacks native
logs. In this post we will learn how to work around this limitation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://thiagowfx.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Alpine Linux: apk logs with etckeeper","item":"https://thiagowfx.github.io/2022/01/alpine-linux-apk-logs-with-etckeeper/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Alpine Linux: apk logs with etckeeper","name":"Alpine Linux: apk logs with etckeeper","description":"apk(8) is the Alpine Linux package manager. Surprisingly, it lacks native logs. In this post we will learn how to work around this limitation.\n","keywords":["linux"],"articleBody":"apk(8) is the Alpine Linux package manager. Surprisingly, it lacks native logs. In this post we will learn how to work around this limitation.\nIn a distribution like Arch Linux that uses pacman(8), one would typically find logs in /var/log/pacman.log. You would expect Alpine Linux to follow suit and provide some /var/log/apk.log or similar, however that’s not the case.\nLogs are nowhere to be found, even in the apk-* man pages. I double-checked by asking on the #alpine-linux IRC and someone confirmed this is indeed the case, and there’s an (unconfirmed) possibility the next generation of apk may add logging support.\nMeanwhile, we will use etckeeper(8) to overcome this limitation.\netckeeper: set-up etckeeper is\na collection of tools to let /etc be stored in a git, mercurial, bazaar or darcs repository. This lets you use git to review or revert changes that were made to /etc. Or even push the repository elsewhere for backups or cherry-picking configuration changes.\nby Joey Hess.\nIt is available in the Alpine Linux repositories, just install it:\n% apk add etckeeper No configuration is needed, it works out-of-the-box, thanks to a post-install hook to initialize the git repository, and an apk commit hook to update it upon apk package operations.\netckeeper: viewing logs Just run git log as root. Root privilege is necessary because the git repository is initialized under /etc/etckeeper. Pick your poison:\n$ GIT_DIR=/etc/etckeeper doas git log $ doas git -C /etc/etckeeper log $ (cd /etc/etckeeper \u0026\u0026 doas git log) Here’s what a typical log looks like, courtesy of apk-autoupdate(1)1:\ncommit f06255c4be4657481082406b2050ecd88e3da768 Author: root Date: Tue Jan 11 00:00:24 2022 -0500 committing changes in /etc after apk run Package changes: -libeconf-0.4.2-r0 -libeconf-doc-0.4.2-r0 +libeconf-0.4.4-r0 +libeconf-doc-0.4.4-r0 -mtools-4.0.36-r0 -mtools-doc-4.0.36-r0 +mtools-4.0.37-r0 +mtools-doc-4.0.37-r0 -perl-io-socket-ssl-2.073-r0 -perl-io-socket-ssl-doc-2.073-r0 +perl-io-socket-ssl-2.074-r0 +perl-io-socket-ssl-doc-2.074-r0 -py3-idna-3.3-r1 +py3-idna-3.3-r2 -py3-jinja2-3.0.1-r1 -py3-jinja2-doc-3.0.1-r1 +py3-jinja2-3.0.3-r0 +py3-jinja2-doc-3.0.3-r0 Which merely does apk upgrade, automatically. More details here. ↩︎\n","wordCount":"305","inLanguage":"en","datePublished":"2022-01-10T23:14:43-05:00","dateModified":"2022-01-10T23:14:43-05:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://thiagowfx.github.io/2022/01/alpine-linux-apk-logs-with-etckeeper/"},"publisher":{"@type":"Person","name":"Not Just Serendipity","logo":{"@type":"ImageObject","url":"https://thiagowfx.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://thiagowfx.github.io/ accesskey=h title="Not Just Serendipity (Alt + H)"><img src=https://thiagowfx.github.io/apple-touch-icon.png alt aria-label=logo height=32>Not Just Serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://thiagowfx.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://thiagowfx.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://thiagowfx.github.io/tags/star/ title=bestof><span>bestof</span></a></li><li><a href=https://thiagowfx.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://thiagowfx.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Alpine Linux: apk logs with etckeeper</h1><div class=post-meta><span title='2022-01-10 23:14:43 -0500 -0500'>January 10, 2022</span>&nbsp;·&nbsp;305 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p><code>apk(8)</code> is the Alpine Linux package manager. Surprisingly, it lacks native
logs. In this post we will learn how to work around this limitation.</p><p>In a distribution like Arch Linux that uses <code>pacman(8)</code>, one would typically
find logs in <code>/var/log/pacman.log</code>. You would expect Alpine Linux to follow
suit and provide some <code>/var/log/apk.log</code> or similar, however that&rsquo;s not the
case.</p><p>Logs are nowhere to be found, even in the <code>apk-*</code> man pages. I double-checked
by asking on the <code>#alpine-linux</code> IRC and someone confirmed this is indeed the
case, and there&rsquo;s an (unconfirmed) possibility the next generation of apk may
add logging support.</p><p>Meanwhile, we will use <code>etckeeper(8)</code> to overcome this limitation.</p><h2 id=etckeeper-set-up>etckeeper: set-up<a hidden class=anchor aria-hidden=true href=#etckeeper-set-up>#</a></h2><p><a href=https://etckeeper.branchable.com/><code>etckeeper</code></a> is</p><blockquote><p>a collection of tools to let <code>/etc</code> be stored in a git, mercurial, bazaar or
darcs repository. This lets you use git to review or revert changes that were
made to /etc. Or even push the repository elsewhere for backups or
cherry-picking configuration changes.</p></blockquote><p>by <a href=https://joeyh.name/>Joey Hess</a>.</p><p>It is available in the Alpine Linux <a href="https://pkgs.alpinelinux.org/packages?name=etckeeper">repositories</a>, just install it:</p><pre tabindex=0><code>% apk add etckeeper
</code></pre><p>No configuration is needed, it works out-of-the-box, thanks to a <a href=https://git.alpinelinux.org/aports/tree/main/etckeeper/etckeeper.post-install>post-install
hook</a> to initialize the git repository, and an <a href=https://git.alpinelinux.org/aports/tree/main/etckeeper/apk-commit_hook>apk commit
hook</a> to update it upon <code>apk</code> package operations.</p><h2 id=etckeeper-viewing-logs>etckeeper: viewing logs<a hidden class=anchor aria-hidden=true href=#etckeeper-viewing-logs>#</a></h2><p>Just run <code>git log</code> as root. Root privilege is necessary because the git
repository is initialized under <code>/etc/etckeeper</code>. Pick your poison:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ GIT_DIR<span style=color:#f92672>=</span>/etc/etckeeper doas git log
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ doas git -C /etc/etckeeper log
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ <span style=color:#f92672>(</span>cd /etc/etckeeper <span style=color:#f92672>&amp;&amp;</span> doas git log<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Here&rsquo;s what a typical log looks like, courtesy of <code>apk-autoupdate(1)</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>:</p><pre tabindex=0><code>commit f06255c4be4657481082406b2050ecd88e3da768
Author: root &lt;root@localhost.localdomain&gt;
Date:   Tue Jan 11 00:00:24 2022 -0500

    committing changes in /etc after apk run

    Package changes:
    -libeconf-0.4.2-r0
    -libeconf-doc-0.4.2-r0
    +libeconf-0.4.4-r0
    +libeconf-doc-0.4.4-r0
    -mtools-4.0.36-r0
    -mtools-doc-4.0.36-r0
    +mtools-4.0.37-r0
    +mtools-doc-4.0.37-r0
    -perl-io-socket-ssl-2.073-r0
    -perl-io-socket-ssl-doc-2.073-r0
    +perl-io-socket-ssl-2.074-r0
    +perl-io-socket-ssl-doc-2.074-r0
    -py3-idna-3.3-r1
    +py3-idna-3.3-r2
    -py3-jinja2-3.0.1-r1
    -py3-jinja2-doc-3.0.1-r1
    +py3-jinja2-3.0.3-r0
    +py3-jinja2-doc-3.0.3-r0
</code></pre><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Which merely does <code>apk upgrade</code>, automatically. More details <a href=https://github.com/jirutka/apk-autoupdate>here</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://thiagowfx.github.io/tags/linux/>linux</a></li></ul></footer><div style=text-align:center><a href="mailto:tbperrotta@gmail.com?subject=RE: Not%20Just%20Serendipity comment for 'Alpine%20Linux%3a%20apk%20logs%20with%20etckeeper'" target=_blank><button>Reply via email</button></a></div></article></main><footer class=footer><span>Copyright © 2021 - 2023 Thiago Perrotta • <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> • <a href=/index.xml>RSS</a> •</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>