<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>systemd: share environment variables with xorg | not just serendipity</title><meta name=title content="systemd: share environment variables with xorg">
<meta name=description content="In this post we will learn how to share environment variables (e.g.
$GDK_SCALE) between a system user session and X11/Xorg.
The typical ~/.xinitrc and/or ~/.xprofile setup in
2020s involves some environment variable exports such as the following:
# fix java application decorations, for tiling window managers
export _JAVA_AWT_WM_NONREPARENTING=1

# make Chrome pick up proxy settings stored in gconf
export DESKTOP_SESSION=gnome

# HiDPI settings for GTK3+
export GDK_DPI_SCALE=0.5
export GDK_SCALE=2

# HiDPI settings for QT
export QT_FONT_DPI=192
This particular set of customizations stems from my dotfiles but
there isn&rsquo;t anything special about it. I&rsquo;ll include an explanation anyway for
completeness:"><meta name=keywords content="linux,bestof★,"><meta property="og:url" content="https://perrotta.dev/2022/01/systemd-share-environment-variables-with-xorg/"><meta property="og:site_name" content="not just serendipity"><meta property="og:title" content="systemd: share environment variables with xorg"><meta property="og:description" content="In this post we will learn how to share environment variables (e.g. $GDK_SCALE) between a system user session and X11/Xorg.
The typical ~/.xinitrc and/or ~/.xprofile setup in 2020s involves some environment variable exports such as the following:
# fix java application decorations, for tiling window managers export _JAVA_AWT_WM_NONREPARENTING=1 # make Chrome pick up proxy settings stored in gconf export DESKTOP_SESSION=gnome # HiDPI settings for GTK3+ export GDK_DPI_SCALE=0.5 export GDK_SCALE=2 # HiDPI settings for QT export QT_FONT_DPI=192 This particular set of customizations stems from my dotfiles but there isn’t anything special about it. I’ll include an explanation anyway for completeness:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-31T21:38:54-05:00"><meta property="article:modified_time" content="2022-01-31T21:38:54-05:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Bestof★"><meta name=twitter:card content="summary"><meta name=twitter:title content="systemd: share environment variables with xorg"><meta name=twitter:description content="In this post we will learn how to share environment variables (e.g. $GDK_SCALE) between a system user session and X11/Xorg.
The typical ~/.xinitrc and/or ~/.xprofile setup in 2020s involves some environment variable exports such as the following:
# fix java application decorations, for tiling window managers export _JAVA_AWT_WM_NONREPARENTING=1 # make Chrome pick up proxy settings stored in gconf export DESKTOP_SESSION=gnome # HiDPI settings for GTK3+ export GDK_DPI_SCALE=0.5 export GDK_SCALE=2 # HiDPI settings for QT export QT_FONT_DPI=192 This particular set of customizations stems from my dotfiles but there isn’t anything special about it. I’ll include an explanation anyway for completeness:"><meta itemprop=name content="systemd: share environment variables with xorg"><meta itemprop=description content="In this post we will learn how to share environment variables (e.g. $GDK_SCALE) between a system user session and X11/Xorg.
The typical ~/.xinitrc and/or ~/.xprofile setup in 2020s involves some environment variable exports such as the following:
# fix java application decorations, for tiling window managers export _JAVA_AWT_WM_NONREPARENTING=1 # make Chrome pick up proxy settings stored in gconf export DESKTOP_SESSION=gnome # HiDPI settings for GTK3+ export GDK_DPI_SCALE=0.5 export GDK_SCALE=2 # HiDPI settings for QT export QT_FONT_DPI=192 This particular set of customizations stems from my dotfiles but there isn’t anything special about it. I’ll include an explanation anyway for completeness:"><meta itemprop=datePublished content="2022-01-31T21:38:54-05:00"><meta itemprop=dateModified content="2022-01-31T21:38:54-05:00"><meta itemprop=wordCount content="620"><meta itemprop=keywords content="Linux,Bestof★"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/><style>body{font-family:crimson pro,vollkorn,alegreya,iowan old style,apple garamond,baskerville,times new roman,noto serif,droid serif,times,source serif pro,serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fffcf0;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444;-webkit-text-size-adjust:100%}h1,h2,h3,h4,h5,h6,strong,b{color:#222}h1,h2,h3,h4,h5,h6,footer,nav{font-family:inter,fira sans,lato,system-ui,-apple-system,BlinkMacSystemFont,avenir next,avenir,segoe ui,helvetica neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}footer{font-size:small;padding:8px;text-align:center}a{color:#3273dc}.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}li code,p code{font-size:small}pre code{color:#222;display:block;padding:20px;white-space:pre;font-size:14px;overflow-x:auto}code,pre{font-family:fira code,pt mono,ibm plex mono,Menlo,Consolas,Monaco,liberation mono,ubuntu mono,lucida console,monospace}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 110px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#01242e;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#444}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.png alt="thiagowfx's avatar" width=32 height=32><h2>not just serendipity</h2></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/bestof/>★</a></nav></header><main><h1><span>★</span>
systemd: share environment variables with xorg</h1><p><i><time datetime=2022-01-31 pubdate>31 Jan, 2022
</time>• 620 words
• 3 min</i></p><content><p>In this post we will learn how to share environment variables (e.g.
<code>$GDK_SCALE</code>) between a system user session and X11/Xorg.</p><p>The typical <a href=https://wiki.archlinux.org/title/Xinit><code>~/.xinitrc</code></a> and/or <a href=https://wiki.archlinux.org/title/Xprofile><code>~/.xprofile</code></a> setup in
2020s involves some environment variable exports such as the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># fix java application decorations, for tiling window managers</span>
</span></span><span style=display:flex><span>export _JAVA_AWT_WM_NONREPARENTING<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># make Chrome pick up proxy settings stored in gconf</span>
</span></span><span style=display:flex><span>export DESKTOP_SESSION<span style=color:#f92672>=</span>gnome
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># HiDPI settings for GTK3+</span>
</span></span><span style=display:flex><span>export GDK_DPI_SCALE<span style=color:#f92672>=</span>0.5
</span></span><span style=display:flex><span>export GDK_SCALE<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># HiDPI settings for QT</span>
</span></span><span style=display:flex><span>export QT_FONT_DPI<span style=color:#f92672>=</span><span style=color:#ae81ff>192</span>
</span></span></code></pre></div><p>This particular set of customizations stems from my <a href=https://github.com/thiagowfx/.dotfiles>dotfiles</a> but
there isn&rsquo;t anything special about it. I&rsquo;ll include an explanation anyway for
completeness:</p><ul><li><p>The java setting is meant for launching certain java-based applications from
within a tiling window manager.</p></li><li><p>All the other settings are meant for 4K HiDPI displays. The baseline DPI is
96, which is too small for 4K monitors, the fonts and icons all look tiny. In
order to make them scale it&rsquo;s necessary to use a higher DPI. Typical setups
use either 144 (x1.5) or 192 (x2.0), the bigger the DPI the bigger fonts and
icons will appear in the screen.</p></li></ul><p>Those exports work well for graphical applications launched from your favorite
window manager after it has already started, however if you decide to launch an
application from <code>systemd</code>, those settings will not be picked up by it.</p><p>For example, if you decide to manage <a href=http://jonls.dk/redshift/><code>redshift</code></a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> (more
specifically, <code>redshift-gtk</code> which has a system tray app) from a systemd user
session<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, its fonts will look small.</p><p>There are several ways to address this issue.</p><p>One of them is to edit the service file directly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ systemctl --user edit redshift-gtk
</span></span></code></pre></div><p>And then add:</p><pre tabindex=0><code>[Unit]
Environment=GDK_SCALE=2 GDK_DPI_SCALE=0.5
</code></pre><p>Which results in:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat ~/.config/systemd/user/redshift-gtk.service.d/override.conf
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Environment<span style=color:#f92672>=</span>GDK_SCALE<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> GDK_DPI_SCALE<span style=color:#f92672>=</span>0.5
</span></span></code></pre></div><p>Which you can make effective by:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ systemctl --user daemon-reload
</span></span><span style=display:flex><span>$ systemctl --user restart redshift-gtk
</span></span></code></pre></div><p>I am not a fan of this approach though, because this step would need to be repeated
to all service files you want to manage this way. There&rsquo;s a better, <a href=https://en.wikipedia.org/wiki/Don%27t_repeat_yourself>DRY</a> way to
do so.</p><p><code>systemd</code> supports <a href=https://www.freedesktop.org/software/systemd/man/environment.d.html>environment
files</a>
(<code>environment.d(5)</code>). User-defined ones live in
<code>~/.config/environment.d/*.conf</code> by default.</p><p>This means we could produce the following file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat ~/.config/environment.d/user.conf
</span></span><span style=display:flex><span><span style=color:#75715e># systemd environment.d(5) EnvironmentFile</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://www.freedesktop.org/software/systemd/man/environment.d.html</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Do not use export here.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Alternatively</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   systemctl --user import-environment [var1] [var2] [...]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Troubleshooting</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   systemctl --user show-environment</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># fix java application decorations, for tiling window managers</span>
</span></span><span style=display:flex><span>_JAVA_AWT_WM_NONREPARENTING<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># make Chrome pick up proxy settings stored in gconf</span>
</span></span><span style=display:flex><span>DESKTOP_SESSION<span style=color:#f92672>=</span>gnome
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># HiDPI settings for GTK3+</span>
</span></span><span style=display:flex><span>GDK_DPI_SCALE<span style=color:#f92672>=</span>0.5
</span></span><span style=display:flex><span>GDK_SCALE<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># HiDPI settings for QT</span>
</span></span><span style=display:flex><span>QT_FONT_DPI<span style=color:#f92672>=</span><span style=color:#ae81ff>192</span>
</span></span></code></pre></div><p>Which is applied to all systemd user service files automatically, no need to
set <code>Environment=</code> manually everywhere.</p><p>However, now we need to maintain two different files: the systemd <code>.conf</code> one
and the xorg <code>~/.xinitrc</code> one.</p><p>One elegant way to reduce maintenance burden is, in my opinion, the follownig:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat ~/.xinitrc
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#75715e># Parse user session environment variables.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This file is shared with the systemd user instance.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Export all variables: https://stackoverflow.com/a/30969768/1745064</span>
</span></span><span style=display:flex><span>set -a
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -r ~/.config/environment.d/user.conf <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> . ~/.config/environment.d/user.conf
</span></span><span style=display:flex><span>set +a
</span></span></code></pre></div><p>It does what you expect: the underlying shell sources the <code>*.conf</code> file as if
you were <code>export</code>ing each variable therein.</p><p>One caveat of this setup is that you cannot define the variables
dynamically; for example, with subshells, with external programs, or with
simple mathematical operations derived from other variables<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><p>Ultimately though you end up with only one file to manage, which is the systemd one.
<a href=https://en.wikipedia.org/wiki/KISS_principle>KISS</a>™.</p><figure><a href=https://xkcd.com/963/><img src=https://imgs.xkcd.com/comics/x11.png alt="Thomas Jefferson thought that every law and every constitution should be torn down and rewritten from scratch every nineteen years--which means X is overdue."></a><figcaption><p>XKCD Courtesy of Randall Munroe</p></figcaption></figure><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Redshift adjusts the color temperature of your screen according to your
surroundings. This may help your eyes hurt less if you are working in front
of the screen at night. Redshift is similar to <a href=https://justgetflux.com/>f.lux</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><code>systemctl --user start redshift</code>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>For example, <code>QT_FONT_DPI=$(($GDK_SCALE * 96))</code> or similar.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></content><p><a href=https://perrotta.dev/tags/linux/>#linux</a>
<a href=https://perrotta.dev/tags/bestof/>#bestof★</a></p></main><hr><footer><span>© 2021 - 2025
<a href=mailto:tbperrotta@gmail.com>Thiago Perrotta
</a>·
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ·
<a href=/index.xml>RSS</a> ·
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo ʕ•ᴥ•ʔ bear</a></span></footer></body></html>