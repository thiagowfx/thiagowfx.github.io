<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>★ Alpine Linux: New APKBUILD Workflow | not just serendipity</title>
<meta name=keywords content="dev,linux,bestof"><meta name=description content="This document describes my workflow to manage APKBUILDs for the
aports repository in Alpine Linux."><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://www.perrotta.dev/2022/01/alpine-linux-new-apkbuild-workflow/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.perrotta.dev/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://www.perrotta.dev/favicon.ico><link rel=apple-touch-icon href=https://www.perrotta.dev/apple-touch-icon.png><link rel=mask-icon href=https://www.perrotta.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.perrotta.dev/2022/01/alpine-linux-new-apkbuild-workflow/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:title" content="★ Alpine Linux: New APKBUILD Workflow"><meta property="og:description" content="This document describes my workflow to manage APKBUILDs for the
aports repository in Alpine Linux."><meta property="og:type" content="article"><meta property="og:url" content="https://www.perrotta.dev/2022/01/alpine-linux-new-apkbuild-workflow/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-23T19:15:02-05:00"><meta property="article:modified_time" content="2022-01-23T19:15:02-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="★ Alpine Linux: New APKBUILD Workflow"><meta name=twitter:description content="This document describes my workflow to manage APKBUILDs for the
aports repository in Alpine Linux."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.perrotta.dev/posts/"},{"@type":"ListItem","position":2,"name":"★ Alpine Linux: New APKBUILD Workflow","item":"https://www.perrotta.dev/2022/01/alpine-linux-new-apkbuild-workflow/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"★ Alpine Linux: New APKBUILD Workflow","name":"★ Alpine Linux: New APKBUILD Workflow","description":"This document describes my workflow to manage APKBUILDs for the aports repository in Alpine Linux.\n","keywords":["dev","linux","bestof"],"articleBody":"This document describes my workflow to manage APKBUILDs for the aports repository in Alpine Linux.\nDisclaimer First of all, this post is not a substitute to the AlpineWiki and it will likely get outdated at some point. In particular, refer to the following articles for up-to-date documentation that will outlive this blog:\nhttps://wiki.alpinelinux.org/wiki/APKBUILD_Reference https://wiki.alpinelinux.org/wiki/Abuild_and_Helpers https://wiki.alpinelinux.org/wiki/Aports_tree https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package This article is not a tutorial, as such it assumes you already know what an APKBUILD is and how to use abuild. In particular, you should have the alpine-sdk, atools and spdx-licenses-list packages installed in your system.\nStructure I manage my packages with git. Create a GitLab account on https://gitlab.alpinelinux.org/, fork the aports tree, and git clone your fork.\nThe structure follows Alpine Linux repositories:\n$ git clone https://gitlab.alpinelinux.org/alpine/aports.git \u0026\u0026 tree -L 1 aports aports ├── CODINGSTYLE.md ├── COMMITSTYLE.md ├── README.md ├── community ├── main ├── non-free ├── scripts ├── testing └── unmaintained Bootstrapping I am going to illustrate with a package I added recently, sensible-utils:\nBefore you even begin, check if the package already exists, do a quick search in the Alpine Repositories1.\nStart by scaffolding a new APKBUILD from the base template:\n$ cd aports/testing # Always add new packages in testing/ first. $ newapkbuild sensible-utils $ cd sensible-utils $ $EDITOR APKBUILD Note: If you have a language-specific package (e.g. perl, python, rust), use the language-specific template instead of the base one. Run newapkbuild -h to list available templates. There are also some apkbuild-* helpers such as apkbuild-pypi and apkbuild-cpan.\nFill in APKBUILD metadata like pkgname=, url=, etc. Refer to the AlpineWiki for up-to-date best practices.\nBy doing so, I produced the following APKBUILD:\npkgname=sensible-utils pkgver=0.0.14 pkgrel=0 pkgdesc=\"Utilities for sensible alternative selection\" url=\"https://packages.debian.org/source/sensible-utils\" arch=\"all\" license=\"GPL-2.0-or-later\" makedepends=\"po4a\" subpackages=\"$pkgname-doc\" source=\"http://ftp.debian.org/debian/pool/main/s/$pkgname/${pkgname}_$pkgver.tar.xz\" builddir=\"$srcdir/$pkgname.git\" build() { ./configure --prefix=/usr make } check() { make -k check } package() { make DESTDIR=\"$pkgdir/\" install # only works with update-alternatives, specific to debian rm \"$pkgdir/usr/bin/select-editor\" } sha512sums=\" 15ba996f811ab3a9c1f5726f35766d74aafdf925c5c2392b33c6643d6c439796a742f9d0f4625c79de640e6b5e4a6a032b768eb1bc4ac31b448f9767b0ceed44 sensible-utils_0.0.14.tar.xz \" Note: $srcdir refers to the src/ directory within sensible-utils. $pkgdir refers to the pkg/ directory within sensible-utils.\nIf you’re used to Arch Linux PKGBUILDs you’ll notice a striking similarity to APKBUILDs. I highlighted a few notable differences in a previous post, My First APKBUILD.\nAdjustments Generate the checksums with abuild checksum. It will automatically update the APKBUILD inplace.\nDownload and extract package files with abuild unpack.\nls src/ and check the directory structure. Update $builddir in your APKBUILD to match it. Usually it will be $srcdir/$pkgname-$pkgver, but sometimes tiny adjustments are necessary. In this case, it was $srcdir/$pkgname.git.\nThen run abuild -r. If everything goes well, your package (and subpackages, if any) will be successfully built2 in an isolated environment and placed in ~/packages (sensible-utils-0.0.14-r0.apk and sensible-utils-doc-0.0.14-r0.apk), however that doesn’t mean it is a decent package yet.\nRun apkbuild-lint APKBUILD and abuild sanitycheck to lint your package and catch common errors. Fix the errors, if any.\nRequest feedback if needed If the package is only relevant to you, stop here. git commit, git push, and then you’re done. Install the package with doas apk add .\nOtherwise, if the package might be potentially useful to other Alpine users, you could consider uploading it to the aports repository.\nBefore you do so, stop for a moment and make an honest judgment whether this is a high quality package and whether you’re confident it is clean and polished enough, following the best practices documented in the Wiki. The answer doesn’t need to be positive, it’s perfectly OK to commit mistakes and everyone is a newbie at some point.\nIf the answer is negative, or if you’re new to this process and would like some help, fear no more! There are at least two decent community resources wherein to ask for help:\n#alpine-devel on OFTC IRC Drew DeVault wrote a good post about IRC etiquette.\nalpine-devel mailing list.\nIf you’re part of any other community (e.g. Reddit, Discord) feel free to ask therein as well. Avoid posting everywhere though, pick one community, draft your post and then patiently wait.\nPublish your package If all is well, it’s time to publish your APKBUILD. Follow the up-to-date steps at https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package#Code_review. There are basically two options:\nSend a gitlab merge request (MR). This follows the standard git forge workflow (GitHub / BitBucket / GitLab) wherein you fork the main repository, create a branch in your own clone, push it and then initiate a pull request3.\nAlternatively, send an email with your patch to the aports mailing list with git send-email:\n$ git config sendemail.to \"alpine-aports@lists.alpinelinux.org\" $ git send-email -1 # Implicitly uses --to=alpine-linux@lists.alpinelinux.org as set above Tip: The second approach has a steep learning curve, however once you figure it out it’s actually faster, simpler and more streamlined. Whenever a new email is sent to the aports mailing list, a MR is automatically created on GitLab.\nNote: If you adopt the email workflow and need to send a follow-up to your initial patch, do not use --in-reply-to. Instead, create a new email thread. This is needed because as of this post new GitLab MRs are only created when new email threads are created. Replies to existing email threads do not update the MR patch.\nAnd that’s all! Other useful tips:\nUse repology to look for preexisting packages in other Linux (or even BSD) distributions, it’s very handy as a starting point if you have no idea how to package a given package. In particular, Arch Linux PKGBUILDs are very similar to APKBUILDs. Gentoo EBUILDs and FreeBSD Makefiles are also reasonable approximations. Use abump to bump pkgver in APKBUILD files if the package gets an update to a newer upstream release. Use apkgrel to bump or reset the pkgrel value of your APKBUILD. Use urlwatch to track upstream updates. If you use https://duckduckgo.com/, query for !alpine sensible-utils. ↩︎\nPackage debugging is out of scope of this post. ↩︎\nIn GitLab it’s called Merge Request (MR). The list of all aports MRs is here. ↩︎\n","wordCount":"983","inLanguage":"en","datePublished":"2022-01-23T19:15:02-05:00","dateModified":"2022-01-23T19:15:02-05:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.perrotta.dev/2022/01/alpine-linux-new-apkbuild-workflow/"},"publisher":{"@type":"Person","name":"not just serendipity","logo":{"@type":"ImageObject","url":"https://www.perrotta.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.perrotta.dev/ accesskey=h title="not just serendipity (Alt + H)"><img src=https://www.perrotta.dev/apple-touch-icon.png alt aria-label=logo height=32>not just serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.perrotta.dev/posts/ title=posts><span>posts</span></a></li><li><a href=https://www.perrotta.dev/tags/bestof/ title="★ bestof"><span>★ bestof</span></a></li><li><a href=https://www.perrotta.dev/tags/serenity/ title=serenity><span>serenity</span></a></li><li><a href=https://www.perrotta.dev/archives/ title=archives><span>archives</span></a></li><li><a href=https://www.perrotta.dev/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://www.perrotta.dev/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">★ Alpine Linux: New APKBUILD Workflow</h1><div class=post-meta><span title='2022-01-23 19:15:02 -0500 -0500'>January 23, 2022</span>&nbsp;·&nbsp;983 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p>This document describes my workflow to manage <code>APKBUILDs</code> for the
<a href=https://gitlab.alpinelinux.org/alpine/aports>aports</a> repository in <a href=https://alpinelinux.org/>Alpine Linux</a>.</p><h2 id=disclaimer>Disclaimer<a hidden class=anchor aria-hidden=true href=#disclaimer>#</a></h2><p>First of all, this post is not a substitute to the <a href=https://wiki.alpinelinux.org/wiki/Main_Page>AlpineWiki</a>
and it will likely get outdated at some point. In particular, refer to the
following articles for up-to-date documentation that will outlive this blog:</p><ul><li><a href=https://wiki.alpinelinux.org/wiki/APKBUILD_Reference>https://wiki.alpinelinux.org/wiki/APKBUILD_Reference</a></li><li><a href=https://wiki.alpinelinux.org/wiki/Abuild_and_Helpers>https://wiki.alpinelinux.org/wiki/Abuild_and_Helpers</a></li><li><a href=https://wiki.alpinelinux.org/wiki/Aports_tree>https://wiki.alpinelinux.org/wiki/Aports_tree</a></li><li><a href=https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package>https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package</a></li></ul><p>This article is not a tutorial, as such it assumes you already know what an
<code>APKBUILD</code> is and how to use <code>abuild</code>. In particular, you should have the
<code>alpine-sdk</code>, <code>atools</code> and <code>spdx-licenses-list</code> packages installed in your
system.</p><h2 id=structure>Structure<a hidden class=anchor aria-hidden=true href=#structure>#</a></h2><p>I manage my packages with <code>git</code>. Create a GitLab account on
<a href=https://gitlab.alpinelinux.org/>https://gitlab.alpinelinux.org/</a>, fork the <a href=https://gitlab.alpinelinux.org/alpine/aports><code>aports</code></a> tree, and <code>git clone</code> your fork.</p><p>The structure follows Alpine Linux repositories:</p><pre tabindex=0><code>$ git clone https://gitlab.alpinelinux.org/alpine/aports.git &amp;&amp; tree -L 1 aports
aports
├── CODINGSTYLE.md
├── COMMITSTYLE.md
├── README.md
├── community
├── main
├── non-free
├── scripts
├── testing
└── unmaintained
</code></pre><h2 id=bootstrapping>Bootstrapping<a hidden class=anchor aria-hidden=true href=#bootstrapping>#</a></h2><p>I am going to illustrate with a package I added recently, <a href=https://packages.debian.org/source/sensible-utils><code>sensible-utils</code></a>:</p><ul><li><p>Before you even begin, check if the package already exists, do a quick search in the <a href="https://pkgs.alpinelinux.org/packages?name=sensible%2Dutils">Alpine Repositories</a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p></li><li><p>Start by scaffolding a new <code>APKBUILD</code> from the base template:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd aports/testing  <span style=color:#75715e># Always add new packages in testing/ first.</span>
</span></span><span style=display:flex><span>$ newapkbuild sensible-utils
</span></span><span style=display:flex><span>$ cd sensible-utils
</span></span><span style=display:flex><span>$ $EDITOR APKBUILD
</span></span></code></pre></div><p><strong>Note</strong>: If you have a language-specific package (e.g. perl, python, rust),
use the language-specific template instead of the base one. Run <code>newapkbuild -h</code> to list available templates. There are also some <code>apkbuild-*</code> helpers such
as <code>apkbuild-pypi</code> and <code>apkbuild-cpan</code>.</p><ul><li><p>Fill in <code>APKBUILD</code> metadata like <code>pkgname=</code>, <code>url=</code>, etc. Refer to the AlpineWiki for up-to-date best practices.</p></li><li><p>By doing so, I produced the following <code>APKBUILD</code>:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pkgname<span style=color:#f92672>=</span>sensible-utils
</span></span><span style=display:flex><span>pkgver<span style=color:#f92672>=</span>0.0.14
</span></span><span style=display:flex><span>pkgrel<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>pkgdesc<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Utilities for sensible alternative selection&#34;</span>
</span></span><span style=display:flex><span>url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://packages.debian.org/source/sensible-utils&#34;</span>
</span></span><span style=display:flex><span>arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;all&#34;</span>
</span></span><span style=display:flex><span>license<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;GPL-2.0-or-later&#34;</span>
</span></span><span style=display:flex><span>makedepends<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;po4a&#34;</span>
</span></span><span style=display:flex><span>subpackages<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-doc&#34;</span>
</span></span><span style=display:flex><span>source<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://ftp.debian.org/debian/pool/main/s/</span>$pkgname<span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>pkgname<span style=color:#e6db74>}</span><span style=color:#e6db74>_</span>$pkgver<span style=color:#e6db74>.tar.xz&#34;</span>
</span></span><span style=display:flex><span>builddir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$srcdir<span style=color:#e6db74>/</span>$pkgname<span style=color:#e6db74>.git&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>build<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	./configure --prefix<span style=color:#f92672>=</span>/usr
</span></span><span style=display:flex><span>	make
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>check<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	make -k check
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>package<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	make DESTDIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/&#34;</span> install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># only works with update-alternatives, specific to debian</span>
</span></span><span style=display:flex><span>	rm <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/bin/select-editor&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sha512sums<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>15ba996f811ab3a9c1f5726f35766d74aafdf925c5c2392b33c6643d6c439796a742f9d0f4625c79de640e6b5e4a6a032b768eb1bc4ac31b448f9767b0ceed44  sensible-utils_0.0.14.tar.xz
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p><strong>Note</strong>: <code>$srcdir</code> refers to the <code>src/</code> directory within <code>sensible-utils</code>. <code>$pkgdir</code>
refers to the <code>pkg/</code> directory within <code>sensible-utils</code>.</p><p>If you&rsquo;re used to Arch Linux <code>PKGBUILDs</code> you&rsquo;ll notice a striking similarity to
<code>APKBUILDs</code>. I highlighted a few notable differences in a previous post, <a href=https://www.perrotta.dev/2022/01/my-first-apkbuild/#build-comparison><code>My First APKBUILD</code></a>.</p><h2 id=adjustments>Adjustments<a hidden class=anchor aria-hidden=true href=#adjustments>#</a></h2><ul><li><p>Generate the checksums with <code>abuild checksum</code>. It will automatically update the <code>APKBUILD</code> inplace.</p></li><li><p>Download and extract package files with <code>abuild unpack</code>.</p></li><li><p><code>ls src/</code> and check the directory structure. Update <code>$builddir</code> in your
<code>APKBUILD</code> to match it. Usually it will be <code>$srcdir/$pkgname-$pkgver</code>, but
sometimes tiny adjustments are necessary. In this case, it was
<code>$srcdir/$pkgname.git</code>.</p></li><li><p>Then run <code>abuild -r</code>. If everything goes well, your package (and subpackages,
if any) will be successfully built<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> in an isolated environment and placed
in <code>~/packages</code> (<code>sensible-utils-0.0.14-r0.apk</code> and
<code>sensible-utils-doc-0.0.14-r0.apk</code>), however that doesn&rsquo;t mean it is a decent
package yet.</p></li><li><p>Run <code>apkbuild-lint APKBUILD</code> and <code>abuild sanitycheck</code> to lint your package
and catch common errors. Fix the errors, if any.</p></li></ul><h2 id=request-feedback-if-needed>Request feedback if needed<a hidden class=anchor aria-hidden=true href=#request-feedback-if-needed>#</a></h2><p>If the package is only relevant to you, stop here. <code>git commit</code>, <code>git push</code>, and then you&rsquo;re done. Install the package with <code>doas apk add &lt;pkg></code>.</p><p>Otherwise, if the package might be potentially useful to other Alpine users, you could consider uploading it to the <a href=https://gitlab.alpinelinux.org/alpine/aports>aports</a> repository.</p><p>Before you do so, stop for a moment and make an honest judgment whether this is a high quality package and whether you&rsquo;re confident it is clean and polished enough, following the best practices documented in the Wiki. The answer doesn&rsquo;t need to be positive, it&rsquo;s perfectly OK to commit mistakes and everyone is a newbie at some point.</p><p>If the answer is negative, or if you&rsquo;re new to this process and would like some help, fear no more! There are at least two decent community resources wherein to ask for help:</p><ol><li><p><a href=https://wiki.alpinelinux.org/wiki/Alpine_Linux:IRC><code>#alpine-devel</code> on OFTC IRC</a> Drew DeVault wrote a good <a href=https://drewdevault.com/2021/11/24/A-philosophy-for-instant-messaging.html>post</a> about IRC etiquette.</p></li><li><p><a href=https://wiki.alpinelinux.org/wiki/Alpine_Linux:Mailing_lists><code>alpine-devel</code> mailing list</a>.</p></li></ol><p>If you&rsquo;re part of any other community (e.g. Reddit, Discord) feel free to ask therein as well. Avoid posting everywhere though, pick one community, draft your post and then patiently wait.</p><h2 id=publish-your-package>Publish your package<a hidden class=anchor aria-hidden=true href=#publish-your-package>#</a></h2><p>If all is well, it&rsquo;s time to publish your <code>APKBUILD</code>. Follow the up-to-date
steps at
<a href=https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package#Code_review>https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package#Code_review</a>. There are basically two options:</p><ol><li><p>Send a gitlab merge request (MR). This follows the standard git forge workflow
(GitHub / BitBucket / GitLab) wherein you fork the main repository, create
a branch in your own clone, push it and then initiate a pull request<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p></li><li><p>Alternatively, send an email with your patch to the <code>aports</code> mailing list
with <a href=https://git-send-email.io/><code>git send-email</code></a>:</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ git config sendemail.to <span style=color:#e6db74>&#34;alpine-aports@lists.alpinelinux.org&#34;</span>
</span></span><span style=display:flex><span>$ git send-email -1  <span style=color:#75715e># Implicitly uses --to=alpine-linux@lists.alpinelinux.org as set above</span>
</span></span></code></pre></div><p><strong>Tip</strong>: The second approach has a steep learning curve, however once you
figure it out it&rsquo;s actually faster, simpler and more streamlined. Whenever
a new email is sent to the aports mailing list, a MR is automatically created
on GitLab.</p><p><strong>Note</strong>: If you adopt the email workflow and need to send a follow-up to your
initial patch, do not use <code>--in-reply-to</code>. Instead, create a new email thread.
This is needed because as of this post new GitLab MRs are only created when new
email threads are created. Replies to existing email threads do not update the
MR patch.</p><p>And that&rsquo;s all! Other useful tips:</p><ul><li>Use <a href=https://repology.org/>repology</a> to look for preexisting packages in other Linux (or even BSD) distributions, it&rsquo;s very handy as a starting point if you have no idea how to package a given package. In particular, Arch Linux <code>PKGBUILDs</code> are very similar to <code>APKBUILDs</code>. Gentoo <code>EBUILDs</code> and FreeBSD <code>Makefiles</code> are also reasonable approximations.</li><li>Use <code>abump</code> to bump pkgver in <code>APKBUILD</code> files if the package gets an update to a newer upstream release.</li><li>Use <code>apkgrel</code> to bump or reset the <code>pkgrel</code> value of your <code>APKBUILD</code>.</li><li>Use <a href=https://www.perrotta.dev/2022/01/arch-linux-new-pkgbuild-workflow/#bonus-track-upstream><code>urlwatch</code></a> to track upstream updates.</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>If you use <a href=https://duckduckgo.com/>https://duckduckgo.com/</a>, query for <code>!alpine sensible-utils</code>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Package debugging is out of scope of this post.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>In GitLab it&rsquo;s called Merge Request (MR). The list of all aports MRs is <a href=https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests>here</a>.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.perrotta.dev/tags/dev/>Dev</a></li><li><a href=https://www.perrotta.dev/tags/linux/>Linux</a></li><li><a href=https://www.perrotta.dev/tags/bestof/>Bestof</a></li></ul></footer></article></main><footer class=footer><span>Copyright © 2021 - 2024 Thiago Perrotta · <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> · <a href=/index.xml>RSS</a> · Made with ♥ in 🇨🇦</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>