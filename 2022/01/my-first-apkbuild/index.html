<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>★ My First APKBUILD | Not Just Serendipity</title>
<meta name=keywords content="linux"><meta name=description content="In the same spirit of my first PKGBUILD and Ebuild, herein I will describe my first APKBUILD."><meta name=author content="Thiago Perrotta"><link rel=canonical href=https://thiagowfx.github.io/2022/01/my-first-apkbuild/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://thiagowfx.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://thiagowfx.github.io/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://thiagowfx.github.io/favicon.ico><link rel=apple-touch-icon href=https://thiagowfx.github.io/apple-touch-icon.png><link rel=mask-icon href=https://thiagowfx.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>body{font-family:Crimson Pro,Vollkorn,Alegreya,Iowan Old Style,Apple Garamond,Baskerville,Times New Roman,Noto Serif,Droid Serif,Times,Source Serif Pro,serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}h1,h2,h3,h4,h5,h6,footer,nav,.toc,.post-meta{font-family:Inter,Fira Sans,Lato,system-ui,-apple-system,BlinkMacSystemFont,Avenir Next,Avenir,Segoe UI,Helvetica Neue,Helvetica,Ubuntu,Roboto,Noto,Cantarell,Arial,sans-serif}code,pre{font-family:Fira Code,PT Mono,IBM Plex Mono,Menlo,Consolas,Monaco,Liberation Mono,Ubuntu Mono,Lucida Console,monospace}</style><meta property="og:title" content="★ My First APKBUILD"><meta property="og:description" content="In the same spirit of my first PKGBUILD and Ebuild, herein I will describe my first APKBUILD."><meta property="og:type" content="article"><meta property="og:url" content="https://thiagowfx.github.io/2022/01/my-first-apkbuild/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-07T20:03:07-05:00"><meta property="article:modified_time" content="2022-01-07T20:03:07-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="★ My First APKBUILD"><meta name=twitter:description content="In the same spirit of my first PKGBUILD and Ebuild, herein I will describe my first APKBUILD."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://thiagowfx.github.io/posts/"},{"@type":"ListItem","position":2,"name":"★ My First APKBUILD","item":"https://thiagowfx.github.io/2022/01/my-first-apkbuild/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"★ My First APKBUILD","name":"★ My First APKBUILD","description":"In the same spirit of my first PKGBUILD and Ebuild, herein I will describe my first APKBUILD.\n","keywords":["linux"],"articleBody":"In the same spirit of my first PKGBUILD and Ebuild, herein I will describe my first APKBUILD.\nAt a glance Alpine Linux package management is very similar to Arch Linux, with tiny differences:\nPKGBUILD → APKBUILD: The filename is obviously different. Their format are very similar though, both of them are bash scripts with variables and functions. In particular, there’s check, patch, build and package. cp /usr/share/pacman/PKGBUILD.proto → newapkbuild: Template versus scaffolding. pacman → apk: The package manager is different. makepkg -s → abuild -r: makepkg drives all things package building for pacman. abuild drives package building for apk. makepkg -i → apk add : makepkg can also drive package installations whereas abuild cannot, apk must be used. namcap → apkbuild-lint (from atools) + abuild sanitycheck1: Linters are different. updpkgsums → abuild checksum: Generate hashes for package sources. XKCD Courtesy of Randall Munroe\nOther than that, the process of writing an APKBUILD is very similar to writing a PKGBUILD. In fact, the Arch repositories (especially the AUR) tend to be much more comprehensive than Alpine’s in terms of number of packages, so chances are if you want to write a new package for Alpine, check in Arch’s repos first, it’s a good starting point.\nMy first package: fpp fpp stands for ‘Facebook Path Picker’.\nAs of the time of this post, I maintain fpp-git in the AUR. It looks like this:\npkgname=fpp-git pkgver=0.9.2.r130.ge0d5cfc pkgrel=1 pkgdesc='TUI that lets you pick paths out of its stdin and run arbitrary commands on them' url='https://facebook.github.io/PathPicker' license=('MIT') source=(\"${pkgname%-git}::git+https://github.com/facebook/PathPicker.git\") sha256sums=('SKIP') arch=('any') makedepends=('git') depends=('python') conflicts=(\"${pkgname%-git}\") provides=(\"${pkgname%-git}\") prepare() { cd \"$srcdir/${pkgname%-git}\" rm -r \"src/tests\" } pkgver() { cd \"$srcdir/${pkgname%-git}\" git describe --long --tags | sed 's/\\([^-]*-g\\)/r\\1/;s/-/./g' } package() { cd \"$srcdir/${pkgname%-git}\" # library install -Dm755 \"fpp\" -t \"$pkgdir/usr/share/fpp\" cp -a src \"$pkgdir/usr/share/fpp\" # entrypoint install -dm755 \"$pkgdir/usr/bin\" ln -s \"/usr/share/fpp/fpp\" \"$pkgdir/usr/bin\" # documentation install -Dm644 LICENSE -t \"$pkgdir/usr/share/licenses/$pkgname\" install -Dm644 \"debian/usr/share/man/man1/fpp.1\" -t \"$pkgdir/usr/share/man/man1\" } PKGBUILD guidelines and instructions:\nhttps://wiki.archlinux.org/title/PKGBUILD https://wiki.archlinux.org/title/Arch_package_guidelines The equivalent APKBUILD I wrote looks like this:\npkgname=fpp pkgver=0.9.2 pkgrel=0 pkgdesc=\"TUI that lets you pick paths out of its stdin and run arbitrary commands on them\" url=\"https://facebook.github.io/PathPicker\" arch=\"noarch\" license=\"MIT\" depends=\"bash python3\" subpackages=\"$pkgname-doc\" source=\"$pkgname-$pkgver.tar.gz::https://github.com/facebook/PathPicker/archive/$pkgver.tar.gz\" builddir=\"$srcdir/PathPicker-$pkgver\" check() { fpp --version } prepare() { default_prepare rm -r \"src/__tests__\" } package() { # library install -Dm755 \"fpp\" -t \"$pkgdir/usr/share/fpp\" cp -a src \"$pkgdir/usr/share/fpp\" # entrypoint install -dm755 \"$pkgdir/usr/bin\" ln -s \"/usr/share/fpp/fpp\" \"$pkgdir/usr/bin\" # documentation install -Dm644 LICENSE -t \"$pkgdir/usr/share/licenses/$pkgname\" install -Dm644 \"debian/usr/share/man/man1/fpp.1\" -t \"$pkgdir/usr/share/man/man1\" } sha512sums=\" 65b6b077f437bd642ebf94c55be901aabc73f7b9c89e4522c4f51970c4d63d744ad8fa29cac06816851f63bcb81d0480e61d405231c582e9aca0f4e650949a97 fpp-0.9.2.tar.gz \" APKBUILD guidelines and instructions:\nhttps://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package https://wiki.alpinelinux.org/wiki/APKBUILD_Reference Build Comparison Let’s highlight a few similarities and differences in them, excluding the fact that one is fetched from git and the other one fetches a point release directly2:\npackage metadata, by the means of bash variables, are almost equivalent one-to-one A notable difference is the architecture, Arch primarily supports x86_64 whereas Alpine has support for multiple architectures. When a package is architecture agnostic, Arch denotes it with any whereas alpine has both noarch and all, the latter is like any (=all architectures), the former means it’s agnostic (=e.g. a pure bash script or python package). APKBUILDs use flat strings, whereas PKGBUILDs use bash arrays Alpine encourages splitting larger packages into subpackages, as such APKBUILD has first-class support and syntactic sugar for that. -dev and -doc subpackages are very common. On the other hand, Arch tends to have monolithic packages in order to keep it simple, although it also supports subpackages. Alpine supports setting $builddir whereas Arch doesn’t. As a consequence, it’s often unneeded to cd in build() and package() in Alpine, whereas in Arch one does need to manually change directories to $srcdir/$pkgname before building. Alpine lacks optional dependencies, whereas Arch has optdepends. Alpine enforces the use of check in test packages, otherwise it needs to be explicitly disabled and documented with !check in options=. That’s not the case in Arch. check(), build() and package() are pretty much similar in both formats. $srcdir and $pkgdir are provided in both. The ArchWiki is way more documented in terms of packaging guidelines and examples than Alpine’s. If you use DuckDuckGo, you can query for !aw as a bang shortcut to search directly in the ArchWiki. Last but not least, in Arch one can install package tarballs3 with makepkg -i or pacman -U. In Alpine that approach doesn’t seem to be directly supported. The workflow is to add a local repository diretory in /etc/apk/repositories (notice the last two lines):\n$ cat /etc/apk/repositories # http://dl-cdn.alpinelinux.org/alpine/v3.15/main # http://dl-cdn.alpinelinux.org/alpine/v3.15/community # http://dl-cdn.alpinelinux.org/alpine/latest-stable/main # http://dl-cdn.alpinelinux.org/alpine/latest-stable/community http://dl-cdn.alpinelinux.org/alpine/edge/main http://dl-cdn.alpinelinux.org/alpine/edge/community http://dl-cdn.alpinelinux.org/alpine/edge/testing /home/$USER/packages/community /home/$USER/packages/testing abuild will place the resulting package tarball in ~/packages, in this case:\n$ ls ~/packages/testing/x86_64/fpp* /home/$USER/packages/testing/x86_64/fpp-0.9.2-r0.apk /home/$USER/packages/testing/x86_64/fpp-doc-0.9.2-r0.apk …and then apk add fpp will automagically recognize it’s in there and install it. The advantage of this approach is that it keeps a local package repository around and it’s well integrated with apk, way differently from pacman that has no integration with the AUR at all. One could also possibly set up a local repository in Arch, for example, with ccm, but it takes extra steps and it’s not officially supported.\nUpstream Contributions On Arch, to contribute a PKGBUILD upstream one just needs to create an account in the AUR. Armed with a git + ssh infrastructure, all you need to do is git push. There are no ACLs involved, anyone can do that4.\nOn Alpine there’s a bit more of politics involved5: Anyone can send a patch(1), either via mailing list or via a Gitlab MR (merge request). Patch works well with git send-email -1, being automatically cross-posted to a Gitlab MR. On the other hand the MR workflow is easier to be followed up on feedback from developers and other contributors (git push --force), and it’s also cross-posted, to the mailing list. An Alpine developer with the appropriate permissions must approve your patch/MR before it becomes available to other Alpine users.\nSadly at the time of this writing my patch hasn’t yet been approved (2 weeks later), however we’re in holiday season. This wouldn’t have been a problem in the AUR, where I could have just pushed it immediately, without any review. On the other hand the Alpine approach at least gives me some hope that the submitted packages have slightly higher quality than the average ones in the AUR, since they need to be manually reviewed/approved/vetted by at least one Alpine developer.\nInstall spdx-licenses-list to lint the licenses, it’s used by abuild sanitycheck as an optional dependency. ↩︎\nThe AUR tends to have both non-vcs and vcs versions of a software, whereas Alpine is focused a bit more on stability and tends to have non-vcs only. This is not a hard rule though, exceptions may exist. ↩︎\n.tar.xz or, more recently, .tar.zstd. ↩︎\nAnd this is one of the reasons why you should always inspect every PKGBUILD you install from the Arch User Repository, as it could have been tampered with and/or contain malicious code. ↩︎\nI’ll leave it open-ended whether that’s a bug or a feature. Depending on the lens you see through, it could be considered either gatekeeping (bureaucracy, control) or sanity (quality, stability). It has pros and cons, and even those are arguable. ↩︎\n","wordCount":"1181","inLanguage":"en","datePublished":"2022-01-07T20:03:07-05:00","dateModified":"2022-01-07T20:03:07-05:00","author":{"@type":"Person","name":"Thiago Perrotta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://thiagowfx.github.io/2022/01/my-first-apkbuild/"},"publisher":{"@type":"Person","name":"Not Just Serendipity","logo":{"@type":"ImageObject","url":"https://thiagowfx.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://thiagowfx.github.io/ accesskey=h title="Not Just Serendipity (Alt + H)"><img src=https://thiagowfx.github.io/apple-touch-icon.png alt aria-label=logo height=32>Not Just Serendipity</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://thiagowfx.github.io/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://thiagowfx.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://thiagowfx.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://thiagowfx.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>★ My First APKBUILD</h1><div class=post-meta><span title='2022-01-07 20:03:07 -0500 -0500'>January 7, 2022</span>&nbsp;·&nbsp;1181 words&nbsp;·&nbsp;Thiago Perrotta</div></header><div class=post-content><p>In the same spirit of my first <a href=https://thiagowfx.github.io/2014/02/meu-primeiro-pkgbuild/><code>PKGBUILD</code></a> and <a href=https://thiagowfx.github.io/2014/09/my-first-ebuild/><code>Ebuild</code></a>, herein I will describe my first <code>APKBUILD</code>.</p><h2 id=at-a-glance>At a glance<a hidden class=anchor aria-hidden=true href=#at-a-glance>#</a></h2><p>Alpine Linux package management is very similar to Arch Linux, with tiny differences:</p><ul><li><code>PKGBUILD</code> → <code>APKBUILD</code>: The filename is obviously different. Their format are very similar though, both of them are bash scripts with variables and functions. In particular, there&rsquo;s <code>check</code>, <code>patch</code>, <code>build</code> and <code>package</code>.</li><li><code>cp /usr/share/pacman/PKGBUILD.proto</code> → <code>newapkbuild</code>: Template versus scaffolding.</li><li><code>pacman</code> → <code>apk</code>: The package manager is different.</li><li><code>makepkg -s</code> → <code>abuild -r</code>: <code>makepkg</code> drives all things package building for <code>pacman</code>. <code>abuild</code> drives package building for <code>apk</code>.</li><li><code>makepkg -i</code> → <code>apk add &lt;pkg></code>: <code>makepkg</code> can also drive package installations whereas <code>abuild</code> cannot, <code>apk</code> must be used.</li><li><code>namcap</code> → <code>apkbuild-lint</code> (from <code>atools</code>) + <code>abuild sanitycheck</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>: Linters are different.</li><li><code>updpkgsums</code> → <code>abuild checksum</code>: Generate hashes for package sources.</li></ul><figure class=align-center><a href=https://xkcd.com/927/><img loading=lazy src=https://imgs.xkcd.com/comics/standards.png#center alt="Fortunately, the charging one has been solved now that we've all standardized on mini-USB. Or is it micro-USB? Shit."></a><figcaption><p>XKCD Courtesy of Randall Munroe</p></figcaption></figure><p>Other than that, the process of writing an <code>APKBUILD</code> is very similar to writing a <code>PKGBUILD</code>. In fact, the Arch repositories (especially the <a href=https://aur.archlinux.org/>AUR</a>) tend to be much more comprehensive than Alpine&rsquo;s in terms of number of packages, so chances are if you want to write a new package for Alpine, check in Arch&rsquo;s repos first, it&rsquo;s a good starting point.</p><h2 id=my-first-package-fpp>My first package: <code>fpp</code><a hidden class=anchor aria-hidden=true href=#my-first-package-fpp>#</a></h2><p><code>fpp</code> stands for &lsquo;Facebook Path Picker&rsquo;.</p><p>As of the time of this post, I maintain <a href=https://aur.archlinux.org/packages/fpp-git/><code>fpp-git</code></a> in the AUR. It looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pkgname<span style=color:#f92672>=</span>fpp-git
</span></span><span style=display:flex><span>pkgver<span style=color:#f92672>=</span>0.9.2.r130.ge0d5cfc
</span></span><span style=display:flex><span>pkgrel<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>pkgdesc<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;TUI that lets you pick paths out of its stdin and run arbitrary commands on them&#39;</span>
</span></span><span style=display:flex><span>url<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;https://facebook.github.io/PathPicker&#39;</span>
</span></span><span style=display:flex><span>license<span style=color:#f92672>=(</span><span style=color:#e6db74>&#39;MIT&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>source<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pkgname%-git<span style=color:#e6db74>}</span><span style=color:#e6db74>::git+https://github.com/facebook/PathPicker.git&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>sha256sums<span style=color:#f92672>=(</span><span style=color:#e6db74>&#39;SKIP&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>arch<span style=color:#f92672>=(</span><span style=color:#e6db74>&#39;any&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>makedepends<span style=color:#f92672>=(</span><span style=color:#e6db74>&#39;git&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>depends<span style=color:#f92672>=(</span><span style=color:#e6db74>&#39;python&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>conflicts<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pkgname%-git<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>provides<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pkgname%-git<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>prepare<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  cd <span style=color:#e6db74>&#34;</span>$srcdir<span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>pkgname%-git<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  rm -r <span style=color:#e6db74>&#34;src/tests&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pkgver<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  cd <span style=color:#e6db74>&#34;</span>$srcdir<span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>pkgname%-git<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  git describe --long --tags | sed <span style=color:#e6db74>&#39;s/\([^-]*-g\)/r\1/;s/-/./g&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>package<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  cd <span style=color:#e6db74>&#34;</span>$srcdir<span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>pkgname%-git<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># library</span>
</span></span><span style=display:flex><span>  install -Dm755 <span style=color:#e6db74>&#34;fpp&#34;</span> -t <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/share/fpp&#34;</span>
</span></span><span style=display:flex><span>  cp -a src <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/share/fpp&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># entrypoint</span>
</span></span><span style=display:flex><span>  install -dm755 <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/bin&#34;</span>
</span></span><span style=display:flex><span>  ln -s <span style=color:#e6db74>&#34;/usr/share/fpp/fpp&#34;</span> <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/bin&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># documentation</span>
</span></span><span style=display:flex><span>  install -Dm644 LICENSE -t <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/share/licenses/</span>$pkgname<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  install -Dm644 <span style=color:#e6db74>&#34;debian/usr/share/man/man1/fpp.1&#34;</span> -t <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/share/man/man1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><code>PKGBUILD</code> guidelines and instructions:</p><ul><li><a href=https://wiki.archlinux.org/title/PKGBUILD>https://wiki.archlinux.org/title/PKGBUILD</a></li><li><a href=https://wiki.archlinux.org/title/Arch_package_guidelines>https://wiki.archlinux.org/title/Arch_package_guidelines</a></li></ul><p>The equivalent <code>APKBUILD</code> I wrote looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pkgname<span style=color:#f92672>=</span>fpp
</span></span><span style=display:flex><span>pkgver<span style=color:#f92672>=</span>0.9.2
</span></span><span style=display:flex><span>pkgrel<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>pkgdesc<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;TUI that lets you pick paths out of its stdin and run arbitrary commands on them&#34;</span>
</span></span><span style=display:flex><span>url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://facebook.github.io/PathPicker&#34;</span>
</span></span><span style=display:flex><span>arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;noarch&#34;</span>
</span></span><span style=display:flex><span>license<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MIT&#34;</span>
</span></span><span style=display:flex><span>depends<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bash python3&#34;</span>
</span></span><span style=display:flex><span>subpackages<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-doc&#34;</span>
</span></span><span style=display:flex><span>source<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>.tar.gz::https://github.com/facebook/PathPicker/archive/</span>$pkgver<span style=color:#e6db74>.tar.gz&#34;</span>
</span></span><span style=display:flex><span>builddir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$srcdir<span style=color:#e6db74>/PathPicker-</span>$pkgver<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>check<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	fpp --version
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>prepare<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	default_prepare
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	rm -r <span style=color:#e6db74>&#34;src/__tests__&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>package<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># library</span>
</span></span><span style=display:flex><span>	install -Dm755 <span style=color:#e6db74>&#34;fpp&#34;</span> -t <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/share/fpp&#34;</span>
</span></span><span style=display:flex><span>	cp -a src <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/share/fpp&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># entrypoint</span>
</span></span><span style=display:flex><span>	install -dm755 <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/bin&#34;</span>
</span></span><span style=display:flex><span>	ln -s <span style=color:#e6db74>&#34;/usr/share/fpp/fpp&#34;</span> <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/bin&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># documentation</span>
</span></span><span style=display:flex><span>	install -Dm644 LICENSE -t <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/share/licenses/</span>$pkgname<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>	install -Dm644 <span style=color:#e6db74>&#34;debian/usr/share/man/man1/fpp.1&#34;</span> -t <span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/usr/share/man/man1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sha512sums<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>65b6b077f437bd642ebf94c55be901aabc73f7b9c89e4522c4f51970c4d63d744ad8fa29cac06816851f63bcb81d0480e61d405231c582e9aca0f4e650949a97  fpp-0.9.2.tar.gz
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p><code>APKBUILD</code> guidelines and instructions:</p><ul><li><a href=https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package>https://wiki.alpinelinux.org/wiki/Creating_an_Alpine_package</a></li><li><a href=https://wiki.alpinelinux.org/wiki/APKBUILD_Reference>https://wiki.alpinelinux.org/wiki/APKBUILD_Reference</a></li></ul><h2 id=build-comparison>Build Comparison<a hidden class=anchor aria-hidden=true href=#build-comparison>#</a></h2><p>Let&rsquo;s highlight a few similarities and differences in them, excluding the fact that one is fetched from git and the other one fetches a point release directly<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>:</p><ul><li>package metadata, by the means of bash variables, are almost equivalent
one-to-one<ul><li>A notable difference is the architecture, Arch primarily supports
<em>x86_64</em> whereas Alpine has support for multiple architectures. When
a package is architecture agnostic, Arch denotes it with <code>any</code> whereas
alpine has both <code>noarch</code> and <code>all</code>, the latter is like <code>any</code> (=all
architectures), the <code>former</code> means it&rsquo;s agnostic (=e.g. a pure bash script
or python package).</li><li><code>APKBUILDs</code> use flat strings, whereas <code>PKGBUILDs</code> use bash arrays</li><li>Alpine encourages splitting larger packages into subpackages, as such
<code>APKBUILD</code> has first-class support and syntactic sugar for that. <code>-dev</code> and
<code>-doc</code> subpackages are very common. On the other hand, Arch tends to have
monolithic packages in order to keep it simple, although it also supports
subpackages.</li><li>Alpine supports setting <code>$builddir</code> whereas Arch doesn&rsquo;t. As a consequence, it&rsquo;s often unneeded to <code>cd</code> in <code>build()</code> and <code>package()</code> in Alpine, whereas in Arch one does need to manually change directories to <code>$srcdir/$pkgname</code> before building.</li><li>Alpine lacks optional dependencies, whereas Arch has <code>optdepends</code>.</li></ul></li><li>Alpine enforces the use of <code>check</code> in test packages, otherwise it needs to be explicitly disabled and documented with <code>!check</code> in <code>options=</code>. That&rsquo;s not the case in Arch.</li><li><code>check()</code>, <code>build()</code> and <code>package()</code> are pretty much similar in both formats. <code>$srcdir</code> and <code>$pkgdir</code> are provided in both.</li><li>The <a href=https://wiki.archlinux.org/title/Main_page>ArchWiki</a> is way more documented in terms of packaging guidelines and examples than Alpine&rsquo;s. If you use DuckDuckGo, you can query for <code>!aw &lt;foo></code> as a bang shortcut to search directly in the ArchWiki.</li></ul><p>Last but not least, in Arch one can install package tarballs<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> with <code>makepkg -i</code> or <code>pacman -U</code>. In Alpine that approach doesn&rsquo;t seem to be directly supported. The workflow is to add a local repository diretory in <code>/etc/apk/repositories</code> (notice the last two lines):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat /etc/apk/repositories
</span></span><span style=display:flex><span><span style=color:#75715e># http://dl-cdn.alpinelinux.org/alpine/v3.15/main</span>
</span></span><span style=display:flex><span><span style=color:#75715e># http://dl-cdn.alpinelinux.org/alpine/v3.15/community</span>
</span></span><span style=display:flex><span><span style=color:#75715e># http://dl-cdn.alpinelinux.org/alpine/latest-stable/main</span>
</span></span><span style=display:flex><span><span style=color:#75715e># http://dl-cdn.alpinelinux.org/alpine/latest-stable/community</span>
</span></span><span style=display:flex><span>http://dl-cdn.alpinelinux.org/alpine/edge/main
</span></span><span style=display:flex><span>http://dl-cdn.alpinelinux.org/alpine/edge/community
</span></span><span style=display:flex><span>http://dl-cdn.alpinelinux.org/alpine/edge/testing
</span></span><span style=display:flex><span>/home/$USER/packages/community
</span></span><span style=display:flex><span>/home/$USER/packages/testing
</span></span></code></pre></div><p><code>abuild</code> will place the resulting package tarball in <code>~/packages</code>, in this case:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ls ~/packages/testing/x86_64/fpp*
</span></span><span style=display:flex><span>/home/$USER/packages/testing/x86_64/fpp-0.9.2-r0.apk
</span></span><span style=display:flex><span>/home/$USER/packages/testing/x86_64/fpp-doc-0.9.2-r0.apk
</span></span></code></pre></div><p>&mldr;and then <code>apk add fpp</code> will automagically recognize it&rsquo;s in there and install it. The advantage of this approach is that it keeps a local package repository around and it&rsquo;s well integrated with <code>apk</code>, way differently from <code>pacman</code> that has no integration with the AUR at all. One could also possibly set up a local repository in Arch, for example, with <a href=https://github.com/graysky2/clean-chroot-manager><code>ccm</code></a>, but it takes extra steps and it&rsquo;s not officially supported.</p><h2 id=upstream-contributions>Upstream Contributions<a hidden class=anchor aria-hidden=true href=#upstream-contributions>#</a></h2><p>On Arch, to contribute a <code>PKGBUILD</code> upstream one just needs to create an account in the <a href=https://aur.archlinux.org/>AUR</a>. Armed with a git + ssh infrastructure, all you need to do is <code>git push</code>. There are no ACLs involved, anyone can do that<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>.</p><p>On Alpine there&rsquo;s a bit more of politics involved<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>: Anyone can send a <code>patch(1)</code>, either via <a href=mailto:alpine-aports@lists.alpinelinux.org>mailing list</a> or via a <a href=https://gitlab.alpinelinux.org/alpine/aports>Gitlab MR</a> (merge request). Patch works well with <code>git send-email -1</code>, being automatically cross-posted to a Gitlab MR. On the other hand the MR workflow is easier to be followed up on feedback from developers and other contributors (<code>git push --force</code>), and it&rsquo;s also cross-posted, to the mailing list. An Alpine developer with the appropriate permissions must approve your patch/MR before it becomes available to other Alpine users.</p><p>Sadly at the time of this writing <a href=https://lists.alpinelinux.org/~alpine/aports/patches/3799>my patch</a> hasn&rsquo;t yet been approved (2 weeks later), however we&rsquo;re in holiday season. This wouldn&rsquo;t have been a problem in the AUR, where I could have just pushed it immediately, without any review. On the other hand the Alpine approach at least gives me some hope that the submitted packages have slightly higher quality than the average ones in the AUR, since they need to be manually reviewed/approved/vetted by at least one Alpine developer.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Install <code>spdx-licenses-list</code> to lint the licenses, it&rsquo;s used by <code>abuild sanitycheck</code> as an optional dependency.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>The AUR tends to have both non-vcs and vcs versions of a software, whereas Alpine is focused a bit more on stability and tends to have non-vcs only. This is not a hard rule though, exceptions may exist.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><code>.tar.xz</code> or, more recently, <code>.tar.zstd</code>.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>And this is one of the reasons why you should always inspect every <code>PKGBUILD</code> you install from the Arch User Repository, as it could have been tampered with and/or contain malicious code.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>I&rsquo;ll leave it open-ended whether that&rsquo;s a bug or a feature. Depending on the lens you see through, it could be considered either gatekeeping (bureaucracy, control) or sanity (quality, stability). It has pros and cons, and even those are arguable.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://thiagowfx.github.io/tags/linux/>linux</a></li></ul></footer><div style=text-align:center><a href="mailto:tbperrotta@gmail.com?subject=RE: Not%20Just%20Serendipity comment for '%e2%98%85%20My%20First%20APKBUILD'" target=_blank><button>Reply via email</button></a></div></article></main><footer class=footer><span>Copyright © 2021 - 2023 Thiago Perrotta • <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> • <a href=/index.xml>RSS</a> •</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>