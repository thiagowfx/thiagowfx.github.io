<!doctype html><html lang=en id=root-html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=theme-color content="#eff1f5" media="(prefers-color-scheme: light)"><meta name=theme-color content="#1e1e2e" media="(prefers-color-scheme: dark)"><title class=title>Alpine Linux on Raspberry Pi: Diskless Mode with persistent storage | ¬¨ just serendipity üçÄ</title><meta name=title content="Alpine Linux on Raspberry Pi: Diskless Mode with persistent storage"><meta name=description content="Use case: Given an Alpine Linux diskless1 installation meant for a Raspberry Pi setup, we would like to add a persistent storage component to it to make it ‚Ä¶"><meta name=keywords content="alpine-linux,bestof,dev,"><meta property="og:url" content="https://perrotta.dev/2022/01/alpine-linux-on-raspberry-pi-diskless-mode-with-persistent-storage/"><meta property="og:site_name" content="¬¨ just serendipity üçÄ"><meta property="og:title" content="Alpine Linux on Raspberry Pi: Diskless Mode with persistent storage"><meta property="og:description" content="Use case: Given an Alpine Linux diskless1 installation meant for a Raspberry Pi setup, we would like to add a persistent storage component to it to make it survive across reboots.
Goal The Alpine Linux Wiki covers most of the installation process, hence I will only document the bits that were lacking and/or confusing therein.
My use case is the following:
Given a Raspberry Pi 3B with an old 4GiB SD Card as CF storage2, install Alpine Linux in diskless mode. Find a way to preserve modifications in /etc and /var, as well as any installed packages through its apk package manager."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-15T23:18:56-05:00"><meta property="article:modified_time" content="2026-02-07T13:01:14+01:00"><meta property="article:tag" content="Alpine-Linux"><meta property="article:tag" content="Bestof"><meta property="article:tag" content="Dev"><meta name=twitter:card content="summary"><meta name=twitter:title content="Alpine Linux on Raspberry Pi: Diskless Mode with persistent storage"><meta name=twitter:description content="Use case: Given an Alpine Linux diskless1 installation meant for a Raspberry Pi setup, we would like to add a persistent storage component to it to make it survive across reboots.
Goal The Alpine Linux Wiki covers most of the installation process, hence I will only document the bits that were lacking and/or confusing therein.
My use case is the following:
Given a Raspberry Pi 3B with an old 4GiB SD Card as CF storage2, install Alpine Linux in diskless mode. Find a way to preserve modifications in /etc and /var, as well as any installed packages through its apk package manager."><script type=application/ld+json>{"@context":"https://schema.org","@type":"\"BlogPosting\"","headline":"\"Alpine Linux on Raspberry Pi: Diskless Mode with persistent storage\"","description":"\"Use case: Given an Alpine Linux diskless1 installation meant for a Raspberry Pi setup, we would like to add a persistent storage component to it to make it ‚Ä¶\"","url":"\"https://perrotta.dev/2022/01/alpine-linux-on-raspberry-pi-diskless-mode-with-persistent-storage/\"","datePublished":"\"2022-01-15T23:18:56-05:00\"","dateModified":"\"2026-02-07T13:01:14+01:00\"","author":"{\"@type\":\"Person\",\"name\":\"Thiago Perrotta\",\"url\":\"https://perrotta.dev/\"}","mainEntityOfPage":{"@type":"WebPage","@id":"\"https://perrotta.dev/2022/01/alpine-linux-on-raspberry-pi-diskless-mode-with-persistent-storage/\""},"keywords":"[\"alpine-linux\",\"bestof\",\"dev\"]"}</script><meta name=referrer content="no-referrer-when-downgrade"><link rel=icon href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/2022/01/alpine-linux-on-raspberry-pi-diskless-mode-with-persistent-storage/><link rel=alternate type=text/markdown href=https://perrotta.dev/2022/01/alpine-linux-on-raspberry-pi-diskless-mode-with-persistent-storage/index.md title="Alpine Linux on Raspberry Pi: Diskless Mode with persistent storage"><style>:root{--color-light-gray:#5c5f77;--color-light-grayer:#6c6f85;--color-dark-gray:#9399b2;--color-dark-grayer:#7f849c;--font-title:"Inter", "Fira Sans", "Lato", system-ui, -apple-system,
    BlinkMacSystemFont, "Avenir Next", "Avenir", "Segoe UI", "Helvetica Neue",
    Helvetica, Ubuntu, Roboto, Noto, Cantarell, Arial, sans-serif;--font-body:"Crimson Pro", "Vollkorn", "Alegreya", "Iowan Old Style",
    "Apple Garamond", "Baskerville", "Times New Roman", "Noto Serif",
    "Droid Serif", "Times", "Source Serif Pro", serif, "Apple Color Emoji",
    "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";--font-code:"Fira Code", "PT Mono", "IBM Plex Mono", Menlo, Consolas, Monaco,
    "Liberation Mono", "Ubuntu Mono", "Lucida Console", monospace;--color-light-bg:#eff1f5;--color-light-text:#4c4f69;--color-light-heading:#4c4f69;--color-light-link:#1e66f5;--color-light-border:#ccd0da;--color-light-code-bg:#e6e9ef;--color-light-code-text:#4c4f69;--color-dark-bg:#1e1e2e;--color-dark-text:#cdd6f4;--color-dark-heading:#cdd6f4;--color-dark-link:#89b4fa;--color-dark-border:#45475a;--color-dark-code-bg:#181825;--color-dark-code-text:#cdd6f4;--color-gray:light-dark(var(--color-light-gray), var(--color-dark-gray));--color-grayer:light-dark(var(--color-light-grayer), var(--color-dark-grayer));--bg-color:light-dark(var(--color-light-bg), var(--color-dark-bg));--text-color:light-dark(var(--color-light-text), var(--color-dark-text));--heading-color:light-dark(var(--color-light-heading), var(--color-dark-heading));--link-color:light-dark(var(--color-light-link), var(--color-dark-link));--border-color:light-dark(var(--color-light-border), var(--color-dark-border));--code-bg:light-dark(var(--color-light-code-bg), var(--color-dark-code-bg));--code-text-color:light-dark(var(--color-light-code-text), var(--color-dark-code-text))}body{font-family:var(--font-body);font-size:21px;line-height:1.5;color:var(--text-color);max-width:840px;margin:0 auto;padding:20px;background-color:var(--bg-color);word-wrap:break-word;overflow-wrap:break-word;-webkit-text-size-adjust:100%}h1,h2,h3,h4,h5,h6,strong,b{color:var(--heading-color);line-height:1.2;font-family:var(--font-title)}h1{font-size:2.5rem}h2{font-size:2rem}h3{font-size:1.75rem}h4{font-size:1.5rem}h5,h6{font-size:1.25rem}a{color:var(--link-color)}code{padding:3px 6px;background-color:var(--code-bg);font-family:var(--font-code);color:var(--code-text-color)}.chroma code{background-color:inherit;color:inherit;padding:0}img{max-width:100%;height:auto}.content img{display:block;margin:1rem auto}.old-entry-warning{border-left:5px solid light-dark(#fe640b,#f9e2af);background-color:light-dark(#fe640b,#fab387);padding:1rem 1.15rem;margin:1.75rem 0;font-size:1em;border-radius:6px;font-weight:500;color:light-dark(#eff1f5,#1e1e2e);box-shadow:light-dark(0 4px 18px rgba(0,0,0,8%),0 6px 20px rgba(0,0,0,.35))}.dt-published{color:var(--color-gray);font-size:.95em;margin-right:.5em}@media(max-width:600px){body{padding:15px}h3{font-size:1.5rem}}@view-transition{navigation: auto;
  }body{text-align:left;margin:auto}h1,h2,h3,h4,h5,h6,footer,nav{font-family:var(--font-title)}footer{font-size:smaller;text-align:center;display:flex;flex-direction:column;gap:16px}footer>a{text-decoration:none}a{color:var(--link-color)}.header-top{display:flex;align-items:center;justify-content:space-between;gap:12px}.header-buttons{display:flex;align-items:center;gap:8px}#lang-toggle{display:inline-flex;align-items:center;padding:4px 10px;background:var(--code-bg);border-radius:12px;text-decoration:none;color:var(--link-color);font-family:inherit;font-size:.85em;transition:all .2s ease}#lang-toggle:hover{transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.1)}a.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:12px;display:inline-block}.nav-dropdown{display:inline-block;position:relative;margin-right:12px}.nav-dropdown-trigger{background:0 0;border:none;cursor:pointer;color:var(--link-color);font-family:inherit;font-size:inherit;padding:0;display:flex;align-items:center;gap:4px}.nav-dropdown-trigger:hover{text-decoration:underline}.nav-dropdown-arrow{display:inline-block;font-size:.7em;transition:transform .2s ease}.nav-dropdown.open .nav-dropdown-arrow{transform:rotate(180deg)}.nav-dropdown-menu{position:absolute;top:100%;left:0;background-color:var(--bg-color);border:1px solid var(--border-color);border-radius:4px;min-width:150px;box-shadow:0 4px 6px rgba(0,0,0,.1);z-index:1000;display:none;margin-top:4px}.nav-dropdown.open .nav-dropdown-menu{display:block}.nav-dropdown-item{display:block;padding:10px 16px;color:var(--link-color);text-decoration:none;white-space:nowrap;font-size:.95em}.nav-dropdown-item-highlight{padding-left:1.5em}.nav-dropdown-item:hover{background-color:var(--code-bg);text-decoration:underline}.nav-dropdown-item:first-child{border-radius:3px 3px 0 0}.nav-dropdown-item:last-child{border-radius:0 0 3px 3px}.lang-dropdown{display:inline-block;position:relative;margin-right:12px}.lang-toggle-button{background:0 0;border:none;cursor:pointer;color:var(--link-color);font-family:inherit;font-size:inherit;padding:0;display:flex;align-items:center;gap:4px}.lang-toggle-button:hover{text-decoration:underline}.lang-dropdown-arrow{display:inline-block;font-size:.7em;transition:transform .2s ease}.lang-dropdown.open .lang-dropdown-arrow{transform:rotate(180deg)}.lang-dropdown-menu{position:absolute;top:100%;left:0;background-color:var(--bg-color);border:1px solid var(--border-color);border-radius:4px;min-width:100px;box-shadow:0 4px 6px rgba(0,0,0,.1);z-index:1000;display:none;margin-top:4px}.lang-dropdown.open .lang-dropdown-menu{display:block}.lang-dropdown-item{display:block;padding:10px 16px;color:var(--link-color);text-decoration:none;white-space:nowrap;font-size:.95em}.lang-dropdown-item:hover{background-color:var(--code-bg);text-decoration:underline}.lang-dropdown-item:first-child{border-radius:3px 3px 0 0}.lang-dropdown-item:last-child{border-radius:0 0 3px 3px}.lang-active{font-weight:700}hr{border:none;border-top:1px dashed var(--border-color)}nav a.has-emoji .nav-emoji{display:none}nav a.has-emoji:hover .nav-emoji,nav a.active-star .nav-emoji{display:inline}nav a.has-emoji:hover .nav-text,nav a.active-star .nav-text{display:none}textarea{width:100%;font-size:16px}input{font-size:16px}.content{line-height:1.4}table{width:100%}img{max-width:100%}code{background-color:var(--code-bg)}li code,p code{font-size:.9em}pre{margin:1.5rem 0;border-radius:10px;background-color:var(--code-bg);overflow-x:auto}pre code{display:block;padding:18px 22px;white-space:pre;font-size:17px;overflow-x:auto;background:0 0;color:inherit}code,pre{font-family:var(--font-code)}.rss-link{display:inline-flex;align-items:center;justify-content:center;width:1em;height:1em;overflow:hidden}.rss-link svg{width:100%;height:100%}.codeblock{margin:1.5rem 0;border-radius:12px;border:1px solid var(--border-color);overflow:hidden}.codeblock-header{display:flex;justify-content:space-between;align-items:center;font-size:.85em;padding:10px 16px;background:rgba(0,0,0,2%);border-bottom:1px solid var(--border-color);color:var(--color-gray)}.codeblock-language{font-weight:600}.codeblock-actions{display:flex;align-items:center;gap:8px}.codeblock-lang-badge{opacity:.7;font-size:.9em}.codeblock-copy{background:0 0;border:none;color:inherit;padding:2px 6px;font-size:.9em;cursor:pointer}.codeblock .highlight{background:0 0}.codeblock pre{margin:0;border-radius:0}.codeblock pre code{padding:18px 22px}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex;gap:8px;margin-bottom:8px}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:light-dark(#8839ef,#b4befe)}.pubdate-list{color:var(--color-gray);font-style:italic;font-size:.85em}.pubdate-single{color:var(--color-gray);font-style:italic}.social-link-wrapper{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap}.social-link{text-decoration:none;font-size:1.4em;display:inline-flex;align-items:center;justify-content:center;padding:.3em;border-radius:50%;background-color:var(--code-bg);color:var(--text-color);transition:all .3s ease;position:relative}.social-link:hover{transform:translateY(-4px);background-color:var(--link-color);color:#fff;box-shadow:0 4px 12px rgba(0,0,0,.15)}.social-link:active{transform:translateY(-2px)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}#theme-toggle{background:0 0;border:none;padding:0;cursor:pointer;font-size:1.2em;display:inline-block;vertical-align:middle;transition:transform .2s ease}#theme-toggle.spinning{animation:spin .6s ease-in-out}#theme-toggle:active{transform:scale(.95)}.badge-wrapper{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap}.badge-wrapper a{display:inline-block;text-decoration:none;transition:transform .2s ease}.badge-wrapper a:hover{transform:translateY(-2px)}.badge-wrapper img{display:block;height:auto}.footer-statement{font-size:.75em;margin:0}sup.gray{color:var(--color-gray)}.featured-posts{margin-top:2rem}.featured-grid{display:flex;flex-wrap:wrap;gap:1rem;margin:1rem 0;width:100%}.featured-card{flex:1 1 250px;padding:1rem;background:var(--code-bg);border-radius:.5rem;border:1px solid var(--border-color);transition:transform .15s ease,box-shadow .15s ease}.featured-card:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.1)}.featured-card h3{margin:0 0 .5rem;font-size:1.05rem}.featured-card p{margin:.5rem 0;font-size:.9rem}.featured-card small{color:var(--color-gray)}.featured-grid h2{flex-basis:100%}.tag-cloud{display:flex;flex-wrap:wrap;gap:12px;margin-top:16px}.tag-pill{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;background:var(--code-bg);border-radius:6px;text-decoration:none;transition:all .2s ease}.tag-pill:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.tag-count{color:var(--color-gray);font-size:.9em}.rss-link{display:inline-flex;align-items:center;justify-content:center;margin-left:12px;padding:4px 6px;text-decoration:none;border-radius:4px;font-size:1em;transition:all .2s ease;vertical-align:middle}.rss-link svg{height:1.2em;width:1.2em}.rss-link:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.year-group{margin:12px 0;border:1px solid var(--border-color);border-radius:8px;background:var(--bg-color);overflow:hidden;transition:box-shadow .3s ease,border-color .3s ease}.year-group:hover{border-color:var(--link-color);box-shadow:light-dark(0 4px 12px rgba(0,0,0,8%),0 4px 12px rgba(0,0,0,.3))}.year-group summary{cursor:pointer;user-select:none;padding:12px 20px;font-size:1.5rem;transition:background-color .2s ease;list-style:none;display:flex;align-items:center;gap:12px}.year-group summary::-webkit-details-marker{display:none}.year-group summary:hover{background-color:var(--code-bg)}.year-group summary .chevron-icon{flex-shrink:0;transition:transform .3s ease;color:var(--link-color)}.year-group[open] summary .chevron-icon{transform:rotate(90deg)}.year-group summary strong{font-weight:600}.year-group .year-content{display:grid;grid-template-rows:0fr;transition:grid-template-rows .3s ease-out}.year-group[open] .year-content{grid-template-rows:1fr}.year-group .year-content-inner{overflow:hidden;opacity:0;transition:opacity .3s ease}.year-group[open] .year-content-inner{opacity:1}.year-group .month-group{padding:0 20px}.year-group .month-group+.month-group{margin-top:.5em}.year-group ul.blog-posts{margin-top:0;padding:0 0 12px}.year-group ul.blog-posts li{margin-bottom:4px;padding:6px 14px;border-radius:6px;transition:background-color .2s ease,transform .15s ease}.year-group ul.blog-posts li:hover{background-color:var(--code-bg);transform:translateX(4px)}.year-group ul.blog-posts li a{text-decoration:none;transition:color .2s ease}.year-group ul.blog-posts li a:hover{text-decoration:underline}@media(prefers-reduced-motion:reduce){.year-group,.year-group summary,.year-group summary .chevron-icon,.year-group .year-content,.year-group .year-content-inner,.year-group ul.blog-posts li{transition:none}}@media(min-width:601px){.title{font-size:38px}}@media(max-width:600px){body{font-size:18px}.title{font-size:1.35rem}.header-top{gap:6px}a.title{column-gap:6px}#lang-toggle{padding:4px 6px}.header-buttons{gap:4px}.lang-dropdown{margin-right:0}h1{font-size:1.65rem}h2{font-size:1.4rem}h3{font-size:1.2rem}h4{font-size:1.1rem}h5,h6{font-size:1rem}nav a,.nav-dropdown-trigger{margin-right:8px;font-size:.9em}pre code{font-size:15px;padding:14px 18px}.year-group{margin:10px 0}.year-group summary{font-size:1.15rem;padding:10px 16px;gap:10px}.year-group .month-group{padding:0 16px}.year-group ul.blog-posts{padding:0 0 10px}.year-group ul.blog-posts li{flex-direction:column;gap:4px;margin-bottom:8px;padding:6px 12px}.year-group ul.blog-posts li:hover{transform:translateX(2px)}.year-group ul.blog-posts li span,ul.blog-posts li span{flex:unset}}blockquote{border-left:2px solid light-dark(#9ca0b0,#7f849c);color:light-dark(var(--heading-color),#bac2de);padding-left:25px;padding-right:15px;font-style:italic}textarea,input{background-color:light-dark(initial,#313244);color:light-dark(initial,var(--text-color))}.search-container{margin-bottom:1.5rem}#search-input{width:100%;padding:12px 16px;font-size:1rem;border:1px solid var(--border-color);border-radius:8px;background-color:var(--bg-color);color:var(--text-color);transition:border-color .2s ease,box-shadow .2s ease;box-sizing:border-box}#search-input:focus{outline:none;border-color:var(--link-color);box-shadow:0 0 0 3px rgba(30,102,245,.15)}#search-input::placeholder{color:var(--color-gray)}.search-info{margin-top:8px;font-size:.85em;color:var(--color-gray)}.search-results{margin-top:1rem}.search-result{padding:16px 0;border-bottom:1px solid var(--border-color)}.search-result:last-child{border-bottom:none}.search-result-title{font-size:1.1em;font-weight:600;text-decoration:none;display:block;margin-bottom:6px}.search-result-title:hover{text-decoration:underline}.search-result-meta{font-size:.85em;color:var(--color-gray);margin-bottom:8px}.search-result-date{font-style:italic}.search-result-tags{margin-left:8px}.search-tag{color:var(--link-color);text-decoration:none;margin-right:6px}.search-tag:hover{text-decoration:underline}.search-result-summary{font-size:.9em;color:var(--text-color);margin:0;line-height:1.5}.search-result mark{background-color:light-dark(rgba(223,142,29,.4),rgba(249,226,175,.35));color:inherit;padding:1px 2px;border-radius:2px}.no-results{color:var(--color-gray);font-style:italic}.search-modal{display:none;position:fixed;inset:0;z-index:9999;align-items:flex-start;justify-content:center;padding-top:min(20vh,150px)}.search-modal.open{display:flex}.search-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px)}.search-modal-container{position:relative;width:90%;max-width:600px;max-height:70vh;background:var(--bg-color);border:1px solid var(--border-color);border-radius:12px;box-shadow:0 16px 48px rgba(0,0,0,.2);display:flex;flex-direction:column;overflow:hidden}.search-modal-header{display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid var(--border-color);gap:8px}.search-modal-header input{flex:1;border:none;background:0 0;color:var(--text-color);font-size:1.1rem;outline:none;padding:4px 0}.search-modal-header input::placeholder{color:var(--color-gray)}.search-modal-kbd{font-family:var(--font-code);font-size:.75em;padding:2px 6px;border:1px solid var(--border-color);border-radius:4px;color:var(--color-gray);background:var(--code-bg);flex-shrink:0}.search-modal-container>.search-info{padding:4px 16px;font-size:.8em;border-bottom:1px solid var(--border-color)}.search-modal-container>.search-info:empty{display:none}.search-modal-results{overflow-y:auto;overscroll-behavior:contain}.search-modal-result{display:block;padding:10px 16px;text-decoration:none;color:var(--text-color);cursor:pointer;border-bottom:1px solid var(--border-color)}.search-modal-result:last-child{border-bottom:none}.search-modal-result:hover,.search-modal-result.active{background:var(--code-bg)}.search-modal-result-title{display:block;font-weight:600;margin-bottom:2px;color:var(--link-color)}.search-modal-result-meta{display:block;font-size:.8em;color:var(--color-gray)}.search-modal-result mark{background-color:light-dark(rgba(223,142,29,.4),rgba(249,226,175,.35));color:inherit;padding:1px 2px;border-radius:2px}.toc{margin:1.5rem 0;padding:.75rem 1rem;background:var(--code-bg);border-radius:4px;border:1px solid var(--border-color)}.toc summary{cursor:pointer;user-select:none;font-weight:600;list-style:none;position:relative;padding-left:24px}.toc summary::-webkit-details-marker{display:none}.toc summary::before{content:'‚ñ∂';position:absolute;left:0;top:50%;transform:translateY(-50%);transition:transform .3s ease;color:var(--link-color);font-size:.7em}.toc[open] summary::before{transform:translateY(-50%)rotate(90deg)}.toc nav ul{list-style:none;padding-left:0;margin:.75rem 0 0}.toc nav ul ul{padding-left:1.25rem}.toc nav li{margin:.25rem 0}.toc nav a{text-decoration:none;color:var(--text-color)}.toc nav a:hover{color:var(--link-color)}.reading-progress{position:fixed;top:0;left:0;width:0;height:3px;background:var(--link-color);z-index:9999;transition:width .1s linear}.article-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:.67em}.article-header h2{margin:.67em 0 0}.fullscreen-btn{background:0 0;border:none;cursor:pointer;color:var(--link-color);font-size:1.2em;padding:0;display:flex;align-items:center;justify-content:center;line-height:1;transition:opacity .2s ease;flex-shrink:0}.fullscreen-btn:hover{opacity:.7}body.fullscreen-mode{background:var(--bg-color)}body.fullscreen-mode header nav{display:none}body.fullscreen-mode header a.title{opacity:.5;font-size:.8em}body.fullscreen-mode header a.title h1{font-size:.8em;color:var(--color-gray)}body.fullscreen-mode header a.title img{width:20px;height:20px}body.fullscreen-mode header{padding:1rem 0}body.fullscreen-mode footer{display:none}body.fullscreen-mode .previously{display:none}body.fullscreen-mode main{max-width:100%;padding:2rem}body.fullscreen-mode article{max-width:100%}body.fullscreen-mode .related-posts{display:none}body.fullscreen-mode .backlinks{display:none}body.fullscreen-mode .mini-graph{display:none}body.fullscreen-mode>hr{display:none}@media(max-width:768px){.article-header{gap:8px}.article-header h2{font-size:1.4rem}.fullscreen-btn{font-size:1em}body.fullscreen-mode main{padding:.5rem}}.bg{color:light-dark(#4c4f69,#abb2bf);background-color:light-dark(#eff1f5,#282c34)}.chroma{color:light-dark(#4c4f69,#abb2bf);background-color:light-dark(#eff1f5,#282c34);-webkit-text-size-adjust:none}.chroma .err{color:light-dark(#d20f39,#abb2bf)}.chroma .lnlinks{outline:none;text-decoration:none;color:inherit}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0}.chroma .hl{background-color:light-dark(#bcc0cc,#3d4148)}.chroma .lnt{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:light-dark(#8c8fa1,#55595f)}.chroma .ln{white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:light-dark(#8c8fa1,#55595f)}.chroma .line{display:flex}.chroma .k{color:light-dark(#8839ef,#c678dd)}.chroma .kc{color:light-dark(#fe640b,#e5c07b)}.chroma .kd{color:light-dark(#d20f39,#c678dd)}.chroma .kn{color:light-dark(#179299,#c678dd)}.chroma .kp{color:light-dark(#8839ef,#c678dd)}.chroma .kr{color:light-dark(#8839ef,#c678dd)}.chroma .kt{color:light-dark(#d20f39,#e5c07b)}.chroma .na{color:light-dark(#1e66f5,#e06c75)}.chroma .nc{color:light-dark(#df8e1d,#e5c07b)}.chroma .no{color:light-dark(#df8e1d,#e06c75)}.chroma .nd{color:light-dark(#1e66f5,#61afef);font-weight:700}.chroma .ni{color:light-dark(#179299,#e06c75)}.chroma .ne{color:light-dark(#fe640b,#e06c75)}.chroma .nx{color:light-dark(#1e66f5,#e06c75)}.chroma .nl{color:light-dark(#04a5e5,#e06c75)}.chroma .nn{color:light-dark(#fe640b,#e06c75)}.chroma .py{color:light-dark(#fe640b,#e06c75)}.chroma .nt{color:light-dark(#8839ef,#e06c75)}.chroma .nb{color:light-dark(#04a5e5,#e5c07b)}.chroma .bp{color:light-dark(#04a5e5,#e5c07b)}.chroma .nv{color:light-dark(#dc8a78,#e06c75)}.chroma .vc{color:light-dark(#dc8a78,#e06c75)}.chroma .vg{color:light-dark(#dc8a78,#e06c75)}.chroma .vi{color:light-dark(#dc8a78,#e06c75)}.chroma .vm{color:light-dark(#dc8a78,#e06c75)}.chroma .nf{color:light-dark(#1e66f5,#61afef);font-weight:700}.chroma .fm{color:light-dark(#1e66f5,#56b6c2);font-weight:700}.chroma .l{color:light-dark(#fe640b,#d19a66)}.chroma .ld{color:light-dark(#40a02b,#98c379)}.chroma .s{color:light-dark(#40a02b,#98c379)}.chroma .sa{color:light-dark(#d20f39,#98c379)}.chroma .sb{color:light-dark(#40a02b,#98c379)}.chroma .sc{color:light-dark(#40a02b,#98c379)}.chroma .dl{color:light-dark(#1e66f5,#98c379)}.chroma .sd{color:light-dark(#9ca0b0,#98c379)}.chroma .s2{color:light-dark(#40a02b,#98c379)}.chroma .se{color:light-dark(#1e66f5,#98c379)}.chroma .sh{color:light-dark(#9ca0b0,#98c379)}.chroma .si{color:light-dark(#40a02b,#98c379)}.chroma .sx{color:light-dark(#40a02b,#98c379)}.chroma .sr{color:light-dark(#179299,#98c379)}.chroma .s1{color:light-dark(#40a02b,#98c379)}.chroma .ss{color:light-dark(#40a02b,#98c379)}.chroma .m{color:light-dark(#fe640b,#d19a66)}.chroma .mb{color:light-dark(#fe640b,#d19a66)}.chroma .mf{color:light-dark(#fe640b,#d19a66)}.chroma .mh{color:light-dark(#fe640b,#d19a66)}.chroma .mi{color:light-dark(#fe640b,#d19a66)}.chroma .il{color:light-dark(#fe640b,#d19a66)}.chroma .mo{color:light-dark(#fe640b,#d19a66)}.chroma .o{color:light-dark(#04a5e5,#56b6c2);font-weight:700}.chroma .ow{color:light-dark(#04a5e5,#56b6c2);font-weight:700}.chroma .c{color:light-dark(#9ca0b0,#7f848e);font-style:italic}.chroma .ch{color:light-dark(#acb0be,#7f848e);font-style:italic}.chroma .cm{color:light-dark(#9ca0b0,#7f848e);font-style:italic}.chroma .c1{color:light-dark(#9ca0b0,#7f848e);font-style:italic}.chroma .cs{color:light-dark(#9ca0b0,#7f848e);font-style:italic}.chroma .cp{color:light-dark(#9ca0b0,#7f848e);font-style:italic}.chroma .cpf{color:light-dark(#9ca0b0,#7f848e);font-weight:700;font-style:italic}.chroma .gd{color:light-dark(#d20f39,#e06c75);background-color:light-dark(#ccd0da,transparent)}.chroma .ge{font-style:italic}.chroma .gr{color:#d20f39}.chroma .gh{color:#fe640b;font-weight:700}.chroma .gi{color:light-dark(#40a02b,#98c379);background-color:light-dark(#ccd0da,transparent)}.chroma .gs{font-weight:700}.chroma .gu{color:light-dark(#fe640b,#7f848e);font-weight:700}.chroma .gt{color:#d20f39}.chroma .gl{text-decoration:underline}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.webp></head><body><div class=h-card style=display:none><a class="p-name u-url" href=https://perrotta.dev/>Thiago Perrotta</a>
<span class=p-nickname>thiagowfx</span>
<a class=u-email href=mailto:serendipity@perrotta.dev>serendipity@perrotta.dev</a>
<img class=u-photo src=https://perrotta.dev/thiagowfx.webp alt="Thiago Perrotta"></div><header><div class=header-top><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.webp alt="thiagowfx's avatar" width=32 height=32 fetchpriority=high><h1 class=title>¬¨ just serendipity üçÄ</h1></a><div class=header-buttons><button id=theme-toggle aria-label="Toggle theme" title="Toggle theme">
<span id=theme-toggle-icon>‚òÄÔ∏è</span></button></div></div><nav aria-label="Main navigation"><a href=/tags/bestof/ class="has-emoji active-star"><span class=nav-emoji>‚≠ê</span>
<span class=nav-text>‚òÖ</span>
</a><a href=/search/><span class=nav-text>üîç</span>
</a><a href=/posts/><span class=nav-text>Blog</span></a><div class=nav-dropdown><button class=nav-dropdown-trigger>
<span class=nav-text>Explore</span>
<span class=nav-dropdown-arrow>‚ñº</span></button><div class=nav-dropdown-menu><a href=/projects/ class=nav-dropdown-item>Projects</a>
<a href=/blogroll/ class=nav-dropdown-item>Blogroll</a>
<a href=/tags/ class=nav-dropdown-item>üè∑Ô∏è Tags</a>
<a href=/tags/serenity/ class="nav-dropdown-item nav-dropdown-item-highlight">‚ñ∏ Serenity</a>
<a href=/categories/ class=nav-dropdown-item>üìÇ Categories</a>
<a href=/categories/coding/ class="nav-dropdown-item nav-dropdown-item-highlight">‚ñ∏ üíª Coding</a>
<a href=/graph/ class=nav-dropdown-item>üï∏Ô∏è Graph</a>
<a href=/random/ class=nav-dropdown-item>üé≤ Random</a>
<a href=/radio/ class=nav-dropdown-item>üìª Radio</a>
<a href=/pomodoro/ class=nav-dropdown-item>üçÖ Pomodoro</a></div></div></nav></header><main><div id=reading-progress class=reading-progress aria-hidden=true></div><script>document.addEventListener("keydown",function(e){if(e.target.closest('input:not([type="hidden"]), textarea, [contenteditable="true"]'))return;if(e.key==="j"||e.key==="ArrowLeft"){const e=document.querySelector('[data-nav="prev"]');e&&e.href&&(window.location.href=e.href)}else if(e.key==="k"||e.key==="ArrowRight"){const e=document.querySelector('[data-nav="next"]');e&&e.href&&(window.location.href=e.href)}})</script><a href=https://perrotta.dev/2022/01/rss-follow-commit-updates-from-github/ data-nav=prev hidden></a><a href=https://perrotta.dev/2022/01/debian-enable-unattended-upgrades/ data-nav=next hidden></a><article class=h-entry><div class=article-header><h2><span>‚òÖ</span>
<span class=p-name>Alpine Linux on Raspberry Pi: Diskless Mode with persistent storage</span></h2><button id=fullscreen-btn class=fullscreen-btn aria-label="Toggle fullscreen mode" title="Toggle fullscreen mode (f)">
<span id=fullscreen-icon>‚õ∂</span></button></div><p><span class=pubdate-single><time class=dt-published datetime=2022-01-15T23:18:56-05:00>15 Jan, 2022
</time>‚Ä¢ 1601 words ‚Ä¢ 8 min
‚Ä¢ updated <time datetime=2026-02-07>07 Feb, 2026</time></span></p><div class=old-entry-warning role=note>‚ö†Ô∏è This post is over one year old. It may no longer be up to date or relevant. Opinions may have changed.</div><div class=e-content><p>Use case: Given an Alpine Linux <strong>diskless</strong><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> installation meant for
a Raspberry Pi setup, we would like to add a persistent storage component to it
to make it survive across reboots.</p><h2 id=goal>Goal</h2><p>The <a href=https://wiki.alpinelinux.org/wiki/Installation>Alpine Linux Wiki</a> covers most of the installation process, hence I will only document the bits that were lacking and/or confusing therein.</p><p>My use case is the following:</p><blockquote><p>Given a Raspberry Pi 3B with an old 4GiB SD Card as CF storage<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, install Alpine Linux in diskless mode. Find a way to preserve modifications in <code>/etc</code> and <code>/var</code>, as well as any installed packages through its <code>apk</code> package manager.</p></blockquote><p>Let&rsquo;s follow the steps outlined in the wiki.</p><h2 id=copy-alpine-to-the-sd-card>Copy Alpine to the SD Card</h2><blockquote><p>Grab the SD card and install Alpine Linux in it.</p></blockquote><p>Alpine provides officially supported images designed for the Raspberry Pi.</p><p>Most Linux distributions provide an <code>.iso</code> or <code>.img</code> file to be installed with a tool like <a href=https://www.balena.io/etcher/>Balena Etcher</a>, <a href=https://rufus.ie/en/>Rufus</a>, <a href=https://www.raspberrypi.com/news/raspberry-pi-imager-imaging-utility/><strong>Raspberry Pi Imager</strong></a> or plain <a href=https://www.gnu.org/software/coreutils/manual/html_node/dd-invocation.html><code>dd</code></a><sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><p>Alpine is not like most Linux distributions: Instead, it provides a <code>.tar.gz</code> archive with files that should be copied directly to the SD card. Grab the latest version (3.15 at the time of this post) from <a href=https://alpinelinux.org/downloads/>https://alpinelinux.org/downloads/</a>. There are 3 options:</p><ul><li><p><code>armhf</code>: Works with all Pis, but may perform less optimally on recent versions.</p></li><li><p><code>armv7</code>: Works with the Pi 3B, 32-bit.</p></li><li><p><code>aarch64</code>: Works with the Pi 3B, 64-bit.</p></li></ul><p>I opted for <code>aarch64</code> to make it 64-bit, but <code>armv7</code> would also have worked well for my setup. In fact, Raspberry Pi OS (Debian) uses <code>armv7</code> (32-bit) at the time of this writing.</p><p>Before copying files over, format the SD Card. As I was doing this
from a Windows machine because it was the only one I had readily available with
a SD card slot, I just used the native Windows Disk Management tool to do so.
I decided to allocate a 100MB<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> FAT32 partition. The rest of the SD card would be
blank for now. Alpine is surprisingly small, 100MB was more than enough for the kernel and other needed files.</p><p>Once the SD card is formatted, copy the files over to it. It turns out Windows cannot extract tarballs (<code>.tar.gz</code>); a tool like <a href=https://www.7-zip.org/>7-zip</a> should do the job. Copy the files over to the root of the newly allocated FAT32 partition, and then safely eject the SD card.</p><h2 id=boot-alpine-from-the-sd-card>Boot Alpine from the SD Card</h2><p>The next step is to insert the SD Card into the Pi and then boot. I had some trouble in this step and eventually figured out I didn&rsquo;t mark the primary FAT32 partition as bootable. Unfortunately it&rsquo;s not straightforward to mark the partition as bootable from Windows. On a Linux machine there&rsquo;s a wide array of tools to do so: <code>fdisk</code>, <code>cfdisk</code> (TUI), <code>sfdisk</code> (scriptable <code>fdisk</code>), <code>parted</code>, <code>gparted</code> (GUI) are some of them. I worked around that by installing Raspberry Pi OS on the SD card with the Raspberry Pi imager, and then overwriting it with the Alpine files. This works because the Raspberry PI OS installation marks the FAT32 partition as bootable.</p><h2 id=install-alpine>Install Alpine</h2><p>Installing Alpine is well documented in the <a href=https://wiki.alpinelinux.org/wiki/Installation>wiki</a> thus it won&rsquo;t be covered here. It basically comes down to invoking <code>setup-alpine</code>, which then invokes other <code>setup-*</code> scripts.</p><p>Keep in mind we&rsquo;re not really &ldquo;installing&rdquo; Alpine as this is a diskless installation. A more accurate term here would be &ldquo;configuring&rdquo;.</p><p>Before invoking the installation script, I created a second primary partition in the SD card, set to <code>ext4</code>:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<span class=codeblock-actions><button class=codeblock-copy type=button data-copy-code title=Copy><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></button></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Configure networking to get working internet access.</span>
</span></span><span class=line><span class=cl>% setup-interfaces
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Install some partitioning tools.</span>
</span></span><span class=line><span class=cl>% apk add cfdisk e2fsprogs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create a second partition (mmcblk0p2) and write it.</span>
</span></span><span class=line><span class=cl>% cfdisk /dev/mmcblk0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Format the partition as ext4.</span>
</span></span><span class=line><span class=cl>% mkfs.ext4 /dev/mmcblk0p2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mount the partition under /media.</span>
</span></span><span class=line><span class=cl>% mount /dev/mmcblk0p2 /media/mmcblk0p2</span></span></code></pre></div></div><p>The installation is straightforward, we just need to pay attention to a few select steps:</p><ul><li><code>setup-disk</code>: Select <code>none</code> to ensure a <code>diskless</code> installation<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>.</li><li><code>setup-apkcache</code>: Select <code>/media/mmcblk0p2/cache</code> to persist downloaded <code>apk</code> packages.</li><li><code>setup-lbu</code>: Edit <code>/etc/lbu/lbu.conf</code> and set <code>LBU_MEDIA="mmcblk0p2"</code>. Note: Do not add <code>/media</code> as it is implicit.</li></ul><p>Once the installation is complete, run <code>lbu commit</code> to persist the changes in the second partition. Once you do so, a <code>&lt;hostname>.apkovl.tar.gz</code><sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup> file should materialize on <code>/media/mmcblk0p2/</code>.</p><p>This is a good moment to reboot. Before we do so, let&rsquo;s cache the packages we had previously downloaded.</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<span class=codeblock-actions><button class=codeblock-copy type=button data-copy-code title=Copy><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></button></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Cache packages.</span>
</span></span><span class=line><span class=cl>% apk cache download
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% reboot</span></span></code></pre></div></div><h2 id=after-the-first-reboot>After the first reboot</h2><p>If everything worked as expected, once you reboot all your previously installed packages should have been preserved and automatically restored / reinstalled, as well as your modifications done to <code>/etc</code>.</p><p>From this point on, whenever you install a new package that you want to be preserved for subsequent reboots, run <code>lbu commit</code> afterwards. For example:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<span class=codeblock-actions><button class=codeblock-copy type=button data-copy-code title=Copy><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></button></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>% apk add vim
</span></span><span class=line><span class=cl>% lbu commit</span></span></code></pre></div></div><p>If you would like to see what is going to be committed, run <code>lbu status</code> or <code>lbu diff</code> before doing the actual commit. Whenever you commit, <code>/media/mmcblk0p2/&lt;hostname>.apkovl.tar.gz</code> gets overwritten with your most recent modifications.</p><p>It&rsquo;s possible to keep more than one backup file by changing <code>BACKUP_LIMIT=</code> in <code>/etc/lbu/lbu.conf</code>. This is specially handy if you decide to revert to an earlier system snapshot / state later on. The stock config looks like this:</p><div class=codeblock data-lang=conf><div class=codeblock-header><span class=codeblock-language>/etc/lbu/lbu.conf</span>
<span class=codeblock-actions><span class=codeblock-lang-badge>conf</span> <button class=codeblock-copy type=button data-copy-code title=Copy><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></button></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># what cipher to use with -e option</span>
</span></span><span class=line><span class=cl><span class=na>DEFAULT_CIPHER</span><span class=o>=</span><span class=s>aes-256-cbc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Uncomment the row below to encrypt config by default</span>
</span></span><span class=line><span class=cl><span class=c1># ENCRYPTION=$DEFAULT_CIPHER</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Uncomment below to avoid &lt;media&gt; option to &#39;lbu commit&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># Can also be set to &#39;floppy&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># LBU_MEDIA=usb</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set the LBU_BACKUPDIR variable in case you prefer to save the apkovls</span>
</span></span><span class=line><span class=cl><span class=c1># in a normal directory instead of mounting an external media.</span>
</span></span><span class=line><span class=cl><span class=c1># LBU_BACKUPDIR=/root/config-backups</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Uncomment below to let lbu make up to 3 backups</span>
</span></span><span class=line><span class=cl><span class=c1># BACKUP_LIMIT=3</span></span></span></code></pre></div></div><p><strong>Tip</strong>: You can find the list of all explicitly installed packages in <code>/etc/apk/world</code>.</p><h2 id=the-last-piece-make-var-persistent>The last piece: make /var persistent</h2><p>There are three natural ways that come to mind to make <code>/var</code> persistent:</p><h3 id=a-separate-partition-or-file>A) Separate partition (or file)</h3><p>Instead of two partitions (FAT32 and ext4), create 3 partitions: FAT32, ext4 and ext4. Use the latter one to mount <code>/var</code> on, saving this information in <code>/etc/fstab</code>. The main disadvantage of this setup is that you&rsquo;ll need to allocate a fixed amount of space of each of the ext4 partitions and it may be difficult to figure out how to split the space between them.</p><p>A variant of this approach is to just create the third partition as a file:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<span class=codeblock-actions><button class=codeblock-copy type=button data-copy-code title=Copy><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></button></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 500MB file</span>
</span></span><span class=line><span class=cl>% dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>/media/mmcblk0p2/var.img <span class=nv>bs</span><span class=o>=</span>1M <span class=nv>count</span><span class=o>=</span><span class=m>500</span> <span class=nv>status</span><span class=o>=</span>progress
</span></span><span class=line><span class=cl>% mkfs.ext4 /media/mmcblk0p2/var.img
</span></span><span class=line><span class=cl>% mount /media/mmcblk0p2/var.img /var</span></span></code></pre></div></div><p>This works because the Linux kernel supports mounting files as if they were device blocks, treating them as loop devices (pseudo-devices).</p><p>I don&rsquo;t like these approaches because they shadow the preexisting <code>/var</code> from the boot media, which in turn messes up with existing services that use it such as <code>cron</code>: <code>% crontab -l</code> would fail. One workaround would be to mount a <code>/var</code> subdirectory instead: for example, <code>/var/lib/docker</code> for docker.</p><h3 id=b-bind-mount>B) Bind mount</h3><p>This one is straightforward:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<span class=codeblock-actions><button class=codeblock-copy type=button data-copy-code title=Copy><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></button></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>% mount --bind /media/mmcblk0p2/var/lib/docker /var/lib/docker</span></span></code></pre></div></div><p>The actual partition lives in the SD card, however we make a bind mount under
<code>/var</code>, which is like an <em>alias</em>. From <a href=https://unix.stackexchange.com/questions/198590/what-is-a-bind-mount>Stack Exchange</a>:</p><blockquote><p>A bind mount is an alternate view of a directory tree. Classically, mounting creates a view of a storage device as a directory tree. A bind mount instead takes an existing directory tree and replicates it under a different point. The directories and files in the bind mount are the same as the original. Any modification on one side is immediately reflected on the other side, since the two views show the same data.</p></blockquote><h3 id=c-overlay-mount>C) Overlay mount</h3><p>From <a href=https://wiki.archlinux.org/title/Overlay_filesystem>ArchWiki</a>:</p><blockquote><p>Overlayfs allows one, usually read-write, directory tree to be overlaid onto another, read-only directory tree. All modifications go to the upper, writable layer. This type of mechanism is most often used for live CDs but there is a wide variety of other uses.</p></blockquote><p>It&rsquo;s perfect for our use case, which uses a live bootable SD card for Alpine. It blends the preexisting, ephemeral, in-memory <code>/var</code> with the persistent in-disk <code>/var</code>.</p><p>I wanted to mount <code>/var</code> directly but found it to be problematic for the same reasons mentioned earlier, therefore I just went with <code>/var/lib/docker</code> instead:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<span class=codeblock-actions><button class=codeblock-copy type=button data-copy-code title=Copy><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></button></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Create overlay upper and work directories.</span>
</span></span><span class=line><span class=cl>% mkdir -p /media/mmcblk0p2/var/lib/docker /media/mmcblk0p2/var/lib/docker-work
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Add mountpoint entry to fstab. Note: The work dir must be an empty directory in the same filesystem mount as the upper directory.</span>
</span></span><span class=line><span class=cl>% <span class=nb>echo</span> <span class=s2>&#34;overlay /var/lib/docker overlay lowerdir=/var/lib/docker,upperdir=/media/mmcblk0p2/var/lib/docker,workdir=/media/mmcblk0p2/var/lib/docker-work 0 0&#34;</span> &gt;&gt; /etc/fstab
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mount all fstab entries, including our newly added one.</span>
</span></span><span class=line><span class=cl>% mount -a</span></span></code></pre></div></div><h2 id=conclusion>Conclusion</h2><p>I opted for the third approach, using an overlay mount, it was the most
seamless one. A bind mount would have been fine as well.</p><p>The final setup works surprisingly well:</p><ul><li>Alpine Linux is very lightweight and runs mostly from RAM</li><li><code>apk</code> cache is persistent to the ext4 partition</li><li><code>/var/</code> is persistent to the ext4 partition</li><li><code>lbu commit</code> persists changes in <code>/etc/</code> and <code>/home/</code> in the ext4 partition</li><li>Every reboot fully resets the system sans persistent components above</li></ul><h2 id=references>References</h2><ul><li><a href=https://vincentserpoul.github.io/post/alpine-linux-rpi0/>https://vincentserpoul.github.io/post/alpine-linux-rpi0/</a></li><li><a href=http://dahl-jacobsen.dk/tips/blog/2021-04-08-docker-on-alpine-linux/>http://dahl-jacobsen.dk/tips/blog/2021-04-08-docker-on-alpine-linux/</a></li><li><a href=http://dahl-jacobsen.dk/tips/blog/2018-03-15-alpine-on-raspberry-pi/>http://dahl-jacobsen.dk/tips/blog/2018-03-15-alpine-on-raspberry-pi/</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Running (almost) fully from RAM.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>CF = Compact disk.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>On Linux I&rsquo;d usually opt for <code>dd</code>, on Windows the Raspberry Pi Imager is a sensible choice.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>100MB is overly conservative, but keep in mind I had a very small SD Card, with only 4GiB storage. 250MB or even 500MB should be a more sensible default if you have a bigger SD Card (e.g. 32GiB).&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>An alternative is to select <code>data</code> disk mode, but it didn&rsquo;t work for me.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><em>ovl</em> is short for <em>overlay</em>. Not to be confused with <em>vol</em> for <em>volume</em>.&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><p style="text-align:center;margin:2em 0 1em">‚Äî ¬ß ‚Äî</p><div style=display:flex;justify-content:space-between><p style=margin:0>Reply via
<a href="mailto:serendipity@perrotta.dev?subject=Reply to: Alpine%20Linux%20on%20Raspberry%20Pi%3a%20Diskless%20Mode%20with%20persistent%20storage">email</a></p><p style=margin:0><a href=https://perrotta.dev/tags/alpine-linux/>#alpine-linux</a> <a href=https://perrotta.dev/tags/bestof/>#bestof</a> <a href=https://perrotta.dev/tags/dev/>#dev</a></p></div><div class=related-posts style="border:2px solid var(--border-color);border-radius:.5rem;padding:1.5rem;margin-top:1.5rem"><h4 id=related-posts style=margin-top:0>Related Posts</h4><section style="display:flex;flex-wrap:wrap;gap:1rem;margin:1rem 0"><article style="flex:1 1 250px;padding:1rem;background:var(--code-bg);border-radius:.25rem;color:var(--text-color)"><h5 style=margin-top:0;margin-bottom:.5rem;color:var(--heading-color)><a href=https://perrotta.dev/2025/06/alpine-linux-packaging-track-new-software-releases/>Alpine Linux packaging: track new software releases</a></h5><p style="margin:.5rem 0;font-size:.9rem">Problem statement: You maintain packages for a Linux distribution, for example, Alpine Linux. Find a way to keep track of new software releases, to ‚Ä¶</p><small style=color:var(--color-gray)>Jun 03, 2025</small></article><article style="flex:1 1 250px;padding:1rem;background:var(--code-bg);border-radius:.25rem;color:var(--text-color)"><h5 style=margin-top:0;margin-bottom:.5rem;color:var(--heading-color)><a href=https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/>PostgreSQL major version upgrade on Alpine Linux</a></h5><p style="margin:.5rem 0;font-size:.9rem">Problem statement Given Alpine Linux 3.22 running PostgreSQL 16, upgrade to PostgreSQL 17. For this specific example, consider a miniflux database. ‚Ä¶</p><small style=color:var(--color-gray)>May 24, 2025</small></article></section><p class=previously style=margin-bottom:0;margin-top:.5rem><a href=https://perrotta.dev/2022/01/my-first-apkbuild/ title="My First APKBUILD">Previously</a>, <a href=https://perrotta.dev/2022/01/alpine-linux-apk-command-not-found-hook/ title="Alpine Linux: apk command not found hook">previously</a>, <a href=https://perrotta.dev/2022/01/keychron-k2-review/ title="Keychron K2: Review">previously</a>, <a href=https://perrotta.dev/2022/01/alpine-linux-apk-logs-with-etckeeper/ title="Alpine Linux: apk logs with etckeeper">previously</a>, <a href=https://perrotta.dev/2022/01/direnv-automate-your-environment-variables/ title="Direnv: Automate your Environment Variables">previously</a>.</p></div><a class=u-url href=https://perrotta.dev/2022/01/alpine-linux-on-raspberry-pi-diskless-mode-with-persistent-storage/ aria-hidden=true style=display:none></a><span class="p-author h-card" style=display:none><a class="p-name u-url" href=https://perrotta.dev/ rel=author>Thiago Perrotta</a></span></article></main><hr><footer><span>¬© 2013 - 2026 Thiago Perrotta ¬∑
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ¬∑
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo  ï‚Ä¢·¥•‚Ä¢ î bear</a> ¬∑ <a href=/canary>üê¶</a> ¬∑ <a href=https://uptime.perrotta.dev/status/indianapolis>status</a></span><div class=social-link-wrapper><a target=_blank rel=noopener class=social-link href=mailto:serendipity@perrotta.dev title="Email address" aria-label="Email address"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" height="1.2em" width="1.2em"><path d="M3 8l7.89 5.26a2 2 0 002.22.0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v10a2 2 0 002 2z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://perrotta.dev/index.xml title="RSS feed" aria-label="RSS feed"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" height="1.2em" width="1.2em"><path d="M4 11a9 9 0 019 9M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg>
</a><a target=_blank rel="me noopener" class=social-link href=https://github.com/thiagowfx title="Github profile" aria-label="Github profile"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a target=_blank rel="me noopener" class=social-link href=https://goodreads.com/user/show/7873832-thiago title="Goodreads profile" aria-label="Goodreads profile"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 50 50" height="1em" width="1em"><path d="M25 2c-4.541.0-8.41336 1.9082151-11.017578 4.9453125C11.378203 9.9824099 10 14.07975 10 18.5s1.378203 8.517589 3.982422 11.554688C16.58664 33.091785 20.459 35 25 35c4.531588.0 8.395936-1.901605 11-4.927734V35c0 2.598543-.818503 4.764071-2.451172 6.339844C31.91616 42.915616 29.363725 44 25.5 44 17.784314 44 15 39.933333 15 36H11c0 6.066667 5.215686 12 14.5 12 4.636275.0 8.33384-1.377726 10.826172-3.783203C38.818503 41.811319 40 38.476457 40 35V18.5 3H36V6.9277344C33.395936 3.9016049 29.531588 2 25 2zm0 4c3.459.0 6.08664 1.3379255 7.982422 3.5488281C34.878203 11.759731 36 14.91225 36 18.5s-1.121797 6.740269-3.017578 8.951172C31.08664 29.662074 28.459 31 25 31s-6.08664-1.337926-7.982422-3.548828C15.121797 25.240269 14 22.08775 14 18.5s1.121797-6.740269 3.017578-8.9511719C18.91336 7.3379255 21.541 6 25 6z"/></svg>
</a><a target=_blank rel="me noopener" class=social-link href=https://linkedin.com/in/thiagoperrotta title="LinkedIn profile" aria-label="LinkedIn profile"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 30 30" height="1.2em" width="1.2em"><path d="M24 4H6C4.895 4 4 4.895 4 6v18c0 1.105.895 2 2 2h18c1.105.0 2-.895 2-2V6c0-1.105-.895-2-2-2zM10.954 22h-2.95v-9.492h2.95V22zM9.449 11.151c-.951.0-1.72-.771-1.72-1.72s.77-1.719 1.72-1.719c.948.0 1.719.771 1.719 1.719C11.168 10.38 10.397 11.151 9.449 11.151zM22.004 22h-2.948v-4.616c0-1.101-.02-2.517-1.533-2.517-1.535.0-1.771 1.199-1.771 2.437V22h-2.948v-9.492h2.83v1.297h.04c.394-.746 1.356-1.533 2.791-1.533 2.987.0 3.539 1.966 3.539 4.522V22z"/></svg>
</a><a target=_blank rel="me noopener" class=social-link href=https://stackoverflow.com/users/1745064/thiagowfx title="StackOverflow profile" aria-label="StackOverflow profile"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em"><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 3e2zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-2e2v39.7h2e2zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg></a></div><div class=badge-wrapper><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/ title="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License"><img src=https://perrotta.dev/vendor/cc-by-nc-sa-4.0-88x31.webp width=88 height=31 alt="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License" loading=lazy>
</a><a target=_blank href=https://indieweb.org/ title=IndieWebCamp><img src=https://perrotta.dev/vendor/indieweb88x31-flat.webp width=88 height=31 alt=IndieWebCamp loading=lazy>
</a><a target=_blank href=https://512kb.club title="512kb.club badge"><img src=https://perrotta.dev/vendor/green-team.webp width=88 height=31 alt="a proud member of the green team of 512KB club" loading=lazy>
</a><a target=_blank href=https://powrss.com/ title=powRSS><img src=https://perrotta.dev/vendor/powrss-88-31.webp width=88 height=31 alt=powRSS loading=lazy>
</a><a target=_blank href=https://www.vim.org/ title="Vim text editor"><img src=https://perrotta.dev/vendor/vim.webp width=88 height=31 alt="Vim text editor" loading=lazy>
</a><a target=_blank href=https://edleeman.co.uk/cookie-zero/ title="Cookie Zero"><img src=https://perrotta.dev/vendor/cookiezero.webp width=88 height=31 alt="Cookie Zero" loading=lazy>
</a><a target=_blank href="https://validator.w3.org/nu/?doc=https://perrotta.dev/" title="Valid HTML5"><img src=https://perrotta.dev/vendor/html5-validator-badge.webp width=88 height=31 alt="Valid HTML5" loading=lazy>
</a><a target=_blank href="https://validator.w3.org/feed/check.cgi?url=https://perrotta.dev/index.xml" title="Valid RSS feed"><img src=https://perrotta.dev/vendor/valid-rss-rogers.webp width=88 height=31 alt="Valid RSS feed" loading=lazy></a></div><p class=footer-statement>This site respects your privacy by not containing <a href=https://www.nevermonetize.com/>ads</a>,
not using tracking cookies,
and not collecting any personally identifiable information.
<a href=/ai>Gen AI policy</a>.</p></footer><div id=search-modal class=search-modal role=dialog aria-modal=true aria-label=Search><div class=search-modal-backdrop></div><div class=search-modal-container><div class=search-modal-header><input type=text id=search-modal-input placeholder="Search posts... (use * as wildcard)" autocomplete=off>
<kbd class=search-modal-kbd>ESC</kbd></div><div id=search-modal-info class=search-info></div><div id=search-modal-results class=search-modal-results></div></div></div><script type=module>
  let searchIndex = null;
  const modal = document.getElementById('search-modal');
  const modalInput = document.getElementById('search-modal-input');
  const modalResults = document.getElementById('search-modal-results');
  const modalInfo = document.getElementById('search-modal-info');
  const backdrop = modal.querySelector('.search-modal-backdrop');

  const lang = 'en' || 'en';
  const langPath = lang === 'en' ? '' : '/' + lang;

  const debounce = (fn, delay) => {
    let timeout;
    return (...args) => {
      clearTimeout(timeout);
      timeout = setTimeout(() => fn(...args), delay);
    };
  };

  const escapeHtml = (text) => {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  };

  const matchesTerm = (text, term) => {
    if (term.includes('*')) {
      const escaped = term.replace(/[.+?^${}()|[\]\\]/g, '\\$&');
      return new RegExp(escaped.replace(/\*/g, '.*'), 'i').test(text);
    }
    return text.includes(term);
  };

  const highlightMatch = (text, query) => {
    if (!text) return '';
    const escaped = escapeHtml(text);
    const terms = query.toLowerCase().split(/\s+/).filter(t => t.length > 0);
    return terms.reduce((result, term) => {
      const pattern = term.includes('*')
        ? term.replace(/[.+?^${}()|[\]\\]/g, '\\$&').replace(/\*/g, '[^\\s]*')
        : term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      return result.replace(new RegExp(`(${pattern})`, 'gi'), '<mark>$1</mark>');
    }, escaped);
  };

  const loadSearchIndex = () => {
    if (searchIndex !== null) return Promise.resolve();
    return fetch(langPath + '/search/index.json')
      .then(response => response.json())
      .then(data => { searchIndex = data; })
      .catch(err => {
        modalInfo.textContent = 'Error loading search index';
        console.error('Search index load error:', err);
      });
  };

  const performSearch = (query) => {
    if (!searchIndex) return;

    const q = query.toLowerCase().trim();
    if (q.length === 0) {
      modalResults.innerHTML = '';
      modalInfo.textContent = '';
      return;
    }

    const terms = q.split(/\s+/).filter(t => t.length > 0);
    const results = [];

    for (const post of searchIndex) {
      const title = (post.title ?? '').toLowerCase();
      const summary = (post.summary ?? '').toLowerCase();
      const tags = (post.tags ?? []).map(t => t.toLowerCase());
      const tagsText = tags.join(' ');

      let allMatch = true;
      let score = 0;

      for (const term of terms) {
        const inTitle = matchesTerm(title, term);
        const inSummary = matchesTerm(summary, term);
        const inTags = matchesTerm(tagsText, term);

        if (!inTitle && !inSummary && !inTags) {
          allMatch = false;
          break;
        }

        if (inTitle) score += 10;
        if (inTags) score += 5;
        if (inSummary) score += 1;
      }

      if (allMatch) {
        results.push({ post, score });
      }
    }

    results.sort((a, b) => b.score - a.score || b.post.date.localeCompare(a.post.date));

    if (results.length === 0) {
      modalInfo.textContent = 'No results found';
      modalResults.innerHTML = '';
      return;
    }

    modalInfo.textContent = `${results.length} result${results.length === 1 ? '' : 's'}`;

    modalResults.innerHTML = results.slice(0, 20).map(({ post }, i) => {
      const tags = (post.tags ?? [])
        .map(t => `<span class="search-tag">#${escapeHtml(t)}</span>`)
        .join(' ');

      return `
        <a href="${escapeHtml(post.url)}" class="search-modal-result${i === 0 ? ' active' : ''}" data-index="${i}">
          <span class="search-modal-result-title">${highlightMatch(post.title, query)}</span>
          <span class="search-modal-result-meta">
            <span class="search-result-date">${escapeHtml(post.date)}</span>
            ${tags ? ` ¬∑ ${tags}` : ''}
          </span>
        </a>
      `;
    }).join('');
  };

  let activeIndex = 0;

  const updateActive = (newIndex) => {
    const items = modalResults.querySelectorAll('.search-modal-result');
    if (items.length === 0) return;
    activeIndex = Math.max(0, Math.min(newIndex, items.length - 1));
    items.forEach((item, i) => {
      item.classList.toggle('active', i === activeIndex);
    });
    items[activeIndex].scrollIntoView({ block: 'nearest' });
  };

  const openModal = () => {
    modal.classList.add('open');
    document.body.style.overflow = 'hidden';
    loadSearchIndex().then(() => {
      modalInput.focus();
      if (modalInput.value) {
        performSearch(modalInput.value);
      }
    });
  };

  const closeModal = () => {
    modal.classList.remove('open');
    document.body.style.overflow = '';
    modalInput.value = '';
    modalResults.innerHTML = '';
    modalInfo.textContent = '';
    activeIndex = 0;
  };

  
  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      e.stopPropagation();
      openModal();
    }
  });

  
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal.classList.contains('open')) {
      e.preventDefault();
      closeModal();
    }
  });

  
  modalInput.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      updateActive(activeIndex + 1);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      updateActive(activeIndex - 1);
    } else if (e.key === 'Enter') {
      const items = modalResults.querySelectorAll('.search-modal-result');
      if (items[activeIndex]) {
        items[activeIndex].click();
      }
    }
  });

  
  backdrop.addEventListener('click', closeModal);

  
  modalInput.addEventListener('input', debounce((e) => {
    activeIndex = 0;
    performSearch(e.target.value);
  }, 150));
</script><script src=/js/main.min.a5641a82d197dea7bc10e38c8c402e256df848a79f0fc92c9822d80ec5f59175.js defer></script></body></html>