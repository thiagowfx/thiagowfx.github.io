{{- $rawLang := .Type | default "" -}}
{{- $langAliases := dict
  "anki" "text"
  "conf" "ini"
  "git" "bash"
  "gitconfig" "ini"
  "gitdiff" "diff"
  "gotemplate" "go-template"
  "graphviz" "text"
  "hjson" "json"
  "logseq" "markdown"
  "none" "text"
  "shell" "bash"
  "text" "plaintext"
-}}
{{- $lang := $rawLang -}}
{{- with index $langAliases $rawLang }}
  {{- $lang = . -}}
{{- end }}
{{- if eq $lang "" }}
  {{- $lang = "plaintext" -}}
{{- end }}
{{- $label := $rawLang -}}
{{- if eq $label "" }}
  {{- if ne $lang "plaintext" }}
    {{- $label = $lang -}}
  {{- end }}
{{- end }}
{{- $filename := .Attributes.filename | default "" -}}
<div class="codeblock"{{ if $label }} data-lang="{{ $label }}"{{ end }}>
   {{- if or $label $filename }}
   <div class="codeblock-header">
     <span class="codeblock-language">{{ with $filename }}{{ . }}{{ else }}{{ $label }}{{ end }}</span>
     <span class="codeblock-actions">{{ if and $filename $label }}<span class="codeblock-lang-badge">{{ $label }}</span> {{ end }}<button class="codeblock-copy" type="button" data-copy-code title="Copy"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></span>
   </div>
   {{- end }}
   {{ highlight .Inner $lang }}
</div>
