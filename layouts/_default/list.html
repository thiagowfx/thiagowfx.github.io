{{- define "main" }}
<content>
  <h2 id="posts">
    {{- if .Data.Singular }} Posts tagged with #{{ .Name }} ({{ len .Pages }})
    {{- else }} All Posts ({{ len .Pages }}) {{- end }}
    <sup>(<a href='{{ (.OutputFormats.Get "RSS").Permalink }}'>rss</a>)</sup>
  </h2>


  {{ $currentYear := now.Year | printf "%d" }}
  {{ $pagesGroupedByYear := .Pages.GroupByDate "2006" }}

  {{ if not $pagesGroupedByYear }}
    <ul class="blog-posts">
      <li>No posts yet</li>
    </ul>
  {{ else }}
    {{ range $pagesGroupedByYear }}
    <details class="year-group" {{ if eq .Key $currentYear }}open{{ end }}>
      <summary><strong>{{ .Key }}</strong> ({{ len .Pages }} {{ if eq (len .Pages) 1 }}post{{ else }}posts{{ end }})</summary>
      <ul class="blog-posts">
        {{ range .Pages }}
        <li>
          <span>
            <time
              datetime='{{ .Date.Format "2006-01-02" }}'
              pubdate
              class="pubdate-list"
            >
              {{ .Date.Format (default "02 Jan, 2006" .Site.Params.dateFormat) }}
            </time>
          </span>
          <a href="{{ .Permalink }}">
            {{- if in .Params.tags "bestof" }}
            <span>â˜…</span>
            {{- end }} {{ .Title }}
          </a>
        </li>
        {{ end }}
      </ul>
    </details>
    {{ end }}
  {{ end }}
  {{- if not .Data.Singular }}
  <h2 id="tags">
    Tags
    <a href='{{ "posts/#tags" | absURL }}'>#</a>
  </h2>
  <small>
    <div>
      {{- range .Site.Taxonomies.tags }}
      <a href="{{ .Page.Permalink }}">#{{ .Page.Name }}</a
      ><sup class="gray">({{ len .Pages }})</sup>
      {{- else }} No tags yet {{- end }}
    </div>
  </small>
  {{- end }}
</content>
{{- end }}
