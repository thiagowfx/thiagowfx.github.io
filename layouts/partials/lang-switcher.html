{{- $currentLang := .Site.Language.Lang }}
{{- $currentLangName := cond (eq $currentLang "pt") "PT" "EN" }}
{{- $currentLangFlag := cond (eq $currentLang "pt") "ðŸ‡§ðŸ‡·" "ðŸ‡¬ðŸ‡§" }}
{{- $currentPath := .RelPermalink }}

{{- /* Build paths for both languages */ -}}
{{- $enPath := "/" }}
{{- $ptPath := "/" }}

{{- /* Calculate PT path */ -}}
{{- if eq $currentPath "/" }}
  {{- $ptPath = "/pt/" }}
{{- else if strings.HasPrefix $currentPath "/pt/" }}
  {{- $ptPath = $currentPath }}
{{- else }}
  {{- $ptPath = printf "/pt%s" $currentPath }}
{{- end }}

{{- /* Calculate EN path */ -}}
{{- if eq $currentPath "/pt/" }}
  {{- $enPath = "/" }}
{{- else if strings.HasPrefix $currentPath "/pt/" }}
  {{- $enPath = strings.TrimPrefix "/pt" $currentPath }}
{{- else }}
  {{- $enPath = $currentPath }}
{{- end }}

{{- /* Check if translated pages exist */ -}}
{{- $enExists := false }}
{{- $ptExists := false }}

{{- if eq $enPath "/" }}
  {{- $enExists = true }}
{{- else if eq $enPath "/pt/" }}
  {{- $enExists = false }}
{{- else }}
  {{- range $.Site.Sites }}
    {{- if eq .Language.Lang "en" }}
      {{- range .Pages }}
        {{- if eq .RelPermalink $enPath }}
          {{- $enExists = true }}
        {{- end }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}

{{- if eq $ptPath "/pt/" }}
  {{- $ptExists = false }}
{{- else }}
  {{- range $.Site.Sites }}
    {{- if eq .Language.Lang "pt" }}
      {{- range .Pages }}
        {{- if eq .RelPermalink $ptPath }}
          {{- $ptExists = true }}
        {{- end }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}

{{- /* Only show language switcher if both languages exist */ -}}
{{- if and $enExists $ptExists }}
<div class="lang-dropdown">
  <button id="lang-toggle" class="lang-toggle-button" aria-label="Switch language" title="Switch language">
    <span class="lang-toggle-text">{{ $currentLangFlag }}</span>
    <span class="lang-dropdown-arrow">â–¼</span>
  </button>
  <div class="lang-dropdown-menu">
    <a href="{{ $enPath }}" class="lang-dropdown-item{{ if eq $currentLang "en" }} lang-active{{ end }}" title="English">ðŸ‡¬ðŸ‡§ English</a>
    <a href="{{ $ptPath }}" class="lang-dropdown-item{{ if eq $currentLang "pt" }} lang-active{{ end }}" title="PortuguÃªs">ðŸ‡§ðŸ‡· PortuguÃªs</a>
  </div>
</div>
{{- end }}
