{{- /* Find older posts with overlapping tags, jwz-style "previously" links */ -}}
{{- if .Params.tags -}}

{{- $currentFilename := path.Base .File.Path | replaceRE "\\.md$" "" -}}
{{- $linkData := index $.Site.Data.links.posts $currentFilename -}}
{{- $previouslyIds := $linkData.previously | default slice -}}
{{- $paths := $.Site.Data.links.paths -}}

{{- /* Resolve previously IDs to page objects */ -}}
{{- $previously := slice -}}
{{- range $previouslyIds -}}
  {{- $hugoPath := index $paths . -}}
  {{- if $hugoPath -}}
    {{- $page := $.Site.GetPage $hugoPath -}}
    {{- if $page -}}
      {{- $previously = $previously | append $page -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- if $previously -}}
<p class="previously">
  {{- range $i, $p := $previously -}}
    {{- if eq $i 0 -}}
      <a href="{{ $p.Permalink }}" title="{{ $p.Title }}">Previously</a>
    {{- else -}}
      , <a href="{{ $p.Permalink }}" title="{{ $p.Title }}">previously</a>
    {{- end -}}
  {{- end -}}.
</p>
{{- end -}}

{{- end -}}
