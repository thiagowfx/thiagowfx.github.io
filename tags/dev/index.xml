<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Dev on ¬ just serendipity 🍀</title><link>https://perrotta.dev/tags/dev/</link><description>Recent content in Dev on ¬ just serendipity 🍀</description><generator>Hugo</generator><language>en-us</language><managingEditor>serendipity@perrotta.dev (Thiago Perrotta)</managingEditor><webMaster>serendipity@perrotta.dev (Thiago Perrotta)</webMaster><copyright>© 2021 - 2025 Thiago Perrotta ·
[some rights reserved](https://creativecommons.org/licenses/by-nc-sa/4.0/) ·
a fork of [hugo ʕ•ᴥ•ʔ bear](https://github.com/janraasch/hugo-bearblog/)</copyright><lastBuildDate>Thu, 12 Jun 2025 11:51:32 +0200</lastBuildDate><atom:link href="https://perrotta.dev/tags/dev/index.xml" rel="self" type="application/rss+xml"/><item><title>ArgoCD: application stuck in unknown</title><link>https://perrotta.dev/2025/06/argocd-application-stuck-in-unknown/</link><pubDate>Thu, 12 Jun 2025 11:51:32 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-application-stuck-in-unknown/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: An application in ArgoCD that was previously running
smoothly has suddenly started to fail. Its status has changed to &amp;ldquo;Unknown&amp;rdquo;.
The &amp;ldquo;Refresh&amp;rdquo; button is grayed out in the Argo web UI.&lt;/p>
&lt;p>I found the following works in this scenario, which is typically a transient
issue:&lt;/p>
&lt;ul>
&lt;li>restart the argo server&lt;/li>
&lt;li>restart the argo repo server&lt;/li>
&lt;/ul>
&lt;p>In terms of commands:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% kubectl rollout restart deployment argocd-server -n argocd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% kubectl rollout restart deployment argocd-repo-server -n argocd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>JIRA Service Management search is terrible</title><link>https://perrotta.dev/2025/06/jira-service-management-search-is-terrible/</link><pubDate>Tue, 10 Jun 2025 13:49:28 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/jira-service-management-search-is-terrible/</guid><description>&lt;p>&lt;a href="https://www.atlassian.com/software/jira/service-management">JIRA Service
Management&lt;/a> is a
platform that tries to do way too many things (poorly) and has been plagued with
AI hype, but today we&amp;rsquo;re only concerned with its Alerting platform (think
PagerDuty).&lt;/p>
&lt;p>An anecdote from today:&lt;/p>
&lt;p>I searched for the list of all alerts (open and closed) that match
&lt;a href="https://chartmuseum.com/">&lt;code>chartmuseum&lt;/code>&lt;/a>. Simple, right? That is one of the
main user journeys of the platform.&lt;/p>
&lt;p>It returned no results. Zero. Nada. Zilch.&lt;/p>
&lt;p>That cannot be! I just received an alert about chartmuseum. What gives?&lt;/p>
&lt;p>The alerts have this title form:&lt;/p>
&lt;ul>
&lt;li>&lt;code>[AWS CloudWatch]: chartmuseum-cpu-alarm-container-insights&lt;/code>&lt;/li>
&lt;li>&lt;code>[AWS CloudWatch]: chartmuseum-cpu-alarm&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>Surely &lt;code>chartmuseum&lt;/code> should match them?&lt;/p>
&lt;p>After some back-and-forth, I realized that searching for &lt;code>chartmuseum-cpu-alarm&lt;/code>
would work, as well as &lt;code>chartmuseum-cpu-alarm-container-insights&lt;/code>.&lt;/p>
&lt;p>Aha! So they are doing an implicit word boundary search (think &lt;code>\bterm\b&lt;/code> in
PCRE regex terms).&lt;/p>
&lt;p>This is, frankly, a horrible default. I could not find any way to make a
substring match. Yet, it is unreasonable to expect us users to search for the
whole word like that. Sometimes I don&amp;rsquo;t know what alert I am looking for.&lt;/p>
&lt;p>There&amp;rsquo;s a workaround. From their &lt;a href="https://support.atlassian.com/jira-service-management-cloud/docs/search-syntax-for-alerts/">docs&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Using asterisk (*) as a wildcard&lt;/strong>&lt;/p>
&lt;p>Wildcards can only be used after characters and will only match from the start
of character sequences. Character sequences need to be separated by a space
for the wildcard to try and match to each sequence of characters.&lt;/p>
&lt;/blockquote>
&lt;p>Therefore &lt;code>chartmuseum*&lt;/code> works. Or, even better: &lt;code>*chartmuseum*&lt;/code>.&lt;/p>
&lt;p>It&amp;rsquo;s a pity, but the way forward here is to memorize that I need to add &lt;code>*&lt;/code>
every single time.&lt;/p>
&lt;p>Come on Atlassian, surely you can do better than this?&lt;/p></description></item><item><title>bad interpreter: perl: no such file or directory</title><link>https://perrotta.dev/2025/06/bad-interpreter-perl-no-such-file-or-directory/</link><pubDate>Sun, 08 Jun 2025 17:48:35 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/bad-interpreter-perl-no-such-file-or-directory/</guid><description>&lt;p>The full error message is:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ack -i nmap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zsh: /opt/homebrew/bin/ack: bad interpreter: /opt/homebrew/opt/perl/bin/perl: no such file or directory
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This keeps happening, I am not sure why. &lt;a href="https://perrotta.dev/2024/09/life-without-ack/">Previously&lt;/a>.&lt;/p>
&lt;p>The fix is quite simple though:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% brew reinstall perl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apple App Store Geo-blocking</title><link>https://perrotta.dev/2025/06/apple-app-store-geo-blocking/</link><pubDate>Thu, 05 Jun 2025 19:22:15 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/apple-app-store-geo-blocking/</guid><description>&lt;p>Apple Accounts are tied to a specific country. You can have one and only one
country associated with an account at any given time.&lt;/p>
&lt;p>This is a problem whenever certain apps are restricted to &lt;em>only&lt;/em> certain countries
(&lt;a href="https://en.wikipedia.org/wiki/Geo-blocking">geo-blocking&lt;/a>).&lt;/p>
&lt;p>For example, an app from a bank or a financial broker may be made available
&lt;em>only&lt;/em> in the country wherein it operates, thereby completely ignoring the
existence and needs of expats.&lt;/p>
&lt;p>How do you know in which countries certain apps are made available? Here&amp;rsquo;s one
way:&lt;/p>
&lt;ul>
&lt;li>Brazil: &lt;a href="https://www.apple.com/br/search/">https://www.apple.com/br/search/&lt;/a>&lt;/li>
&lt;li>Canada: &lt;a href="https://www.apple.com/ca/search/">https://www.apple.com/ca/search/&lt;/a>&lt;/li>
&lt;li>Germany: &lt;a href="https://www.apple.com/de/search/">https://www.apple.com/de/search/&lt;/a>&lt;/li>
&lt;li>USA: &lt;a href="https://www.apple.com/us/search/">https://www.apple.com/us/search/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Wanna see examples? Try searching for these apps in different stores&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.apple.com/de/search/commerzbank?src=serp">Commerzbank&lt;/a> is only available in Germany.&lt;/li>
&lt;li>&lt;a href="https://www.apple.com/br/search/MEI?src=serp">MEI&lt;/a> is only available in Brazil.&lt;/li>
&lt;li>&lt;a href="https://www.apple.com/us/search/venmo?src=serp">Venmo&lt;/a> is only available in the USA.&lt;/li>
&lt;li>&lt;a href="https://www.apple.com/ca/search/wealthsimple?src=serp">WealthSimple&lt;/a> is only available in Canada.&lt;/li>
&lt;/ul>
&lt;p>You can change the country associated with your App Store by following Apple&amp;rsquo;s
&lt;a href="https://support.apple.com/en-us/118283">official documentation&lt;/a>.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>For the sake of basic
&lt;a href="https://en.wikipedia.org/wiki/Operations_security">OpSec&lt;/a>, I don&amp;rsquo;t have an
account in any of these services, in case you were wondering :-)&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Alpine Linux: Dockerfile: install package from edge</title><link>https://perrotta.dev/2025/06/alpine-linux-dockerfile-install-package-from-edge/</link><pubDate>Wed, 04 Jun 2025 12:37:47 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/alpine-linux-dockerfile-install-package-from-edge/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given a &lt;code>Dockerfile&lt;/code> based on a fixed release of Alpine
Linux (e.g. &lt;code>FROM alpine:3.22&lt;/code>), install a package from &lt;code>edge&lt;/code> (i.e. a package
that did not yet make it to a fixed release).&lt;/p>
&lt;p>The approach is similar to package &lt;a href="https://perrotta.dev/2025/01/alpine-linux-install-/-pin-old-packages/">pinning&lt;/a>, by providing a custom
&lt;code>--repository&lt;/code> to &lt;code>apk add&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">RUN&lt;/span> apk add --no-cache --repository&lt;span style="color:#56b6c2">=&lt;/span>https://dl-cdn.alpinelinux.org/alpine/edge/testing gliderlabs-sigil vals
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Replace &amp;ldquo;testing&amp;rdquo; with &amp;ldquo;community&amp;rdquo; or &amp;ldquo;main&amp;rdquo; as needed.&lt;/p></description></item><item><title>Alpine Linux: package is gone?!</title><link>https://perrotta.dev/2025/06/alpine-linux-package-is-gone/</link><pubDate>Wed, 04 Jun 2025 11:43:05 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/alpine-linux-package-is-gone/</guid><description>&lt;p>Upon upgrading one of our Dockerfiles from Alpine Linux 3.21 to 3.22, we noticed
that the &lt;code>ruby-json&lt;/code> package no longer exists:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% docker build -t myproject -f Dockerfile .
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;gt; &lt;span style="color:#56b6c2">[&lt;/span> 2/10&lt;span style="color:#56b6c2">]&lt;/span> RUN apk add --update --no-cache ruby-json&lt;span style="color:#56b6c2">=&lt;/span>~&lt;span style="color:#98c379">&amp;#34;3.4&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2.371 ERROR: unable to &lt;span style="color:#c678dd">select&lt;/span> packages:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2.371 ruby-json &lt;span style="color:#56b6c2">(&lt;/span>no such package&lt;span style="color:#56b6c2">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2.371 required by: world&lt;span style="color:#56b6c2">[&lt;/span>ruby-json~3.4&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Why??&lt;/p>
&lt;p>First, look into &lt;a href="https://pkgs.alpinelinux.org/packages">Alpine Linux Packages&lt;/a>:
&lt;a href="https://pkgs.alpinelinux.org/packages?name=ruby-json&amp;amp;branch=v3.22&amp;amp;repo=&amp;amp;arch=&amp;amp;origin=&amp;amp;flagged=&amp;amp;maintainer=">query&lt;/a>.
Ensure to set branch to v3.22 and architecture to All. And it&amp;rsquo;s indeed not
there anymore:&lt;/p>
&lt;blockquote>
&lt;p>No matching packages found&amp;hellip;&lt;/p>
&lt;/blockquote>
&lt;p>Next, do a bit of digging in the
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports">aports&lt;/a> repository on the &lt;a href="https://gitlab.alpinelinux.org/">Alpine
Linux GitLab&lt;/a>:
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/?sort=created_date&amp;amp;state=all&amp;amp;search=ruby-json&amp;amp;first_page_size=20">query&lt;/a>.
Search for &lt;code>ruby-json&lt;/code> in &amp;ldquo;All&amp;rdquo; Merge requests.&lt;/p>
&lt;p>That leads to
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/80599">&lt;code>!80599&lt;/code>&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>community/ruby-json: remove&lt;/p>
&lt;p>&lt;code>ruby-json&lt;/code> is already bundled with &lt;code>main/ruby&lt;/code>. The &lt;code>community/ruby-json&lt;/code>
could never be installed due to conflicts.&lt;/p>
&lt;/blockquote>
&lt;p>Aha, then there&amp;rsquo;s nothing to do here. Installing the base &lt;code>ruby&lt;/code> package should
be enough from now on.&lt;/p>
&lt;p>&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/issues/16938">#16938&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>I think it&amp;rsquo;s safe to say community/ruby-json does literally nothing, has never been installed, and does not work.&lt;/p>
&lt;/blockquote>
&lt;p>Oh well.&lt;/p></description></item><item><title>git pull: authentication issues</title><link>https://perrotta.dev/2025/06/git-pull-authentication-issues/</link><pubDate>Tue, 03 Jun 2025 14:35:04 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/git-pull-authentication-issues/</guid><description>&lt;p>&lt;code>git pull&lt;/code> authentication issues is &lt;em>really&lt;/em> a disguise for &lt;code>ssh&lt;/code> auth issues.&lt;/p>
&lt;p>Today a teammate could not &lt;code>git pull&lt;/code> one of our internal repos:&lt;/p>
&lt;pre tabindex="0">&lt;code>% git pull
Enter passphrase for key &amp;#39;/Users/user/.ssh/id_ed25519&amp;#39;:
git@github.com: Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
&lt;/code>&lt;/pre>&lt;p>The first thing we verified was that his public key was
&lt;a href="https://github.com/settings/keys">added&lt;/a> to his github profile, and that the
private key was present in &lt;code>~/.ssh/id_ed25519&lt;/code>.&lt;/p>
&lt;p>Next, verify &lt;code>~/.ssh/config&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>Host github.com
AddKeysToAgent yes
UseKeychain yes
IdentityFile ~/.ssh/id_ed25519
&lt;/code>&lt;/pre>&lt;p>Looks fine. Then:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">export&lt;/span> &lt;span style="color:#e06c75">GIT_SSH_COMMAND&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>&lt;span style="color:#98c379">&amp;#34;ssh -vvv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% git pull
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug3: Search &lt;span style="color:#c678dd">for&lt;/span> item with query: &lt;span style="color:#56b6c2">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">acct&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;/Users/user/.ssh/id_ed25519&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">agrp&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;com.apple.ssh.passphrases&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">class&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> genp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">labl&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;SSH: /Users/user/.ssh/id_ed25519&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">nleg&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;r_Data&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">svce&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> OpenSSH;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;u_AuthUI&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;u_AuthUIF&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug2: Unexpected keychain error &lt;span style="color:#c678dd">while&lt;/span> searching &lt;span style="color:#c678dd">for&lt;/span> an item: User interaction is not allowed.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Herein lies the error! The interaction with the system keychain in macOS was not
successful.&lt;/p>
&lt;p>I suggested him to remove &lt;code>AddKeysToAgent&lt;/code> and &lt;code>UseKeychain&lt;/code> from this config
file, but that did not work either:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% git pull
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Enter passphrase &lt;span style="color:#c678dd">for&lt;/span> key &lt;span style="color:#98c379">&amp;#39;/Users/user/.ssh/id_ed25519&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug2: no passphrase given, try next key
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug2: we did not send a packet, disable method
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug1: No more authentication methods to try.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git@github.com: Permission denied &lt;span style="color:#56b6c2">(&lt;/span>publickey&lt;span style="color:#56b6c2">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fatal: Could not &lt;span style="color:#e5c07b">read&lt;/span> from remote repository.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Please make sure you have the correct access rights
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>and the repository exists.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The ssh key is protected with a passphrase.&lt;/p>
&lt;p>In this case, it&amp;rsquo;s better to fix the keychain issue. We readd the two deleted
lines.&lt;/p>
&lt;p>Restart the &lt;code>ssh-agent&lt;/code> and readd the key there:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">eval&lt;/span> &lt;span style="color:#98c379">&amp;#34;&lt;/span>&lt;span style="color:#c678dd">$(&lt;/span>ssh-agent -s&lt;span style="color:#c678dd">)&lt;/span>&lt;span style="color:#98c379">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% ssh-add -K ~/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Problem resolved! &lt;code>git pull&lt;/code> works now.&lt;/p></description></item><item><title>Alpine Linux packaging: track new software releases</title><link>https://perrotta.dev/2025/06/alpine-linux-packaging-track-new-software-releases/</link><pubDate>Tue, 03 Jun 2025 01:36:53 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/alpine-linux-packaging-track-new-software-releases/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: You maintain packages for a Linux distribution, for
example, &lt;a href="https://www.alpinelinux.org/">Alpine Linux&lt;/a>. Find a way to keep track
of new software releases, to ensure your packages are kept up-to-date.&lt;/p>
&lt;p>The &lt;a href="https://release-monitoring.org/">Release Monitoring&lt;/a> project (codename
&lt;em>Anitya&lt;/em>), part of the &lt;a href="https://www.fedoraproject.org/">Fedora Linux&lt;/a> distro,
can accomplish that:&lt;/p>
&lt;blockquote>
&lt;p>Watch for releases of your favorite projects&lt;/p>
&lt;p>We all have our favorite projects and we all like to use their latest versions
with their latest features. However, it is hard to keep in touch with all of
them and be informed when they release a new version. Anitya can help!&lt;/p>
&lt;p>We monitor upstream releases and broadcast them on Fedora messaging bus.&lt;/p>
&lt;/blockquote>
&lt;p>The underlying project:&lt;/p>
&lt;blockquote>
&lt;p>Anitya is a release monitoring project.&lt;/p>
&lt;p>Its goal is to regularly check if a project has made a new release. When
Anitya discovers a new release for a project, it publishes a RabbitMQ message
via fedora messaging. This makes it easy to integrate with Anitya and perform
actions when a new release is created for a project. For example, the Fedora
project runs a service called the-new-hotness which files a Bugzilla bug
against a package when the upstream project makes a new release.&lt;/p>
&lt;p>Anitya provides a user-friendly interface to add, edit, or browse projects.&lt;/p>
&lt;/blockquote>
&lt;p>Even though it is part of Fedora, we can use it for Alpine Linux just fine!&lt;/p>
&lt;p>Recently I packaged &lt;a href="https://github.com/zizmorcore/zizmor/issues/780">zizmor&lt;/a>. I
noticed there was no entry for it in Anitya. I added one. It&amp;rsquo;s very
straightforward:&lt;/p>
&lt;ul>
&lt;li>head to &lt;a href="https://release-monitoring.org/">https://release-monitoring.org/&lt;/a>&lt;/li>
&lt;li>ensure the project you want to monitor isn&amp;rsquo;t already present there&lt;/li>
&lt;li>log in (e.g. via GitHub)&lt;/li>
&lt;li>click &lt;a href="https://release-monitoring.org/project/new">add project&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Fill in the form:&lt;/p>
&lt;ul>
&lt;li>Project name: zizmor&lt;/li>
&lt;li>Homepage: &lt;a href="https://docs.zizmor.sh">https://docs.zizmor.sh&lt;/a>&lt;/li>
&lt;li>BackEnd: GitHub&lt;/li>
&lt;li>Version scheme: Semantic&lt;/li>
&lt;li>Github owner/project: &lt;a href="https://github.com/zizmorcore/zizmor">zizmorcore/zizmor&lt;/a>&lt;/li>
&lt;li>Version prefix: &lt;code>v&lt;/code>&lt;/li>
&lt;li>Pre-release filter: &lt;code>rc&lt;/code>&lt;/li>
&lt;li>Version filter: &lt;code>rc&lt;/code> (excludes &lt;a href="https://github.com/zizmorcore/zizmor/releases/tag/v1.8.0-rc0">&lt;code>1.8.0-rc0&lt;/code>&lt;/a>) and the like&lt;/li>
&lt;li>Check off &amp;ldquo;check releases instead of tags&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;p>Once the project is &lt;a href="https://release-monitoring.org/project/378497/">created&lt;/a>,
add a new distribution mapping:&lt;/p>
&lt;ul>
&lt;li>Distribution: Alpine&lt;/li>
&lt;li>Package name: &lt;a href="https://pkgs.alpinelinux.org/package/edge/testing/x86_64/zizmor">zizmor&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>And we&amp;rsquo;re done!&lt;/p>
&lt;p>As per &lt;a href="https://pkgs.alpinelinux.org/flagging">https://pkgs.alpinelinux.org/flagging&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Package flagging&lt;/p>
&lt;p>Manual package flagging has been disabled in favour of automatic flagging
based on Anitya.&lt;/p>
&lt;p>If you want a package to be up-to-date or to inform the maintainer about the
package status, please feel free to create a package mapping on Anitya. Once
the mapping is made, it should automatically send an email to the maintainer
whenever a new version is available.&lt;/p>
&lt;p>For details on how to create a project mapping for Alpine Linux, please refer
to the &lt;a href="https://release-monitoring.org/static/docs/user-guide.html">release monitoring
documentation&lt;/a>.&lt;/p>
&lt;/blockquote></description></item><item><title>ArgoCD: upgrade to v3, remove helm labels</title><link>https://perrotta.dev/2025/06/argocd-upgrade-to-v3-remove-helm-labels/</link><pubDate>Mon, 02 Jun 2025 13:03:24 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-upgrade-to-v3-remove-helm-labels/</guid><description>&lt;p>I am leading the effort to upgrade ArgoCD to its &lt;a href="https://blog.argoproj.io/announcing-argo-cd-v3-small-but-mighty-df05c0b39ad6">newest major version
(v3)&lt;/a>
across our fleet.&lt;/p>
&lt;p>One of its &lt;a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/upgrading/2.14-3.0/">breaking
changes&lt;/a>
is the removal of helm labels from argo applications, like such:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># [...]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">app.kubernetes.io/managed-by&lt;/span>: Helm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Applying a normal sync does not get rid of the label.&lt;/p>
&lt;p>I found out that doing an one-off &lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#server-side-apply">server-side apply
sync&lt;/a>
addresses the label removal, and it is safe to do (incurs no downtime):&lt;/p>
&lt;blockquote>
&lt;p>However, there are some cases where you want to use &lt;code>kubectl apply --server-side&lt;/code> over &lt;code>kubectl apply&lt;/code>:&lt;/p>
&lt;p>[&amp;hellip;]&lt;/p>
&lt;p>Patching of existing resources on the cluster that are not fully managed by
Argo CD.&lt;/p>
&lt;/blockquote>
&lt;p>There&amp;rsquo;s no need to make the server-side apply a permanent config, i.e.:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">apiVersion&lt;/span>: argoproj.io/v1alpha1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">kind&lt;/span>: Application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">syncPolicy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">syncOptions&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - ServerSideApply=true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&amp;hellip;though there&amp;rsquo;s no harm either in doing so.&lt;/p></description></item><item><title>PDB: minAvailable and maxUnavailable cannot be both set</title><link>https://perrotta.dev/2025/06/pdb-minavailable-and-maxunavailable-cannot-be-both-set/</link><pubDate>Mon, 02 Jun 2025 12:00:05 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/pdb-minavailable-and-maxunavailable-cannot-be-both-set/</guid><description>&lt;p>In Kubernetes it&amp;rsquo;s not possible to have a &lt;a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">&lt;code>PodDisruptionBudget&lt;/code>
(PDB)&lt;/a> with
both &lt;code>minAvailable&lt;/code> and &lt;code>maxUnavailable&lt;/code> set simultaneously:&lt;/p>
&lt;pre tabindex="0">&lt;code>one or more objects failed to apply, reason: PodDisruptionBudget.policy &amp;#34;pgbouncer-pgbouncer&amp;#34; is invalid: spec: Invalid value: policy.PodDisruptionBudgetSpec{MinAvailable:(*intstr.IntOrString)(0xc02c03dd20), Selector:(*v1.LabelSelector)(0xc02c03dd40), MaxUnavailable:(*intstr.IntOrString)(0xc02c03dd60), UnhealthyPodEvictionPolicy:(*policy.UnhealthyPodEvictionPolicyType)(nil)}: minAvailable and maxUnavailable cannot be both set (retried 5 times).
&lt;/code>&lt;/pre>&lt;p>Our manifests did not violate this rule though. Then where did the error message
come from?&lt;/p>
&lt;p>It turns out &lt;a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD&lt;/a> was creating an
intermediate state containing both properties:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># [...]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">minAvailable&lt;/span>: &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">maxUnavailable&lt;/span>: &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># [...]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>One solution is to sync the underlying application PDB manifest with
&lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#replace-resource-instead-of-applying-changes">replace&lt;/a>.&lt;/p>
&lt;p>&lt;strong>Warning&lt;/strong>: It&amp;rsquo;s better to &amp;ldquo;sync with replace&amp;rdquo; &lt;strong>only&lt;/strong> the PDB. Do not do it
in the entire application.&lt;/p></description></item><item><title>Replace text in PDFs</title><link>https://perrotta.dev/2025/06/replace-text-in-pdfs/</link><pubDate>Sun, 01 Jun 2025 22:39:36 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/replace-text-in-pdfs/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given an existing PDF file, replace text in it.&lt;/p>
&lt;p>&lt;code>Preview.app&lt;/code> on macOS cannot replace text; it can only add annotations. It is
possible to use it in a hacky way: add a white square on top of the text you
want to replace, then add another piece of text atop.&lt;/p>
&lt;p>I found that &lt;a href="https://www.pdfgear.com/">PDFGear&lt;/a> does the job well. It is not
open source, but it is free. On macOS it needs to be manually downloaded and
installed from the &lt;a href="https://apps.apple.com/us/app/pdfgear-pdf-editor-reader/id6469021132?mt=12&amp;amp;os=mac&amp;amp;lang=en">Mac App
Store&lt;/a>,
as it&amp;rsquo;s not in Homebrew. It&amp;rsquo;s also available on Windows. It is quite well-rated
in &lt;a href="https://www.trustpilot.com/review/pdfgear.com">Trustpilot&lt;/a> (4.9 stars, 6500+
reviews).&lt;/p>
&lt;p>On Linux I would probably try &lt;a href="https://xournalpp.github.io/">Xournal++&lt;/a>, however
it is really a PDF &lt;em>annotation&lt;/em> tool.&lt;/p></description></item><item><title>Kagi trial expires</title><link>https://perrotta.dev/2025/05/kagi-trial-expires/</link><pubDate>Sat, 31 May 2025 16:44:02 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/kagi-trial-expires/</guid><description>&lt;p>My Kagi trial is going to expire within 2 days.&lt;/p>
&lt;p>&lt;a href="https://perrotta.dev/2025/05/kagi/">Previously&lt;/a>, I wrote:&lt;/p>
&lt;blockquote>
&lt;p>The question to ask yourself is whether it&amp;rsquo;s worth paying $10 / month for
their professional plan, or whether DuckDuckGo is enough for you. If you can
have your company expense them, then it&amp;rsquo;s definitely a no-brainer.&lt;/p>
&lt;/blockquote>
&lt;p>My company approved my request to expense it, therefore I am going to buy their
&lt;a href="https://kagi.com/pricing">1-year Professional plan&lt;/a>.&lt;/p>
&lt;p>Now, a few observations:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Would I pay for it out of my own pocket? Probably no. It&amp;rsquo;s perfectly
reasonable and enough for my purposes to use a blend of &lt;a href="https://perrotta.dev/2024/12/switching-from-google-to-chatgpt-search/">DuckDuckGo + ChatGPT
Search&lt;/a>.
That said, Kagi provides extra value to me on top of that duo; I prefer using
it.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Once you grow accustomed with search results without ads it&amp;rsquo;s very, very hard
to go back. Searching on Google suddenly feels like a thing of the past. It&amp;rsquo;s
very similar to the experience of getting used to ad-blocking software in the
web browser and then suddenly turning them off. The Web feels messy and
bloated.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>I did 961 searches at the time of this post, with 18 assistant interactions. I
barely use their AI features because I prefer the OpenAI ChatGPT experience.
Nonetheless, their AI features are occasionally handy and I find them to be
integrated in a non-intrusive way.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>TL;DR&lt;/strong>: Go for Kagi iff you can expense it. This is not a sponsored post. :)&lt;/p></description></item><item><title>Limited creativity</title><link>https://perrotta.dev/2025/05/limited-creativity/</link><pubDate>Sat, 31 May 2025 16:20:54 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/limited-creativity/</guid><description>&lt;p>I feel I got to a point where my own environment is limiting my creativity. And
this is something I would like to change. Allow me to explain.&lt;/p>
&lt;p>I have a myriad of ideas in my head. Recently I&amp;rsquo;ve been noting down some of them
in my &lt;a href="https://logseq.com/">PKM&lt;/a>, which reduces stress. On the other hand, most
of these ideas ended up becoming abandoned bullet points, lost in the sea of
interconnected pages in my knowledge graph.&lt;/p>
&lt;p>I know what to do when I want to convert an idea into reality: the very first
step is to add it to my &lt;a href="https://culturedcode.com/things/">task manager&lt;/a>, and
then schedule / prioritize it. This is a superpower that I love: it&amp;rsquo;s virtually
impossible to forget anything that ends up in the task manager. Whether it&amp;rsquo;s tax
season, or a random deadline to apply for something, or to cancel a recurring
subscription, or to buy tickets for a concert&amp;hellip;full stop. The difficulty lies
in breaking down a large(r) and/or long(er)-term project into smaller,
actionable pieces.&lt;/p>
&lt;p>There is at least one missing piece in my current workflow (and environment),
which I am still trying to figure out, to close the loop and become 10x more
productive, reducing the time between the conception of an idea and its
implementation.&lt;/p>
&lt;p>The best example that illustrates it is &lt;a href="https://perrotta.dev/2024/10/new-series-raspberry-pi-fun-with-devops/">that post&lt;/a> about the Raspberry
Pi. It never took off (and it&amp;rsquo;s still in my backlog!). Another example is the
&lt;a href="https://perrotta.dev/2025/05/winterbreak-hello-world/">Kindle jailbreak&lt;/a> – it took
me 4-5 months to do it. Once I started it, it took me only a few minutes to
start it&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>. So the major bottleneck is to kick start a project. I am very
confident in my current skill set and knowledge for the execution once it has
taken off.&lt;/p>
&lt;p>What can I do in order to be more effective in terms of converting abstract
ideas into small, concrete and actionable items?&lt;/p>
&lt;p>The discovery journey continues&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;em>Hours&lt;/em>, if you account for taking notes plus waiting for the process to
complete.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>Why is the title &amp;ldquo;limited creativity&amp;rdquo; if, apparently, the flow of ideas
doesn&amp;rsquo;t stop? Isn&amp;rsquo;t this somewhat paradoxical? I take a practical
standpoint: it&amp;rsquo;s useless to have a myriad of ideas if they do not become
concrete. Virtual ideas are essentially the same as nothing. Output (or
deliverables, if you will) is the metric that matters most of the time.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Golang fuzzing</title><link>https://perrotta.dev/2025/05/golang-fuzzing/</link><pubDate>Wed, 28 May 2025 17:37:06 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/golang-fuzzing/</guid><description>&lt;p>Given &lt;code>go.mod&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat go.mod
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>module testfuzzing
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go 1.24.3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Given &lt;code>fuzz_test.go&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat fuzz_test.go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>package testfuzzing
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>import &lt;span style="color:#56b6c2">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;encoding/json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;testing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>func FuzzJsonIsValid&lt;span style="color:#56b6c2">(&lt;/span>f *testing.F&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f.Fuzz&lt;span style="color:#56b6c2">(&lt;/span>func&lt;span style="color:#56b6c2">(&lt;/span>t *testing.T, data &lt;span style="color:#56b6c2">[]&lt;/span>byte&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> json.Valid&lt;span style="color:#56b6c2">(&lt;/span>data&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#56b6c2">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Run:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% go &lt;span style="color:#e5c07b">test&lt;/span> -fuzz&lt;span style="color:#56b6c2">=&lt;/span>FuzzJsonIsValid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 0s, gathering baseline coverage: 0/325 completed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 0s, gathering baseline coverage: 325/325 completed, now fuzzing with &lt;span style="color:#d19a66">12&lt;/span> workers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 3s, execs: &lt;span style="color:#d19a66">1193906&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>397950/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 6s, execs: &lt;span style="color:#d19a66">2450910&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>419012/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 9s, execs: &lt;span style="color:#d19a66">3720167&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>423002/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 12s, execs: &lt;span style="color:#d19a66">4994906&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>424923/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 15s, execs: &lt;span style="color:#d19a66">6159087&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>388000/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 18s, execs: &lt;span style="color:#d19a66">7364384&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>401883/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 21s, execs: &lt;span style="color:#d19a66">8588030&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>407881/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 24s, execs: &lt;span style="color:#d19a66">9826978&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>412996/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 27s, execs: &lt;span style="color:#d19a66">11093873&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>422306/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">3&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 328&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 30s, execs: &lt;span style="color:#d19a66">12359227&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>421773/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">3&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 328&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>^Cfuzz: elapsed: 31s, execs: &lt;span style="color:#d19a66">12650530&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>403107/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">3&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 328&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PASS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ok testfuzzing 31.154s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go &lt;span style="color:#e5c07b">test&lt;/span> -fuzz&lt;span style="color:#56b6c2">=&lt;/span>FuzzJsonIsValid 286.93s user 61.51s system 1105% cpu 31.505 total
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s very cool (and convenient!) that golang supports fuzzing natively, and
integrated with its test framework. &lt;a href="https://go.dev/doc/security/fuzz/">Docs&lt;/a>.&lt;/p></description></item><item><title>pre-commit: add hugo build</title><link>https://perrotta.dev/2025/05/pre-commit-add-hugo-build/</link><pubDate>Sat, 24 May 2025 17:29:48 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/pre-commit-add-hugo-build/</guid><description>&lt;p>Sometimes I make changes to this blog that yield build errors with its static
site generator (&lt;a href="https://gohugo.io/">hugo&lt;/a>).&lt;/p>
&lt;p>It&amp;rsquo;s trivial to spot these changes with a simple &lt;code>hugo build&lt;/code>, but &lt;a href="https://perrotta.dev/2025/03/yolo-debug-only-after-push/">I don&amp;rsquo;t always
run it&lt;/a>.&lt;/p>
&lt;p>Here&amp;rsquo;s what a typical error looks like:&lt;/p>
&lt;pre tabindex="0">&lt;code>% hugo build
Start building sites …
hugo v0.147.5+extended+withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew

ERROR [en] REF_NOT_FOUND: Ref &amp;#34;nonexistent/2025-03-24-maccy-pin-items&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-16-espanso-hello-world.md:10:14&amp;#34;: page not found
Total in 242 ms
Error: error building site: logged 1 error(s)
&lt;/code>&lt;/pre>&lt;p>The same happens when invoking &lt;a href="https://just.systems/man/en/">&lt;code>just&lt;/code>&lt;/a>, as you
would expect:&lt;/p>
&lt;pre tabindex="0">&lt;code>% just build
hugo --environment production --gc --minify
Start building sites …
hugo v0.147.5+extended+withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew

ERROR [en] REF_NOT_FOUND: Ref &amp;#34;nonexistent/2025-03-24-maccy-pin-items&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-16-espanso-hello-world.md:10:14&amp;#34;: page not found
Total in 280 ms
Error: error building site: logged 1 error(s)
error: Recipe `build` failed on line 17 with exit code 1
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Problem statement&lt;/strong>: catch such build errors at git pre-commit time.&lt;/p>
&lt;p>This is trivial with a &lt;a href="https://pre-commit.com/">pre-commit.com&lt;/a> hook:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>Author: Thiago Perrotta &amp;lt;{email redacted}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Date: Sat May 24 17:26:59 2025 +0200
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pre-commit: add just build
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>diff --git .pre-commit-config.yaml .pre-commit-config.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>index 60eb2022..623e135d 100644
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">--- .pre-commit-config.yaml
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+++ .pre-commit-config.yaml
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">&lt;/span>@@ -112,5 +112,10 @@ repos:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> language: pygrep
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> types:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - markdown
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ - id: hugo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ name: Hugo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ language: system
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ entry: just build
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ pass_filenames: false
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here&amp;rsquo;s the end result:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% git commit -m &lt;span style="color:#98c379">&amp;#34;test&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Check hooks apply to the repository.............................................&lt;span style="color:#56b6c2">(&lt;/span>no files to check&lt;span style="color:#56b6c2">)&lt;/span>Skipped
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Check &lt;span style="color:#c678dd">for&lt;/span> useless excludes......................................................&lt;span style="color:#56b6c2">(&lt;/span>no files to check&lt;span style="color:#56b6c2">)&lt;/span>Skipped
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Forbid usage of UTM analytics / tracking............................................................Passed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Hugo................................................................................................Failed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- hook id: hugo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#e5c07b">exit&lt;/span> code: &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hugo --environment production --gc --minify
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Start building sites …
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hugo v0.147.5+extended+withdeploy darwin/arm64 &lt;span style="color:#e06c75">BuildDate&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>2025-05-22T11:37:19Z &lt;span style="color:#e06c75">VendorInfo&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>brew
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ERROR &lt;span style="color:#56b6c2">[&lt;/span>en&lt;span style="color:#56b6c2">]&lt;/span> REF_NOT_FOUND: Ref &lt;span style="color:#98c379">&amp;#34;a/2024-12-23-unbuffer&amp;#34;&lt;/span>: &lt;span style="color:#98c379">&amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-24-watch-with-color.md:54:54&amp;#34;&lt;/span>: page not found
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Total in &lt;span style="color:#d19a66">276&lt;/span> ms
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Error: error building site: logged &lt;span style="color:#d19a66">1&lt;/span> error&lt;span style="color:#56b6c2">(&lt;/span>s&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>error: Recipe &lt;span style="color:#98c379">`&lt;/span>build&lt;span style="color:#98c379">`&lt;/span> failed on line &lt;span style="color:#d19a66">19&lt;/span> with &lt;span style="color:#e5c07b">exit&lt;/span> code &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>PostgreSQL major version upgrade on Alpine Linux</title><link>https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/</link><pubDate>Sat, 24 May 2025 16:00:23 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/</guid><description>&lt;h2 id="problem-statement">Problem statement&lt;/h2>
&lt;p>Given Alpine Linux 3.22 running PostgreSQL 16, upgrade to PostgreSQL 17. For
this specific example, consider a &lt;a href="https://miniflux.app/">&lt;code>miniflux&lt;/code>&lt;/a> database.&lt;/p>
&lt;h2 id="procedure">Procedure&lt;/h2>
&lt;p>Install PostgreSQL 17:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk add postgres
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It can coexist with &lt;code>postgres16&lt;/code>.&lt;/p>
&lt;p>Stop the PostgreSQL daemon:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas service postgresql stop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you navigate to the Miniflux server with your browser, it will fail, as
expected:&lt;/p>
&lt;pre tabindex="0">&lt;code>store: unable to create app session: dial tcp [::1]:5432: connect: connection refused
&lt;/code>&lt;/pre>&lt;p>Change the PostgreSQL system version to the desired one:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas pg_versions set-default &lt;span style="color:#d19a66">17&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Change to the root user, for convenience, then change to the existing postgresql
directory:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas su
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> /var/lib/postgresql/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Prepare files and directories for the upgrade:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> 16/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% mv data olddata
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> ../
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% mkdir 17/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> 17/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% mkdir data tmp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% chown postgres:postgres data tmp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Change to the &lt;code>postgres&lt;/code> user:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% su postgres
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> tmp/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Initialize the new cluster:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% initdb -D /var/lib/postgresql/17/data --locale&lt;span style="color:#56b6c2">=&lt;/span>en_US.UTF-8 --encoding&lt;span style="color:#56b6c2">=&lt;/span>UTF8 &lt;span style="color:#56b6c2">[&lt;/span>--data-checksums&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The files belonging to this database system will be owned by user &lt;span style="color:#98c379">&amp;#34;postgres&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>This user must also own the server process.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The database cluster will be initialized with locale &lt;span style="color:#98c379">&amp;#34;en_US.UTF-8&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The default text search configuration will be &lt;span style="color:#e5c07b">set&lt;/span> to &lt;span style="color:#98c379">&amp;#34;english&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Data page checksums are disabled.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fixing permissions on existing directory /var/lib/postgresql/17/data ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>creating subdirectories ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>selecting dynamic shared memory implementation ... posix
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>selecting default &lt;span style="color:#98c379">&amp;#34;max_connections&amp;#34;&lt;/span> ... &lt;span style="color:#d19a66">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>selecting default &lt;span style="color:#98c379">&amp;#34;shared_buffers&amp;#34;&lt;/span> ... 128MB
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>selecting default &lt;span style="color:#e5c07b">time&lt;/span> zone ... America/Toronto
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>creating configuration files ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>running bootstrap script ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>performing post-bootstrap initialization ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>syncing data to disk ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>initdb: warning: enabling &lt;span style="color:#98c379">&amp;#34;trust&amp;#34;&lt;/span> authentication &lt;span style="color:#c678dd">for&lt;/span> &lt;span style="color:#e5c07b">local&lt;/span> connections
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next &lt;span style="color:#e5c07b">time&lt;/span> you run initdb.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Success.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In the previous command I chose to omit &lt;code>--data-checksums&lt;/code>, otherwise I get the
following error:&lt;/p>
&lt;pre tabindex="0">&lt;code>old cluster does not use data checksums but the new one does
Failure, exiting
&lt;/code>&lt;/pre>&lt;p>Upgrade the new cluster:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% pg_upgrade -b /usr/libexec/postgresql16/ -B /usr/libexec/postgresql17/ -d /var/lib/postgresql/16/olddata/ -D /var/lib/postgresql/17/data/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Performing Consistency Checks
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-----------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking cluster versions ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking database user is the install user ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking database connection settings ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> prepared transactions ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> contrib/isn with bigint-passing mismatch ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking data &lt;span style="color:#e5c07b">type&lt;/span> usage ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Creating dump of global objects ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Creating dump of database schemas
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> presence of required libraries ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking database user is the install user ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> prepared transactions ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> new cluster tablespace directories ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>If pg_upgrade fails after this point, you must re-initdb the
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>new cluster before continuing.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Performing Upgrade
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting locale and encoding &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Analyzing all rows in the new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Freezing all rows in the new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Deleting files from new pg_xact ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copying old pg_xact to new server ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting oldest XID &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting next transaction ID and epoch &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Deleting files from new pg_multixact/offsets ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copying old pg_multixact/offsets to new server ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Deleting files from new pg_multixact/members ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copying old pg_multixact/members to new server ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting next multixact ID and offset &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Resetting WAL archives ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting frozenxid and minmxid counters in new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Restoring global objects in the new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Restoring database schemas in the new cluster
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copying user relation files
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting next OID &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Sync data directory to disk ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Creating script to delete old cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> extension updates ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Upgrade Complete
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>----------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Optimizer statistics are not transferred by pg_upgrade.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Once you start the new server, consider running:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> /usr/libexec/postgresql17/vacuumdb --all --analyze-in-stages
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Running this script will delete the old cluster&amp;#39;s data files:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ./delete_old_cluster.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now clean up:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ^D &lt;span style="color:#7f848e"># go back to the root user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% /var/lib/postgresql/17/tmp/delete_old_cluster.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% rmdir /var/lib/postgresql/16/ &lt;span style="color:#7f848e"># it should be empty by now&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you&amp;rsquo;re curious about this script, it&amp;rsquo;s a simple one-liner:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rm -rf &lt;span style="color:#98c379">&amp;#39;/var/lib/postgresql/16/olddata&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Finally, let&amp;rsquo;s get the cluster back up and vacuum it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ^D &lt;span style="color:#7f848e"># go back to your main user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas service postgresql start
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas su - postgres -c &lt;span style="color:#98c379">&amp;#39;/usr/libexec/postgresql17/vacuumdb --all --analyze-in-stages&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;miniflux&amp;#34;&lt;/span>: Generating minimal optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">1&lt;/span> target&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;postgres&amp;#34;&lt;/span>: Generating minimal optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">1&lt;/span> target&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;template1&amp;#34;&lt;/span>: Generating minimal optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">1&lt;/span> target&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;miniflux&amp;#34;&lt;/span>: Generating medium optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">10&lt;/span> targets&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;postgres&amp;#34;&lt;/span>: Generating medium optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">10&lt;/span> targets&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;template1&amp;#34;&lt;/span>: Generating medium optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">10&lt;/span> targets&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;miniflux&amp;#34;&lt;/span>: Generating default &lt;span style="color:#56b6c2">(&lt;/span>full&lt;span style="color:#56b6c2">)&lt;/span> optimizer statistics
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;postgres&amp;#34;&lt;/span>: Generating default &lt;span style="color:#56b6c2">(&lt;/span>full&lt;span style="color:#56b6c2">)&lt;/span> optimizer statistics
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;template1&amp;#34;&lt;/span>: Generating default &lt;span style="color:#56b6c2">(&lt;/span>full&lt;span style="color:#56b6c2">)&lt;/span> optimizer statistics
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>At this point, Miniflux should be working again.
Navigate to &lt;code>/about&lt;/code> and verify its database version: &lt;code>Postgres version: 17.5&lt;/code>.&lt;/p>
&lt;p>Last step, delete the previous package:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk del postgresql16 postgres16-contrib
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Double-check the newer version is still installed:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% apk list -I | grep postgres
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>libpq-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql-common-1.2-r1 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql-common&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>MIT&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql-common-openrc-1.2-r1 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql-common&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>MIT&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql-zsh-completion-5.9-r5 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>zsh&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>MIT-Modern-Variant AND GPL-2.0-only&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql17-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql17-client-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql17-contrib-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql17-openrc-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And we&amp;rsquo;re done!&lt;/p>
&lt;h2 id="references">References&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wiki.alpinelinux.org/wiki/Postgresql">https://wiki.alpinelinux.org/wiki/Postgresql&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://beune.dev/posts/upgrade-alpine-postgresql/">https://beune.dev/posts/upgrade-alpine-postgresql/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Tailspin</title><link>https://perrotta.dev/2025/05/tailspin/</link><pubDate>Sat, 24 May 2025 15:17:27 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/tailspin/</guid><description>&lt;p>&lt;a href="https://github.com/bensadeh/tailspin">tailspin&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>tailspin&lt;/code> works by reading through a log file line by line, running a series
of regexes against each line. The regexes recognize patterns you expect to
find in a logfile, like dates, numbers, severity keywords and more.&lt;/p>
&lt;p>&lt;code>tailspin&lt;/code> does not make any assumptions on the format or position of the
items it wants to highlight. For this reason, it requires no configuration and
the highlighting will work consistently across different logfiles.&lt;/p>
&lt;/blockquote>
&lt;p>The binary name is &lt;code>tspin(1)&lt;/code>, not &lt;code>tailspin(1)&lt;/code> (confusing!). MacOS has an
existing &lt;code>/usr/bin/tailspin&lt;/code> binary, which appears to be kernel-related.&lt;/p>
&lt;p>It supports &lt;code>-f&lt;/code> (&lt;code>--follow&lt;/code>), just like &lt;code>tail(1)&lt;/code>. In fact, you can think of
&lt;code>tspin -f&lt;/code> as a drop-in replacement for &lt;code>tail -f&lt;/code>.&lt;/p>
&lt;p>It is available in &lt;a href="https://repology.org/project/tailspin/versions">most package
managers&lt;/a>.&lt;/p>
&lt;p>It supports custom highlight rules (groups) via a &lt;code>~/.config/tailspin&lt;/code> file.&lt;/p>
&lt;p>Usage:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># against a log file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% tspin -f /var/log/system.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># against a command&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% kubectl logs mypod -n myns -f | tspin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># built-in highlighters showcase&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">echo&lt;/span> &lt;span style="color:#98c379">&amp;#34;2025-01-01 hello null true false 42 https://example.com?param1=foo&amp;amp;param2=bar ERROR WARNING WARN INFO 127.0.0.1 /etc/passwd foo=&amp;#39;bar&amp;#39;&amp;#34;&lt;/span> | tspin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s possible to add one-off highlighters from the command line (note: case
sensitive).&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% tspin --highlight&lt;span style="color:#56b6c2">=&lt;/span>red:err,error,fail --highlight&lt;span style="color:#56b6c2">=&lt;/span>green:success,ok
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>watch with --color</title><link>https://perrotta.dev/2025/05/watch-with--color/</link><pubDate>Sat, 24 May 2025 14:40:07 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/watch-with--color/</guid><description>&lt;p>When using &lt;code>watch(1)&lt;/code> to monitor program output, colors will not be emitted by
default.&lt;/p>
&lt;p>Thankfully &lt;a href="https://man.archlinux.org/man/watch.1">&lt;code>watch(1)&lt;/code>&lt;/a> has a &lt;code>--color&lt;/code>
(or &lt;code>-c&lt;/code> flag).&lt;/p>
&lt;p>Still, when using it with e.g. &lt;a href="https://nodejs.org/api/test.html">&lt;code>node&lt;/code> tests&lt;/a>,
colors are not emitted:&lt;/p>
&lt;pre tabindex="0">&lt;code>% watch --color -- node mytest.js
Every 2.0s: node ex5.js MacBookAir: 14:43:06
 in 0.107s (0)
✔ toWasm (0.865792ms)
ℹ tests 1
ℹ suites 0
ℹ pass 1
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 3.8805
&lt;/code>&lt;/pre>&lt;p>The command detects that it&amp;rsquo;s not attached to the terminal. :(&lt;/p>
&lt;p>How can we &lt;strong>force color output&lt;/strong> in this case?&lt;/p>
&lt;p>There&amp;rsquo;s no universal answer:&lt;/p>
&lt;ul>
&lt;li>Set &lt;a href="https://bixense.com/clicolors/">&lt;code>CLICOLOR=1&lt;/code>, &lt;code>CLICOLOR_FORCE=1&lt;/code>&lt;/a>&lt;/li>
&lt;li>See whether the program has a &lt;code>--color&lt;/code> flag. For example:
&lt;a href="https://git-scm.com/book/sv/v2/Customizing-Git-Git-Configuration">&lt;code>git&lt;/code>&lt;/a> and
&lt;a href="https://superuser.com/questions/665274/how-to-make-ls-color-its-output-by-default-without-setting-up-an-alias">&lt;code>ls&lt;/code>&lt;/a>
both support &lt;code>--color=always&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>Another possibility, which is program agnostic, is to use an utility such as
&lt;a href="https://man.archlinux.org/man/unbuffer.1">&lt;code>unbuffer(1)&lt;/code>&lt;/a> from the &lt;a href="https://wiki.tcl-lang.org/page/Expect">TCL
Expect&lt;/a> package:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% watch --color -- unbuffer node mytest.js
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The &lt;code>unbuffer&lt;/code> solution is my favorite (&lt;a href="https://perrotta.dev/2024/12/unbuffer/">previously&lt;/a>).&lt;/p>
&lt;p>&lt;strong>Reference&lt;/strong>: &lt;a href="https://stackoverflow.com/questions/3793126/colors-with-unix-command-watch">Stack
Overflow&lt;/a>.&lt;/p></description></item><item><title>npx serve</title><link>https://perrotta.dev/2025/05/npx-serve/</link><pubDate>Sat, 24 May 2025 11:14:22 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/npx-serve/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2024/01/start-an-http-server-asap/">Previously&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Start an HTTP server ASAP&lt;/p>
&lt;/blockquote>
&lt;h2 id="option-5-use-node">Option #5: use &lt;code>node&lt;/code>&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% npx serve
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://www.npmjs.com/package/serve">serve&lt;/a> comes from Vercel:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>serve&lt;/code> helps you serve a static site, single page application or just a static
file (no matter if on your device or on the local network). It also provides a
neat interface for listing the directory&amp;rsquo;s contents:&lt;/p>
&lt;p>The quickest way to get started is to just run npx serve in your project&amp;rsquo;s
directory.&lt;/p>
&lt;/blockquote></description></item><item><title>WebAssembly: hello world</title><link>https://perrotta.dev/2025/05/webassembly-hello-world/</link><pubDate>Sat, 24 May 2025 10:39:13 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/webassembly-hello-world/</guid><description>&lt;p>Today I am attending a WebAssembly workshop.&lt;/p>
&lt;p>&lt;a href="https://webassembly.org/">WebAssembly&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>WebAssembly (abbreviated &lt;em>Wasm&lt;/em>) is a binary instruction format for a
stack-based virtual machine. Wasm is designed as a portable compilation target
for programming languages, enabling deployment on the web for client and
server applications.&lt;/p>
&lt;/blockquote>
&lt;p>Given &lt;code>add.wat&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>(module
 ;; stack/forth syntax
 ;; looks like vanilla assembly
 (func $add (param $a i32) (param $b i32) (result i32)
 local.get $a
 local.get $b
 i32.add
 )

 ;; nested/lisp syntax
 ;; functional, parentheses hell
 (func $add-alt (param $a i32) (param $b i32) (result i32)
 (i32.add
 (local.get $a)
 (local.get $b))
 )

 (export &amp;#34;add&amp;#34; (func $add))
 (export &amp;#34;addAlt&amp;#34; (func $add-alt))
)
&lt;/code>&lt;/pre>&lt;p>&amp;hellip;it adds two integers.
There are two implementations, they are equivalent.&lt;/p>
&lt;p>Install dependencies:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% brew install wabt wasm-tools
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can compile &lt;code>.wat&lt;/code> to &lt;code>.wasm&lt;/code> with one of:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% wat2wasm add.wat
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% wasm-tools parse add.wat -o add.wasm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now how do we consume it? Create a &lt;code>test.js&lt;/code> file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">import&lt;/span> &lt;span style="color:#e06c75">test&lt;/span> &lt;span style="color:#e06c75">from&lt;/span> &lt;span style="color:#98c379">&amp;#34;node:test&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">import&lt;/span> &lt;span style="color:#e06c75">assert&lt;/span> &lt;span style="color:#e06c75">from&lt;/span> &lt;span style="color:#98c379">&amp;#34;node:assert&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">import&lt;/span> &lt;span style="color:#e06c75">fs&lt;/span> &lt;span style="color:#e06c75">from&lt;/span> &lt;span style="color:#98c379">&amp;#34;node:fs/promises&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">test&lt;/span>(&lt;span style="color:#98c379">&amp;#34;Instantiate add.wasm and call exported functions&amp;#34;&lt;/span>, &lt;span style="color:#c678dd">async&lt;/span> () =&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">const&lt;/span> &lt;span style="color:#e06c75">bytes&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#c678dd">await&lt;/span> &lt;span style="color:#e06c75">fs&lt;/span>.&lt;span style="color:#e06c75">readFile&lt;/span>(&lt;span style="color:#98c379">&amp;#34;add.wasm&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">const&lt;/span> {&lt;span style="color:#e06c75">instance&lt;/span>} &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#c678dd">await&lt;/span> &lt;span style="color:#e06c75">WebAssembly&lt;/span>.&lt;span style="color:#e06c75">instantiate&lt;/span>(&lt;span style="color:#e06c75">bytes&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">const&lt;/span> {&lt;span style="color:#e06c75">add&lt;/span>, &lt;span style="color:#e06c75">addAlt&lt;/span>} &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">instance&lt;/span>.&lt;span style="color:#e06c75">exports&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">assert&lt;/span>.&lt;span style="color:#e06c75">equal&lt;/span>(&lt;span style="color:#e06c75">add&lt;/span>(&lt;span style="color:#d19a66">1&lt;/span>, &lt;span style="color:#d19a66">4&lt;/span>), &lt;span style="color:#d19a66">5&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">assert&lt;/span>.&lt;span style="color:#e06c75">equal&lt;/span>(&lt;span style="color:#e06c75">addAlt&lt;/span>(&lt;span style="color:#d19a66">10&lt;/span>, &lt;span style="color:#d19a66">40&lt;/span>), &lt;span style="color:#d19a66">50&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Execute it with &lt;code>node&lt;/code> (&lt;code>brew install node&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% node ex0.js
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>✔ Instantiate add.wasm and call exported functions &lt;span style="color:#56b6c2">(&lt;/span>4.1875ms&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ℹ tests &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ℹ suites &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ℹ pass &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ℹ fail &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ℹ cancelled &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ℹ skipped &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ℹ todo &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ℹ duration_ms 7.125625
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Explanation:&lt;/p>
&lt;ul>
&lt;li>&lt;code>bytes&lt;/code> reads the &lt;code>.wasm&lt;/code> file, nothing special&lt;/li>
&lt;li>&lt;a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Reference/JavaScript_interface/instantiate_static">&lt;code>WebAssembly.instantiate&lt;/code>&lt;/a>:
compile and instantiate WebAssembly code&lt;/li>
&lt;li>access its
&lt;a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Reference/JavaScript_interface/Module/exports_static">&lt;code>exports&lt;/code>&lt;/a>
field&lt;/li>
&lt;/ul>
&lt;h2 id="references">References&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wasmgroundup.com/">WebAssembly from the Ground up&lt;/a> by Mariano Guerra
&amp;amp; Patrick Dubroy
&lt;ul>
&lt;li>&lt;a href="https://wasmgroundup.com/workshop/">Workshop&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://www.w3.org/TR/2019/REC-wasm-core-1-20191205/">WebAssembly Core
Specification&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>mdsh: a markdown pre-processor</title><link>https://perrotta.dev/2025/05/mdsh-a-markdown-pre-processor/</link><pubDate>Fri, 23 May 2025 13:00:56 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/mdsh-a-markdown-pre-processor/</guid><description>&lt;p>&lt;a href="https://github.com/zimbatm/mdsh">mdsh&lt;/a>, a markdown shell pre-processor;&lt;/p>
&lt;blockquote>
&lt;p>The mdsh project describes a Markdown language extension that can be used to
automate some common tasks in README.md files. Quite often I find myself
needing to embed a snippet of code or markdown from a different file. Or I
want to show the output of a command. In both cases this can be done manually,
but what all you had to do was run mdsh and have the file updated
automatically?&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>mdsh&lt;/code> enables keeping command outputs in markdown files up-to-date.&lt;/p>
&lt;p>It&amp;rsquo;s similar to &lt;a href="https://jupyter.org/">Jupyter Notebooks&lt;/a> (ipython
notebooks) in Python.&lt;/p>
&lt;h2 id="sample-usage">Sample usage&lt;/h2>
&lt;p>List all files within the repository that satisfy certain criteria:&lt;/p>
&lt;pre tabindex="0">&lt;code>`&amp;gt; find apps/overlays -name kustomization.yaml | cut -d&amp;#39;/&amp;#39; -f3 | sed -e &amp;#39;s/^/1. /&amp;#39; | sort -d`

&amp;lt;!-- BEGIN mdsh --&amp;gt;
1. g02
1. g03
1. g05
&amp;lt;!-- END mdsh --&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="advanced-usage">Advanced usage&lt;/h2>
&lt;p>List all pending action items (&lt;code>TODOs&lt;/code>) in this repository:&lt;/p>
&lt;pre tabindex="0">&lt;code>`&amp;gt; set +o pipefail &amp;amp;&amp;amp; files=$(grep -ErHn &amp;#39;(FIXME|TODO):&amp;#39; apps | grep -iv &amp;#34;enable auto sync&amp;#34; | sort -d -u) &amp;amp;&amp;amp; if [ -z &amp;#34;$files&amp;#34; ]; then echo &amp;#34;None&amp;#34;; else echo &amp;#34;$files&amp;#34; | sed -e &amp;#39;s/^/- /&amp;#39;; fi`

&amp;lt;!-- BEGIN mdsh --&amp;gt;
- apps/base/email/email.yaml:48: # TODO: Consider moving to the base ArgoCD chart.
- apps/base/sms/sms.yaml:58: # TODO: Consider moving to the base ArgoCD chart.
&amp;lt;!-- END mdsh --&amp;gt;
&lt;/code>&lt;/pre>&lt;p>It&amp;rsquo;s an inline shell expression on steroids, but there&amp;rsquo;s nothing special about
it. In fact, you&amp;rsquo;re not limited to the shell: it&amp;rsquo;s perfectly fine to call an
external program like &lt;code>perl&lt;/code> or &lt;code>python&lt;/code> or &lt;code>ruby&lt;/code> (e.g. to manipulate regular
expressions).&lt;/p>
&lt;h2 id="integration">Integration&lt;/h2>
&lt;p>The value of &lt;code>mdsh&lt;/code> lies in keeping its output always up-to-date. There are
multiple ways to accomplish that. The most popular ones are:&lt;/p>
&lt;ul>
&lt;li>via a CI job (e.g. a github action, a bitbucket pipeline)&lt;/li>
&lt;li>via a git pre-commit hook&lt;/li>
&lt;/ul>
&lt;p>I prefer &lt;a href="https://pre-commit.com">pre-commit&lt;/a>.&lt;/p>
&lt;p>A sample config looks like this (&lt;code>.pre-commit-config.yaml&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">repo&lt;/span>: https://github.com/zimbatm/mdsh.git
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">rev: 4b8c0ca49c96d1a3ffaad30788e6c4ebb60b2bbf # frozen&lt;/span>: v0.9.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: mdsh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">always_run&lt;/span>: &lt;span style="color:#e5c07b">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: ^README.md$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Web browser privacy tests</title><link>https://perrotta.dev/2025/05/web-browser-privacy-tests/</link><pubDate>Fri, 23 May 2025 01:13:56 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/web-browser-privacy-tests/</guid><description>&lt;p>&lt;a href="https://privacytests.org/">Privacy Tests&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Most web browsers leak your identity and your browsing history, but some
browsers are more leaky than others.&lt;/p>
&lt;p>The goal of PrivacyTests.org is to understand in detail: what data is each web
browser leaking? Which web browsers offer the best privacy protections?&lt;/p>
&lt;p>PrivacyTests.org is an open-source initiative that subjects popular web
browsers to a suite of automated tests. These tests are designed to audit web
browsers&amp;rsquo; privacy properties in an unbiased manner. The results of the tests
are made public to help users make an informed choice about which browser to
use, and to encourage browser makers to fix leaks of private user data.&lt;/p>
&lt;/blockquote>
&lt;p>I wasn&amp;rsquo;t aware of &lt;a href="https://mullvad.net/en/browser">Mullvad Browser&lt;/a>.&lt;/p></description></item><item><title>bash: set a trap to log errors</title><link>https://perrotta.dev/2025/05/bash-set-a-trap-to-log-errors/</link><pubDate>Thu, 22 May 2025 13:41:43 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/bash-set-a-trap-to-log-errors/</guid><description>&lt;p>Create &lt;code>main.sh&lt;/code> and mark it as executable (&lt;code>chmod +x&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e">&lt;/span>&lt;span style="color:#e5c07b">set&lt;/span> -euo pipefail
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># Set a trap to handle errors and log them.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e5c07b">trap&lt;/span> &lt;span style="color:#98c379">&amp;#39;echo &amp;#34;Error occurred at line $LINENO. Command: $BASH_COMMAND&amp;#34;&amp;#39;&lt;/span> ERR
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e5c07b">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now execute it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ./main.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Error occurred at line 7. Command: &lt;span style="color:#e5c07b">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This pattern is useful to debug failing (non-zero exit code) shell scripts.&lt;/p></description></item><item><title>kubernetes: list pending pods in daemonset</title><link>https://perrotta.dev/2025/05/kubernetes-list-pending-pods-in-daemonset/</link><pubDate>Tue, 20 May 2025 16:41:00 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/kubernetes-list-pending-pods-in-daemonset/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given a DaemonSet with a couple of pods stuck in
&amp;ldquo;Pending&amp;rdquo; state during their rollout, find out which nodes did not yet complete
the pod initialization.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% kubectl get nodes -o name | grep -vFf &amp;lt;&lt;span style="color:#56b6c2">(&lt;/span>kubectl get pods -n &lt;span style="color:#56b6c2">{&lt;/span>namespace&lt;span style="color:#56b6c2">}&lt;/span> -l &lt;span style="color:#56b6c2">{&lt;/span>ds-label-selector&lt;span style="color:#56b6c2">}&lt;/span> -o wide --no-headers | awk &lt;span style="color:#98c379">&amp;#39;{print &amp;#34;node/&amp;#34; $7}&amp;#39;&lt;/span>&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node/aks-database-12345678-vmss000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node/aks-database-12345678-vmss000002
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node/aks-systempool-87654321-vmss000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node/aks-systempool-87654321-vmss000001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Notes:&lt;/p>
&lt;ul>
&lt;li>&lt;code>kubectl get nodes -o name&lt;/code>: list all node names in the &lt;code>node/&amp;lt;name&amp;gt;&lt;/code> form&lt;/li>
&lt;li>&lt;code>kubectl get pods [...] -o wide&lt;/code>: get the node name for each running DaemonSet pod&lt;/li>
&lt;li>&lt;code>awk '{print &amp;quot;node/&amp;quot; $7}'&lt;/code>: get the node name matching the output of &lt;code>get nodes&lt;/code>&lt;/li>
&lt;li>&lt;code>grep [...]&lt;/code>: find the nodes we are looking for&lt;/li>
&lt;/ul>
&lt;p>Surely there must be an easier way to accomplish this?&lt;/p></description></item><item><title>ack with context</title><link>https://perrotta.dev/2025/05/ack-with-context/</link><pubDate>Mon, 19 May 2025 14:12:35 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/ack-with-context/</guid><description>&lt;p>I often use &lt;a href="https://beyondgrep.com/">&lt;code>ack(1)&lt;/code>&lt;/a> to &lt;code>grep&lt;/code> for text patterns in git
repositories&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>Today I learned about its &lt;a href="https://linux.die.net/man/1/ack">&lt;code>-C&lt;/code>&lt;/a> flag:&lt;/p>
&lt;pre tabindex="0">&lt;code>-C [ NUM ], --context[= NUM ]
 Print NUM lines (default 2) of context around matching lines.
&lt;/code>&lt;/pre>&lt;p>It&amp;rsquo;s a handy shortcut, better than fiddling with &lt;code>-A&lt;/code> and &lt;code>-B&lt;/code> (after and
before, respectively).&lt;/p>
&lt;p>&lt;strong>Bonus&lt;/strong>: the same flag exists in &lt;code>grep&lt;/code> and in &lt;code>rg&lt;/code> (&lt;code>ripgrep&lt;/code>).&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>I should probably fully migrate to
&lt;a href="https://github.com/BurntSushi/ripgrep">&lt;code>ripgrep&lt;/code>&lt;/a> one day. Heck, it&amp;rsquo;s not
even in the &lt;a href="https://aur.archlinux.org/packages/ack">Arch core repositories&lt;/a>
anymore.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Ultrathink</title><link>https://perrotta.dev/2025/05/ultrathink/</link><pubDate>Mon, 19 May 2025 14:08:25 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/ultrathink/</guid><description>&lt;p>Simon Willison,
&lt;a href="https://simonwillison.net/2025/Apr/19/claude-code-best-practices/">Ultrathink&lt;/a>
(&lt;a href="https://news.ycombinator.com/item?id=43739997">via&lt;/a>):&lt;/p>
&lt;blockquote>
&lt;p>We recommend using the word &amp;ldquo;think&amp;rdquo; to trigger extended thinking mode, which
gives Claude additional computation time to evaluate alternatives more
thoroughly. These specific phrases are mapped directly to increasing levels of
thinking budget in the system: &amp;ldquo;think&amp;rdquo; &amp;lt; &amp;ldquo;think hard&amp;rdquo; &amp;lt; &amp;ldquo;think harder&amp;rdquo; &amp;lt;
&amp;ldquo;ultrathink.&amp;rdquo; Each level allocates progressively more thinking budget for
Claude to use.&lt;/p>
&lt;/blockquote>
&lt;p>A prompt I used recently:&lt;/p>
&lt;blockquote>
&lt;p>How can I leverage &lt;a href="https://kustomize.io/">&lt;code>kustomize&lt;/code>&lt;/a> modules (e.g.
components or replacements) to reduce code duplication in this repository?
Ultrathink and suggest some ideas.&lt;/p>
&lt;/blockquote>
&lt;p>🤖&lt;/p></description></item><item><title>ChatGPT default settings</title><link>https://perrotta.dev/2025/05/chatgpt-default-settings/</link><pubDate>Sun, 18 May 2025 19:31:16 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/chatgpt-default-settings/</guid><description>&lt;p>&lt;a href="https://onlinesafety.substack.com/p/chatgpt-critical-privacy-settings">ChatGPT&amp;rsquo;s Privacy Trap: Default Settings You Can&amp;rsquo;t Ignore&lt;/a> by Tate Jarrow:&lt;/p>
&lt;blockquote>
&lt;p>ChatGPT is not safe to use out of the box! The default settings almost
certainly compromise your privacy because your chats (that likely contain
personal or sensitive information) are used to train OpenAI&amp;rsquo;s models, are
reviewed by humans, and can be used to identify you uniquely.&lt;/p>
&lt;p>[&amp;hellip;]&lt;/p>
&lt;p>However, if you are using ChatGPT and haven&amp;rsquo;t updated your privacy options,
all the data you enter can be used to train its model (and therefore is no
longer private). This means that if you upload anything personal or sensitive,
like a resume, work material, vacation plans, or anything else, OpenAI can
access and use it. Additionally, OpenAI uses human review, so your data can
also be reviewed and accessed by people. More information on how OpenAI
handles your content is available here.&lt;/p>
&lt;/blockquote>
&lt;p>Tate recommends:&lt;/p>
&lt;ul>
&lt;li>turn off model improvement&lt;/li>
&lt;li>use temporary chats&lt;/li>
&lt;li>submit a &amp;ldquo;Do not train on my content&amp;rdquo; at OpenAI&amp;rsquo;s Privacy Center&lt;/li>
&lt;li>consider turning off &amp;ldquo;Memory&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;p>I had the opportunity to speak with Tate once, in a virtual meeting.&lt;/p>
&lt;p>In my opinion, he is quite competent and gives sound advice.&lt;/p></description></item><item><title>fpp: facebook path picker</title><link>https://perrotta.dev/2025/05/fpp-facebook-path-picker/</link><pubDate>Sun, 18 May 2025 18:34:19 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/fpp-facebook-path-picker/</guid><description>&lt;p>&lt;a href="https://github.com/facebook/PathPicker">&lt;code>fpp&lt;/code>&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>PathPicker accepts a wide range of input &amp;ndash; output from git commands, grep
results, searches &amp;ndash; pretty much anything. After parsing the input, PathPicker
presents you with a nice UI to select which files you&amp;rsquo;re interested in. After
that you can open them in your favorite editor or execute arbitrary commands.&lt;/p>
&lt;/blockquote>
&lt;p>Think of &lt;code>fpp&lt;/code> as the result of parsing file-looking paths in &lt;code>stdout&lt;/code> and
injecting them into &lt;a href="https://github.com/junegunn/fzf">&lt;code>fzf&lt;/code>&lt;/a>.&lt;/p>
&lt;p>It&amp;rsquo;s part of my daily tool belt.&lt;/p>
&lt;p>Sadly, the project is &lt;a href="https://github.com/facebook/PathPicker/commits/main/">somewhat
abandoned&lt;/a> since 2022.
Nonetheless, it doesn&amp;rsquo;t need any new features: &lt;a href="https://en.wikipedia.org/wiki/Unix_philosophy">it does one thing and does it
well&lt;/a>.&lt;/p>
&lt;p>Its latest released version is
&lt;a href="https://github.com/facebook/PathPicker/releases/tag/0.9.5">0.9.5&lt;/a>. Ironically,
due to a bug, there is a mismatch in &lt;code>--version&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% fpp --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fpp version 0.9.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>A few usage examples:&lt;/p>
&lt;ul>
&lt;li>&lt;code>git st | fpp&lt;/code>: modified files in a git repository&lt;/li>
&lt;li>&lt;code>fd -e ts --type file | fpp&lt;/code>: files with a given extension&lt;/li>
&lt;li>&lt;code>ack -l {pattern} | fpp&lt;/code>: files that match a given pattern&lt;/li>
&lt;/ul>
&lt;p>To continuously edit files in a loop, use &lt;code>fpp -ko&lt;/code> (&lt;code>ko&lt;/code> stands for
&lt;code>--keep-open&lt;/code>).&lt;/p></description></item><item><title>Espanso: hello world</title><link>https://perrotta.dev/2025/05/espanso-hello-world/</link><pubDate>Fri, 16 May 2025 17:40:26 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/espanso-hello-world/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2025/03/maccy-pin-items/">Previously&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Sometimes it&amp;rsquo;s useful to have certain code snippets be easily accessible from
the clipboard manager.&lt;/p>
&lt;p>[&amp;hellip;]&lt;/p>
&lt;p>This workflow is decent for temporary entries. For semi-permanent ones, I
should look into &lt;a href="https://espanso.org/">Espanso&lt;/a> at some point. For now,
&lt;a href="https://perrotta.dev/2025/01/raycast-snippets/">Raycast Snippets&lt;/a> fills in this
role.&lt;/p>
&lt;/blockquote>
&lt;p>Today is the day!&lt;/p>
&lt;p>&lt;a href="https://espanso.org/">Espanso&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Supercharge your typing| experience.&lt;/p>
&lt;p>Tired of typing the same sentences over and over? Discover the incredible
power of a full-blown text expander.&lt;/p>
&lt;/blockquote>
&lt;p>So?&lt;/p>
&lt;blockquote>
&lt;p>How it works&lt;/p>
&lt;p>Espanso detects when you type a keyword&lt;/p>
&lt;p>Today is :date&lt;/p>
&lt;p>(becomes) Today is 05/16/2025&lt;/p>
&lt;p>and replaces it while you&amp;rsquo;re typing.&lt;/p>
&lt;/blockquote>
&lt;p>It&amp;rsquo;s just like &lt;a href="https://www.raycast.com/core-features/snippets">Text Expander&lt;/a>
from Raycast snippets.&lt;/p>
&lt;p>It&amp;rsquo;s available on all major OSes (Windows, Linux, macOS). I am testing it on
macOS. Installation:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% brew install espanso
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>After installing it and opening it, give it all sorts of System Accessibility
permissions so that it can perform its magic.&lt;/p>
&lt;p>This is just a &amp;ldquo;hello world&amp;rdquo; post, therefore I am not going to list every single
capability it has. Let&amp;rsquo;s just keep it simple and get our feet wet.&lt;/p>
&lt;p>I have to type &lt;code>helm ls -A --max 9999 | grep -i {release}&lt;/code> &lt;a href="https://perrotta.dev/2024/08/helm-list-all-installed-charts-in-the-cluster/">all the time&lt;/a>, and I&amp;rsquo;m fed
up with it.&lt;/p>
&lt;p>I want to create a &lt;code>:helm:ls&lt;/code> expansion that will trigger that command
expansion.&lt;/p>
&lt;p>Run &lt;code>espanso edit&lt;/code>. It opens a stock &lt;code>base.yml&lt;/code> file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># espanso match file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># For a complete introduction, visit the official docs at: https://espanso.org/docs/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># You can use this file to define the base matches (aka snippets)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># that will be available in every application when using espanso.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># Matches are substitution rules: when you type the &amp;#34;trigger&amp;#34; string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># it gets replaced by the &amp;#34;replace&amp;#34; string.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">matches&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># Simple text replacement&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">trigger&lt;/span>: &lt;span style="color:#98c379">&amp;#34;:espanso&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">replace&lt;/span>: &lt;span style="color:#98c379">&amp;#34;Hi there!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># NOTE: espanso uses YAML to define matches, so pay attention to the indentation!&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># But matches can also be dynamic:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># Print the current date&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">trigger&lt;/span>: &lt;span style="color:#98c379">&amp;#34;:date&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">replace&lt;/span>: &lt;span style="color:#98c379">&amp;#34;{{mydate}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">vars&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">name&lt;/span>: mydate
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">type&lt;/span>: date
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">format&lt;/span>: &lt;span style="color:#98c379">&amp;#34;%m/%d/%Y&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># Print the output of a shell command&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">trigger&lt;/span>: &lt;span style="color:#98c379">&amp;#34;:shell&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">replace&lt;/span>: &lt;span style="color:#98c379">&amp;#34;{{output}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">vars&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">name&lt;/span>: output
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">type&lt;/span>: shell
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">cmd&lt;/span>: &lt;span style="color:#98c379">&amp;#34;echo &amp;#39;Hello from your shell&amp;#39;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># And much more! For more information, visit the docs: https://espanso.org/docs/&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The file is self-contained and well-documented enough that I do not need to look
up any docs nor use AI to add the desired entry:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># [...]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">matches&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># [...]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">trigger&lt;/span>: &lt;span style="color:#98c379">&amp;#34;:helm:ls&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">replace&lt;/span>: &lt;span style="color:#98c379">&amp;#34;helm ls --max 9999 -A | grep -i&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Once the file is saved, it&amp;rsquo;s magic ✨, and it takes effect immediately.&lt;/p>
&lt;p>Example usage&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>:helm:ls redis
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&amp;hellip;becomes:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>helm ls --max &lt;span style="color:#d19a66">9999&lt;/span> -A | grep -i redis
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For reference, this is the full path to the file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% espanso edit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Editing file: /Users/thiago.perrotta/Library/Application Support/espanso/match/base.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I am particularly excited it&amp;rsquo;s YAML and it&amp;rsquo;s accessible in a stable location: it
should be quite easy to integrate it with my dotfiles later on.&lt;/p>
&lt;p>Its out-of-the-box usability (for developers who prefer text files) and
perceived speed are better than Raycast snippets.&lt;/p>
&lt;p>There are so many possibilities to explore: command &lt;del>espansions&lt;/del> expansions, LLM prompts,
email greetings, canned responses, and so on.&lt;/p>
&lt;p>For Raycast snippets I was using &lt;code>@@&lt;/code> as a prefix. Espanso seems to recommend
&lt;code>:&lt;/code>. Let&amp;rsquo;s see which one I will stick to.&lt;/p>
&lt;p>Also, I&amp;rsquo;d like to thank Farzad for the recommendation via email. It wasn&amp;rsquo;t the
first time I had heard about Espanso, but it has reinforced my desire to try it
out.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>In order to type a plain &lt;code>:helm:ls&lt;/code> without expansion (e.g. for this blog
post), type the following: &lt;code>:helm:l{left arrow}{right arrow}s&lt;/code>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Stack Overflow is almost dead</title><link>https://perrotta.dev/2025/05/stack-overflow-is-almost-dead/</link><pubDate>Thu, 15 May 2025 23:14:16 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/stack-overflow-is-almost-dead/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2025/01/why-self-answer-questions-in-your-own-blog-instead-of-stack-overflow/">Previously&lt;/a>.&lt;/p>
&lt;p>&lt;a href="https://blog.pragmaticengineer.com/stack-overflow-is-almost-dead/">Stack overflow is almost dead&lt;/a>&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> by Gergely Orosz:&lt;/p>
&lt;blockquote>
&lt;p>Four months ago, we asked Are LLMs making Stack Overflow irrelevant? Data at
the time suggested that the answer is likely &amp;ldquo;yes:&amp;rdquo;&lt;/p>
&lt;p>[&amp;hellip;]&lt;/p>
&lt;p>Since then, things at Stack Overflow went from bad to worse. The volume of
questions asked has nearly dried up, new data shows:&lt;/p>
&lt;p>[&amp;hellip;]&lt;/p>
&lt;p>This tallies with my memory of feeling that site moderators had gone on a
power trip by closing legitimate questions. I stopped asking questions around
this time because the site felt unwelcome.&lt;/p>
&lt;p>[&amp;hellip;]&lt;/p>
&lt;p>ChatGPT is faster and it&amp;rsquo;s trained on StackOverflow data, so the quality of
answers is similar. Plus, ChatGPT is polite and answers all questions, in
contrast to StackOverflow moderators.&lt;/p>
&lt;/blockquote>
&lt;p>A bit of politeness&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup> goes a long way, eh?&lt;/p>
&lt;p>Where do you ask novel questions these days?&lt;/p>
&lt;p>Stack Exchange is still my to-go site for that, but it&amp;rsquo;s starting to feel like a
ghost town. Oftentimes I end up self-answering my own question, because no one
else does. Nonetheless, I&amp;rsquo;d rather post on my blog if I know the answer in
advance. The reason to post on SE is when &lt;em>I don&amp;rsquo;t know&lt;/em>.&lt;/p>
&lt;p>It feels to me the best place to ask specific questions these days is wherever
the project is developed. GitHub or GitLab issues, Discourse (BBS / forums),
Discord&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup>, Slack&amp;hellip;and so on. There&amp;rsquo;s a lot of fragmentation. Perhaps that&amp;rsquo;s
not too bad after all, but it incurs additional effort.&lt;/p>
&lt;p>And where to ask general questions? Reddit&lt;sup id="fnref1:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup>, the Fediverse™, social media,
project-agnostic chat platforms / communities&amp;hellip;&lt;/p>
&lt;p>Perhaps one day we&amp;rsquo;ll just be able to tell our LLM agents to go out there in the
dark corners of the Web&lt;sup id="fnref:4">&lt;a href="#fn:4" class="footnote-ref" role="doc-noteref">4&lt;/a>&lt;/sup> to ask a question for us.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>I am (nit)picky. Gergely did &lt;strong>not&lt;/strong> capitalize &amp;ldquo;overflow&amp;rdquo;. &lt;em>This is plainly wrong&lt;/em>!!1! 🤷&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>🇨🇦&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>Ewwww.&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&amp;#160;&lt;a href="#fnref1:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:4">
&lt;p>Will the Web even be alive by then?&amp;#160;&lt;a href="#fnref:4" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Cursor</title><link>https://perrotta.dev/2025/05/cursor/</link><pubDate>Thu, 15 May 2025 15:18:53 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/cursor/</guid><description>&lt;p>Meanwhile, in a conversation with a coworker&amp;hellip;&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Me&lt;/strong>: My &lt;em>aha!&lt;/em> moment from this week was to use
&lt;a href="https://cline.bot/">Cline&lt;/a>&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> with this new &amp;ldquo;Use the browser&amp;rdquo; integration.
It opens an embedded web browser within its pane and starts to use the cursor
to click around.&lt;/p>
&lt;p>&lt;strong>Coworker&lt;/strong>: &lt;a href="https://www.cursor.com/">Cursor&lt;/a>&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>, the IDE?&lt;/p>
&lt;p>&lt;strong>Me&lt;/strong>: Nooo, I mean, the mouse cursor, the pointer.&lt;/p>
&lt;/blockquote>
&lt;p>I was waiting for this moment when the overloaded &amp;ldquo;Cursor&amp;rdquo; term would become
ambiguous. It&amp;rsquo;s just somewhat of a funny coincidence that it appeared in the
context of one of its main competitors.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Cline: &lt;em>an AI-powered coding assistant that runs in VS Code&lt;/em>&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>Cursor: &lt;em>the AI Code Editor&lt;/em>&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Github: dependabot: group updates</title><link>https://perrotta.dev/2025/05/github-dependabot-group-updates/</link><pubDate>Wed, 14 May 2025 15:08:40 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/github-dependabot-group-updates/</guid><description>&lt;p>&lt;a href="https://docs.github.com/en/code-security/getting-started/dependabot-quickstart-guide">dependabot&lt;/a>
supports
&lt;a href="https://docs.github.com/en/code-security/dependabot/working-with-dependabot/dependabot-options-reference#groups--">grouping&lt;/a>
commits into fewer, targeted pull requests.&lt;/p>
&lt;p>A recent example in the repository of this blog:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>% git show
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>commit 1fa93bed4d0faa9dfcdd6e554201d708baa38dbb (HEAD -&amp;gt; master, origin/master, origin/HEAD)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Author: Thiago Perrotta &amp;lt;{email redacted}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Date: Wed May 14 15:08:23 2025 +0200
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group dependabot updates
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>diff --git .github/dependabot.yml .github/dependabot.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>index d6ca206c..3a5d1b09 100644
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">--- .github/dependabot.yml
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+++ .github/dependabot.yml
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">&lt;/span>@@ -4,7 +4,15 @@ updates:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> directory: /
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> schedule:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> interval: monthly
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ groups:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ all:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ patterns:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ - &amp;#34;*&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">&lt;/span> - package-ecosystem: github-actions
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> directory: /
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> schedule:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> interval: monthly
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ groups:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ all:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ patterns:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ - &amp;#34;*&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This is better for my workflow because then I will have less pull requests to
deal with at once, instead of having to review them one by one for each
individual github action or git submodule bump.&lt;/p></description></item><item><title>VSCode: Github Pull Requests plug-in: collapse all comments by default</title><link>https://perrotta.dev/2025/05/vscode-github-pull-requests-plug-in-collapse-all-comments-by-default/</link><pubDate>Wed, 14 May 2025 14:40:34 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/vscode-github-pull-requests-plug-in-collapse-all-comments-by-default/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: I am constantly annoyed at opening files in VSCode with
PR comments being automatically expanded by default and occupying precious real
estate. Get rid of these comments!&lt;/p>
&lt;p>&lt;a href="https://github.com/Microsoft/vscode-pull-request-github/issues/665">Github
issue&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>From your user settings with &lt;code>&amp;quot;githubPullRequests.commentExpandState&amp;quot;&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>I added the following to my &lt;code>settings.json&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">&amp;#34;githubPullRequests.commentExpandState&amp;#34;&lt;/span>: &lt;span style="color:#98c379">&amp;#34;collapseAll&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>How to file a great feature request</title><link>https://perrotta.dev/2025/05/how-to-file-a-great-feature-request/</link><pubDate>Wed, 14 May 2025 13:46:26 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/how-to-file-a-great-feature-request/</guid><description>&lt;p>Obviously I&amp;rsquo;m biased to say this but I have just
&lt;a href="https://github.com/gruntwork-io/pre-commit/issues/130">filed&lt;/a> a high-quality
feature request for a software project I am interested to adopt. What makes it
great™:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>describe &lt;strong>concisely&lt;/strong> and &lt;strong>precisely&lt;/strong> &lt;strong>what&lt;/strong> you&amp;rsquo;re looking for&lt;/p>
&lt;ul>
&lt;li>being concise is essential: we live in a fast-paced world. If no one looks
at your FR, then it won&amp;rsquo;t move forward. Period.&lt;/li>
&lt;li>being precise (unambiguous) is important to avoid back-and-forth and
potential bikeshedding&lt;/li>
&lt;li>I prefer to write it using my own words. Using an LLM risks making your FR
robotic and unappealing for anyone to consider. YMMV.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>describe &lt;strong>why&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>what is the &lt;em>raison d&amp;rsquo;être&lt;/em> of the feature? What is the rationale behind it?
How does it make the project better? How does it improve the developer
experience?&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>(&lt;em>optional&lt;/em>, but &lt;strong>highly recommended&lt;/strong>) suggest &lt;strong>how&lt;/strong> and offer to address it&lt;/p>
&lt;ul>
&lt;li>Everyone wants everything, but few people want to put in the effort to see
changes take place. Your FR has a much higher chance of becoming reality if
you volunteer your time, effort and expertise to implement the feature
yourself, rather than &lt;a href="https://xkcd.com/2347/">demanding&lt;/a> someone (likely an
unpaid volunteer) to do so for you.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>In my experience it&amp;rsquo;s better to file an issue / ticket / FR first, &lt;strong>prior to&lt;/strong>
sending a pull request. You &lt;em>cannot&lt;/em> know in advance whether the FR is welcome
by the project or its maintainers. Sending in a PR just to see its underlying
&lt;em>raison d&amp;rsquo;être&lt;/em> be rejected is a waste of time, besides being a frustrating
experience.&lt;/p>
&lt;p>Furthermore, the ticket doubles-down as documentation for the PR description /
commit message in the future, should the FR be accepted. The small overhead of
time to file a ticket is a reasonable trade-off.&lt;/p>
&lt;p>Now, even if your FR is great and very reasonable&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>, there&amp;rsquo;s absolutely no
guarantee:&lt;/p>
&lt;ul>
&lt;li>you will even get a reply in the first place&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>&lt;/li>
&lt;li>back-and-forth chatter will be quick and responsive&lt;/li>
&lt;li>the maintainers / developers will agree with your sense of &amp;lsquo;usefulness&amp;rsquo;&lt;/li>
&lt;li>the maintainers / developers will agree with &lt;em>how&lt;/em> you believe it should be
tackled or implemented&lt;/li>
&lt;li>your follow-up PR will even be reviewed and, let alone, merged&lt;/li>
&lt;li>your merged PR will make it into a new point release&lt;/li>
&lt;/ul>
&lt;p>&lt;em>Life is hard&lt;/em>. Nonetheless, do not give up! Open source software is beautiful
and serendipitous. :)&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>It&amp;rsquo;s a subjective matter.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>Sometimes it takes &lt;a href="https://github.com/funtoo/keychain/issues/119">more than 3
years&lt;/a>.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Slack: Github bot: post notifications</title><link>https://perrotta.dev/2025/05/slack-github-bot-post-notifications/</link><pubDate>Mon, 12 May 2025 11:51:18 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/slack-github-bot-post-notifications/</guid><description>&lt;p>Assume your organization has the &lt;a href="https://github.com/integrations/slack">Github
bot&lt;/a> integrated with Slack, and it&amp;rsquo;s
already properly configured.&lt;/p>
&lt;p>Assume you have a channel called &lt;code>#team-reviews&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Problem statement&lt;/strong>: subscribe the github repository &lt;code>my-org/my-repo&lt;/code> to post
updates to that channel.&lt;/p>
&lt;p>As per the
&lt;a href="https://github.com/integrations/slack?tab=readme-ov-file#subscribing-and-unsubscribing">documentation&lt;/a>,
use the &lt;code>/subscribe&lt;/code> and &lt;code>/unsubscribe&lt;/code> commands. Send them in the
&lt;code>#team-reviews&lt;/code> channel:&lt;/p>
&lt;pre tabindex="0">&lt;code>/github subscribe my-org/my-repo
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>✅ Subscribed to my-org/my-repo. This channel will receive notifications for
&lt;code>issues&lt;/code>, &lt;code>pulls&lt;/code>, &lt;code>commits&lt;/code>, &lt;code>releases&lt;/code>, &lt;code>deployments&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>In case you wish to subscribe to only pull requests and commits, follow up with:&lt;/p>
&lt;pre tabindex="0">&lt;code>/github unsubscribe my-org/my-repo issues,releases,deployments
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>✅ Subscribed to my-org/my-repo. This channel will receive notifications for
&lt;code>pulls&lt;/code>, &lt;code>commits&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>Repeat for as many repositories as needed.&lt;/p></description></item><item><title>Kagi: Small Web</title><link>https://perrotta.dev/2025/05/kagi-small-web/</link><pubDate>Sat, 10 May 2025 18:24:21 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/kagi-small-web/</guid><description>&lt;p>&lt;a href="https://help.kagi.com/kagi/company/">Kagi&lt;/a> is a paid search engine.&lt;/p>
&lt;p>The &lt;a href="https://blog.kagi.com/small-web">Kagi Small Web&lt;/a> is:&lt;/p>
&lt;blockquote>
&lt;p>the non-commercial part of the web, crafted by individuals to express
themselves or share knowledge without seeking any financial gain. This concept
often evokes nostalgia for the early, less commercialized days of the web,
before the ad-supported business model took over the internet (and we started
fighting back!)&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://benhoyt.com/writings/the-small-web-is-beautiful/">Context&lt;/a>.&lt;/p>
&lt;p>Kagi supports searching websites within the Small Web via a &lt;a href="https://help.kagi.com/kagi/features/lenses.html">dedicated
lens&lt;/a> (think of it as a search
scope).&lt;/p>
&lt;p>They also provide a integrated &lt;a href="https://kagi.com/api/v1/smallweb/feed/">RSS
feed&lt;/a> (think of it as a &amp;ldquo;small web
&lt;a href="https://en.wikipedia.org/wiki/Planet_(software)">planet&lt;/a>&amp;rdquo;).&lt;/p>
&lt;p>And, also, a &lt;a href="https://kagi.com/smallweb">navigator&lt;/a> (think of it as StumbleUpon
or Digg in the early days).&lt;/p>
&lt;p>The small web somewhat correlates with the &lt;a href="https://indieweb.org/">IndieWeb&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>What is the IndieWeb?&lt;/p>
&lt;p>The IndieWeb is a people-focused alternative to the &amp;ldquo;corporate web&amp;rdquo;.&lt;/p>
&lt;p>We are a community of independent and personal websites based on the
principles of: owning your domain and using it as your primary online
identity, publishing on your own site first (optionally elsewhere), and owning
your content.&lt;/p>
&lt;/blockquote>
&lt;p>It is a great source of serendipity.&lt;/p></description></item><item><title>helm-secrets + vals: string interpolation</title><link>https://perrotta.dev/2025/05/helm-secrets--vals-string-interpolation/</link><pubDate>Thu, 08 May 2025 15:25:14 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/helm-secrets--vals-string-interpolation/</guid><description>&lt;p>&lt;a href="https://github.com/jkroepke/helm-secrets">helm-secrets&lt;/a> is:&lt;/p>
&lt;blockquote>
&lt;p>a helm plugin that helps to manage secrets with Git workflow and store them
anywhere.&lt;/p>
&lt;/blockquote>
&lt;p>It uses &lt;a href="https://github.com/helmfile/vals">vals&lt;/a> underneath, which is a:&lt;/p>
&lt;blockquote>
&lt;p>Helm-like configuration values loader with support for various sources&lt;/p>
&lt;/blockquote>
&lt;p>&amp;hellip;including, in particular, &lt;a href="https://www.hashicorp.com/en/products/vault">HashiCorp Vault&lt;/a>.&lt;/p>
&lt;p>The &lt;code>vals&lt;/code> syntax is documented
&lt;a href="https://github.com/helmfile/vals?tab=readme-ov-file#expression-syntax">here&lt;/a>.&lt;/p>
&lt;p>&lt;strong>Problem statement&lt;/strong>: construct a string composed of the following two vault
entries:&lt;/p>
&lt;ul>
&lt;li>&lt;code>vault://kv-v2/services/common/postgres/#url&lt;/code>&lt;/li>
&lt;li>&lt;code>vault://kv-v2/services/common/postgres/#params&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&amp;hellip;to yield &lt;code>{url}?{params}&lt;/code>.&lt;/p>
&lt;p>How do we concatenate two vault entries?
The secret is in the &lt;code>+&lt;/code>:&lt;/p>
&lt;blockquote>
&lt;p>Finally, the optional trailing &lt;code>+&lt;/code> is the explicit &amp;ldquo;end&amp;rdquo; of the expression.
You usually don&amp;rsquo;t need it, as if omitted, it treats anything after &lt;code>ref+&lt;/code> and
before the new-line or the end-of-line as an expression to be evaluated. An
explicit &lt;code>+&lt;/code> is handy when you want to do a simple string interpolation. That
is, &lt;code>foo ref+SECRET1+ ref+SECRET2+ bar&lt;/code> evaluates to &lt;code>foo SECRET1_VALUE SECRET2_VALUE bar&lt;/code>.&lt;/p>
&lt;/blockquote>
&lt;p>The final result:&lt;/p>
&lt;pre tabindex="0">&lt;code>secrets+literal://ref+vault://kv-v2/services/common/postgres/#url+?ref+vault://kv-v2/services/common/postgres/#params
&lt;/code>&lt;/pre>&lt;p>&amp;hellip;wherein &lt;code>secrets+literal://&lt;/code> comes from &lt;code>helm-secrets&lt;/code>. It needs to appear only
once. &lt;code>ref+vault://&lt;/code> comes from &lt;code>vals&lt;/code>, it appears once for each vault entry.&lt;/p></description></item><item><title>1Password SSH agent error</title><link>https://perrotta.dev/2025/05/1password-ssh-agent-error/</link><pubDate>Wed, 07 May 2025 12:52:00 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/1password-ssh-agent-error/</guid><description>&lt;p>A day in the life:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ssh &lt;span style="color:#56b6c2">{&lt;/span>my-server&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>STDERR:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sign_and_send_pubkey: signing failed &lt;span style="color:#c678dd">for&lt;/span> ED25519 &lt;span style="color:#98c379">&amp;#34;/Users/thiago/.ssh/id_ed25519&amp;#34;&lt;/span> from agent: agent refused operation
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> git@github.com: Permission denied &lt;span style="color:#56b6c2">(&lt;/span>publickey&lt;span style="color:#56b6c2">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fatal: Could not &lt;span style="color:#e5c07b">read&lt;/span> from remote repository.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Please make sure you have the correct access rights
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> and the repository exists.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What&amp;rsquo;s the matter?&lt;/p>
&lt;p>My ssh config is integrated with the &lt;a href="https://developer.1password.com/docs/ssh/agent/">1Password ssh
agent&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>Host *
 # Use 1Password SSH agent when available
 # macOS only
 # Linux: &amp;#34;~/.1password/agent.sock&amp;#34;
 IdentityAgent &amp;#34;~/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock&amp;#34;
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Solution&lt;/strong>: Ensure 1Password is unlocked, so that the agent can be used.&lt;/p>
&lt;p>It can be unlocked from its macOS app, or from the CLI (&lt;code>op signin --account {my-account}&lt;/code>).&lt;/p></description></item><item><title>ByteBurst Brigade</title><link>https://perrotta.dev/2025/05/byteburst-brigade/</link><pubDate>Tue, 06 May 2025 17:56:02 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/byteburst-brigade/</guid><description>&lt;p>If you have Telegram, you&amp;rsquo;re welcome to join &lt;a href="https://t.me/+OzLfJRhjA69iNWFh">ByteBurst
Brigade&lt;/a>, a supergroup I host with friends to
discuss Tech in general: privacy, self-hosting, news, workflows, etc.&lt;/p>
&lt;p>The noise in the group is low – arguably, that&amp;rsquo;s a feature, à la
&lt;a href="https://lobste.rs/about#invitations">lobsters&lt;/a>.&lt;/p></description></item><item><title>Slack snippets</title><link>https://perrotta.dev/2025/05/slack-snippets/</link><pubDate>Tue, 06 May 2025 17:48:15 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/slack-snippets/</guid><description>&lt;p>In order to post a large text file to Slack, use a &lt;a href="https://slack.com/intl/en-gb/help/articles/204145658-Create-or-paste-code-snippets-in-Slack">snippet&lt;/a>.
Snippet is short for &amp;ldquo;code snippet&amp;rdquo;.&lt;/p>
&lt;p>Type in &lt;code>/snippet&lt;/code>, then complete the wizard.&lt;/p>
&lt;p>You can choose the language – typically YAML, JSON or Shell – for syntax
highlighting.&lt;/p>
&lt;p>This is better than dumping the entire source within a pair of three backticks.&lt;/p></description></item><item><title>Do you like to live in danger?</title><link>https://perrotta.dev/2025/05/do-you-like-to-live-in-danger/</link><pubDate>Mon, 05 May 2025 18:11:23 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/do-you-like-to-live-in-danger/</guid><description>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% claude --dangerously-skip-permissions &lt;span style="color:#98c379">&amp;#34;fix the zizmor issue: pre-commit run --all-files zizmor&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ WARNING: Claude Code running in Bypass Permissions mode │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ In Bypass Permissions mode, Claude Code will not ask &lt;span style="color:#c678dd">for&lt;/span> your approval before running potentially dangerous commands. │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ This mode should only be used in a sandboxed container/VM that has restricted internet access and can easily be restored &lt;span style="color:#c678dd">if&lt;/span> damaged. │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ By proceeding, you accept all responsibility &lt;span style="color:#c678dd">for&lt;/span> actions taken &lt;span style="color:#c678dd">while&lt;/span> running in Bypass Permissions mode. │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ https://docs.anthropic.com/s/claude-code-security │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ ❯ 1. No, &lt;span style="color:#e5c07b">exit&lt;/span> │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ 2. Yes, I accept │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ │
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Enter to confirm · Esc to &lt;span style="color:#e5c07b">exit&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>⏺ Great! The zizmor pre-commit check now passes. Let&amp;#39;s summarize the changes we made:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1. Removed user-provided inputs &lt;span style="color:#c678dd">for&lt;/span> version numbers that could potentially be used &lt;span style="color:#c678dd">for&lt;/span> code injection
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2. Replaced them with an auto-generated timestamp-based version when the workflow is manually triggered
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3. Maintained the existing behavior &lt;span style="color:#c678dd">for&lt;/span> automatic triggers &lt;span style="color:#56b6c2">(&lt;/span>using &lt;span style="color:#98c379">&amp;#34;latest&amp;#34;&lt;/span> tag&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> This approach is more secure since:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1. No user inputs are used in any &lt;span style="color:#e5c07b">command&lt;/span> execution context
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2. The version tag is generated from a trusted &lt;span style="color:#e5c07b">source&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>the system timestamp&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3. The workflow still provides versioned images when manually triggered, just with an automatically generated version instead of a user-provided one
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let the agentic overlords take over 😬🤖.&lt;/p>
&lt;p>How does it know it can do so?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% grep -i bypass ~/.claude.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;bypassPermissionsModeAccepted&amp;#34;&lt;/span>: &lt;span style="color:#e5c07b">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://docs.anthropic.com/en/docs/agents-and-tools/claude-code/overview#control-claude-code-with-commands">Anthropic Docs&lt;/a>.&lt;/p></description></item><item><title>bkt: bypass cache</title><link>https://perrotta.dev/2025/05/bkt-bypass-cache/</link><pubDate>Mon, 05 May 2025 15:21:19 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/bkt-bypass-cache/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2024/12/bkt-cache-command-outputs/">Previously&lt;/a>.&lt;/p>
&lt;p>Whenever using &lt;a href="https://www.bkt.rs/">&lt;code>bkt&lt;/code>&lt;/a>, sometimes you may need to evict the
cache to get fresh data.&lt;/p>
&lt;p>Use the &lt;code>--force&lt;/code> option to do so. Usage:&lt;/p>
&lt;p>Replace:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% bkt --ttl 30d -- &lt;span style="color:#56b6c2">{&lt;/span>my cool command&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>with:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% bkt --force --ttl 30d -- &lt;span style="color:#56b6c2">{&lt;/span>my cool command&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Github: pull request template</title><link>https://perrotta.dev/2025/05/github-pull-request-template/</link><pubDate>Sun, 04 May 2025 21:10:34 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/github-pull-request-template/</guid><description>&lt;p>To create a pull request template for a github repository, create a
&lt;code>.github/pull_request_template.md&lt;/code> file.&lt;/p>
&lt;p>Take advantage of &lt;a href="https://www.markdownguide.org/basic-syntax/">markdown
formatting&lt;/a>.&lt;/p>
&lt;p>I found the following prompt useful as a starting point for &lt;a href="https://docs.anthropic.com/en/docs/agents-and-tools/claude-code/overview">Claude
Code&lt;/a>
within the repository:&lt;/p>
&lt;blockquote>
&lt;p>Suggest a template for this repository for new github PRs.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/creating-a-pull-request-template-for-your-repository">Upstream
docs&lt;/a>.&lt;/p></description></item><item><title>JIRA: stand-up mode</title><link>https://perrotta.dev/2025/05/jira-stand-up-mode/</link><pubDate>Fri, 02 May 2025 17:06:53 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/jira-stand-up-mode/</guid><description>&lt;p>&lt;a href="https://www.jakeworth.com/tils/jira-standup-mode/">Jira Standup Mode&lt;/a> via Jake
Worth:&lt;/p>
&lt;blockquote>
&lt;p>Jira recently launched &amp;lsquo;Standup Mode&amp;rsquo; feature, and love it!&lt;/p>
&lt;p>When you click the &amp;ldquo;Start Standup&amp;rdquo; button on any Jira board, your board
converts to a simplified, presentation version.&lt;/p>
&lt;p>On the left, each team member is listed in random order, which you can
re-shuffle. I like to avoid the same order of reports every day, so this helps
me.&lt;/p>
&lt;p>You can assign a timer for each member that restarts as you switch.&lt;/p>
&lt;/blockquote>
&lt;p>The default is 2 minutes. I like it.&lt;/p></description></item><item><title>Terminal autocorrection</title><link>https://perrotta.dev/2025/05/terminal-autocorrection/</link><pubDate>Fri, 02 May 2025 16:43:42 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/terminal-autocorrection/</guid><description>&lt;p>Appreciate this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% gitp ushm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zsh: correct &lt;span style="color:#98c379">&amp;#39;gitp&amp;#39;&lt;/span> to &lt;span style="color:#98c379">&amp;#39;git&amp;#39;&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>nyae&lt;span style="color:#56b6c2">]&lt;/span>? y
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARNING: You called a Git &lt;span style="color:#e5c07b">command&lt;/span> named &lt;span style="color:#98c379">&amp;#39;ushm&amp;#39;&lt;/span>, which does not exist.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Continuing in 1.0 seconds, assuming that you meant &lt;span style="color:#98c379">&amp;#39;pushm&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>branch &lt;span style="color:#98c379">&amp;#39;master&amp;#39;&lt;/span> &lt;span style="color:#e5c07b">set&lt;/span> up to track &lt;span style="color:#98c379">&amp;#39;origin/master&amp;#39;&lt;/span> by rebasing.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Everything up-to-date
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;a href="https://hunden.linuxkompis.se/2018/08/04/spell-check-and-auto-correction-of-commands-in-zsh.html">&lt;code>zsh&lt;/code> autocorrection&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://andycarter.dev/blog/auto-correct-git-commands">&lt;code>git&lt;/code> autocorrection&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>The ack + xargs + sed pattern</title><link>https://perrotta.dev/2025/04/the-ack--xargs--sed-pattern/</link><pubDate>Wed, 30 Apr 2025 16:20:24 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/04/the-ack--xargs--sed-pattern/</guid><description>&lt;p>I employ this pattern almost every day:&lt;/p>
&lt;ul>
&lt;li>use &lt;a href="https://beyondgrep.com/">&lt;code>ack&lt;/code>&lt;/a> to search for a given string in a codebase (git repo)&lt;/li>
&lt;li>use &lt;a href="https://man.archlinux.org/man/xargs.1">&lt;code>xargs&lt;/code>&lt;/a> to iterate through each finding&lt;/li>
&lt;li>use &lt;a href="https://www.gnu.org/software/sed/manual/sed.html">&lt;code>sed&lt;/code>&lt;/a> to make a text transformation&lt;/li>
&lt;/ul>
&lt;p>Example of the day:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ack &lt;span style="color:#98c379">&amp;#34;limit: 2&amp;#34;&lt;/span> -l | xargs -n &lt;span style="color:#d19a66">1&lt;/span> gsed -i -e &lt;span style="color:#98c379">&amp;#39;s/limit: 2/limit: 5/g&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Given multiple &lt;a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD app manifests&lt;/a> in the form:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">syncPolicy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">retry&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">limit&lt;/span>: &lt;span style="color:#d19a66">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">backoff&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">duration&lt;/span>: 5s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">factor&lt;/span>: &lt;span style="color:#d19a66">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">maxDuration&lt;/span>: 1m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Replace &lt;code>limit: 2&lt;/code> with &lt;code>limit: 5&lt;/code> in all files. That&amp;rsquo;s what the command above
does:&lt;/p>
&lt;ul>
&lt;li>&lt;code>ack -l&lt;/code> lists all files that match the given pattern&lt;/li>
&lt;li>pipe to &lt;code>xargs -n 1&lt;/code> iterates on each of them&lt;/li>
&lt;li>&lt;code>gsed -i&lt;/code> (GNU &lt;code>sed&lt;/code>) makes a text transformation in-place&lt;/li>
&lt;/ul>
&lt;p>It&amp;rsquo;s not bulletproof, but it works most of the time.&lt;/p>
&lt;p>Sometimes I use &lt;a href="https://github.com/sharkdp/fd">&lt;code>fd&lt;/code>&lt;/a> to narrow the search down
to a file pattern. For example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% fd -e yaml | xargs ack &lt;span style="color:#98c379">&amp;#34;limit: 2&amp;#34;&lt;/span> -l
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this case, though, &lt;code>ack --yaml&lt;/code> would be even simpler.&lt;/p>
&lt;p>When &lt;code>sed&lt;/code> isn&amp;rsquo;t up for the job, &lt;code>awk&lt;/code> tends to be a decent alternative.&lt;/p>
&lt;p>Regular expression replacements aren&amp;rsquo;t always precise.
False positives can easily take place.
Adding &lt;code>\b&lt;/code> (word boundaries) sometimes helps.&lt;/p>
&lt;p>Other times it&amp;rsquo;s better to use a syntax-aware tool instead of &lt;code>sed&lt;/code>.&lt;/p>
&lt;p>For YAML, there&amp;rsquo;s &lt;a href="https://github.com/mikefarah/yq">&lt;code>yq&lt;/code>&lt;/a>.&lt;/p>
&lt;p>For JSON, there&amp;rsquo;s &lt;a href="https://jqlang.org/">&lt;code>jq&lt;/code>&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>jq&lt;/code> is like &lt;code>sed&lt;/code> for JSON data - you can use it to slice and filter and map
and transform structured data with the same ease that &lt;code>sed&lt;/code>, &lt;code>awk&lt;/code>, &lt;code>grep&lt;/code> and
friends let you play with text.&lt;/p>
&lt;/blockquote></description></item><item><title>YAML: complex keys</title><link>https://perrotta.dev/2025/04/yaml-complex-keys/</link><pubDate>Tue, 29 Apr 2025 13:06:16 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/04/yaml-complex-keys/</guid><description>&lt;p>&lt;strong>Today I learned&lt;/strong>: YAML complex keys (&lt;a href="https://stackoverflow.com/questions/33987316/what-is-a-complex-mapping-key-in-yaml">stack
overflow&lt;/a>).&lt;/p>
&lt;p>From the &lt;a href="https://yaml.org/spec/1.2.2/">spec&lt;/a>, § 2.11:&lt;/p>
&lt;blockquote>
&lt;p>A question mark and space (&lt;code>&amp;quot;? &amp;quot;&lt;/code>) indicate a complex mapping key. Within a
block collection, key/value pairs can start immediately following the dash,
colon, or question mark.&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>? - Detroit Tigers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - Chicago cubs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>: - 2001-07-23
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>? [ New York Yankees,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Atlanta Braves ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>: [ 2001-07-02, 2001-08-12,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2001-08-14 ]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I noticed it when saving a &lt;code>values.yaml&lt;/code> file from &lt;a href="https://helm.sh/">helm&lt;/a> in
VSCode, which has auto-formatted it like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>diff --git a/helm/argocd/values.yaml b/helm/argocd/values.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>index b0884b26d..928c02eb3 100644
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">--- a/helm/argocd/values.yaml
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+++ b/helm/argocd/values.yaml
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">&lt;/span>@@ -471,10 +471,12 @@ argo-cd:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> # Do not trigger a reconciliation when the reported status of a HorizontalPodAutoscaler or ExternalSecret changes.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> # That would mean reconciling every application with a hpa every 5 seconds which is heavy on the cpu.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> # https://argo-cd.readthedocs.io/en/stable/operator-manual/reconcile/#finding-resources-to-ignore
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">- resource.customizations.ignoreResourceUpdates.autoscaling_HorizontalPodAutoscaler: |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+ ? resource.customizations.ignoreResourceUpdates.autoscaling_HorizontalPodAutoscaler
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ : |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">&lt;/span> jsonPointers:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - /status
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">- resource.customizations.ignoreResourceUpdates.external-secrets.io_ExternalSecret: |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+ ? resource.customizations.ignoreResourceUpdates.external-secrets.io_ExternalSecret
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ : |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">&lt;/span> jsonPointers:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - /status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Initially I thought this was a mistake that would yield a parse error.
Upon running &lt;code>helm template&lt;/code>, however, I observed it&amp;rsquo;s in fact a no-op.&lt;/p>
&lt;p>The LLM says:&lt;/p>
&lt;blockquote>
&lt;p>VS Code is reformatting your YAML that way because it&amp;rsquo;s interpreting the
structure as YAML mapping with complex keys.&lt;/p>
&lt;p>This happens when your keys contain special characters (like dots or
underscores) or are long strings — YAML interpreters sometimes use the &lt;code>? key :&lt;/code> value syntax to denote explicit mapping entries with complex keys.&lt;/p>
&lt;/blockquote>
&lt;p>I surely cannot deny it&amp;rsquo;s a long key. Go blame
&lt;a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/reconcile/#system-level-configuration">ArgoCD&lt;/a>
:P&lt;/p></description></item><item><title>GitHub: create a pull request from CLI</title><link>https://perrotta.dev/2025/04/github-create-a-pull-request-from-cli/</link><pubDate>Mon, 28 Apr 2025 14:12:57 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/04/github-create-a-pull-request-from-cli/</guid><description>&lt;p>Using the &lt;a href="https://cli.github.com/">&lt;code>gh&lt;/code>&lt;/a> tool (the official GitHub CLI tool):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% gh pr create
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It will prompt for more information.&lt;/p>
&lt;p>To skip all prompts and simply use the commit message to fill in the PR Title
and the PR description, pass &lt;code>--fill&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% gh pr create --fill
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% gh pr create --help | grep -- --fill
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">`&lt;/span>--body&lt;span style="color:#98c379">`&lt;/span> to skip this, or use &lt;span style="color:#98c379">`&lt;/span>--fill&lt;span style="color:#98c379">`&lt;/span> to autofill these values from git commits.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alongside &lt;span style="color:#98c379">`&lt;/span>--fill&lt;span style="color:#98c379">`&lt;/span>, the values specified by &lt;span style="color:#98c379">`&lt;/span>--title&lt;span style="color:#98c379">`&lt;/span> and/or &lt;span style="color:#98c379">`&lt;/span>--body&lt;span style="color:#98c379">`&lt;/span> will
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -f, --fill Use commit info &lt;span style="color:#c678dd">for&lt;/span> title and body
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --fill-first Use first commit info &lt;span style="color:#c678dd">for&lt;/span> title and body
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --fill-verbose Use commits msg+body &lt;span style="color:#c678dd">for&lt;/span> description
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>macOS: delete file, bypass trash</title><link>https://perrotta.dev/2025/04/macos-delete-file-bypass-trash/</link><pubDate>Fri, 25 Apr 2025 16:37:28 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/04/macos-delete-file-bypass-trash/</guid><description>&lt;p>To delete a file in Finder on macOS without moving it to the trash, press
&lt;code>Option&lt;/code> + &lt;code>Command&lt;/code> + &lt;code>Delete&lt;/code> upon selecting the file.&lt;/p>
&lt;p>When using the CLI, of course, &lt;code>rm&lt;/code> is enough.&lt;/p></description></item><item><title>Delete newlines in a pipe</title><link>https://perrotta.dev/2025/04/delete-newlines-in-a-pipe/</link><pubDate>Fri, 25 Apr 2025 11:59:20 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/04/delete-newlines-in-a-pipe/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given &lt;code>{cmd}&lt;/code> that emits lots of blank lines, delete all
blank lines in a pipe.&lt;/p>
&lt;p>The following is a very elegant (and easy to remember!) way to do so:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">{&lt;/span>cmd&lt;span style="color:#56b6c2">}&lt;/span> | awk &lt;span style="color:#98c379">&amp;#39;NF&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>From the LLM:&lt;/p>
&lt;blockquote>
&lt;p>When you use awk &amp;lsquo;NF&amp;rsquo;, it evaluates to true for lines where NF is greater than
zero—that is, lines that are not empty or do not consist solely of whitespace.
This makes it a concise way to filter out blank lines.&lt;/p>
&lt;/blockquote>
&lt;p>Other ways with classic tools and regular expressions:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">{&lt;/span>cmd&lt;span style="color:#56b6c2">}&lt;/span> | grep -v &lt;span style="color:#98c379">&amp;#39;^[[:space:]]*$&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">{&lt;/span>cmd&lt;span style="color:#56b6c2">}&lt;/span> | sed -e &lt;span style="color:#98c379">&amp;#39;/^[[:space:]]*$/d&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>They are just a bit harder to remember.&lt;/p></description></item></channel></rss>