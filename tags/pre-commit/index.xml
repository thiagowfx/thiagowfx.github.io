<?xml version="1.0" encoding="utf-8" standalone="yes"?><?xml-stylesheet type="text/xsl" href="https://perrotta.dev/rss.xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Pre-Commit on ¬¨ just serendipity üçÄ</title><link>https://perrotta.dev/</link><description>Recent content in Pre-Commit on ¬¨ just serendipity üçÄ</description><generator>Hugo</generator><language>en</language><managingEditor>serendipity@perrotta.dev (Thiago Perrotta)</managingEditor><webMaster>serendipity@perrotta.dev (Thiago Perrotta)</webMaster><copyright>¬© 2013 - 2026 Thiago Perrotta ¬∑
[some rights reserved](https://creativecommons.org/licenses/by-nc-sa/4.0/) ¬∑
a fork of [hugo  ï‚Ä¢·¥•‚Ä¢ î bear](https://github.com/janraasch/hugo-bearblog/)</copyright><lastBuildDate>Sun, 22 Feb 2026 18:44:50 +0100</lastBuildDate><atom:link href="https://perrotta.dev/tags/pre-commit/index.xml" rel="self" type="application/rss+xml"/><item><title>github workflow: external script</title><link>https://perrotta.dev/2026/02/github-workflow-external-script/</link><pubDate>Sun, 22 Feb 2026 14:10:11 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>git</category><category>pre-commit</category><guid>https://perrotta.dev/2026/02/github-workflow-external-script/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: execute a &lt;code&gt;.js&lt;/code&gt; script in a GitHub workflow. The script
must be stored in a separate file (than the workflow) in the same git
repository.&lt;/p&gt;
&lt;p&gt;Why store the file separately?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Inlining a big script is ugly and very non-elegant&lt;/li&gt;
&lt;li&gt;No syntax highlighting when updating the script ‚Üí error-prone&lt;/li&gt;
&lt;li&gt;Risk of messing up with string interpolation or escaping characters ‚Üí
error-prone&lt;/li&gt;
&lt;li&gt;Limited ability to use formatters and linters in inlined scripts&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The following approach, taken from a real example, works well:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% tree {repo root}/.github/
.github/
‚îú‚îÄ‚îÄ scripts
‚îÇ ‚îî‚îÄ‚îÄ drift-summary.js
‚îî‚îÄ‚îÄ workflows
 ‚îú‚îÄ‚îÄ drift-summary.yml
 [...]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;name: &amp;#39;Drift Summary&amp;#39;

on:
 schedule:
 - cron: &amp;#39;0 9 * * MON-FRI&amp;#39;
 workflow_dispatch:

permissions:
 issues: write

jobs:
 summarize:
 name: &amp;#39;Update drift summary issue&amp;#39;
 runs-on: ubuntu-latest
 steps:
 - name: &amp;#39;Checkout repository&amp;#39;
 uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
 with:
 persist-credentials: false

 - name: &amp;#39;Aggregate drift and update summary&amp;#39;
 uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b # v7
 with:
 script: |
 const script = require(&amp;#39;./.github/scripts/drift-summary.js&amp;#39;);
 await script({ github, context });&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Use &lt;a href="https://github.com/actions/github-script"&gt;&lt;code&gt;github-script&lt;/code&gt;&lt;/a&gt; + &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules"&gt;&lt;code&gt;require&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: github workflow: external script"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/git/"&gt;#git&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>pre-commit: hazmat n1</title><link>https://perrotta.dev/2026/02/pre-commit-hazmat-n1/</link><pubDate>Fri, 06 Feb 2026 18:28:16 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2026/02/pre-commit-hazmat-n1/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: some CLI tools accept only a single file as an argument.
Create a &lt;a href="https://pre-commit.com/"&gt;pre-commit&lt;/a&gt; local hook for them.&lt;/p&gt;
&lt;p&gt;A common workaround is to wrap it in a bash for-loop (&lt;code&gt;.pre-commit-config.yaml&lt;/code&gt;):&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: local
 hooks:
 - id: my-formatter
 name: my-formatter
 language: system
 entry: bash -c &amp;#39;for file in &amp;#34;$@&amp;#34;; do my-formatter fmt &amp;#34;$file&amp;#34;; done&amp;#39; --
 files: ^path/to/files/&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This works, but it&amp;rsquo;s noisy and easy to get wrong. Plus it&amp;rsquo;s not elegant at all.&lt;/p&gt;
&lt;p&gt;It turns out pre-commit has a built-in mechanism for this: &lt;a href="https://pre-commit.com/#codepre-commit-hazmat-n1code"&gt;&lt;code&gt;hazmat n1&lt;/code&gt;&lt;/a&gt;. It runs the hook
once per file, one at a time:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;some hooks only take one filename argument. this runs them one at a time
(which is super slow!)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: local
 hooks:
 - id: my-formatter
 name: my-formatter
 language: system
 entry: pre-commit hazmat n1 my-formatter fmt --
 files: ^path/to/files/&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Note the trailing &lt;code&gt;--&lt;/code&gt; at the end of &lt;code&gt;entry&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This is a super recent feature, added in &lt;a href="https://github.com/pre-commit/pre-commit/commit/1af6c8fa9502336c6977c2ff3e79185bd97a6e57"&gt;pre-commit 4.5.0, in Nov
2025&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The name &amp;ldquo;hazmat&amp;rdquo; is supposedly intended to discourage people from using it.
Yet, here we are.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;hazardous materials&amp;rdquo;&lt;/p&gt;
&lt;p&gt;pre-commit provides a few entry prefix &amp;ldquo;helpers&amp;rdquo; for unusual situations.&lt;/p&gt;
&lt;p&gt;in case it&amp;rsquo;s not clear, using these is usually a bad idea.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It is a bad idea, but sometimes the underlying hook / script simply does not
support multiple arguments.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: pre-commit: hazmat n1"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>npm error code EBADF</title><link>https://perrotta.dev/2026/02/npm-error-code-ebadf/</link><pubDate>Thu, 05 Feb 2026 13:21:00 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>macos</category><category>pre-commit</category><category>security</category><guid>https://perrotta.dev/2026/02/npm-error-code-ebadf/</guid><description>&lt;p&gt;Symptom:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% pre-commit run -a
[INFO] Installing environment for https://github.com/rbubley/mirrors-prettier.
[INFO] Once installed this environment will be reused.
[INFO] This may take a few minutes...
An unexpected error has occurred: CalledProcessError: command: (&amp;#39;/Users/thiago.perrotta/.cache/pre-commit/repo78y8p1fk/node_env-system/bin/node&amp;#39;, &amp;#39;/opt/homebrew/bin/npm&amp;#39;, &amp;#39;install&amp;#39;, &amp;#39;-g&amp;#39;, &amp;#39;/Users/thiago.perrotta/.cache/pre-commit/repo78y8p1fk/placeholder_package-0.0.0.tgz&amp;#39;, &amp;#39;prettier@3.8.1&amp;#39;)
return code: 1
stdout: (none)
stderr:
 npm error code EBADF
 npm error errno EBADF
 npm error request to https://registry.npmjs.org/prettier failed, reason:
 npm error A complete log of this run can be found in: /Users/thiago.perrotta/.npm/_logs/2026-02-04T12_22_05_104Z-debug-0.log
Check the log at /Users/thiago.perrotta/.cache/pre-commit/pre-commit.log&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Initially I thought it was an issue with &lt;code&gt;prettier&lt;/code&gt;. The pre-commit repository
is deprecated after all:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This is a fork of the (now archived)
&lt;a href="https://github.com/pre-commit/mirrors-prettier"&gt;https://github.com/pre-commit/mirrors-prettier&lt;/a&gt; with the only difference being
that it only references release versions of prettier, not e.g. alpha/beta
versions.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The actual error was &lt;a href="https://www.obdev.at/products/littlesnitch/index.html"&gt;Little
Snitch&lt;/a&gt; on macOS blocking
all outgoing connections to the NPM registry.&lt;/p&gt;
&lt;p&gt;How to address it?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Click &amp;ldquo;Manage Rules&amp;hellip;&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Click &amp;ldquo;Deny&amp;rdquo; to list all network blocks&lt;/li&gt;
&lt;li&gt;Delete the NPM registry entry&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: npm error code EBADF"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/macos/"&gt;#macos&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;</description></item><item><title>new pre-commit hook: check-bash-shebang</title><link>https://perrotta.dev/2025/11/new-pre-commit-hook-check-bash-shebang/</link><pubDate>Sun, 16 Nov 2025 20:48:17 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/11/new-pre-commit-hook-check-bash-shebang/</guid><description>&lt;p&gt;&lt;a href="https://perrotta.dev/2025/11/bash-shebang-/"&gt;Previously&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I couldn&amp;rsquo;t resist creating a &lt;a href="https://pre-commit.com/"&gt;pre-commit hook&lt;/a&gt; for
this:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: https://github.com/thiagowfx/pre-commit-hooks/
 rev: v0.0.11
 hooks:
 - id: check-bash-shebang
 types:
 - shell&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;In action:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% cd {pancake}
% pre-commit run -a check-bash-shebang
Check bash scripts use portable shebang..................................Failed
- hook id: check-bash-shebang
- exit code: 1

error: &amp;#39;aws_china_mfa/aws_china_mfa.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;
error: &amp;#39;aws_login_headless/aws_login_headless.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;
error: &amp;#39;pritunl_login/pritunl_login.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;
error: &amp;#39;sd_world/sd_world.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;
error: &amp;#39;pdf_password_remove/pdf_password_remove.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;
error: &amp;#39;img_optimize/img_optimize.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;
error: &amp;#39;copy/copy.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;
error: &amp;#39;ssh_mux_restart/ssh_mux_restart.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;
error: &amp;#39;op_login_all/op_login_all.sh&amp;#39; uses &amp;#39;#!/bin/bash&amp;#39; instead of &amp;#39;#!/usr/bin/env bash&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: new pre-commit hook: check-bash-shebang"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>go/keep-sorted</title><link>https://perrotta.dev/2025/09/go/keep-sorted/</link><pubDate>Mon, 22 Sep 2025 11:12:59 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/09/go/keep-sorted/</guid><description>&lt;p&gt;&lt;a href="https://perrotta.dev/2024/12/keep-sorted/"&gt;Previously&lt;/a&gt;,
&lt;a href="https://perrotta.dev/2025/03/using-keep-sorted-to-keep-your-~/.gitconfig-tidy/"&gt;previously&lt;/a&gt;,
&lt;a href="https://perrotta.dev/2025/03/keep-sorted-with-quotes/"&gt;previously&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;keep-sorted is, by far, one of my favorite tools to enforce tidying up a
codebase.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Google Testing Blog, &lt;a href="https://testing.googleblog.com/2025/09/sort-lines-in-source-code.html"&gt;Sort Lines in Source Code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;They have finally released a
&lt;a href="https://abseil.io/resources/swe-book/html/ch11.html#:~:text=their%20testing%20culture.-,Testing%20on%20the%20Toilet,-Of%20all%20the"&gt;TotT&lt;/a&gt;
(&amp;ldquo;Testing on the Toilet&amp;rdquo;) episode about
&lt;a href="https://github.com/google/keep-sorted"&gt;keep-sorted&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s such an underappreciated tool: not even 300 stars on GitHub. In the
meantime, anything named &amp;ldquo;AI&amp;rdquo; or &amp;ldquo;Agents&amp;rdquo; or &amp;ldquo;LLM&amp;rdquo; rises to the top without any
scrutiny of quality.&lt;/p&gt;
&lt;p&gt;Now I am happy that I have somewhere to link to other than my blog.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: go/keep-sorted"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>pre-commit: autoupdate</title><link>https://perrotta.dev/2025/09/pre-commit-autoupdate/</link><pubDate>Mon, 01 Sep 2025 12:05:52 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/09/pre-commit-autoupdate/</guid><description>&lt;p&gt;When using &lt;a href="https://pre-commit.com/"&gt;&lt;code&gt;pre-commit&lt;/code&gt;&lt;/a&gt;, you can take advantage of
its built-in &lt;code&gt;pre-commit autoupdate&lt;/code&gt; command to keep your hook dependencies
up-to-date.&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s one major drawback of adopting it ubiquitously: it is virtually
&lt;a href="https://stackoverflow.com/questions/74232399/is-it-possible-that-pre-commit-autoupdate-skips-a-single-linter"&gt;impossible&lt;/a&gt;
to instruct it to skip certain repositories.&lt;/p&gt;
&lt;p&gt;It wouldn&amp;rsquo;t be hard to update it to ignore hook dependencies with skip byline
comments, but its author &lt;a href="https://stackoverflow.com/a/74240674/1745064"&gt;isn&amp;rsquo;t
keen&lt;/a&gt; on implementing support for
it.&lt;/p&gt;
&lt;p&gt;So far I&amp;rsquo;ve been working around it by manually reverting undesired updates, but
that is super tedious and inefficient.&lt;/p&gt;
&lt;p&gt;Today I discovered a small utility,
&lt;a href="https://pypi.org/project/pre-commit-update/"&gt;&lt;code&gt;pre-commit-update&lt;/code&gt;&lt;/a&gt;, which
explicitly supports that and was created precisely because of the limitation of
the original subcommand:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;pre-commit-update was created because there is no easy way to update your
hooks by using pre-commit autoupdate as it is not versatile enough.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The tool (which is thankfully also written in Python, for uniformity) supports a
config file to skip certain hooks from &lt;code&gt;autoupdate&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: pre-commit: autoupdate"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>"Fix typo"</title><link>https://perrotta.dev/2025/08/fix-typo/</link><pubDate>Wed, 13 Aug 2025 11:13:35 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><category>serenity</category><guid>https://perrotta.dev/2025/08/fix-typo/</guid><description>&lt;p&gt;You, too, can make the &lt;del&gt;word&lt;/del&gt; world a better place,
&lt;a href="https://github.com/codespell-project/codespell/pull/3758"&gt;one&lt;/a&gt;
&lt;a href="https://github.com/codespell-project/codespell/pull/3759"&gt;typo&lt;/a&gt; at a time.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://github.com/codespell-project/codespell/"&gt;codespell&lt;/a&gt; project can be
trivially adopted in a git repository via a &lt;a href="https://pre-commit.com/"&gt;pre-commit
hook&lt;/a&gt;:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;repos:
 - repo: https://github.com/codespell-project/codespell
 rev: 63c8f8312b7559622c0d82815639671ae42132ac # frozen: v2.4.1
 hooks:
 - id: codespell&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: "Fix typo""&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/serenity/"&gt;#serenity&lt;/a&gt;&lt;/p&gt;</description></item><item><title>‚òÖ check-json-schema: pre-commit hook</title><link>https://perrotta.dev/2025/07/check-json-schema-pre-commit-hook/</link><pubDate>Fri, 11 Jul 2025 22:05:32 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/07/check-json-schema-pre-commit-hook/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: given an &lt;code&gt;entry.json&lt;/code&gt; file, validate it against a given
&lt;code&gt;schema.json&lt;/code&gt; file (for example, found via the &lt;a href="https://www.schemastore.org/"&gt;schema
store&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;I like the
&lt;a href="https://github.com/python-jsonschema/check-jsonschema"&gt;check-jsonschema&lt;/a&gt; python
package:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;pipx run check-jsonschema --schemafile schema.json entry.json&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;What if we want to do the validation via a
&lt;a href="https://pre-commit.com"&gt;pre-commit.com&lt;/a&gt; hook?&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: https://github.com/python-jsonschema/check-jsonschema
 rev: 0.33.2
 hooks:
 - id: check-jsonschema
 files: ^entry\.json$
 args:
 - --schemafile
 - schema.json&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This approach works well, but it requires the upkeep of a mapping from JSON file
to JSON schema.&lt;/p&gt;
&lt;p&gt;If we had various JSON files within a single repository, this would result in a
maintenance burden in the pre-commit config file.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: https://github.com/python-jsonschema/check-jsonschema
 rev: 0.33.2
 hooks:
 - id: check-jsonschema
 alias: check-jsonschema-entry1
 files: ^entry1\.json$
 args:
 - --schemafile
 - schema1.json
 - id: check-jsonschema
 alias: check-jsonschema-entry2
 files: ^entry2\.json$
 args:
 - --schemafile
 - schema2.json&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;It&amp;rsquo;s somewhat annoying to maintain multiple entries in that fashion. Furthermore
it can easily get outdated: upon the deletion of &lt;code&gt;entry1.json&lt;/code&gt; from the
repository, you&amp;rsquo;d need to remember to manually delete its corresponding entry
from the pre-commit config file.&lt;/p&gt;
&lt;p&gt;Can we do better?&lt;/p&gt;
&lt;p&gt;What if we embedded the schema reference within the JSON file itself?&lt;/p&gt;
&lt;p&gt;For example, with a local schema:&lt;/p&gt;
&lt;div class="codeblock" data-lang="json"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;json&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-json"&gt;{
 &amp;#34;$schema&amp;#34;: &amp;#34;schema.json&amp;#34;
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Or with a remote schema URI, via HTTPS:&lt;/p&gt;
&lt;div class="codeblock" data-lang="json"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;json&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-json"&gt;{
 &amp;#34;$schema&amp;#34;: &amp;#34;https://example.com/schema.json&amp;#34;
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Now the JSON file is self-contained, and there&amp;rsquo;s no need to define a mapping
from it to its JSON schema elsewhere.&lt;/p&gt;
&lt;p&gt;How can we integrate this approach within pre-commit?&lt;/p&gt;
&lt;p&gt;Initially I thought that
&lt;a href="https://github.com/python-jsonschema/check-jsonschema/blob/8900e07e2002c4b073e1dca7969ce81a19fcb142/.pre-commit-hooks.yaml#L10C7-L10C23"&gt;&lt;code&gt;check-metaschema&lt;/code&gt;&lt;/a&gt;
from the &lt;code&gt;check-jsonschema&lt;/code&gt; python package was the answer, but it turns out it
isn&amp;rsquo;t.&lt;/p&gt;
&lt;p&gt;In fact, this isn&amp;rsquo;t currently possible. There&amp;rsquo;s a &lt;a href="https://github.com/python-jsonschema/check-jsonschema/issues/310"&gt;feature
request&lt;/a&gt;,
filed ~2 years ago, with no consensus yet on how move forward. Its maintainer
seems helpful and concerned with backwards compatibility.&lt;/p&gt;
&lt;p&gt;For the sake of unblocking myself, I decided to wrap the ability to do so within
my own pre-commit hook definition.&lt;/p&gt;
&lt;p&gt;This gave birth to the following repository:
&lt;a href="https://github.com/thiagowfx/check-json-schema-meta"&gt;&lt;code&gt;thiagowfx/check-json-schema-meta&lt;/code&gt;&lt;/a&gt;, which I also &lt;a href="https://github.com/python-jsonschema/check-jsonschema/issues/310#issuecomment-3062174357"&gt;announced&lt;/a&gt; in the original feature request thread.&lt;/p&gt;
&lt;p&gt;Usage:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: https://github.com/thiagowfx/check-json-schema-meta
 rev: v0.0.2
 hooks:
 - id: check-json-schema-meta&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;It goes through each JSON file in the repository, looking for an optional
top-level &lt;code&gt;$schema&lt;/code&gt; key. When found, the file is validated against the defined
schema.&lt;/p&gt;
&lt;p&gt;A &lt;code&gt;--strict&lt;/code&gt; command-line flag enforces the presence of the &lt;code&gt;$schema&lt;/code&gt; key,
otherwise the default behavior is to skip files that do not have it.&lt;/p&gt;
&lt;p&gt;The underlying schema validation defers the work to the same python package
first mentioned in this post. Because it uses
&lt;a href="https://github.com/python-jsonschema/check-jsonschema/blob/8900e07e2002c4b073e1dca7969ce81a19fcb142/src/check_jsonschema/schema_loader/main.py#L74"&gt;&lt;code&gt;SchemaLoader&lt;/code&gt;&lt;/a&gt;,
both local and remote (http(s)) file references are supported.&lt;/p&gt;
&lt;p&gt;This is the first original pre-commit hook I have written. By original I mean
that I couldn&amp;rsquo;t find any pre-existing open source hook that accomplishes this
task. The entire repository was developed with AI assistance (&lt;a href="https://www.anthropic.com/claude-code"&gt;Claude
Code&lt;/a&gt;), but I wasn&amp;rsquo;t satisfied with
out-of-the-box defaults; I had to heavily modify it to shape it to my taste ‚Äì
which was achieved with a mix of follow-up prompting and local edits.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: check-json-schema: pre-commit hook"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>Helm repository with a trailing slash</title><link>https://perrotta.dev/2025/06/helm-repository-with-a-trailing-slash/</link><pubDate>Tue, 24 Jun 2025 11:32:50 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>kubernetes</category><category>pre-commit</category><guid>https://perrotta.dev/2025/06/helm-repository-with-a-trailing-slash/</guid><description>&lt;p&gt;&lt;a href="https://github.com/argoproj/argo-cd/issues/9857"&gt;A repository URL with a trailing slash, and the same URL without a trailing
slash, are treated as different
repos&lt;/a&gt;. We found this out the
hard way:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;Failed to load target state: failed to generate manifest for source 1 of 2: rpc error: code = Unknown desc = error building helm chart dependencies: failed to add helm repository https://chartmuseum.{corp intranet}/orgs/{corp}/: failed to add repository: failed to get command args to log: `helm repo add https:--chartmuseum.{corp intranet}-orgs-{corp}- https://chartmuseum.{corp intranet}/orgs/{corp}/` failed exit status 1: Error: looks like &amp;#34;https://chartmuseum.{corp intranet}/orgs/{corp}/&amp;#34; is not a valid chart repository or cannot be reached: failed to fetch https://chartmuseum.{corp intranet}/orgs/{corp}/index.yaml : 401 Unauthorized&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Let&amp;rsquo;s put aside the fact the error message REALLY likes to repeat the repo name.&lt;/p&gt;
&lt;p&gt;This is a repository that we&amp;rsquo;ve already configured, with proper authentication
credentials. Why would it start to fail now, all of a sudden?&lt;/p&gt;
&lt;p&gt;You already got spoiled in the post title. Given &lt;code&gt;Chart.yaml&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;apiVersion: v2
name: corp-postgres-operator
description: Corp Postgres Operator
type: application
version: 1.1.13

dependencies:
 - name: postgres-operator
 repository: https://chartmuseum.{corp intranet}/orgs/archive&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;And also:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;apiVersion: v2
name: corp-postgres-operator
description: Corp Postgres Operator
type: application
version: 1.1.13

dependencies:
 - name: postgres-operator
 repository: https://chartmuseum.{corp intranet}/orgs/archive/&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;These two dependencies end up being treated differently by Argo, even though
they are effectively the same. It&amp;rsquo;s an upstream bug.&lt;/p&gt;
&lt;p&gt;To work around it, I decided to simply remove all trailing slashes from
helm repository dependencies. Canonicalize everything!&lt;/p&gt;
&lt;p&gt;A git &lt;a href="https://pre-commit.com"&gt;pre-commit.com hook&lt;/a&gt; is a good mechanism to do so:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 repo: local
 hooks:
 - id: helm-repo-trailing-slash
 name: Helm repositories must not contain trailing slashes in Chart.yaml
 files: Chart.yaml$
 language: pygrep
 entry: &amp;#39;\s*repository: [\w:/.]&amp;#43;/$&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Run &lt;code&gt;pre-commit run -a helm-repo-trailing-slash&lt;/code&gt;, fix all violations, and then
never think about this again.&lt;/p&gt;
&lt;p&gt;Should the upstream bug ever be fixed, we can remove this workaround.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Helm repository with a trailing slash"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/kubernetes/"&gt;#kubernetes&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>pre-commit: add hugo build</title><link>https://perrotta.dev/2025/05/pre-commit-add-hugo-build/</link><pubDate>Sat, 24 May 2025 17:29:48 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/05/pre-commit-add-hugo-build/</guid><description>&lt;p&gt;Sometimes I make changes to this blog that yield build errors with its static
site generator (&lt;a href="https://gohugo.io/"&gt;hugo&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s trivial to spot these changes with a simple &lt;code&gt;hugo build&lt;/code&gt;, but &lt;a href="https://perrotta.dev/2025/03/yolo-debug-only-after-push/"&gt;I don&amp;rsquo;t always
run it&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s what a typical error looks like:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;% hugo build
Start building sites ‚Ä¶
hugo v0.147.5&amp;#43;extended&amp;#43;withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew

ERROR [en] REF_NOT_FOUND: Ref &amp;#34;nonexistent/2025-03-24-maccy-pin-items&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-16-espanso-hello-world.md:10:14&amp;#34;: page not found
Total in 242 ms
Error: error building site: logged 1 error(s)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The same happens when invoking &lt;a href="https://just.systems/man/en/"&gt;&lt;code&gt;just&lt;/code&gt;&lt;/a&gt;, as you
would expect:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;% just build
hugo --environment production --gc --minify
Start building sites ‚Ä¶
hugo v0.147.5&amp;#43;extended&amp;#43;withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew

ERROR [en] REF_NOT_FOUND: Ref &amp;#34;nonexistent/2025-03-24-maccy-pin-items&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-16-espanso-hello-world.md:10:14&amp;#34;: page not found
Total in 280 ms
Error: error building site: logged 1 error(s)
error: Recipe `build` failed on line 17 with exit code 1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: catch such build errors at git pre-commit time.&lt;/p&gt;
&lt;p&gt;This is trivial with a &lt;a href="https://pre-commit.com/"&gt;pre-commit.com&lt;/a&gt; hook:&lt;/p&gt;
&lt;div class="codeblock" data-lang="diff"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;diff&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-diff"&gt;Author: Thiago Perrotta &amp;lt;{email redacted}&amp;gt;
Date: Sat May 24 17:26:59 2025 &amp;#43;0200

 pre-commit: add just build

diff --git .pre-commit-config.yaml .pre-commit-config.yaml
index 60eb2022..623e135d 100644
--- .pre-commit-config.yaml
&amp;#43;&amp;#43;&amp;#43; .pre-commit-config.yaml
@@ -112,5 &amp;#43;112,10 @@ repos:
 language: pygrep
 types:
 - markdown
&amp;#43; - id: hugo
&amp;#43; name: Hugo
&amp;#43; language: system
&amp;#43; entry: just build
&amp;#43; pass_filenames: false&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Here&amp;rsquo;s the end result:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% git commit -m &amp;#34;test&amp;#34;
Check hooks apply to the repository.............................................(no files to check)Skipped
Check for useless excludes......................................................(no files to check)Skipped
[...]
Forbid usage of UTM analytics / tracking............................................................Passed
Hugo................................................................................................Failed
- hook id: hugo
- exit code: 1

hugo --environment production --gc --minify
Start building sites ‚Ä¶
hugo v0.147.5&amp;#43;extended&amp;#43;withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew

ERROR [en] REF_NOT_FOUND: Ref &amp;#34;a/2024-12-23-unbuffer&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-24-watch-with-color.md:54:54&amp;#34;: page not found
Total in 276 ms
Error: error building site: logged 1 error(s)
error: Recipe `build` failed on line 19 with exit code 1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: pre-commit: add hugo build"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>pre-commit: make a hook opt-in</title><link>https://perrotta.dev/2025/03/pre-commit-make-a-hook-opt-in/</link><pubDate>Thu, 27 Mar 2025 13:22:44 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/03/pre-commit-make-a-hook-opt-in/</guid><description>&lt;p&gt;Recently we added the following hook to our &lt;a href="https://pre-commit.com"&gt;pre-commit&lt;/a&gt;
setup:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: https://github.com/sbrunner/hooks
 rev: ee105bd276e163fce85744b39104ca563f923c47 # frozen: 1.4.0
 hooks:
 - id: helm-lock&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;It can be triggered with &lt;code&gt;pre-commit run --all-files helm-lock&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;It turned out to be an issue because not every developer has read-only access
to our helm repositories.&lt;/p&gt;
&lt;p&gt;The workaround was to make this hook opt-in.&lt;/p&gt;
&lt;p&gt;We can do so by adding it to the &lt;a href="https://pre-commit.com/#confining-hooks-to-run-at-certain-stages"&gt;manual stage&lt;/a&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: https://github.com/sbrunner/hooks
 rev: ee105bd276e163fce85744b39104ca563f923c47 # frozen: 1.4.0
 hooks:
 - id: helm-lock
 stages:
 - manual&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;It can be then invoked like this: &lt;code&gt;pre-commit run --all-files helm-lock --hook-stage manual&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;An alternative could have been to instruct people to set
&lt;a href="https://pre-commit.com/#temporarily-disabling-hooks"&gt;&lt;code&gt;SKIP=helm-lock&lt;/code&gt;&lt;/a&gt;, however
&lt;a href="https://world.hey.com/jason/software-defaults-15955a8e"&gt;defaults&lt;/a&gt; are powerful.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: pre-commit: make a hook opt-in"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>pre-commit: pin dependencies with --freeze</title><link>https://perrotta.dev/2025/03/pre-commit-pin-dependencies-with--freeze/</link><pubDate>Thu, 20 Mar 2025 18:12:57 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/03/pre-commit-pin-dependencies-with--freeze/</guid><description>&lt;p&gt;&lt;strong&gt;Today I learned&lt;/strong&gt;: &lt;a href="https://pre-commit.com/#updating-hooks-automatically"&gt;&lt;code&gt;pre-commit autoupdate&lt;/code&gt;&lt;/a&gt; has a
&lt;code&gt;--freeze&lt;/code&gt; option that replaces git tags with SHAs (hashes) on upstream hooks
(dependencies).&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how to adopt them, using this blog as an example:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;% pre-commit autoupdate --jobs $(nproc) --freeze
[https://github.com/lalten/check-gha-pinning] updating v1.3.0 -&amp;gt; v1.3.0 (frozen)
[https://github.com/google/keep-sorted] updating v0.6.0 -&amp;gt; v0.6.0 (frozen)
[https://github.com/sirosen/texthooks] updating 0.6.8 -&amp;gt; 0.6.8 (frozen)
[https://github.com/google/yamlfmt] updating v0.16.0 -&amp;gt; v0.16.0 (frozen)
[https://github.com/pre-commit/pre-commit-hooks] updating v5.0.0 -&amp;gt; v5.0.0 (frozen)
[https://github.com/shssoichiro/oxipng] updating v9.1.3 -&amp;gt; v9.1.4 (frozen)
[https://github.com/codespell-project/codespell] updating v2.4.1 -&amp;gt; v2.4.1 (frozen)
[https://github.com/gitleaks/gitleaks] updating v8.23.3 -&amp;gt; v8.24.0 (frozen)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The resulting diff (redacted one of the hooks for brevity):&lt;/p&gt;
&lt;div class="codeblock" data-lang="diff"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;diff&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-diff"&gt;diff --git .pre-commit-config.yaml .pre-commit-config.yaml
index 30aac4a2..841eac9b 100644
--- .pre-commit-config.yaml
&amp;#43;&amp;#43;&amp;#43; .pre-commit-config.yaml
@@ -23,7 &amp;#43;23,7 @@ repos:
 - id: check-hooks-apply
 - id: check-useless-excludes
 - repo: https://github.com/pre-commit/pre-commit-hooks
- rev: v5.0.0
&amp;#43; rev: cef0300fd0fc4d2a87a85fa2093c6b283ea36f4b # frozen: v5.0.0
 hooks:
 - id: check-executables-have-shebangs
@@ -41,27 &amp;#43;41,27 @@ repos:
 - -D .codespell-dictionary.txt
 - -I .codespell-ignore-words.txt
 - repo: https://github.com/gitleaks/gitleaks
- rev: v8.23.3
&amp;#43; rev: f565e4e10c6c8081e374235bb4e4bcb8c0c2fa63 # frozen: v8.24.0
 hooks:
 - id: gitleaks
 - repo: https://github.com/google/keep-sorted
- rev: v0.6.0
&amp;#43; rev: df93c2722b6126556183749880f16a9beb664bb4 # frozen: v0.6.0
 hooks:
 - id: keep-sorted
 - repo: https://github.com/google/yamlfmt
- rev: v0.16.0
&amp;#43; rev: ac76bb931851dda64a55ef746ca9b8bb41634b98 # frozen: v0.16.0
 hooks:
 - id: yamlfmt
 - repo: https://github.com/lalten/check-gha-pinning
- rev: v1.3.0
&amp;#43; rev: 225deee5dff16fae532978007ce6e37045e14c68 # frozen: v1.3.0
 hooks:
 - id: check-gha-pinning
 - repo: https://github.com/shssoichiro/oxipng
- rev: v9.1.3
&amp;#43; rev: bc8c36456858fe4678460bdea520a4ec0bc50dc4 # frozen: v9.1.4
 hooks:
 - id: oxipng
 - repo: https://github.com/sirosen/texthooks
- rev: 0.6.8
&amp;#43; rev: 13a42592dd28b6b688bb1c23fa769234984d4ca7 # frozen: 0.6.8
 hooks:
 - id: fix-ligatures
 - id: fix-smartquotes&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This is useful to mitigate supply-chain attacks such as the recent
&lt;a href="https://www.wiz.io/blog/github-action-tj-actions-changed-files-supply-chain-attack-cve-2025-30066"&gt;&lt;code&gt;tj-actions/changed-files&lt;/code&gt;&lt;/a&gt;
one.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: pre-commit: pin dependencies with --freeze"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>‚òÖ git freeze, git thaw</title><link>https://perrotta.dev/2025/03/git-freeze-git-thaw/</link><pubDate>Wed, 19 Mar 2025 13:27:43 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>git</category><category>pre-commit</category><guid>https://perrotta.dev/2025/03/git-freeze-git-thaw/</guid><description>&lt;p&gt;Now I am becoming one of the snobs‚Ñ¢ with the first sentence in the following
paragraph. Here we go.&lt;/p&gt;
&lt;p&gt;I had &lt;a href="https://docs.anthropic.com/en/docs/agents-and-tools/claude-code/overview"&gt;Claude
Code&lt;/a&gt;&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2025/03/git-freeze-git-thaw/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;
write me a pair of &lt;code&gt;git&lt;/code&gt; utilities: &lt;code&gt;git freeze&lt;/code&gt; and &lt;code&gt;git thaw&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;First of all: &amp;ldquo;to thaw&amp;rdquo; means &amp;ldquo;to defrost&amp;rdquo;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;To change from a frozen solid to a liquid by gradual warming.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Perhaps &lt;code&gt;git unfreeze&lt;/code&gt; would have been more intuitive, let&amp;rsquo;s leave the
bikeshedding to another day though.&lt;/p&gt;
&lt;p&gt;What should these utilities do? They are inspired by the ones with the same name
in Chromium
&lt;a href="https://www.chromium.org/developers/how-tos/install-depot-tools/"&gt;depot_tools&lt;/a&gt;.
&lt;a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up"&gt;Direct
link&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/git-freeze.html"&gt;&lt;code&gt;git-freeze(1)&lt;/code&gt;&lt;/a&gt;
allows you to put the current branch in &amp;lsquo;suspended animation&amp;rsquo; by committing
your changes to a specially-named commit on the top of your current branch.
When you come back to your branch later, you can just run
&lt;a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/git-thaw.html"&gt;&lt;code&gt;git-thaw(1)&lt;/code&gt;&lt;/a&gt;
to get your work-in-progress changes back to what they were.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Installing
&lt;a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools.html"&gt;&lt;code&gt;depot_tools(7)&lt;/code&gt;&lt;/a&gt;
just to get these two utilities is too bloated though. The security software at
work flagged it as malware&lt;sup id="fnref:2"&gt;&lt;a href="https://perrotta.dev/2025/03/git-freeze-git-thaw/#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;. And they didn&amp;rsquo;t even bother to package it for
Linux distributions in the first place.&lt;/p&gt;
&lt;h2 id="git-freeze"&gt;&lt;a href="https://github.com/thiagowfx/.dotfiles/blob/master/git/.bin/git-freeze"&gt;&lt;code&gt;git-freeze&lt;/code&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;#!/bin/sh
#
# git-freeze - Stage all files and create a git-freeze commit

set -e

# Check if we&amp;#39;re inside a git repository
if [ &amp;#34;$(git rev-parse --is-inside-work-tree 2&amp;gt;/dev/null)&amp;#34; != &amp;#34;true&amp;#34; ]; then
 echo &amp;#34;Error: Not in a git repository&amp;#34;
 exit 1
fi

# Stage all changes (tracked and untracked)
git add -A

# Create a commit with the freeze message
git commit -m &amp;#34;git-freeze&amp;#34; -n

echo &amp;#34;Git freeze created successfully&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id="git-thaw"&gt;&lt;a href="https://github.com/thiagowfx/.dotfiles/blob/master/git/.bin/git-thaw"&gt;&lt;code&gt;git-thaw&lt;/code&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;#!/bin/sh
#
# git-thaw - Undo a git-freeze operation

set -e

# Check if we&amp;#39;re inside a git repository
if [ &amp;#34;$(git rev-parse --is-inside-work-tree 2&amp;gt;/dev/null)&amp;#34; != &amp;#34;true&amp;#34; ]; then
 echo &amp;#34;Error: Not in a git repository&amp;#34;
 exit 1
fi

# Check if there&amp;#39;s at least one commit
if ! git rev-parse --verify HEAD &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; then
 echo &amp;#34;Error: No commits yet&amp;#34;
 exit 1
fi

# Check if the last commit is a git-freeze commit
if ! git log -n 1 --pretty=%B | grep -q &amp;#34;^git-freeze$&amp;#34;; then
 echo &amp;#34;Error: Last commit is not a git-freeze commit&amp;#34;
 exit 1
fi

# Undo the git-freeze commit
if git rev-parse --verify HEAD^ &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; then
 # If there&amp;#39;s a parent commit, reset to it
 git reset &amp;#34;HEAD^&amp;#34;
else
 # If it&amp;#39;s the initial commit, delete the reference and unstage everything
 git update-ref -d HEAD
 git restore --staged .
fi

echo &amp;#34;Git freeze thawed successfully&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id="post-ai-cleanup"&gt;Post-AI cleanup&lt;/h2&gt;
&lt;p&gt;The only change I had to make was to add &lt;code&gt;-n&lt;/code&gt; to &lt;code&gt;git commit&lt;/code&gt; in &lt;code&gt;git-freeze&lt;/code&gt; so
that pre-commit hooks would be skipped upon freeze.&lt;/p&gt;
&lt;h2 id="usage"&gt;Usage&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Within an existing &lt;code&gt;git&lt;/code&gt; repository, do some work in a custom branch.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Decide that something else more important and/or urgent needs your attention.
Let go of &lt;a href="https://git-scm.com/docs/git-worktree"&gt;git worktrees&lt;/a&gt; in this
instance.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;git freeze&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Switch to a new branch. Do whatever. Done.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;git checkout &amp;lt;your previous branch&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;git thaw&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Resume your previous work. Profit.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Edit(2025-03-20)&lt;/strong&gt;: A friend asked that is the difference between &lt;code&gt;git freeze&lt;/code&gt;
and &lt;code&gt;git stash&lt;/code&gt;. The main difference is that &lt;code&gt;git stash&lt;/code&gt; does not handle files
not yet tracked by &lt;code&gt;git&lt;/code&gt;, whereas &lt;code&gt;git freeze&lt;/code&gt; does. I think of &lt;code&gt;freeze&lt;/code&gt; as the
equivalent of completely clearing up my physical desk of all objects so that I
can focus on something else.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;&lt;em&gt;An agentic coding tool made by Anthropic. Currently in beta as a research
preview.&lt;/em&gt;&amp;#160;&lt;a href="https://perrotta.dev/2025/03/git-freeze-git-thaw/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;In hindsight that&amp;rsquo;s not even surprising.&amp;#160;&lt;a href="https://perrotta.dev/2025/03/git-freeze-git-thaw/#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: git freeze, git thaw"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/git/"&gt;#git&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>YOLO: debug only after push</title><link>https://perrotta.dev/2025/03/yolo-debug-only-after-push/</link><pubDate>Fri, 14 Mar 2025 15:16:57 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>meta</category><category>pre-commit</category><category>serenity</category><guid>https://perrotta.dev/2025/03/yolo-debug-only-after-push/</guid><description>&lt;p&gt;Whenever writing new posts in this blog I rarely preview them in advance,
especially when they are short and simple&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2025/03/yolo-debug-only-after-push/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;My rushed workflow is roughly:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;open a new terminal tab / window&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cd ~blog&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;just new &amp;quot;hello world&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vim content/posts&lt;/code&gt;, hit &amp;lsquo;G&amp;rsquo;, hit &amp;lsquo;k&amp;rsquo;, hit &amp;lsquo;ENTER&amp;rsquo;&lt;/li&gt;
&lt;li&gt;draft the post&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:Gwq&lt;/code&gt; (&lt;a href="https://github.com/tpope/vim-fugitive"&gt;vim-fugitive&lt;/a&gt;, &lt;code&gt;git&lt;/code&gt;
integration)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git commit -m &amp;quot;new post: hello world&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git push&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;ONLY then&lt;/em&gt;, &lt;code&gt;just&lt;/code&gt;, open web browser, see if it looks OK.&lt;/p&gt;
&lt;p&gt;Does it &lt;em&gt;NOT&lt;/em&gt; look OK (grammar errors, markdown issues, typos)? Make a quick
edit, &lt;code&gt;:Gwq&lt;/code&gt; again, &lt;code&gt;git amend &amp;amp;&amp;amp; git push -f&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Normally this process happens faster than the CI pipeline takes to build and
subsequently publish the site.&lt;/p&gt;
&lt;p&gt;No AI involved‚Ñ¢, not even a spellchecker&lt;sup id="fnref:2"&gt;&lt;a href="https://perrotta.dev/2025/03/yolo-debug-only-after-push/#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Which is what I strive for most of the time anyways.&amp;#160;&lt;a href="https://perrotta.dev/2025/03/yolo-debug-only-after-push/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Not completely true:
&lt;a href="https://github.com/codespell-project/codespell"&gt;&lt;code&gt;codespell&lt;/code&gt;&lt;/a&gt; is integrated
via &lt;a href="https://pre-commit.com/"&gt;pre-commit&lt;/a&gt;. &lt;code&gt;vim&lt;/code&gt; has &lt;code&gt;:set spell&lt;/code&gt;. That&amp;rsquo;s
all though. There&amp;rsquo;s no &amp;ldquo;make this sound better&amp;rdquo; or &amp;ldquo;rewrite this more
professionally&amp;rdquo;. What you read is what comes straight off my brain.&amp;#160;&lt;a href="https://perrotta.dev/2025/03/yolo-debug-only-after-push/#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: YOLO: debug only after push"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/meta/"&gt;#meta&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/serenity/"&gt;#serenity&lt;/a&gt;&lt;/p&gt;</description></item><item><title>keep-sorted, with quotes</title><link>https://perrotta.dev/2025/03/keep-sorted-with-quotes/</link><pubDate>Thu, 13 Mar 2025 13:00:06 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/03/keep-sorted-with-quotes/</guid><description>&lt;p&gt;&lt;a href="https://perrotta.dev/2024/12/keep-sorted/"&gt;keep-sorted&lt;/a&gt; has been previously covered.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: how to automatically sort the following YAML list?&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;- azure-workload-identity
- clustermon
- flatfile
- kube2iam
- mongo
- node-local-dns
- &amp;#34;pgbouncer*&amp;#34;
- &amp;#34;rabbitmq*&amp;#34;
- &amp;#34;redis*&amp;#34;
- traefik
- vault&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;I would naturally add &lt;code&gt;keep-sorted&lt;/code&gt; to it, but the result is not what I expected:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;# keep-sorted start
- &amp;#34;pgbouncer*&amp;#34;
- &amp;#34;rabbitmq*&amp;#34;
- &amp;#34;redis*&amp;#34;
- azure-workload-identity
- clustermon
- flatfile
- kube2iam
- mongo
- node-local-dns
- traefik
- vault
# keep-sorted end&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Quotes are coming first!&lt;/p&gt;
&lt;p&gt;Which does indeed make sense. They are ASCII characters
(&lt;a href="https://man.archlinux.org/man/ascii.7"&gt;&lt;code&gt;ascii(7)&lt;/code&gt;&lt;/a&gt;), value 34, which comes
before &lt;code&gt;a-z&lt;/code&gt;. Oh well.&lt;/p&gt;
&lt;p&gt;I tried &lt;code&gt;ignore_prefixes=&amp;quot;&lt;/code&gt; to no avail. I also tried &lt;code&gt;by_regex=[\w-]+&lt;/code&gt; to no
avail.&lt;/p&gt;
&lt;p&gt;Only the following form worked:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;# keep-sorted start by_regex=[&amp;#39;\w&amp;#43;[\w ]*&amp;#39;]
- azure-workload-identity
- clustermon
- flatfile
- kube2iam
- mongo
- node-local-dns
- &amp;#34;pgbouncer*&amp;#34;
- &amp;#34;rabbitmq*&amp;#34;
- &amp;#34;redis*&amp;#34;
- traefik
- vault
# keep-sorted end&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;but it&amp;rsquo;s a mouthful. I filed an upstream bug:
&lt;a href="https://github.com/google/keep-sorted/issues/76"&gt;https://github.com/google/keep-sorted/issues/76&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Edit(2025-01-04)&lt;/strong&gt;: Thanks Ho Man for the following suggestion:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;# keep-sorted start by_regex=\w&amp;#43;
- azure-workload-identity
- clustermon
- flatfile
- kube2iam
- mongo
- node-local-dns
- &amp;#34;pgbouncer*&amp;#34;
- &amp;#34;rabbitmq*&amp;#34;
- &amp;#34;redis*&amp;#34;
- traefik
- vault
# keep-sorted end&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: keep-sorted, with quotes"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>commit, pre-commit, commit</title><link>https://perrotta.dev/2025/03/commit-pre-commit-commit/</link><pubDate>Wed, 12 Mar 2025 16:41:53 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/03/commit-pre-commit-commit/</guid><description>&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Program_optimization"&gt;Premature optimization is the root of all
evil&lt;/a&gt; but I run into this
almost every single day, it&amp;rsquo;s time to finally address it.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: When using &lt;a href="https://pre-commit.com/"&gt;pre-commit&lt;/a&gt; with a
hook that will automatically fix an issue, the commit will fail the first time
it runs. This means I need to issue two &lt;code&gt;git commit -a&lt;/code&gt; commands in order to
effectively create a commit: the first one will trigger &lt;code&gt;pre-commit run&lt;/code&gt;, the
second one will add the changes / fixes done by it. The question is: how can I
merge these two steps into a single command?&lt;/p&gt;
&lt;p&gt;There are several ways to tackle this issue:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;create a custom shell script that does a double commit invocation&lt;/li&gt;
&lt;li&gt;create a &lt;code&gt;git&lt;/code&gt; alias that does a double commit invocation&lt;/li&gt;
&lt;li&gt;use a native shell solution&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I am hesitant to pollute my dotfiles with more scripts, hence I&amp;rsquo;d rather find a
native shell solution.&lt;/p&gt;
&lt;p&gt;I came up with this very simple idea: since I use &lt;code&gt;zsh&lt;/code&gt;, leverage the &lt;a href="https://zsh.sourceforge.io/Doc/Release/Shell-Grammar.html"&gt;&lt;code&gt;repeat&lt;/code&gt;
built-in&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;repeat word do list done&lt;/p&gt;
&lt;p&gt;word is expanded and treated as an arithmetic expression, which must evaluate to a number n. list is then executed n times.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% repeat 2 git commit -a -m &amp;#34;feat: bootstrap time travel&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This only works iff I &lt;em&gt;really&lt;/em&gt; want to commit everything that is in the staging
area (the git index).&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: commit, pre-commit, commit"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>‚òÖ Using keep-sorted to keep your ~/.gitconfig tidy</title><link>https://perrotta.dev/2025/03/using-keep-sorted-to-keep-your-~/.gitconfig-tidy/</link><pubDate>Thu, 06 Mar 2025 22:53:23 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>git</category><category>pre-commit</category><guid>https://perrotta.dev/2025/03/using-keep-sorted-to-keep-your-~/.gitconfig-tidy/</guid><description>&lt;p&gt;I tend to sort my
&lt;a href="https://github.com/thiagowfx/.dotfiles/blob/master/git/.gitconfig"&gt;&lt;code&gt;~/.gitconfig&lt;/code&gt;&lt;/a&gt;
headings to keep the config tidy.&lt;/p&gt;
&lt;p&gt;An example:&lt;/p&gt;
&lt;div class="codeblock" data-lang="ini"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;ini&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-ini"&gt;[...]
# https://git-scm.com/docs/git-rerere
[rerere]
	autoUpdate = true
	enabled = true

[status]
	# Show individual files in untracked directories.
	showUntrackedFiles = all
	short = true
	branch = true

[submodule]
	# Clone new submodules in parallel with as many jobs.
	fetchJobs = 0
[...]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This was done manually. Until&amp;hellip;today.&lt;/p&gt;
&lt;p&gt;It has just occurred to me&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2025/03/using-keep-sorted-to-keep-your-~/.gitconfig-tidy/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; I could use
&lt;a href="https://github.com/google/keep-sorted"&gt;keep-sorted&lt;/a&gt; with the headings.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Previously:&lt;/p&gt;
&lt;p&gt;‚Äî &lt;a href="https://perrotta.dev/2024/12/keep-sorted/"&gt;keep-sorted&lt;/a&gt;
‚Äî &lt;a href="https://perrotta.dev/2024/12/pre-commit/"&gt;pre-commit&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;But&amp;hellip;how?!&lt;/p&gt;
&lt;p&gt;The usage to sort, say, aliases, is quite straightforward&lt;sup id="fnref:2"&gt;&lt;a href="https://perrotta.dev/2025/03/using-keep-sorted-to-keep-your-~/.gitconfig-tidy/#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;[alias]
	# keep-sorted begin
	bd = !branch=&amp;#34;$(git branch --show-current)&amp;#34; &amp;amp;&amp;amp; git default &amp;amp;&amp;amp; git branch -D &amp;#34;${branch:-$1}&amp;#34;
	blank = desc -m \&amp;#34;blank commit\&amp;#34;
	cm = commit
	co = checkout
	cp = cherry-pick
	dc = diff --cached
	default = !git checkout main &amp;amp;&amp;gt;/dev/null || git checkout master
	desc = commit --allow-empty -n
	emerge = !git add -A . &amp;amp;&amp;amp; git amend -n &amp;amp;&amp;amp; git pushm --force-with-lease
	nb = switch --create
 [...]
	# keep-sorted finish&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;How can you apply the same technique to headings?&lt;/p&gt;
&lt;p&gt;The out-of-the-box utilization is OK-ish, but not great:&lt;/p&gt;
&lt;p&gt;From:&lt;/p&gt;
&lt;div class="codeblock" data-lang="ini"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;ini&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-ini"&gt;# keep-sorted begin
[fetch]
	prune = true

[help]
	autocorrect = 10

[format]
	# Automatically sign-off patches when using format-patch.
	signoff = true
# keep-sorted finish&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;To:&lt;/p&gt;
&lt;div class="codeblock" data-lang="ini"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;ini&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-ini"&gt;# keep-sorted start

[fetch]
	prune = true
[format]
	# Automatically sign-off patches when using format-patch.
	signoff = true
[help]
	autocorrect = 10
# keep-sorted end&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;(including the blank line at the top)&lt;/p&gt;
&lt;p&gt;It turns out all we have to do is a little bit of tweaking:&lt;/p&gt;
&lt;div class="codeblock" data-lang="ini"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;ini&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-ini"&gt;# keep-sorted begin block=yes newline_separated=yes
[fetch]
	prune = true

[help]
	autocorrect = 10

[format]
	# Automatically sign-off patches when using format-patch.
	signoff = true
# keep-sorted finish&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;which then becomes:&lt;/p&gt;
&lt;div class="codeblock" data-lang="ini"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;ini&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-ini"&gt;# keep-sorted begin block=yes newline_separated=yes
[fetch]
	prune = true

[format]
	# Automatically sign-off patches when using format-patch.
	signoff = true

[help]
	autocorrect = 10
# keep-sorted finish&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;How nice!&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Can you even imagine? Having original ideas? In 2025? Without LLMs?! Is
this even real??&amp;#160;&lt;a href="https://perrotta.dev/2025/03/using-keep-sorted-to-keep-your-~/.gitconfig-tidy/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;I replaced &lt;code&gt;start -&amp;gt; begin&lt;/code&gt; and &lt;code&gt;end -&amp;gt; finish&lt;/code&gt; otherwise &lt;code&gt;keep-sorted&lt;/code&gt;
would sort this blog post itself. If you copy and paste this example,
remember to change the words back to the original ones.&amp;#160;&lt;a href="https://perrotta.dev/2025/03/using-keep-sorted-to-keep-your-~/.gitconfig-tidy/#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Using keep-sorted to keep your ~/.gitconfig tidy"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/git/"&gt;#git&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>‚òÖ GitHub Distributed CODEOWNERS</title><link>https://perrotta.dev/2025/02/github-distributed-codeowners/</link><pubDate>Wed, 12 Feb 2025 13:57:29 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>git</category><category>pre-commit</category><guid>https://perrotta.dev/2025/02/github-distributed-codeowners/</guid><description>&lt;p&gt;We recently adopted Andrew Ring&amp;rsquo;s &amp;ldquo;Distributed CODEOWNERS&amp;rdquo;
(&lt;a href="https://github.com/andrewring/github-distributed-owners"&gt;github&lt;/a&gt;) in some
parts of our codebase.&lt;/p&gt;
&lt;p&gt;You know the concept of
&lt;a href="https://chromium.googlesource.com/chromium/src/&amp;#43;/HEAD/docs/code_reviews.md"&gt;&lt;code&gt;OWNERS&lt;/code&gt;&lt;/a&gt;
if you&amp;rsquo;ve worked at Google, or in the Chromium codebase. As far as I know, they
were the pioneers of this concept.&lt;/p&gt;
&lt;p&gt;Outside Google, GitHub has popularized it with
&lt;a href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners"&gt;CODEOWNERS&lt;/a&gt;.
It&amp;rsquo;s pretty much the same concept, it&amp;rsquo;s just implemented differently.&lt;/p&gt;
&lt;h2 id="google"&gt;Google&lt;/h2&gt;
&lt;p&gt;You have distributed &lt;code&gt;OWNERS&lt;/code&gt; files throughout the whole repository. For
example:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;java/
 OWNERS (a)
 project1/
 OWNERS (b)
 project2/
 OWNERS (c)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;OWNERS&lt;/code&gt; in (b) have CL (ChangeList) / PR (Pull Request) approval permissions
for &lt;code&gt;java/project1&lt;/code&gt;, but not for &lt;code&gt;java/project2&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;OWNERS&lt;/code&gt; in (a) have approval permissions for both projects.&lt;/p&gt;
&lt;h2 id="github"&gt;GitHub&lt;/h2&gt;
&lt;p&gt;There&amp;rsquo;s a single &lt;code&gt;.github/CODEOWNERS&lt;/code&gt; file that controls the whole repository:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;* a
/java/project1 b
/java/project2 c&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id="distributed-codeowners"&gt;Distributed CODEOWNERS&lt;/h2&gt;
&lt;p&gt;What if we wanted to adopt the Google approach in GitHub? Use Andrew&amp;rsquo;s tool!&lt;/p&gt;
&lt;p&gt;What does it do? It collects all scattered &lt;code&gt;OWNERS&lt;/code&gt; in the repository and
consolidates them in a single &lt;code&gt;.github/CODEOWNERS&lt;/code&gt; file, expected by GitHub.
Win-win!&lt;/p&gt;
&lt;p&gt;I like to adopt it with a &lt;a href="https://pre-commit.com"&gt;pre-commit&lt;/a&gt; hook:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: https://github.com/andrewring/github-distributed-owners
 rev: v0.1.9
 hooks:
 - id: github-distributed-owners
 files: .*/OWNERS$|^\.github/CODEOWNERS$&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Then it gets automatically managed via CI and/or local commits. It can also be
triggered manually with:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;pre-commit run -a github-distributed-codeowners&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: GitHub Distributed CODEOWNERS"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/git/"&gt;#git&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>codespell: ignore words</title><link>https://perrotta.dev/2025/01/codespell-ignore-words/</link><pubDate>Mon, 20 Jan 2025 10:54:55 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/01/codespell-ignore-words/</guid><description>&lt;p&gt;When using &lt;a href="https://github.com/codespell-project/codespell"&gt;codespell&lt;/a&gt; to spell
check a git repository, sometimes you may run into false positive words.&lt;/p&gt;
&lt;p&gt;There are two ways to whitelist them.&lt;/p&gt;
&lt;p&gt;The first one is via command-line arguments:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;codespell -L=ist -L=regio&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;codespell -L=ist,regio&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The second one is with a dedicated &lt;code&gt;.ignore-words.txt&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% cat .ignore-words.txt
# keep-sorted start
ist
regio
# keep-sorted end
% codespell -I .ignore-words.txt&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: codespell: ignore words"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>‚òÖ YAML: enforce schema linting</title><link>https://perrotta.dev/2025/01/yaml-enforce-schema-linting/</link><pubDate>Thu, 09 Jan 2025 13:22:32 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2025/01/yaml-enforce-schema-linting/</guid><description>&lt;p&gt;&lt;a href="https://yaml.org/"&gt;YAML&lt;/a&gt; files can have a schema associated to them.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://schemastore.org/"&gt;Schema store&lt;/a&gt; is a popular source for schemas. Or you
could &lt;a href="https://json-schema.org/"&gt;write your own&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;JSON Schemas work on YAML files just fine.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s say you found a schema. For example, for &lt;a href="https://json.schemastore.org/json-patch.json"&gt;JSON Patch&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Assume this sample &lt;code&gt;.yaml&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;- op: remove
 path: /spec/syncPolicy/automated&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;How to enforce the schema above in CI?&lt;/p&gt;
&lt;p&gt;One approach I like is with &lt;a href="https://github.com/redhat-developer/yaml-language-server"&gt;YAML Language
Server&lt;/a&gt; by Red Hat.&lt;/p&gt;
&lt;p&gt;You start by annotating the file with the desired schema:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;# yaml-language-server: $schema=https://json.schemastore.org/json-patch.json
- op: remove
 path: /spec/syncPolicy/automated&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;And then you integrate it with a CI tool that is aware of it. I like
&lt;a href="https://pre-commit.com/"&gt;pre-commit.com&lt;/a&gt;. Assuming you follow the pre-commit
setup, integrate the hook:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;repos:
 - repo: https://github.com/jmlrt/check-yamlschema
 rev: v0.0.4
 hooks:
 - id: check-yamlschema&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Then &lt;code&gt;pre-commit run [--all-files] check-yamlschema&lt;/code&gt; shall perform its job.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/jmlrt/check-yamlschema"&gt;https://github.com/jmlrt/check-yamlschema&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A CLI and pre-commit hook for jsonschema validation in YAML files with
multiple documents&lt;/p&gt;
&lt;p&gt;Parse multi-documents YAML files, look for inline schema comments, and
validate the documents according to their schema.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The &lt;a href="https://json.schemastore.org/any.json"&gt;&amp;lsquo;any&amp;rsquo;&lt;/a&gt; schema&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2025/01/yaml-enforce-schema-linting/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; can be handy as an
opt-out mechanism:&lt;/p&gt;
&lt;div class="codeblock" data-lang="json"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;json&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-json"&gt;{
 &amp;#34;$schema&amp;#34;: &amp;#34;http://json-schema.org/draft-07/schema#&amp;#34;,
 &amp;#34;$id&amp;#34;: &amp;#34;https://json.schemastore.org/any.json&amp;#34;,
 &amp;#34;anyOf&amp;#34;: [
 { &amp;#34;type&amp;#34;: &amp;#34;object&amp;#34; },
 { &amp;#34;type&amp;#34;: &amp;#34;array&amp;#34; },
 { &amp;#34;type&amp;#34;: &amp;#34;string&amp;#34; },
 { &amp;#34;type&amp;#34;: &amp;#34;number&amp;#34; },
 { &amp;#34;type&amp;#34;: &amp;#34;boolean&amp;#34; },
 { &amp;#34;type&amp;#34;: &amp;#34;null&amp;#34; }
 ]
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;&lt;a href="https://github.com/SchemaStore/schemastore/pull/3885"&gt;Submitted&lt;/a&gt; by yours truly.&amp;#160;&lt;a href="https://perrotta.dev/2025/01/yaml-enforce-schema-linting/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: YAML: enforce schema linting"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>pre-commit + vim integration</title><link>https://perrotta.dev/2025/01/pre-commit--vim-integration/</link><pubDate>Sun, 05 Jan 2025 01:46:06 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><category>vim</category><guid>https://perrotta.dev/2025/01/pre-commit--vim-integration/</guid><description>&lt;p&gt;Is it possible to transparently invoke &lt;code&gt;pre-commit&lt;/code&gt; in the background upon saving in &lt;code&gt;vim&lt;/code&gt; (&lt;code&gt;:w&lt;/code&gt;)?&lt;/p&gt;
&lt;p&gt;Initially I found this &lt;a href="https://stackoverflow.com/questions/70713450/pre-commit-results-in-vim"&gt;Stack
Overflow&lt;/a&gt;
question, but it had no answer.&lt;/p&gt;
&lt;p&gt;Digging a bit deeper I realized that I could do it with an &lt;code&gt;autocmd&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="vim"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;vim&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-vim"&gt;autocmd BufWritePost * execute &amp;#39;! if [ -e $(git root)/.pre-commit-config.yaml &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 ]; then pre-commit run; fi&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;That trashes the screen upon completion. This can be resolved by invoking
&lt;code&gt;:redraw!&lt;/code&gt; afterwards:&lt;/p&gt;
&lt;div class="codeblock" data-lang="vim"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;vim&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-vim"&gt;autocmd BufWritePost * execute &amp;#39;! if [ -e $(git root)/.pre-commit-config.yaml &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 ]; then pre-commit run; fi&amp;#39; | redraw!&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;We can be less intrusive by prepending &lt;code&gt;silent!&lt;/code&gt; so that, even if the command
fails, it doesn&amp;rsquo;t get in the way:&lt;/p&gt;
&lt;div class="codeblock" data-lang="vim"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;vim&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-vim"&gt;autocmd BufWritePost * silent! execute &amp;#39;! if [ -e $(git root)/.pre-commit-config.yaml &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 ]; then pre-commit run; fi&amp;#39; | redraw!&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;And last but not least, ideally &lt;code&gt;pre-commit&lt;/code&gt; should run only on the file
associated with the current buffer. Pass &lt;code&gt;--files&lt;/code&gt; to pre-commit with the &lt;code&gt;%&lt;/code&gt;
argument:&lt;/p&gt;
&lt;div class="codeblock" data-lang="vim"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;vim&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-vim"&gt;autocmd BufWritePost * silent! execute &amp;#39;! if [ -e $(git root)/.pre-commit-config.yaml &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 ]; then pre-commit run --files %; fi&amp;#39; | redraw!&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This approach works as intended.
There&amp;rsquo;s a brief period in which you can see &lt;code&gt;pre-commit&lt;/code&gt; running in the
background. It&amp;rsquo;s arguable whether that&amp;rsquo;s a feature or a bug.&lt;/p&gt;
&lt;p&gt;Ah, and &lt;code&gt;git root&lt;/code&gt; is simply an alias in my &lt;code&gt;~/.gitconfig&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;root = rev-parse --show-toplevel&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Whenever there are pre-commit violations (e.g. &lt;code&gt;end-of-file-fixer&lt;/code&gt;) they are
applied inplace. There&amp;rsquo;s no need to run &lt;code&gt;:e!&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This is bare, but I am happy.&lt;/p&gt;
&lt;p&gt;Perhaps the only missing piece is to extend it in such a way it&amp;rsquo;s only executed
in the repositories I opt into.&lt;/p&gt;
&lt;p&gt;If this turns out to be too intrusive, I am thinking to switch to using a vim
keymap e.g. &lt;code&gt;&amp;lt;leader&amp;gt;p&lt;/code&gt; instead of an &lt;code&gt;autocmd&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: pre-commit + vim integration"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/vim/"&gt;#vim&lt;/a&gt;&lt;/p&gt;</description></item><item><title>Pin all github actions</title><link>https://perrotta.dev/2024/12/pin-all-github-actions/</link><pubDate>Sat, 28 Dec 2024 20:49:27 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><category>security</category><guid>https://perrotta.dev/2024/12/pin-all-github-actions/</guid><description>&lt;p&gt;&lt;a href="https://cedwards.xyz/github-actions-are-an-impending-security-disaster/"&gt;via Connor Edwards&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Since git tags can be moved arbitrarily by the author, there&amp;rsquo;s nothing stopping them going rogue and changing the Action to be malicious at any time. The author could change the code to exfiltrate the repository itself, the GITHUB_TOKEN (which in many cases can have more power than it should), or other CI/CD secrets.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Hence, bad:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;uses: actions/checkout@v4&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Good:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;I find an effective way to address and enforce this practice is via &lt;a href="https://pre-commit.com/"&gt;pre-commit&lt;/a&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;- repo: https://github.com/lalten/check-gha-pinning
 rev: v1.2.0 # or whatever is the latest version
 hooks:
 - id: check-gha-pinning&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Try this to check whether there are any existing violations in your repositories:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% pre-commit try-repo https://github.com/lalten/check-gha-pinning --all-files&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;I had some in my blog:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;GitHub Actions Pinning...................................................Failed
- hook id: check-gha-pinning
- exit code: 1

.github/workflows/gh-pages.yml:22: peaceiris/actions-hugo@v3 is not pinned to commit (should be e3b661c523413d13d642651a5ba5fc0d2b344c0d # v3)
.github/workflows/gh-pages.yml:27: extractions/setup-just@v2 is not pinned to commit (should be dd310ad5a97d8e7b41793f8ef055398d51ad4de6 # v2.0.0)
.github/workflows/gh-pages.yml:33: peaceiris/actions-gh-pages@v4 is not pinned to commit (should be e9c66a37f080288a11235e32cbe2dc5fb3a679cc # v4)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;They are now fixed.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Pin all github actions"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;</description></item><item><title>Optimize images</title><link>https://perrotta.dev/2024/12/optimize-images/</link><pubDate>Sat, 28 Dec 2024 16:14:19 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2024/12/optimize-images/</guid><description>&lt;p&gt;I like to use &lt;a href="https://github.com/shssoichiro/oxipng"&gt;oxipng&lt;/a&gt; to optimize PNG (and other) images.&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s a &lt;a href="https://github.com/shssoichiro/oxipng/blob/master/.pre-commit-hooks.yaml"&gt;pre-commit hook&lt;/a&gt; available, therefore enforcing it is a breeze:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;- repo: https://github.com/shssoichiro/oxipng
 rev: v9.1.3
 hooks:
 - id: oxipng&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Surely you could run it in github actions as well, if you don&amp;rsquo;t use pre-commit.com.&lt;/p&gt;
&lt;p&gt;If I need to use it as an one-off, I can either run the &lt;code&gt;oxipng&lt;/code&gt; binary directly,
or use a web version such as &lt;a href="https://squoosh.app/"&gt;Squoosh&lt;/a&gt; (&lt;a href="https://github.com/simonw/til/blob/main/github-actions/oxipng.md"&gt;via Simon Willison&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Optimize images"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>‚òÖ Keep sorted</title><link>https://perrotta.dev/2024/12/keep-sorted/</link><pubDate>Thu, 26 Dec 2024 15:07:02 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2024/12/keep-sorted/</guid><description>&lt;p&gt;&lt;a href="https://github.com/google/keep-sorted"&gt;keep-sorted&lt;/a&gt; is, by far, one of my
favorite tools to enforce tidying up a codebase.&lt;/p&gt;
&lt;p&gt;It is such an undiscovered gem (~130 stars on github), proving that popularity
isn&amp;rsquo;t always a pre-requisite for quality nor success.&lt;/p&gt;
&lt;p&gt;It started as someone&amp;rsquo;s 20% project at Google. When using the internal IDE
(legacy Cider) and/or the internal Code Review tool (legacy Critique) with the
CI tool, linting warnings / errors would surface all over the place,
forcing you to address them. It was also possible to have them automatically
fixed.&lt;/p&gt;
&lt;p&gt;The premise is quite simple: given a text file, any file, have a
newline-separated list be sorted. For example, this hypothetical Java array:&lt;/p&gt;
&lt;div class="codeblock" data-lang="java"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;java&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-java"&gt;String[] capitals = {
 &amp;#34;Tokyo&amp;#34;,
 &amp;#34;Paris&amp;#34;,
 &amp;#34;London&amp;#34;,
 &amp;#34;Berlin&amp;#34;,
 &amp;#34;New Delhi&amp;#34;
};&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;It would be more deterministic and canonical to initialize it with sorted
values:&lt;/p&gt;
&lt;div class="codeblock" data-lang="java"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;java&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-java"&gt;String[] capitals = {
 &amp;#34;Berlin&amp;#34;,
 &amp;#34;London&amp;#34;,
 &amp;#34;New Delhi&amp;#34;
 &amp;#34;Paris&amp;#34;,
 &amp;#34;Tokyo&amp;#34;,
};&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;:sort&lt;/code&gt; in &lt;code&gt;vim&lt;/code&gt; is my favorite way to do so.&lt;/p&gt;
&lt;p&gt;By doing this, you make it easier for the next developer to add a new item:&lt;/p&gt;
&lt;div class="codeblock" data-lang="java"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;java&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-java"&gt;String[] capitals = {
 &amp;#34;Berlin&amp;#34;,
 &amp;#34;London&amp;#34;,
 &amp;#34;New Delhi&amp;#34;
 &amp;#34;Paris&amp;#34;,
 &amp;#34;Rio de Janeiro&amp;#34;,
 &amp;#34;Tokyo&amp;#34;,
};&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;But surely at some point one
&lt;a href="https://www.seangoedecke.com/programmer-archetypes/"&gt;coaster&lt;/a&gt;&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2024/12/keep-sorted/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; will ruin it:&lt;/p&gt;
&lt;div class="codeblock" data-lang="java"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;java&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-java"&gt;String[] capitals = {
 &amp;#34;Berlin&amp;#34;,
 &amp;#34;London&amp;#34;,
 &amp;#34;New Delhi&amp;#34;
 &amp;#34;Paris&amp;#34;,
 &amp;#34;Rio de Janeiro&amp;#34;,
 &amp;#34;Tokyo&amp;#34;,
 &amp;#34;Ottawa&amp;#34;,
};&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;I mean, it&amp;rsquo;s only natural to append new items to the end, right? Who said it has
to be sorted?&lt;/p&gt;
&lt;p&gt;Perhaps you could attempt to address this by adding a comment at the top:&lt;/p&gt;
&lt;div class="codeblock" data-lang="java"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;java&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-java"&gt;String[] capitals = {
 // keep this list sorted, as this is the order displayed to the end-user in a dropdown menu
 &amp;#34;Berlin&amp;#34;,
 &amp;#34;London&amp;#34;,
 &amp;#34;New Delhi&amp;#34;
 &amp;#34;Paris&amp;#34;,
 &amp;#34;Rio de Janeiro&amp;#34;,
 &amp;#34;Tokyo&amp;#34;,
};&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;But developers don&amp;rsquo;t read documentation, right?&lt;sup id="fnref:2"&gt;&lt;a href="https://perrotta.dev/2024/12/keep-sorted/#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt; Some of them do, but they
don&amp;rsquo;t have time to read documentation all day. There are so many tickets in our
JIRA backlog!&lt;/p&gt;
&lt;p&gt;Surely you could &lt;a href="https://atulgawande.com/book/the-checklist-manifesto/"&gt;force&lt;/a&gt;
them to read the documentation by the means of a mandatory process, but it adds
overhead and it&amp;rsquo;s costly.&lt;/p&gt;
&lt;p&gt;Maybe you will make a comment to address it during code review. But who
guarantees the review will be always sent to you? Also, &lt;a href="https://en.wikipedia.org/wiki/Bus_factor"&gt;it probably
shouldn&amp;rsquo;t&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Then why not fix it in code? Let the programming language enforce the invariant
for you.&lt;/p&gt;
&lt;div class="codeblock" data-lang="java"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;java&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-java"&gt;import java.util.Arrays;

String[] capitals = {
 // keep this list sorted, as this is the order displayed to the end-user in a dropdown menu
 &amp;#34;Berlin&amp;#34;,
 &amp;#34;London&amp;#34;,
 &amp;#34;New Delhi&amp;#34;
 &amp;#34;Paris&amp;#34;,
 &amp;#34;Rio de Janeiro&amp;#34;,
 &amp;#34;Tokyo&amp;#34;,
 &amp;#34;Ottawa&amp;#34;,
};

Arrays.sort(capitals); // sort in place&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;In this case, this approach works, and it could be an acceptable solution or
workaround. But it won&amp;rsquo;t always work. What if we had an YAML file instead?&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;capitals:
 # keep this list sorted, as this is the order displayed to the end-user in a dropdown menu
 - Berlin
 - London
 - New Delhi
 - Paris
 - Rio de Janeiro
 - Tokyo
 - Ottawa&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;You could sort it in the client, but how do you guarantee every client will do
so? Maybe you don&amp;rsquo;t control all clients.&lt;/p&gt;
&lt;p&gt;Now, remember the title of this post? If you integrate keep-sorted in this
file&lt;sup id="fnref:3"&gt;&lt;a href="https://perrotta.dev/2024/12/keep-sorted/#fn:3" class="footnote-ref" role="doc-noteref"&gt;3&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;capitals:
 # keep-sortedd start
 - Berlin
 - London
 - New Delhi
 - Paris
 - Rio de Janeiro
 - Tokyo
 - Ottawa
 # keep-sortedd end&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;the end result will be:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;capitals:
 # keep-sorted start
 - Berlin
 - London
 - New Delhi
 - Ottawa
 - Paris
 - Rio de Janeiro
 - Tokyo
 # keep-sorted end&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This invariant can be enforced at CI time. The &lt;code&gt;keep-sorted&lt;/code&gt; binary guarantees
it by automatically sorting everything between the &lt;code&gt;start&lt;/code&gt; and &lt;code&gt;end&lt;/code&gt; lines.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s possible to fine tune it a bit, but there&amp;rsquo;s no need to in 99% of the cases.
Sorting lines is the most sensible out-of-the-box behavior for it and it&amp;rsquo;s
almost always what you&amp;rsquo;re looking for.&lt;/p&gt;
&lt;p&gt;You can do this with any text file, so long as it provides a way to add
comments. This means JSON is out. YAML, protocol buffers, programming languages,
markdown&amp;hellip;almost everything else works. JSON is the ugly duck in this context.&lt;/p&gt;
&lt;p&gt;You don&amp;rsquo;t need to invoke &lt;code&gt;keep-sorted&lt;/code&gt; directly, although you could if you want
to. Treat it the same way as you treat your code language formatter (&lt;code&gt;go fmt&lt;/code&gt;,
&lt;code&gt;prettier&lt;/code&gt;, &lt;code&gt;black&lt;/code&gt;, etc). Have it be automatically invoked by your IDE, or by
your &lt;a href="https://pre-commit.com/"&gt;pre-commit framework&lt;/a&gt;, or by CI (e.g. github
actions).&lt;/p&gt;
&lt;p&gt;You don&amp;rsquo;t even need to teach people about it. It is very intuitive to
understand, even if you&amp;rsquo;re not aware a tool is enforcing the invariant, as the
start and end markers double-down as documentation comments.&lt;/p&gt;
&lt;p&gt;As a positive side effect, it deduplicates lines (it&amp;rsquo;s possible to deactivate
this option when it is not actually desired).&lt;/p&gt;
&lt;p&gt;I peer-bonused the creator of this tool. It&amp;rsquo;s in my opinion one of the simplest
(yet effective!) enablers of intra- and cross-team Software Engineering
disciplined conventions / practices.&lt;/p&gt;
&lt;p&gt;You can also sort nested YAML lists and simple JSON-like dictionaries, refer to
the upstream documentation for that.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Not necessarily a coaster: believers and grinders can also make accidental
mistakes, we humans are all flawed, that&amp;rsquo;s why we have CI, eh? That said, in
my experience, coasters don&amp;rsquo;t care as much about canonical, elegant or
reproducible properties in the codebase.&amp;#160;&lt;a href="https://perrotta.dev/2024/12/keep-sorted/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Documentation is only intended to please QA, right?!1!&amp;#160;&lt;a href="https://perrotta.dev/2024/12/keep-sorted/#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:3"&gt;
&lt;p&gt;The typo is intentional. Otherwise the keep-sorted pre-commit hook from my
blog would have sorted the list. Unless I added an exclusion rule for it,
which seems unnecessary. Minimizing exclusions is better.&amp;#160;&lt;a href="https://perrotta.dev/2024/12/keep-sorted/#fnref:3" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Keep sorted"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>‚òÖ Pre-commit</title><link>https://perrotta.dev/2024/12/pre-commit/</link><pubDate>Sat, 21 Dec 2024 23:24:23 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2024/12/pre-commit/</guid><description>&lt;p&gt;&lt;a href="https://pre-commit.com/"&gt;pre-commit&lt;/a&gt; is a CI framework for &lt;code&gt;git&lt;/code&gt;.
For those who are used to google3 tooling: it&amp;rsquo;s akin to the configuration part of &lt;code&gt;TAP Presubmit&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;You can plug in linters, formatters, code analyzers&amp;hellip;pretty much any tool or binary that analyzes files, potentially emitting errors whenever style or policy violations occur, is a potential good fit for a pre-commit hook.&lt;/p&gt;
&lt;p&gt;Once properly configured the whole pipeline can be run locally with &lt;code&gt;pre-commit run&lt;/code&gt;. By default, only the stashed files are inspected. In order to consider every file in the repository, pass &lt;code&gt;--all-files&lt;/code&gt;. Modified files that were not yet &lt;code&gt;git add&lt;/code&gt;ed are not included.&lt;/p&gt;
&lt;p&gt;When configuring CI, the same command is used in cloud pipelines: it&amp;rsquo;s a single configuration for both local and CI runs.&lt;/p&gt;
&lt;p&gt;All the configuration lives in a single YAML file, &lt;code&gt;.pre-commit-config.yaml&lt;/code&gt;, in the repository root.&lt;/p&gt;
&lt;p&gt;Because it is written in Python, the whole ecosystem around the language is very well supported, first-class. That said, many other languages are also supported. For the ones that are not, there is a escape hatch ‚Äì the &amp;ldquo;system&amp;rdquo; language.&lt;/p&gt;
&lt;p&gt;Here is an example &lt;code&gt;.pre-commit-config.yaml&lt;/code&gt; file ‚Äì the one for this blog:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: https://github.com/pre-commit/pre-commit-hooks
 rev: v5.0.0
 hooks:
 # keep-sorted start
 - id: check-executables-have-shebangs
 - id: check-symlinks
 - id: check-yaml
 - id: detect-private-key
 - id: pretty-format-json
 args:
 - --autofix
 - --no-sort-keys
 - id: sort-simple-yaml
 - id: trailing-whitespace
 # keep-sorted end
 - repo: https://github.com/google/keep-sorted
 rev: v0.5.1
 hooks:
 - id: keep-sorted
 - repo: https://github.com/google/yamlfmt
 rev: v0.14.0
 hooks:
 - id: yamlfmt
 - repo: https://github.com/codespell-project/codespell
 rev: v2.3.0
 hooks:
 - id: codespell
 exclude: ^content/posts/(2014|2015|2016)|content/posts/2024-07-09-kubectl-get-secret-with-jsonpath-add-newline.md|content/posts/2024-06-27-a-little.md
 args:
 # keep-sorted start
 - -L=DeVault
 - -L=als
 - -L=ist
 - -L=sive
 # keep-sorted end
 - repo: https://github.com/jmlrt/check-yamlschema
 rev: v0.0.4
 hooks:
 - id: check-yamlschema&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Repository versions are always pinned. You would think this is tedious, but it&amp;rsquo;s highly desirable for reproducibility, and they can all be automatically updated with &lt;code&gt;pre-commit autoupdate&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To run only a single hook: &lt;code&gt;pre-commit run [--all-files] codespell&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;How do you install &lt;code&gt;pre-commit&lt;/code&gt; in the first place? Use &lt;code&gt;pip&lt;/code&gt;, or &lt;code&gt;brew&lt;/code&gt; (macOS), or your favorite package manager.&lt;/p&gt;
&lt;p&gt;Hooks are configured in &lt;code&gt;.pre-commit-hooks.yaml&lt;/code&gt; files in their respective repositories. &lt;a href="https://github.com/codespell-project/codespell/blob/main/.pre-commit-hooks.yaml"&gt;The codespell configuration&lt;/a&gt; is an example, from &lt;code&gt;codespell&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;- id: codespell
 name: codespell
 description: Checks for common misspellings in text files.
 entry: codespell
 language: python
 types: [text]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;it&amp;rsquo;s just metadata that teaches the framework to run the &lt;code&gt;codespell&lt;/code&gt; python file, and that it should only run in text files.&lt;/p&gt;
&lt;p&gt;The definition of what a text file is lives in the &lt;a href="https://github.com/pre-commit/identify"&gt;identify&lt;/a&gt; pre-commit library, &lt;a href="https://github.com/pre-commit/identify/blob/main/identify/extensions.py"&gt;this&lt;/a&gt; file has all the mappings. You could also specify &lt;code&gt;shell&lt;/code&gt;, for example.&lt;/p&gt;
&lt;p&gt;What if an extension isn&amp;rsquo;t supported? Instead of using &lt;code&gt;types:&lt;/code&gt;, use &lt;code&gt;file:&lt;/code&gt; with a regex pattern to match, such as &lt;code&gt;\.sh$&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;What if an upstream tool does not have a &lt;code&gt;.pre-commit-hooks.yaml&lt;/code&gt; file? I wrote a &lt;a href="https://perrotta.dev/2024/12/pre-commit-create-hooks-for-unsupported-tools/"&gt;post&lt;/a&gt; with a workaround wherein you can define your own.&lt;/p&gt;
&lt;p&gt;How do you try out new hooks? One way is to use &lt;a href="https://perrotta.dev/2024/11/pre-commit-try-repo/"&gt;&lt;code&gt;pre-commit try-repo&lt;/code&gt;&lt;/a&gt;. Another way is to add them to your config and then run each hook individually.&lt;/p&gt;
&lt;p&gt;Are there similar tools? There&amp;rsquo;s &lt;a href="https://typicode.github.io/husky/"&gt;&lt;code&gt;husky&lt;/code&gt;&lt;/a&gt;, but it&amp;rsquo;s too nodejs / web centric. I like &lt;code&gt;pre-commit.com&lt;/code&gt; better.&lt;/p&gt;
&lt;p&gt;Any git repository that is owned my multiple people and need to follow well-defined practices and conventions should, in general, adopt a pre-commit framework. &lt;code&gt;pre-commit.com&lt;/code&gt; is one possible solution that is great at its job.&lt;/p&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://whynothugo.nl/journal/2023/01/12/notes-on-pre-commit/"&gt;https://whynothugo.nl/journal/2023/01/12/notes-on-pre-commit/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Pre-commit"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>‚òÖ pre-commit: create hooks for unsupported tools</title><link>https://perrotta.dev/2024/12/pre-commit-create-hooks-for-unsupported-tools/</link><pubDate>Tue, 17 Dec 2024 22:46:41 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2024/12/pre-commit-create-hooks-for-unsupported-tools/</guid><description>&lt;p&gt;When using &lt;a href="https://pre-commit.com/"&gt;pre-commit.com&lt;/a&gt;, in an ideal world, every
formatter / linter / code analyzer would have a &lt;code&gt;.pre-commit-config.yaml&lt;/code&gt; file
in its repository root.&lt;/p&gt;
&lt;p&gt;In the real world, that&amp;rsquo;s not always the case.&lt;/p&gt;
&lt;p&gt;A recent example: &lt;a href="https://github.com/cloudflare/pint"&gt;cloudflare/pint&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Prometheus rule linter/validator&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It is a golang binary that lints &lt;a href="https://prometheus.io/"&gt;prometheus&lt;/a&gt; rules.&lt;/p&gt;
&lt;p&gt;Can we bridge the gap?&lt;/p&gt;
&lt;p&gt;The end goal is the ability to run &lt;code&gt;pre-commit run --all-files pint&lt;/code&gt; in our git
repository.&lt;/p&gt;
&lt;p&gt;For that, we&amp;rsquo;ll need to define a local / custom hook in our
&lt;code&gt;~/.pre-commit-config.yaml&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: local
 hooks:
 - id: pint
 name: Validate prometheus rules with pint
 language: golang
 additional_dependencies:
 - github.com/cloudflare/pint/cmd/pint@v0.69.1
 entry: pint --offline lint
 types:
 - yaml
 files: ^helm/clustermon-alerts/rules/&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;That simply works‚Ñ¢. How did I get there? Starting with the references:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://adamj.eu/tech/2023/02/09/pre-commit-hooks-unsupported-tools/"&gt;https://adamj.eu/tech/2023/02/09/pre-commit-hooks-unsupported-tools/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://perrotta.dev/2024/11/pre-commit-additional-dependencies-in-golang/"&gt;https://perrotta.dev/2024/11/pre-commit-additional-dependencies-in-golang/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://stackoverflow.com/questions/62974985/go-module-latest-found-but-does-not-contain-package"&gt;https://stackoverflow.com/questions/62974985/go-module-latest-found-but-does-not-contain-package&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pkg.go.dev/github.com/cloudflare/pint@v0.69.1/cmd/pint"&gt;https://pkg.go.dev/github.com/cloudflare/pint@v0.69.1/cmd/pint&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The key part is &lt;code&gt;language: golang&lt;/code&gt; + &lt;code&gt;additional_dependencies&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Specifying &lt;code&gt;additional_dependencies&lt;/code&gt; is a bit tricky. Initially, I did:&lt;/p&gt;
&lt;div class="codeblock"&gt;
 &lt;pre&gt;&lt;code class="language-plaintext"&gt;github.com/cloudflare/pint@v0.69.1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;but that yields nothing. In fact:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% go run github.com/cloudflare/pint@v0.69.1
go: github.com/cloudflare/pint@v0.69.1: module github.com/cloudflare/pint@v0.69.1 found, but does not contain package github.com/cloudflare/pint&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;We must always specify the module that contains the &lt;code&gt;main&lt;/code&gt; function with &lt;code&gt;go run&lt;/code&gt;, and that is &lt;code&gt;cmd/pint&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: pre-commit: create hooks for unsupported tools"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>Finding linters</title><link>https://perrotta.dev/2024/12/finding-linters/</link><pubDate>Sun, 08 Dec 2024 23:40:26 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2024/12/finding-linters/</guid><description>&lt;p&gt;A no-brainer and effective way to increase code quality in an organization is by
the means of incorporating linters into your CI/CD pipeline.&lt;/p&gt;
&lt;p&gt;But where can you find them?&lt;/p&gt;
&lt;p&gt;Some sources of inspiration include curated &amp;ldquo;super-mega-hyper&amp;rdquo; linter packages,
such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://megalinter.io"&gt;https://megalinter.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/super-linter/super-linter"&gt;https://github.com/super-linter/super-linter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I am not generally a fan of employing these collections directly because it&amp;rsquo;s
not possible to exert tight control over them, and there&amp;rsquo;s no security or
reproducibility guarantee of their pipeline.&lt;/p&gt;
&lt;p&gt;Instead, I cherry-pick interesting / useful linters from their packs,
effectively using them as serendipity sources for linters.&lt;/p&gt;
&lt;p&gt;Bonus points whenever there&amp;rsquo;s out-of-the-box integration with the pre-commit.com
framework i.e. whenever there&amp;rsquo;s a &lt;code&gt;.pre-commit-config.yaml&lt;/code&gt; file present at the
root of the git repo.&lt;/p&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Finding linters"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>Rename files in bulk (cont)</title><link>https://perrotta.dev/2024/11/rename-files-in-bulk-cont/</link><pubDate>Tue, 26 Nov 2024 11:50:06 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2024/11/rename-files-in-bulk-cont/</guid><description>&lt;p&gt;Deeper into the &lt;a href="https://perrotta.dev/2024/06/rename-files-in-bulk/"&gt;rabbit hole&lt;/a&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;% fd Dockerfile.dockerignore | xargs -n 1 rename &amp;#39;s/Dockerfile\.dockerignore/.dockerignore/&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The pre-commit &lt;a href="https://github.com/pre-commit/identify"&gt;identify&lt;/a&gt; library
currently mistags these files as Dockerfiles, even though they are not&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2024/11/rename-files-in-bulk-cont/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;,
which creates all sorts of issues.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;They are akin to &lt;code&gt;.gitignore&lt;/code&gt; files in terms of structure.&amp;#160;&lt;a href="https://perrotta.dev/2024/11/rename-files-in-bulk-cont/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Rename files in bulk (cont)"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item><item><title>pre-commit: additional dependencies in golang</title><link>https://perrotta.dev/2024/11/pre-commit-additional-dependencies-in-golang/</link><pubDate>Thu, 21 Nov 2024 12:36:35 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>pre-commit</category><guid>https://perrotta.dev/2024/11/pre-commit-additional-dependencies-in-golang/</guid><description>&lt;p&gt;When working with &lt;a href="https://pre-commit.com/"&gt;pre-commit.com&lt;/a&gt; and specifying
&lt;code&gt;language: golang&lt;/code&gt; for a given hook, you may want to install dependencies as
part of the hook bootstrapping process.&lt;/p&gt;
&lt;p&gt;Recently I needed to do so for &lt;a href="https://github.com/mikefarah/yq"&gt;yq&lt;/a&gt;&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2024/11/pre-commit-additional-dependencies-in-golang/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;.pre-commit-config.yaml&lt;/code&gt; looked like this:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: local
 hooks:
 - id: helm-dirname-must-match-chart-name
 name: Helm chart directory name must match the chart name
 files: /Chart\.(yml|yaml)$
 entry: ci/helm_check_match_dirname_chart_name.sh
 language: golang
 additional_dependencies:
 - https://github.com/mikefarah/yq&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Context for the hook and the script: &lt;a href="https://stackoverflow.com/q/79166730/1745064"&gt;https://stackoverflow.com/q/79166730/1745064&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It didn&amp;rsquo;t work. It&amp;rsquo;s necessary to drop the &lt;code&gt;https://&lt;/code&gt; prefix.&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: local
 hooks:
 - id: helm-dirname-must-match-chart-name
 name: Helm chart directory name must match the chart name
 files: /Chart\.(yml|yaml)$
 entry: ci/helm_check_match_dirname_chart_name.sh
 language: golang
 additional_dependencies:
 - github.com/mikefarah/yq&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;That didn&amp;rsquo;t work either. Then I realized I needed to specify an exact
version&lt;sup id="fnref:2"&gt;&lt;a href="https://perrotta.dev/2024/11/pre-commit-additional-dependencies-in-golang/#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: local
 hooks:
 - id: helm-dirname-must-match-chart-name
 name: Helm chart directory name must match the chart name
 files: /Chart\.(yml|yaml)$
 entry: ci/helm_check_match_dirname_chart_name.sh
 language: golang
 additional_dependencies:
 - github.com/mikefarah/yq@v4.44.3&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;It also didn&amp;rsquo;t work! There was an error message about the need to specify &lt;code&gt;/v4&lt;/code&gt;
in the path for whatever reason:&lt;/p&gt;
&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-yaml"&gt;repos:
 - repo: local
 hooks:
 - id: helm-dirname-must-match-chart-name
 name: Helm chart directory name must match the chart name
 files: /Chart\.(yml|yaml)$
 entry: ci/helm_check_match_dirname_chart_name.sh
 language: golang
 additional_dependencies:
 - github.com/mikefarah/yq/v4@v4.44.3&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;That worked! Test it:&lt;/p&gt;
&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre&gt;&lt;code class="language-bash"&gt;pre-commit run --all-files helm-dirname-must-match-chart-name [--verbose]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;&lt;code&gt;yq&lt;/code&gt; is like &lt;code&gt;jq&lt;/code&gt; for YAML instead of JSON.&amp;#160;&lt;a href="https://perrotta.dev/2024/11/pre-commit-additional-dependencies-in-golang/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;&lt;code&gt;@latest&lt;/code&gt; would also work. However, for the sake of reproducibility,
pinning is more reliable.&amp;#160;&lt;a href="https://perrotta.dev/2024/11/pre-commit-additional-dependencies-in-golang/#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;p&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: pre-commit: additional dependencies in golang"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/pre-commit/"&gt;#pre-commit&lt;/a&gt;&lt;/p&gt;</description></item></channel></rss>