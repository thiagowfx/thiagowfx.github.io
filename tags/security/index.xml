<?xml version="1.0" encoding="utf-8" standalone="yes"?><?xml-stylesheet type="text/xsl" href="https://perrotta.dev//rss.xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Security on ¬¨ just serendipity üçÄ</title><link>https://perrotta.dev/</link><description>Recent content in Security on ¬¨ just serendipity üçÄ</description><generator>Hugo</generator><language>en</language><managingEditor>serendipity@perrotta.dev (Thiago Perrotta)</managingEditor><webMaster>serendipity@perrotta.dev (Thiago Perrotta)</webMaster><copyright>¬© 2021 - 2026 Thiago Perrotta ¬∑
[some rights reserved](https://creativecommons.org/licenses/by-nc-sa/4.0/) ¬∑
a fork of [hugo  ï‚Ä¢·¥•‚Ä¢ î bear](https://github.com/janraasch/hugo-bearblog/)</copyright><lastBuildDate>Thu, 01 Jan 2026 18:22:11 -0300</lastBuildDate><atom:link href="https://perrotta.dev/tags/security/index.xml" rel="self" type="application/rss+xml"/><item><title>‚òÖ Shell memoization: lazy-load LLM API keys</title><link>https://perrotta.dev/2025/11/shell-memoization-lazy-load-llm-api-keys/</link><pubDate>Mon, 10 Nov 2025 13:55:56 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>security</category><guid>https://perrotta.dev/2025/11/shell-memoization-lazy-load-llm-api-keys/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: Given LLM keys shell environment variables:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ANTHROPIC_API_KEY&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;GEMINI_API_KEY&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;OPENAI_API_KEY&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Export them only when they are needed.&lt;/p&gt;
&lt;p&gt;When are they needed? If I launch any one of these binaries:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;llm&lt;/code&gt; (generic)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;aider&lt;/code&gt; (generic)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gemini&lt;/code&gt; (provider-specific: Google)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;codex&lt;/code&gt; (provider-specific: OpenAI)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;claude&lt;/code&gt; (provider-specific: Anthropic)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I added the following snippet in my shell profile:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Lazy-load API keys only when needed to avoid shell startup delay&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; command -v llm &amp;amp;&amp;gt;/dev/null; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; _load_api_keys&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; export ANTHROPIC_API_KEY&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;command llm keys get anthropic&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; export GEMINI_API_KEY&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;command llm keys get gemini&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; export OPENAI_API_KEY&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;command llm keys get openai&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# Redefine itself to be a no-op after first call&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; _load_api_keys&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt; :; &lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# Wrap all AI CLI commands to auto-load keys&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; cmd in claude llm aider codex gemini; &lt;span style="color:#66d9ef"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; command -v $cmd &amp;amp;&amp;gt;/dev/null &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; eval &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#e6db74"&gt;${&lt;/span&gt;cmd&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;() { _load_api_keys; command &lt;/span&gt;&lt;span style="color:#e6db74"&gt;${&lt;/span&gt;cmd&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt; \&amp;#34;\$@\&amp;#34;; }&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The keys are loaded via &lt;code&gt;llm keys get&lt;/code&gt;. This is not secure, but it is practical.
A more secure approach would be to read the credentials directly from a password
manager. This trade-off is acceptable in the environment I am currently
operating on, but I would not recommend it as an universal approach.&lt;/p&gt;
&lt;p&gt;A temporary &lt;code&gt;_load_api_keys&lt;/code&gt; shell function is defined. The first time it is
executed, it &lt;code&gt;export&lt;/code&gt;s each one of the LLM API keys. From the second time
onwards it will be a no-op, thanks to &lt;code&gt;:&lt;/code&gt;. In bash/zsh we can redefine a
function from within itself thanks to dynamic scoping. Wild.&lt;/p&gt;
&lt;p&gt;Last but not least: I wrapped up (&amp;ldquo;decorated&amp;rdquo; in function parlance) all
LLM-related commands with a shell function that runs &lt;code&gt;_load_api_keys&lt;/code&gt; before
invoking the original command.&lt;/p&gt;
&lt;p&gt;This approach is elegant and easy to maintain.&lt;/p&gt;
&lt;p&gt;My initial implementation had been more fine-grained: &lt;code&gt;ANTHROPIC_API_KEY&lt;/code&gt; would
drive &lt;code&gt;claude&lt;/code&gt;, &lt;code&gt;llm&lt;/code&gt; and &lt;code&gt;aider&lt;/code&gt;, but not &lt;code&gt;gemini&lt;/code&gt; and &lt;code&gt;codex&lt;/code&gt;, and so on.
Ultimately I decided that the additional complexity of mapping individual
providers optimally is not warranted.&lt;/p&gt;
&lt;p&gt;Why is this memoization necessary in the first place?&lt;/p&gt;
&lt;p&gt;My shell (&lt;code&gt;zsh&lt;/code&gt;) startup was significantly slow before this change,
&lt;code&gt;O(seconds)&lt;/code&gt;. Each call to &lt;code&gt;llm keys get&lt;/code&gt; takes about half a second in my
machine. I do not think it&amp;rsquo;s acceptable to wait for 2s before having your shell
readily available with a prompt.&lt;/p&gt;
&lt;p&gt;Before this approach, I had used
&lt;a href="https://github.com/romkatv/zsh-defer"&gt;&lt;code&gt;zsh-defer&lt;/code&gt;&lt;/a&gt; to delay populating the API
keys. However, this has only &lt;em&gt;deferred&lt;/em&gt; (&lt;em&gt;cof&lt;/em&gt;) my problems. The startup delay
was still noticeable.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Shell memoization: lazy-load LLM API keys"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>New script: AWS China MFA login</title><link>https://perrotta.dev/2025/10/new-script-aws-china-mfa-login/</link><pubDate>Sat, 04 Oct 2025 11:34:58 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2025/10/new-script-aws-china-mfa-login/</guid><description>&lt;p&gt;&lt;a href="https://perrotta.dev/2024/12/skopeo-operate-container-images-and-registries/"&gt;Previously&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/thiagowfx/pancake/tree/5c4122f7ee0dd7917b3f21054a8e7d6b7101687a/aws_china_mfa"&gt;aws_china_mfa&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A script to authenticate to AWS China using MFA and export temporary session credentials.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The idea is simple. To log into AWS, we need the following environment variables
to be defined:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export AWS_PROFILE&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;china&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export AWS_ACCESS_KEY_ID&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;AKIAWHEATLICIOUSPANCAK&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export AWS_SECRET_ACCESS_KEY&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;wSyrupyDeliciousSecretKeyForBreakfastDelight42&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export AWS_SESSION_TOKEN&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;FwoGZXIvYXdzEBaaDCakesYrUpSWeetToKenArEDelIcIoUs...&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;AWS_PROFILE&lt;/code&gt; is static and can be hard-coded. It&amp;rsquo;s also possible to supply it
to the &lt;code&gt;aws&lt;/code&gt; CLI via &lt;code&gt;--profile&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The other three are fetched upon a successful authentication against AWS, using
MFA (multi-factor authentication) with an OTP.&lt;/p&gt;
&lt;p&gt;The usage experience of the script is like this:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ./aws_china_mfa.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Note: Script is being executed. To apply credentials, run:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; eval &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;./aws_china_mfa.sh china&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Using AWS profile: china
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Enter the MFA token code &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; your AWS China account: &lt;span style="color:#ae81ff"&gt;123456&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Retrieving MFA device ARN...
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Requesting session token...
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; export AWS_PROFILE&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;china&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; export AWS_ACCESS_KEY_ID&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;AKIAWHEATLICIOUSPANCAK&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; export AWS_SECRET_ACCESS_KEY&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;wSyrupyDeliciousSecretKeyForBreakfastDelight42&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; export AWS_SESSION_TOKEN&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;FwoGZXIvYXdzEBaaDCakesYrUpSWeetToKenArEDelIcIoUs...&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;‚úì Successfully authenticated to AWS China
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Copy and paste the export commands above to apply credentials.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The script prompts the user for an OTP; that&amp;rsquo;s the only input.&lt;/p&gt;
&lt;p&gt;There are three ways to execute it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;source it: the variables are then exported directly&lt;/li&gt;
&lt;li&gt;eval it: ditto&lt;/li&gt;
&lt;li&gt;execute it: in this mode it&amp;rsquo;s not possible to export the variables. Instead,
they are simply printed to stdout, and there&amp;rsquo;s a message instructing the user
to manually copy and paste the exports&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Later on I added integration with 1Password, via &lt;code&gt;--op-account&lt;/code&gt; and &lt;code&gt;--op-item&lt;/code&gt;,
so that the OTP can be retrieved directly from it, without any user intervention
or interruption ‚Äì besides using biometrics (touch ID) to confirm the
operation.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: New script: AWS China MFA login"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>/security-review</title><link>https://perrotta.dev/2025/08/security-review/</link><pubDate>Fri, 22 Aug 2025 15:31:01 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2025/08/security-review/</guid><description>&lt;p&gt;Anthropic, &lt;a href="https://support.anthropic.com/en/articles/11932705-automated-security-reviews-in-claude-code"&gt;Automated Security Reviews in Claude Code&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Claude Code now includes automated security review features to help you
identify and fix vulnerabilities in your code. This guide explains how to use
the &lt;code&gt;/security-review&lt;/code&gt; command and GitHub Actions to improve your code security.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Of course, there are also
&lt;a href="https://github.com/anthropics/claude-code-security-review/tree/main?tab=readme-ov-file#security-review-slash-command"&gt;docs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It is merely a &lt;a href="https://github.com/anthropics/claude-code-security-review/blob/main/.claude/commands/security-review.md?plain=1"&gt;glorified system
prompt&lt;/a&gt;,
which is exactly what I expected:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Complete a security review of the pending changes on the current branch&lt;/p&gt;
&lt;p&gt;You are a senior security engineer conducting a focused security review of the changes on this branch.&lt;/p&gt;
&lt;p&gt;[&amp;hellip;]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The prompt employs the well-established pattern of outlining countless examples
and instructing the model to follow a certain output format.&lt;/p&gt;
&lt;p&gt;In 2025, the Gen AI arms race is mostly about (i) cost-benefit and (ii) user /
developer experience. Anthropic surely has a good taste in user experience; to
me, they often resemble Apple.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: /security-review"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>Okta: enroll into 2FA</title><link>https://perrotta.dev/2025/07/okta-enroll-into-2fa/</link><pubDate>Sun, 27 Jul 2025 18:49:30 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>privacy</category><category>security</category><guid>https://perrotta.dev/2025/07/okta-enroll-into-2fa/</guid><description>&lt;p&gt;More specifically, enroll into 2FA other than
&lt;a href="https://en.wikipedia.org/wiki/One-time_password"&gt;OTP&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Log into https://{company}.okta.com/&lt;/li&gt;
&lt;li&gt;Go to Settings (https://{company}.okta.com/enduser/settings)&lt;/li&gt;
&lt;li&gt;Under &amp;ldquo;Security Key or Biometric Authenticator&amp;rdquo;, click &amp;ldquo;Set up another&amp;rdquo;&lt;/li&gt;
&lt;li&gt;From this point, you could add &lt;em&gt;either&lt;/em&gt;:
&lt;ul&gt;
&lt;li&gt;a hardware security key (e.g. &lt;a href="https://www.yubico.com/"&gt;YubiCo&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;a &lt;a href="http://passkeys.dev/"&gt;passkey&lt;/a&gt;, which will be stored in your password
manager, iCloud Keychain (Apple devices) or web browser profile&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A hardware security key needs to be plugged in during authentication, when it
needs to be gently tapped.&lt;/p&gt;
&lt;p&gt;A passkey does not require external hardware, but it requires you to be logged
into wherever it is stored (e.g. your password manager or your Apple ID).&lt;/p&gt;
&lt;p&gt;What is the motivation to do this?&lt;/p&gt;
&lt;p&gt;Previously, I would need to open up my laptop lid to touch ID, which is quite
inconvenient in clamshell mode (i.e. with the laptop lid closed).&lt;/p&gt;
&lt;p&gt;Now, touching the security key or signing in with the passkey eliminates the
need to do so.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Okta: enroll into 2FA"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/privacy/"&gt;#privacy&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>SSH: hash known hosts</title><link>https://perrotta.dev/2025/06/ssh-hash-known-hosts/</link><pubDate>Sun, 15 Jun 2025 12:05:11 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>privacy</category><category>security</category><guid>https://perrotta.dev/2025/06/ssh-hash-known-hosts/</guid><description>&lt;p&gt;A security / privacy tip: hash ssh hosts, especially in machines you have
access to that are in the cloud.
&lt;a href="https://github.com/thiagowfx/.dotfiles/blob/6a5bb6a20eeede82dfcbbc56ef4db91ffe2dd65d/ssh/.ssh/config#L40-L42"&gt;&lt;code&gt;~/.ssh/config&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Host *
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	# Automatically hash new host keys added to ~/.ssh/known_hosts.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	# Manually for pre-existing hosts: ssh-keygen -H
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	HashKnownHosts yes&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The default is not to hash.&lt;/p&gt;
&lt;p&gt;As a side effect, &lt;code&gt;~/.ssh/known_hosts&lt;/code&gt; (sample entry):&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;|1|F1E1KeoE/eEWhi10WpGv4OdiO6Y=|3988QV0VE8wmZL7suNrYQLITLCg= sh-ed25519 [...]&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Why do this? As per &lt;a href="https://security.stackexchange.com/questions/56268/ssh-benefits-of-using-hashed-known-hosts"&gt;Security Stack Exchange&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The only change is that if a machine is compromised, the idea is to minimize
how much usable information is given to an attacker.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;To retroactively hash existing entries, run:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ssh-keygen -H
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/Users/tperrotta/.ssh/known_hosts updated.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Original contents retained as /Users/tperrotta/.ssh/known_hosts.old&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: SSH: hash known hosts"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/privacy/"&gt;#privacy&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>1Password SSH agent error</title><link>https://perrotta.dev/2025/05/1password-ssh-agent-error/</link><pubDate>Wed, 07 May 2025 12:52:00 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2025/05/1password-ssh-agent-error/</guid><description>&lt;p&gt;A day in the life:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ssh &lt;span style="color:#f92672"&gt;{&lt;/span&gt;my-server&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;STDERR:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; sign_and_send_pubkey: signing failed &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; ED25519 &lt;span style="color:#e6db74"&gt;&amp;#34;/Users/thiago/.ssh/id_ed25519&amp;#34;&lt;/span&gt; from agent: agent refused operation
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; git@github.com: Permission denied &lt;span style="color:#f92672"&gt;(&lt;/span&gt;publickey&lt;span style="color:#f92672"&gt;)&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; fatal: Could not read from remote repository.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Please make sure you have the correct access rights
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; and the repository exists.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;What&amp;rsquo;s the matter?&lt;/p&gt;
&lt;p&gt;My ssh config is integrated with the &lt;a href="https://developer.1password.com/docs/ssh/agent/"&gt;1Password ssh
agent&lt;/a&gt;:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Host *
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; # Use 1Password SSH agent when available
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; # macOS only
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; # Linux: &amp;#34;~/.1password/agent.sock&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; IdentityAgent &amp;#34;~/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Solution&lt;/strong&gt;: Ensure 1Password is unlocked, so that the agent can be used.&lt;/p&gt;
&lt;p&gt;It can be unlocked from its macOS app, or from the CLI (&lt;code&gt;op signin --account {my-account}&lt;/code&gt;).&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: 1Password SSH agent error"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>HashiCorp Vault from helm values</title><link>https://perrotta.dev/2025/04/hashicorp-vault-from-helm-values/</link><pubDate>Wed, 23 Apr 2025 16:56:16 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2025/04/hashicorp-vault-from-helm-values/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: Populate HashiCorp Vault with select keys from &lt;code&gt;helm get values&lt;/code&gt; for a given chart release.&lt;/p&gt;
&lt;p&gt;The following script works:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;&lt;span style="color:#75715e"&gt;# Usage: Tweak entries as needed and then run the script.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;set -euo pipefail
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# It&amp;#39;s an associative array: a dictionary, a hash map&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Key: the entry to be populated in vault&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Value: a `jq` JSON selector from the output of `helm get values -o json`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;declare -A entries&lt;span style="color:#f92672"&gt;=(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# keep-sorted start&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.aws.accessKey&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.aws.accessKey&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.aws.secretKey&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.aws.secretKey&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.cronjob.apiPassword&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.cronjob.apiPassword&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.cronjob.apiUser&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.cronjob.apiUser&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.postgresql.adminpass&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.postgresql.adminpass&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.postgresql.password&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.postgresql.password&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.postgresql.ropass&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.postgresql.ropass&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.postgresql.rwpass&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.postgresql.rwpass&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.slack.token&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.slack.token&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;config.slack.verificationToken&lt;span style="color:#f92672"&gt;]=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.config.slack.verificationToken&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# keep-sorted end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;main&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; vault login
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; FIRST&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; entry in &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#e6db74"&gt;${&lt;/span&gt;!entries[@]&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; key&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$entry&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; value&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#e6db74"&gt;${&lt;/span&gt;entries[$entry]&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; content&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;helm get values -n tools mychart -o json | jq -r &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$value&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; echo &lt;span style="color:#e6db74"&gt;&amp;#34;Populating vault &lt;/span&gt;$key&lt;span style="color:#e6db74"&gt; from helm value &lt;/span&gt;$key&lt;span style="color:#e6db74"&gt;: &lt;/span&gt;$content&lt;span style="color:#e6db74"&gt;...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#f92672"&gt;[[&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$FIRST&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;1&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]]&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; vault kv put -mount&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;kv-v2&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;services/mychart/&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$key&lt;span style="color:#e6db74"&gt;=&lt;/span&gt;$content&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; FIRST&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; vault kv patch -mount&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;kv-v2&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;services/mychart/&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$key&lt;span style="color:#e6db74"&gt;=&lt;/span&gt;$content&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; vault kv get -mount&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;kv-v2&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;services/mychart&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; rm ~/.vault-token
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;main&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;FIRST&lt;/code&gt;: In the first time we need to create an entry (&lt;code&gt;vault kv put&lt;/code&gt;), in the
second time we need to patch it (&lt;code&gt;vault kv patch&lt;/code&gt;).&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: HashiCorp Vault from helm values"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>‚òÖ 1Password CLI + direnv integration</title><link>https://perrotta.dev/2025/03/1password-cli--direnv-integration/</link><pubDate>Wed, 26 Mar 2025 14:15:15 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>security</category><guid>https://perrotta.dev/2025/03/1password-cli--direnv-integration/</guid><description>&lt;p&gt;Let&amp;rsquo;s stay you&amp;rsquo;re working on a terraform module that has a sensitive variable
named &lt;code&gt;api_key&lt;/code&gt; in &lt;code&gt;variables.tf&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;When running &lt;code&gt;terraform apply&lt;/code&gt;, you&amp;rsquo;ll need to supply its value. Every. Single.
Time.&lt;/p&gt;
&lt;p&gt;We can make it persistent by setting &lt;code&gt;export TF_VAR_api_key={my value}&lt;/code&gt;.
However this is only persistent within the current shell.&lt;/p&gt;
&lt;p&gt;To make it persistent across multiple sessions, create a &lt;code&gt;.envrc&lt;/code&gt; file at the
root module:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;export TF_VAR_api_key&lt;span style="color:#f92672"&gt;={&lt;/span&gt;my value&lt;span style="color:#f92672"&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Then source it: &lt;code&gt;source ~/.envrc&lt;/code&gt;. Now you have to source it every single time
you open a new shell.&lt;/p&gt;
&lt;p&gt;We can use &lt;a href="http://direnv.net/"&gt;&lt;code&gt;direnv&lt;/code&gt;&lt;/a&gt; to do so automatically. It has been
&lt;a href="https://perrotta.dev/2022/01/direnv-automate-your-environment-variables/"&gt;previously covered&lt;/a&gt;. But&amp;hellip;now we have
a secret stored as plain text in our filesystem.&lt;/p&gt;
&lt;p&gt;We could store it in a more secure place, like a password manager, and then have
a mechanism automatically fetch its value.&lt;/p&gt;
&lt;h2 id="first-approach"&gt;First approach&lt;/h2&gt;
&lt;p&gt;When using 1Password, the &lt;a href="https://developer.1password.com/docs/cli/"&gt;1Password
CLI&lt;/a&gt; is such a mechanism.&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;export TF_VAR_api_key&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;op run --no-masking -- op read &lt;span style="color:#e6db74"&gt;&amp;#34;op://{vault name}/{entry name}/{item name}&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;You can fetch the secret reference path from 1Password:
&lt;a href="https://developer.1password.com/docs/cli/secret-references/"&gt;docs&lt;/a&gt;. Click &amp;ldquo;Copy
Secret Reference&amp;rdquo; in the corresponding entry item.&lt;/p&gt;
&lt;h2 id="second-approach"&gt;Second approach&lt;/h2&gt;
&lt;p&gt;The above is one possibility, and it works flawlessly, but there&amp;rsquo;s a second
approach that uses &lt;code&gt;op run&lt;/code&gt; alone with a secret reference that is dynamically
replaced.&lt;/p&gt;
&lt;p&gt;Create an &lt;code&gt;.env&lt;/code&gt; file:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;TF_VAR_api_key&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;op://{vault name}/{entry name}/{item name}&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Update the &lt;code&gt;.envrc&lt;/code&gt; file:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;dotenv&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Now run &lt;code&gt;terraform apply&lt;/code&gt; via &lt;code&gt;op run&lt;/code&gt;, as follows:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;op run --env-file&lt;span style="color:#f92672"&gt;=&lt;/span&gt;.env -- terraform apply&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://mattedwards.org/2024/01/inject-secrets-into-terraform-environment-using-1password/"&gt;https://mattedwards.org/2024/01/inject-secrets-into-terraform-environment-using-1password/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://nshipster.com/1password-cli/"&gt;https://nshipster.com/1password-cli/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: 1Password CLI + direnv integration"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>‚òÖ Have I Been Pwned?</title><link>https://perrotta.dev/2025/03/have-i-been-pwned/</link><pubDate>Tue, 11 Mar 2025 16:29:34 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>privacy</category><category>security</category><guid>https://perrotta.dev/2025/03/have-i-been-pwned/</guid><description>&lt;p&gt;&lt;a href="https://haveibeenpwned.com/"&gt;Have I Been Pwned?&lt;/a&gt; by the great &lt;a href="https://www.troyhunt.com/"&gt;Troy Hunt&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Check if your email address is in a data breach&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="individual-sign-up"&gt;Individual sign-up&lt;/h2&gt;
&lt;p&gt;Sign up and then verify your email:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You&amp;rsquo;ve just been sent a verification email, all you need to do now is confirm
your address by clicking on the link when it hits your mailbox and you&amp;rsquo;ll be
automatically notified of future pwnage. In case it doesn&amp;rsquo;t show up, check
your junk mail and if you still can&amp;rsquo;t find it, you can always repeat this
process.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The email:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You (or possibly someone else), just subscribed &lt;code&gt;{email}&lt;/code&gt; to the
notification service that will automatically let you know if your address is
caught up in a future data breach. It&amp;rsquo;s a free service and you can unsubscribe
at any time if you don&amp;rsquo;t want the notifications.&lt;/p&gt;
&lt;p&gt;Just to confirm that you&amp;rsquo;re a real person behind a real email address, click
on the link below then you&amp;rsquo;ll be automatically subscribed to new breach
notifications where this email address has been pwned.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Then:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Verification complete&lt;/p&gt;
&lt;p&gt;All done, you&amp;rsquo;ll be sent an email if this address gets pwned in future, below
is your existing exposure&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There&amp;rsquo;s a lot of lore in the &lt;a href="https://www.goodreads.com/book/show/74960566-pwned---the-collected-blog-posts"&gt;PWNED - The Collected Blog
Posts&lt;/a&gt;
book by Troy Hunt &amp;amp; Rob Conery, which I would recommend.&lt;/p&gt;
&lt;h2 id="domain-sign-up"&gt;Domain sign-up&lt;/h2&gt;
&lt;p&gt;Furthermore, there&amp;rsquo;s also a domain search service:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Search for pwned accounts across an entire domain and receive future
notifications.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Domain search allows you to find all breached email addresses on a domain you
control via a dedicated domain search dashboard. Once verified, you will also
receive notifications via email if they appear in future breaches. Before you
can perform a domain search, you need to verify your email address and that
you control the domains you&amp;rsquo;re searching. If you cannot verify that you
control a domain, you will not be able to search for breached email addresses
on it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Upon signing up:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Welcome to the Have I Been Pwned domain search&lt;/p&gt;
&lt;p&gt;You (or possibly someone else), just began the process to access the domain
search dashboard using the email address &lt;code&gt;{email}&lt;/code&gt;. Just to confirm
that you&amp;rsquo;re a real person behind a real email address, click on the link below
which will take you to the dashboard (the link will remain valid for 60
minutes).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Then you can choose a way to verify your domain:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;with a pre-defined address like &lt;code&gt;security@&lt;/code&gt; or &lt;code&gt;webmaster@&lt;/code&gt; or &lt;code&gt;postmaster@&lt;/code&gt;
or &lt;code&gt;hostmaster@&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;with a DNS TXT record&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When following the first route:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An email containing a verification token has been sent off to the address you
chose, just copy and paste it into the text box below and you&amp;rsquo;ll be able to
perform the domain search right after that.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I was already familiar with the individual service, but only now discovered the
domain service, at work, by happenstance.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Have I Been Pwned?"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/privacy/"&gt;#privacy&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>Quick and dirty random password generator</title><link>https://perrotta.dev/2025/01/quick-and-dirty-random-password-generator/</link><pubDate>Thu, 09 Jan 2025 16:41:15 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>privacy</category><category>security</category><guid>https://perrotta.dev/2025/01/quick-and-dirty-random-password-generator/</guid><description>&lt;p&gt;On Linux / macOS, use &lt;code&gt;/dev/urandom&lt;/code&gt;, with a &lt;code&gt;tr&lt;/code&gt; pass-through filter:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% tr -dc &lt;span style="color:#e6db74"&gt;&amp;#39;A-Za-z0-9&amp;#39;&lt;/span&gt; &amp;lt; /dev/urandom | head -c &lt;span style="color:#ae81ff"&gt;20&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; echo
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;BLH1gVgdukdmTcvopOuC&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;In the example above only alphanumeric characters are allowed.&lt;/p&gt;
&lt;p&gt;There are other popular ways to do so:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dice (&lt;a href="https://diceware.dmuth.org/"&gt;Douglas Muth&lt;/a&gt;,
&lt;a href="https://www.eff.org/dice"&gt;EFF&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pwgen.sourceforge.net/"&gt;&lt;code&gt;pwgen&lt;/code&gt;&lt;/a&gt; (via &lt;code&gt;brew home pwgen&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Quick and dirty random password generator"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/privacy/"&gt;#privacy&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>nginx: add basic auth</title><link>https://perrotta.dev/2025/01/nginx-add-basic-auth/</link><pubDate>Tue, 07 Jan 2025 03:28:02 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2025/01/nginx-add-basic-auth/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: You want to expose a HTTPS service from your cloud VPS to
the public Internet. You do not wish to use a VPN (e.g.
&lt;a href="https://tailscale.com/"&gt;tailscale&lt;/a&gt;) to do so ‚Äì which is a great way to address
this, but it&amp;rsquo;s out of scope in this particular instance. How to proceed?&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a simple yet effective way: use / configure &lt;a href="https://nginx.org/"&gt;nginx&lt;/a&gt;
as a reverse proxy.&lt;/p&gt;
&lt;p&gt;Then add &lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication"&gt;HTTP basic
auth&lt;/a&gt; to it:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% doas htpasswd -c /etc/nginx/.htpasswd myuser&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The command will prompt for a password.&lt;/p&gt;
&lt;p&gt;Once it&amp;rsquo;s set, add two lines to the corresponding &lt;code&gt;server {}&lt;/code&gt; block in your
nginx config:&lt;/p&gt;

&lt;div class="codeblock" data-lang="nginxconf"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;nginxconf&lt;/span&gt;
 &lt;/div&gt;
 &lt;pre tabindex="0"&gt;&lt;code class="language-nginxconf" data-lang="nginxconf"&gt;server {
[...]
 auth_basic &amp;#34;Restricted Access&amp;#34;;
 auth_basic_user_file /etc/nginx/.htpasswd;
[...]
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;And finally: run &lt;code&gt;nginx -s reload&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now, whenever you navigate to that host, you&amp;rsquo;ll be prompted to enter the basic
HTTP auth creds above.&lt;/p&gt;
&lt;p&gt;The beauty of this approach is that it works for any HTTPS server, as it is
service agnostic.&lt;/p&gt;
&lt;p&gt;The next level would be to integrate an SSO solution such as
&lt;a href="https://goauthentik.io/"&gt;Authentik&lt;/a&gt;, however it&amp;rsquo;s quite more complex.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: nginx: add basic auth"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>Diceware passphrases</title><link>https://perrotta.dev/2024/09/diceware-passphrases/</link><pubDate>Mon, 09 Sep 2024 23:10:57 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2024/09/diceware-passphrases/</guid><description>&lt;p&gt;I wanted to create a new secure passphrase for my WLAN (Wi-Fi).&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s always an option to use the password generator built into my password
manager, however I wanted to take this opportunity to employ &lt;em&gt;Diceware&lt;/em&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Diceware Password Generator
Generate high-entropy passwords the easy way!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The original source has the best explanation: &lt;a href="https://diceware.dmuth.org/"&gt;https://diceware.dmuth.org/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Or you could read &lt;a href="https://en.wikipedia.org/wiki/Diceware"&gt;Wikipedia&lt;/a&gt; as well.&lt;/p&gt;
&lt;p&gt;For example, for this post:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ScratchObscureTrendHumiliate&lt;/p&gt;
&lt;p&gt;Number of possible passwords:
3 quadrillion&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Good (and memorable!) enough for me.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Diceware passphrases"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>Bcrypt-hash a password</title><link>https://perrotta.dev/2024/06/bcrypt-hash-a-password/</link><pubDate>Thu, 06 Jun 2024 13:35:05 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2024/06/bcrypt-hash-a-password/</guid><description>&lt;p&gt;Given the password &lt;code&gt;correct horse battery staple&lt;/code&gt;, we would like to bcrypt-hash
it.&lt;/p&gt;
&lt;figure&gt;&lt;a href="https://xkcd.com/936/"&gt;&lt;img src="https://imgs.xkcd.com/comics/password_strength.png"
 alt="Through 20 years of effort, we&amp;#39;ve successfully trained everyone to use passwords that are hard for humans to remember, but easy for computers to guess."&gt;&lt;/a&gt;&lt;figcaption&gt;
 &lt;p&gt;XKCD Courtesy of Randall Munroe&lt;/p&gt;
 &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Here&amp;rsquo;s one way to do so via the command line:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ htpasswd -nbBC &lt;span style="color:#ae81ff"&gt;10&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;correct horse battery staple&amp;#39;&lt;/span&gt; | tr -d &lt;span style="color:#e6db74"&gt;&amp;#39;:\n&amp;#39;&lt;/span&gt; | sed &lt;span style="color:#e6db74"&gt;&amp;#39;s/$2y/$2a/&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;which yields:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$2a$10$HKSHfLu4l7TvOmnLkhUngu2U1pJUUw7hEU0LE1iN84S09fJsZowHm&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;You could verify it matches e.g. via &lt;a href="https://bcrypt-generator.com/"&gt;https://bcrypt-generator.com/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Context&lt;/strong&gt;: &lt;a href="https://argo-cd.readthedocs.io/en/stable/"&gt;ArgoCD&lt;/a&gt; expects a
bcrypt-hashed password in its config file.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Bcrypt-hash a password"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>Pritunl log in via CLI</title><link>https://perrotta.dev/2024/05/pritunl-log-in-via-cli/</link><pubDate>Tue, 07 May 2024 16:03:27 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2024/05/pritunl-log-in-via-cli/</guid><description>&lt;p&gt;&lt;a href="https://pritunl.com/"&gt;Pritunl&lt;/a&gt; is an Enterprise Distributed OpenVPN server.&lt;/p&gt;
&lt;p&gt;In order to run its client on macOS, an &lt;code&gt;.app&lt;/code&gt; is provided. However, using it to
log in every day is quite tedious.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s automate it so that we can connect to the VPN with a single command.&lt;/p&gt;
&lt;p&gt;In order to fetch the credentials in this example in a secure manner, we&amp;rsquo;ll be
using 1password. &lt;a href="https://www.passwordstore.org/"&gt;&lt;code&gt;pass&lt;/code&gt;&lt;/a&gt; would have worked just
as fine.&lt;/p&gt;
&lt;p&gt;First, configure Pritunl via its app UI, creating a profile for your corp
credentials.&lt;/p&gt;
&lt;p&gt;Then figure out what the profile ID you just created is:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;profile_id&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;/Applications/Pritunl.app/Contents/Resources/pritunl-client list --json | jq -r &lt;span style="color:#e6db74"&gt;&amp;#39;.[0].id&amp;#39;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Now, create an entry in 1Password for your Pritunl credentials associated with
the profile above.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s use the &lt;code&gt;op&lt;/code&gt; official CLI tool from 1Password to fetch the password and
the OTP (one-time password) for the &amp;ldquo;Pritunl (VPN)&amp;rdquo; entry (change it
accordingly).&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;op_id&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;op item get &lt;span style="color:#e6db74"&gt;&amp;#39;Pritunl (VPN)&amp;#39;&lt;/span&gt; --format json | jq -r &lt;span style="color:#e6db74"&gt;&amp;#39;.id&amp;#39;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;password&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;op read &lt;span style="color:#e6db74"&gt;&amp;#34;op://private/&lt;/span&gt;$op_id&lt;span style="color:#e6db74"&gt;/password&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;otp&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;op item get &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$op_id&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; --totp&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Now we can use the &lt;code&gt;pritunl-client&lt;/code&gt; to log in programmatically:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pritunl-client start &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$profile_id&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; --password &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$password$otp&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Then verify it has indeed connected:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pritunl-client list&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The trick is that it accepts the concatenation of the password with the OTP as
the password. There&amp;rsquo;s not a separate &lt;code&gt;--otp&lt;/code&gt; flag.&lt;/p&gt;
&lt;p&gt;Putting everything together, we can create a function for our favorite shell:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Log into corp VPN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pritunl_login&lt;span style="color:#f92672"&gt;()&lt;/span&gt; &lt;span style="color:#f92672"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	local profile_id&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;/Applications/Pritunl.app/Contents/Resources/pritunl-client list --json | jq -r &lt;span style="color:#e6db74"&gt;&amp;#39;.[0].id&amp;#39;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	local op_id&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;op item get &lt;span style="color:#e6db74"&gt;&amp;#39;Pritunl (VPN)&amp;#39;&lt;/span&gt; --format json | jq -r &lt;span style="color:#e6db74"&gt;&amp;#39;.id&amp;#39;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	local password&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;op read &lt;span style="color:#e6db74"&gt;&amp;#34;op://private/&lt;/span&gt;$op_id&lt;span style="color:#e6db74"&gt;/password&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	local otp&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;op item get &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$op_id&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; --totp&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	pritunl-client start &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$profile_id&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; --password &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$password$otp&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;	pritunl-client list
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Pritunl log in via CLI"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>Be aware that your public SSH keys can reveal your identity</title><link>https://perrotta.dev/2024/05/be-aware-that-your-public-ssh-keys-can-reveal-your-identity/</link><pubDate>Fri, 03 May 2024 16:46:28 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>privacy</category><category>security</category><guid>https://perrotta.dev/2024/05/be-aware-that-your-public-ssh-keys-can-reveal-your-identity/</guid><description>&lt;p&gt;If you have a GitHub account configured with SSH, your public keys are available
at &lt;code&gt;https://github.com/$USERNAME.keys&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For example, mine: &lt;a href="https://github.com/thiagowfx.keys"&gt;https://github.com/thiagowfx.keys&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And then let&amp;rsquo;s say you also use your full name on GitHub.&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ssh whoami.filippo.io
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;The authenticity of host &amp;#39;whoami.filippo.io (2a09:8280:1::a:5d6)&amp;#39; can&amp;#39;t be established.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ED25519 key fingerprint is SHA256:qGAqPqtlvFBCt4LfMME3IgJqZWlcrlBMxNmGjhLVYzY.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;This key is not known by any other names.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Warning: Permanently added &amp;#39;whoami.filippo.io&amp;#39; (ED25519) to the list of known hosts.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; +---------------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | _o/ Hello Thiago Perrotta!
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | Did you know that ssh sends all your public keys to any server |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | it tries to authenticate to? |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | We matched them to the keys of your GitHub account, |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | @thiagowfx, which are available via the GraphQL API
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | and at https://github.com/thiagowfx.keys
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | -- Filippo (https://filippo.io) |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | P.S. The source of this server is at |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | https://github.com/FiloSottile/whoami.filippo.io |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; | |
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; +---------------------------------------------------------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Shared connection to whoami.filippo.io closed.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Then be careful when connecting to random public ssh servers when you have an
intent to be anonymous.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s possible to &amp;ldquo;hide&amp;rdquo; yourself by either setting the &lt;code&gt;IdentitiesOnly=yes&lt;/code&gt;
option, or by removing all your local ssh keys altogether, even if only
temporarily.&lt;/p&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Be aware that your public SSH keys can reveal your identity"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/privacy/"&gt;#privacy&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>HTTPS Everywhere: So long and thanks for all the fish</title><link>https://perrotta.dev/2022/03/https-everywhere-so-long-and-thanks-for-all-the-fish/</link><pubDate>Tue, 22 Mar 2022 01:09:13 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>privacy</category><category>security</category><guid>https://perrotta.dev/2022/03/https-everywhere-so-long-and-thanks-for-all-the-fish/</guid><description>&lt;p&gt;EFF&amp;rsquo;s&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2022/03/https-everywhere-so-long-and-thanks-for-all-the-fish/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; &lt;a href="https://chrome.google.com/webstore/detail/https-everywhere/gcbommkclmclpchllfjekcdonpmejbdp"&gt;HTTPS Everywhere&lt;/a&gt; is a browser extension available for all major browsers that automatically upgrades HTTP to HTTPS on supported websites.&lt;/p&gt;
&lt;p&gt;Other than adblocking, it&amp;rsquo;s one of the first extensions I add to a fresh browser installation.&lt;/p&gt;
&lt;p&gt;Today I learned it is apparently not needed anymore. Both Google Chrome and Firefox have settings these days to perform exactly the same functionality of the extension.&lt;/p&gt;
&lt;p&gt;In Google Chrome do: &lt;a href="https://perrotta.dev/2022/03/https-everywhere-so-long-and-thanks-for-all-the-fish/#ZgotmplZ"&gt;chrome://settings&lt;/a&gt; -&amp;gt; Security and Privacy -&amp;gt; Advanced -&amp;gt; Toggle &amp;lsquo;Always use secure connections&amp;rsquo; on.&lt;/p&gt;
&lt;p&gt;In Firefox the option is located on Settings -&amp;gt; Privacy &amp;amp; Security -&amp;gt; HTTPs only mode.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;EFF is a big proponent and advocate for a secure web, being one of the core responsible actors for &lt;a href="http://certbot.eff.org"&gt;certbot&lt;/a&gt; and &lt;a href="https://letsencrypt.org"&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt;.&amp;#160;&lt;a href="https://perrotta.dev/2022/03/https-everywhere-so-long-and-thanks-for-all-the-fish/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: HTTPS Everywhere: So long and thanks for all the fish"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/privacy/"&gt;#privacy&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>‚òÖ SSH plus tmux automatically</title><link>https://perrotta.dev/2022/02/ssh-plus-tmux-automatically/</link><pubDate>Sun, 13 Feb 2022 20:20:27 -0500</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>bestof</category><category>dev</category><category>security</category><guid>https://perrotta.dev/2022/02/ssh-plus-tmux-automatically/</guid><description>&lt;p&gt;One of the most classic sysadmin/DevOps tasks is to use secure shell to connect to remote machines.&lt;/p&gt;
&lt;p&gt;To persist those connections, a terminal multiplexer is often used, &lt;code&gt;tmux&lt;/code&gt; and &lt;code&gt;screen&lt;/code&gt; being the two most popular ones.&lt;/p&gt;
&lt;p&gt;In this post I will cover a few different client-side and server-side ways to have &lt;code&gt;ssh&lt;/code&gt; automatically spawn &lt;code&gt;tmux&lt;/code&gt; upon connection.&lt;/p&gt;
&lt;h2 id="option-1-use-command-line-ssh-flags-client-side-recommended"&gt;Option #1: Use command-line ssh flags (client-side, recommended)&lt;/h2&gt;
&lt;p&gt;Start &lt;code&gt;tmux&lt;/code&gt;, forcing unicode, attaching to and/or creating a session named &lt;em&gt;main&lt;/em&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ ssh user@host -t -- tmux -u new -A -s main&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;-u&lt;/code&gt; is not strictly necessary, however I experienced occasional weirdness when connecting to some machines and omitting it. Some unicode characters wouldn&amp;rsquo;t be properly rendered, like the horizontal and vertical lines used to render tmux pane splits. Even though most machines should work just fine these days by supporting UTF-8 out-of-the-box, it&amp;rsquo;s safer to always include &lt;code&gt;-u&lt;/code&gt; just in case.&lt;/p&gt;
&lt;p&gt;Tip: If it&amp;rsquo;s annoying to remember to type the full command above, consider adding an &lt;code&gt;alias&lt;/code&gt; in your shell config. Alternatively, use a ssh client that remembers your flags preferences such as the &lt;a href="https://chrome.google.com/webstore/detail/secure-shell/iodihamcpbpeioajjeobimgagajmlibd?hl=en"&gt;chrome secure shell&lt;/a&gt; extension.&lt;/p&gt;
&lt;h2 id="option-2-use-sshconfig-client-side"&gt;Option #2: Use &lt;code&gt;~/.ssh/config&lt;/code&gt; (client-side)&lt;/h2&gt;
&lt;p&gt;This option is very similar to the previous one, but the flags live in the ssh config rather then being specified at the command line:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ cat ~/.ssh/config
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Host *
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; RequestTTY yes
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; RemoteCommand tmux -u new -A -s main&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;You don&amp;rsquo;t need to match all hosts (&lt;code&gt;Host *&lt;/code&gt;), if you&amp;rsquo;d rather match one or more specific hosts, refer to the ssh config syntax &lt;code&gt;ssh_config(5)&lt;/code&gt; to add them. A simple example would be &lt;code&gt;Host mymachine.example.org&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Caveat&lt;/strong&gt;: I&amp;rsquo;ve found this method interferes with &lt;code&gt;git&lt;/code&gt; + &lt;code&gt;ssh&lt;/code&gt; authentication. More specifically:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ git remote -v
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;origin	git@github.com:thiagowfx/.dotfiles.git &lt;span style="color:#f92672"&gt;(&lt;/span&gt;fetch&lt;span style="color:#f92672"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;origin	git@github.com:thiagowfx/.dotfiles.git &lt;span style="color:#f92672"&gt;(&lt;/span&gt;push&lt;span style="color:#f92672"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ git push
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Cannot execute command-line and remote command.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fatal: Could not read from remote repository.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Please make sure you have the correct access rights
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;and the repository exists.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Therefore I discourage it, unless you only use it with specific hosts i.e. don&amp;rsquo;t use it with &lt;code&gt;Host *&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="option-3-use-bash_profile-or-similar-server-side-recommended"&gt;Option #3: Use &lt;code&gt;~/.bash_profile&lt;/code&gt; or similar (server-side, recommended)&lt;/h2&gt;
&lt;p&gt;This method leverages your login shell startup config file (&lt;code&gt;~/.bash_profile&lt;/code&gt;, &lt;code&gt;~/.zprofile&lt;/code&gt;, etc) to automatically spawn &lt;code&gt;tmux&lt;/code&gt;.&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# This file is invoked as part of my ~/.bash_profile.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ cat ~/.profile.d/tmux_auto_ssh.sh.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Automatically spawn tmux within ssh sessions for interactive terminals.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# https://stackoverflow.com/a/43819740/1745064&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# The session is called `main`.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Create a session with PREFIX :new, rename with PREFIX $, toggle with PREFIX s.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Escape hatch:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ssh &amp;lt;host&amp;gt; -t -- NOTMUX=1 &amp;lt;shell&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; -z &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$NOTMUX&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; -z &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$TMUX&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt; -n &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$SSH_TTY&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;]&lt;/span&gt; &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style="color:#f92672"&gt;[[&lt;/span&gt; $- &lt;span style="color:#f92672"&gt;=&lt;/span&gt;~ i &lt;span style="color:#f92672"&gt;]]&lt;/span&gt;; &lt;span style="color:#66d9ef"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; tmux -u new -A -s main
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; exit
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;fi&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;if&lt;/code&gt; basically checks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;whether we&amp;rsquo;re not already inside a tmux session (we shouldn&amp;rsquo;t be), so that we don&amp;rsquo;t nest &lt;code&gt;tmux&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;whether we&amp;rsquo;re accessing the shell via &lt;code&gt;ssh&lt;/code&gt; (we should be)&lt;/li&gt;
&lt;li&gt;whether we&amp;rsquo;re accessing an interactive shell (we should be), so that it doesn&amp;rsquo;t interfere with oneshot &lt;code&gt;ssh&lt;/code&gt; commands&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There&amp;rsquo;s also a escape hatch. If you want to get an interactive shell but bypass &lt;code&gt;tmux&lt;/code&gt; for some reason&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2022/02/ssh-plus-tmux-automatically/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;, just set &lt;code&gt;NOTMUX=1&lt;/code&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ ssh user@host -t -- NOTMUX&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt; bash&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="final-remarks"&gt;Final remarks&lt;/h2&gt;
&lt;p&gt;My favorite methods are #1 and #3, and whether I use one or the other depends whether I want to unconditionally spawn &lt;code&gt;tmux&lt;/code&gt; server-side, or selectively spawn &lt;code&gt;tmux&lt;/code&gt; client-side.&lt;/p&gt;
&lt;p&gt;When using chrome secure shell (hterm) I find #1 convenient because hterm remembers your &lt;code&gt;ssh&lt;/code&gt; host settings. That said, in scenarios where I fully control a host and it&amp;rsquo;s not solely used for production, #3 is my favorite as it works unconditionally regardless of the client terminal emulator I am using.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;For example, maybe if &lt;code&gt;tmux&lt;/code&gt; broke due to a recent upgrade, or if the &lt;code&gt;~/.tmux.conf&lt;/code&gt; is invalid.&amp;#160;&lt;a href="https://perrotta.dev/2022/02/ssh-plus-tmux-automatically/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: SSH plus tmux automatically"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/bestof/"&gt;#bestof&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>Throwaway (disposable) accounts for ephemeral use cases</title><link>https://perrotta.dev/2022/01/throwaway-disposable-accounts-for-ephemeral-use-cases/</link><pubDate>Wed, 26 Jan 2022 00:20:40 -0500</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>privacy</category><category>security</category><guid>https://perrotta.dev/2022/01/throwaway-disposable-accounts-for-ephemeral-use-cases/</guid><description>&lt;p&gt;A brief list of disposable / throwaway account resources:&lt;/p&gt;
&lt;h2 id="email-inbox"&gt;Email inbox&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;del&gt;&lt;a href="https://dispostable.com/"&gt;https://dispostable.com/&lt;/a&gt;&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://10minutemail.com/"&gt;https://10minutemail.com/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://yadim.dismail.de/"&gt;https://yadim.dismail.de/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.mailinator.com/"&gt;https://www.mailinator.com/&lt;/a&gt; (recommended by &lt;a href="https://haveibeenpwned.com/"&gt;HIBP&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="nat--public-urls"&gt;NAT / public URLs&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://ngrok.com/"&gt;https://ngrok.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Or search for &amp;ldquo;tunnelling&amp;rdquo;.&lt;/p&gt;
&lt;h2 id="pastebin"&gt;Pastebin&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://paste.debian.net/"&gt;https://paste.debian.net/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://paste.dismail.de/"&gt;https://paste.dismail.de/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://paste.opensuse.org/"&gt;https://paste.opensuse.org/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://upaste.de/"&gt;https://upaste.de/&lt;/a&gt; (produces short URLs, deleted after one hour)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="sms"&gt;SMS&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://smsreceivefree.com/"&gt;https://smsreceivefree.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="url-shortener"&gt;URL Shortener&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://phishyurl.com/"&gt;https://phishyurl.com/&lt;/a&gt; ‚Äì Create a phishy URL&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="appendix"&gt;Appendix&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.thenewoil.org/data-privacy-week-spotlight-backups-ngp6"&gt;The New Oil&lt;/a&gt; has some good tips on disinformation for throwaway and/or ephemeral accounts.&lt;/li&gt;
&lt;/ul&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Throwaway (disposable) accounts for ephemeral use cases"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/privacy/"&gt;#privacy&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item><item><title>Ufw: Firewall</title><link>https://perrotta.dev/2021/12/ufw-firewall/</link><pubDate>Tue, 28 Dec 2021 17:14:55 -0500</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><category>dev</category><category>security</category><guid>https://perrotta.dev/2021/12/ufw-firewall/</guid><description>&lt;blockquote&gt;
&lt;p&gt;Ufw stands for Uncomplicated Firewall, and is a program for managing a netfilter firewall. It provides a command line interface and aims to be uncomplicated and easy to use.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The firewall makes justice to its name as it is really uncomplicated, and a pleasure to set up.&lt;/p&gt;
&lt;h2 id="install"&gt;Install&lt;/h2&gt;
&lt;p&gt;Install and set up &lt;code&gt;ufw&lt;/code&gt;&lt;sup id="fnref:1"&gt;&lt;a href="https://perrotta.dev/2021/12/ufw-firewall/#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;, which should be packaged for most linux
distributions:&lt;/p&gt;
&lt;h3 id="openrc-based-alpine-linux-gentoo"&gt;OpenRC-based (Alpine Linux, Gentoo)&lt;/h3&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Install ufw and ufw-extras&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ doas apk install ufw&lt;span style="color:#f92672"&gt;{&lt;/span&gt;,-extras&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Enable ufw daemon&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ doas rc-update add ufw
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Start ufw daemon&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ doas rc-service ufw start
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Enable firewall&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ doas ufw enable&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="systemd-based-arch-linux-debian"&gt;Systemd-based (Arch Linux, Debian)&lt;/h3&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Install ufw and ufw-extras&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo pacman -Syu ufw&lt;span style="color:#f92672"&gt;{&lt;/span&gt;,-extras&lt;span style="color:#f92672"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Enable and start ufw daemon&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo systemctl enable --now ufw
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Enable firewall&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ sudo ufw enable&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="add-rules"&gt;Add rules&lt;/h2&gt;
&lt;p&gt;Firewall rules can be added with &lt;code&gt;ufw allow [port]&lt;/code&gt; or &lt;code&gt;ufw allow [name]&lt;/code&gt;.
Named profiles (for example: ssh, http) live in &lt;code&gt;/etc/ufw/applications.d/&lt;/code&gt;, or you can query all of them with &lt;code&gt;ufw app list&lt;/code&gt;.&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ufw app list
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Available applications:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; AIM
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Bonjour
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; CIFS
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; DNS
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Deluge
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; IMAP
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; IMAPS
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; IPP
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; KTorrent
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Kerberos Admin
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Kerberos Full
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Kerberos KDC
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Kerberos Password
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; LDAP
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; LDAPS
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; LPD
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; MSN
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; MSN SSL
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Mail submission
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; NFS
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; POP3
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; POP3S
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; PeopleNearby
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; SMTP
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; SSH
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Socks
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Telnet
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Transmission
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Transparent Proxy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; VNC
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; WWW
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; WWW Cache
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; WWW Full
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; WWW Secure
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; XMPP
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Yahoo
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; qBittorrent
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; svnserve&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Ufw also supports &lt;code&gt;ufw limit [port | name]&lt;/code&gt; which is like &lt;code&gt;add&lt;/code&gt; but with the
added ability to &amp;ldquo;deny connections from IP addresses that attempt to initiate
6 or more connections in the last 30 seconds&amp;rdquo;. It&amp;rsquo;s a good measure to mitigate brute-force and/or DDOS attacks.&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# either use named profiles&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ufw allow http-alt
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ufw limit ssh
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# or port numbers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ufw allow 8080/tcp
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ufw limit &lt;span style="color:#ae81ff"&gt;22&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="remove-rules"&gt;Remove rules&lt;/h2&gt;
&lt;p&gt;Firewall rules can be removed by merely adding &amp;lsquo;delete&amp;rsquo; between ufw and the verb.&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ufw delete allow 8080/tcp
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ufw delete limit ssh&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="check-status"&gt;Check status&lt;/h2&gt;
&lt;p&gt;One status command to rule them all, &amp;ldquo;verbose&amp;rdquo; is optional:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% ufw status verbose
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Status: active
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Logging: on &lt;span style="color:#f92672"&gt;(&lt;/span&gt;low&lt;span style="color:#f92672"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Default: deny &lt;span style="color:#f92672"&gt;(&lt;/span&gt;incoming&lt;span style="color:#f92672"&gt;)&lt;/span&gt;, allow &lt;span style="color:#f92672"&gt;(&lt;/span&gt;outgoing&lt;span style="color:#f92672"&gt;)&lt;/span&gt;, disabled &lt;span style="color:#f92672"&gt;(&lt;/span&gt;routed&lt;span style="color:#f92672"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;New profiles: skip
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;To Action From
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;-- ------ ----
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;22/tcp LIMIT IN Anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;8080&lt;/span&gt; ALLOW IN Anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;22/tcp &lt;span style="color:#f92672"&gt;(&lt;/span&gt;v6&lt;span style="color:#f92672"&gt;)&lt;/span&gt; LIMIT IN Anywhere &lt;span style="color:#f92672"&gt;(&lt;/span&gt;v6&lt;span style="color:#f92672"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;8080&lt;/span&gt; &lt;span style="color:#f92672"&gt;(&lt;/span&gt;v6&lt;span style="color:#f92672"&gt;)&lt;/span&gt; ALLOW IN Anywhere &lt;span style="color:#f92672"&gt;(&lt;/span&gt;v6&lt;span style="color:#f92672"&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Ufw uses iptables under the hood. Inspect the underlying iptables rules:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;% iptables -S | egrep &lt;span style="color:#e6db74"&gt;&amp;#39;\b(22|8080)\b&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;-A ufw-user-input -p tcp -m tcp --dport &lt;span style="color:#ae81ff"&gt;22&lt;/span&gt; -m conntrack --ctstate NEW -m recent --set --name DEFAULT --mask 255.255.255.255 --rsource
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;-A ufw-user-input -p tcp -m tcp --dport &lt;span style="color:#ae81ff"&gt;22&lt;/span&gt; -m conntrack --ctstate NEW -m recent --update --seconds &lt;span style="color:#ae81ff"&gt;30&lt;/span&gt; --hitcount &lt;span style="color:#ae81ff"&gt;6&lt;/span&gt; --name DEFAULT --mask 255.255.255.255 --rsource -j ufw-user-limit
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;-A ufw-user-input -p tcp -m tcp --dport &lt;span style="color:#ae81ff"&gt;22&lt;/span&gt; -j ufw-user-limit-accept
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;-A ufw-user-input -p tcp -m tcp --dport &lt;span style="color:#ae81ff"&gt;8080&lt;/span&gt; -j ACCEPT&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://help.ubuntu.com/community/UFW"&gt;https://help.ubuntu.com/community/UFW&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/title/Uncomplicated_Firewall"&gt;https://wiki.archlinux.org/title/Uncomplicated_Firewall&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;&lt;a href="https://github.com/xyproto/ufw-extras"&gt;&lt;code&gt;ufw-extras&lt;/code&gt;&lt;/a&gt; is optional, it contains additional rules (e.g. mosh, tailscale).&amp;#160;&lt;a href="https://perrotta.dev/2021/12/ufw-firewall/#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;p style="text-align: center; margin-top: 2em;"&gt;‚Äî ¬ß ‚Äî&lt;/p&gt;&lt;div style="display: flex; justify-content: space-between;"&gt;&lt;p style="margin: 0;"&gt;Reply via &lt;a href="mailto:serendipity@perrotta.dev?subject=Reply to: Ufw: Firewall"&gt;email&lt;/a&gt;&lt;/p&gt;&lt;p style="margin: 0;"&gt;&lt;a href="https://perrotta.dev/tags/dev/"&gt;#dev&lt;/a&gt; &lt;a href="https://perrotta.dev/tags/security/"&gt;#security&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</description></item></channel></rss>