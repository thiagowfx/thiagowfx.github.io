<?xml version="1.0" encoding="utf-8" standalone="yes"?><?xml-stylesheet type="text/xsl" href="https://perrotta.dev//rss.xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Selfhosted on ¬¨ just serendipity üçÄ</title><link>https://perrotta.dev/</link><description>Recent content in Selfhosted on ¬¨ just serendipity üçÄ</description><generator>Hugo</generator><language>en-us</language><managingEditor>serendipity@perrotta.dev (Thiago Perrotta)</managingEditor><webMaster>serendipity@perrotta.dev (Thiago Perrotta)</webMaster><copyright>¬© 2021 - 2025 Thiago Perrotta ¬∑
[some rights reserved](https://creativecommons.org/licenses/by-nc-sa/4.0/) ¬∑
a fork of [hugo  ï‚Ä¢·¥•‚Ä¢ î bear](https://github.com/janraasch/hugo-bearblog/)</copyright><lastBuildDate>Thu, 04 Dec 2025 22:40:00 -0300</lastBuildDate><atom:link href="https://perrotta.dev/tags/selfhosted/index.xml" rel="self" type="application/rss+xml"/><item><title>Canary</title><link>https://perrotta.dev/2025/11/canary/</link><pubDate>Mon, 24 Nov 2025 22:42:09 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/11/canary/</guid><description>&lt;p&gt;Inspired by &lt;a href="https://www.usecue.com/blog/warrant-canary-added/"&gt;Joost van der
Schee&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Warrant canary added&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;I have added a canary to the homepage. It is not just a pretty illustration,
it is a signal that is accompanied by a timestamp in the head, called a
warrant canary. I got the idea from &lt;a href="https://ecirtam.net/"&gt;this website&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;The warrant canary is the digital equivalent of the canary coal miners take
into the mine. As long as the canary is alive everything is okay. In this case
the timestamp is the equivalent of the last time somebody checked the canary&amp;rsquo;s
well-being. The canary implicitly inform visitors about being served with a
government subpoena (forcing the delivery of PII and meta data to the
government), despite legal prohibitions on revealing the existence of the
subpoena. It basically tells you that there has NOT been a court-issued
subpoena before the canary&amp;rsquo;s timestamp. The timestamp only updates when I
publish to this website. If I ever get a subpoena I will simply stop
publishing posts on this website. So‚Ä¶ with every new post you will know the
canary is still alive and our (and your) data has not been breached. Isn&amp;rsquo;t
that great news?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;I added the canary to be more transparent, but also (and more importantly) to
raise awareness of the growing digital surveillance worldwide.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://perrotta.dev/canary"&gt;Canary&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;üê§&lt;/p&gt;</description></item><item><title>Stow</title><link>https://perrotta.dev/2025/11/stow/</link><pubDate>Mon, 24 Nov 2025 02:17:08 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/11/stow/</guid><description>&lt;p&gt;For a long time I wanted to write a blog post about &lt;code&gt;stow&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;My procrastination has paid off: &lt;a href="https://pbrisbin.com/posts/stow/"&gt;pbrisbin&lt;/a&gt;
has written one first.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I recently migrated my dotfiles from rcm to GNU Stow. I didn&amp;rsquo;t really have a
reason, I wasn&amp;rsquo;t unhappy with rcm at all, but I saw Stow mentioned somewhere
and felt like trying it out. After migrating, I still don&amp;rsquo;t have strong
feelings ‚Äì both tools are appropriately good and boring ‚Äì but I can at least
now speak to the differences and maybe that would help someone out there
decide for their own dotfiles.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I am also a former user of
&lt;a href="https://thoughtbot.com/blog/rcm-for-rc-files-in-dotfiles-repos"&gt;rcm&lt;/a&gt;. I share
the same considerations as the author.&lt;/p&gt;
&lt;p&gt;I am quite happy with &lt;code&gt;stow&lt;/code&gt; as a dotfiles manager. Every once in a while I
attempt to integrate Ansible to manage the rest of my dotfiles setup, but it
never sticks. Simplicity always wins in the test of time.&lt;/p&gt;</description></item><item><title>Personal blogs are back</title><link>https://perrotta.dev/2025/11/personal-blogs-are-back/</link><pubDate>Sun, 23 Nov 2025 14:48:36 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/11/personal-blogs-are-back/</guid><description>&lt;p&gt;&lt;a href="https://disassociated.com/personal-blogs-back-niche-blogs-next/"&gt;Disassociated&lt;/a&gt; (&lt;a href="https://news.ycombinator.com/item?id=46009894"&gt;via&lt;/a&gt;):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Personal blogs are back, should niche blogs be next?&lt;/p&gt;
&lt;p&gt;A resurgence in personal blogging is the first step in rebuilding a vibrant,
thriving, web, or if you like, blogosphere. Now the focus needs to be on
restoring the flow of accessible and trusted information.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://news.ycombinator.com/item?id=46011877"&gt;Simon Willison&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Here are some reasons to start a personal blog:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;It&amp;rsquo;s a great way to learn. Teaching something to someone else has always
been the best learning tool, and writing about something with an audience
in mind is an effective way to capture some of that value.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It can be a big boost in job hunting. As a hiring manager two of the most
important questions I have about a potential candidate are: Can they code?
Can they communicate well? If a candidate has a blog with just two articles
on it that hasn&amp;rsquo;t been updated in five years that&amp;rsquo;s still a big boost over
candidates with nothing like that at all. In a competitive market that
could be the boost you need to make it from the resume review to the first
round.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If you blog more frequently than that it can be a really valuable resource
for your future self. I love being able to look back on what I was thinking
and writing about ten years ago. Having a good tagging system helps with
this too - I can review my tag of &amp;ldquo;scaling&amp;rdquo; or &amp;ldquo;postgresql&amp;rdquo; and see a
timeline of how my understanding developed.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It&amp;rsquo;s a great way to help establish credibility. If someone asks you about X
and you have a blog entry about X from five years ago you can point them to
that.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Building a blog is really fun! It used to be one of the classic starter
projects for new web developers, I think that needs to come back. It&amp;rsquo;s a
fun project and one that&amp;rsquo;s great to keep on hacking on long into the
future.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Notably none of the above reasons require your blog to attract readers!
There&amp;rsquo;s a ton of value to be had even if nobody actually reads the thing.&lt;/p&gt;
&lt;p&gt;As a general rule, assume nobody will read your blog unless you actively
encourage them to. That&amp;rsquo;s fine. What matters isn&amp;rsquo;t the quantity of readers,
it&amp;rsquo;s their quality. I&amp;rsquo;d rather have a piece read by just a single person that
leads to a new opportunity for me than 1,000 people who read it and never
interact with me ever again.&lt;/p&gt;
&lt;p&gt;If you DO start to get readers things get even more valuable. I&amp;rsquo;ve been
blogging since 2002 and most of the opportunities in my career came from
people I met via blogging. Today I get invited to all sorts of interesting
events because I have a prominent blog covering stuff relating to AI and LLMs.&lt;/p&gt;
&lt;p&gt;But I do honestly think that a blog is a powerful professional tool even if
nobody else is reading it at all.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I do not have anything to add, really. Simon has nailed it.&lt;/p&gt;</description></item><item><title>No adblocker detected</title><link>https://perrotta.dev/2025/11/no-adblocker-detected/</link><pubDate>Sun, 23 Nov 2025 00:23:26 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/11/no-adblocker-detected/</guid><description>&lt;p&gt;&lt;a href="https://maurycyz.com/misc/ads/"&gt;https://maurycyz.com/misc/ads/&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Internet ads are horrible: They waste your time, and the advertising industry
makes the internet a worse place. Payouts are so small that the only way to
survive is to turn your site into an ad filled hellhole with no real
substance.&lt;/p&gt;
&lt;p&gt;If you want to support your favorite authors: send them money. A dollar helps
more than viewing ads ever would.&lt;/p&gt;
&lt;p&gt;However, most people see advertising as a part of the internet experience, which is why I added this message to my site:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;No adblocker detected. Consider using an extension like uBlock Origin to
save time and bandwidth. Click here to close.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It&amp;rsquo;s shown off to the side, and never covers content. It won&amp;rsquo;t be shown if
there isn&amp;rsquo;t enough space. The close button actually works and it stays closed.&lt;/p&gt;
&lt;p&gt;The specific recommendation is important because a lot of people have only
heard of adblockers from ads. Commercial adblockers range from sketchy to
outright scams: If they are paying to be promoted, they must expect to make
money from users.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is a very cool activist idea.&lt;/p&gt;
&lt;p&gt;I prototyped it in this blog:&lt;/p&gt;
&lt;p&gt;&lt;img src="https://perrotta.dev/2025/11/no-adblocker-detected/ad.webp" alt="ad"&gt;&lt;/p&gt;
&lt;p&gt;However I would need to add a cookie in order to implement the close button
effectively, and I&amp;rsquo;d rather not do so.&lt;/p&gt;</description></item><item><title>Open the most recent blog post</title><link>https://perrotta.dev/2025/11/open-the-most-recent-blog-post/</link><pubDate>Fri, 21 Nov 2025 14:07:48 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/11/open-the-most-recent-blog-post/</guid><description>&lt;p&gt;Added a new &lt;a href="https://just.systems/"&gt;just&lt;/a&gt;
&lt;a href="https://just.systems/man/en/the-default-recipe.html"&gt;recipe&lt;/a&gt; to open the latest
(=most recent) blog post in &lt;code&gt;$EDITOR&lt;/code&gt;. Very handy to make quick edits!&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% GIT_PAGER=cat git show HEAD
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;commit 9fac587c257da57a9abb37e4ea1d7b2502ba51d2 (HEAD -&amp;gt; master, origin/master, origin/HEAD)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Author: Thiago Perrotta &amp;lt;{redacted}&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Date: Fri Nov 21 14:07:35 2025 -0300
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; just: add last
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;diff --git Justfile Justfile
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;index a6ba3d0b9..ba6268b98 100755
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;--- Justfile
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+++ Justfile
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;@@ -51,6 +51,18 @@ code title *args:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; alias coding := code
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+# Edit the most recent blog post
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+last:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+ #!/usr/bin/env bash
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+ set -euo pipefail
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+ latest=$(ls -t content/posts/*.md 2&amp;gt;/dev/null | head -n 1 || true)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+ if [ -z &amp;#34;$latest&amp;#34; ]; then
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+ echo &amp;#34;No posts found in content/posts/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+ exit 1
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+ fi
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+ {{ editor }} &amp;#34;$latest&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;+
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; # Delete hugo build artifacts
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; clean:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; rm -rf public/ resources/&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="https://man7.org/linux/man-pages/man1/ls.1.html"&gt;&lt;code&gt;ls -t&lt;/code&gt;&lt;/a&gt; sorts by time, newest
first.&lt;/p&gt;</description></item><item><title>Stress</title><link>https://perrotta.dev/2025/11/stress/</link><pubDate>Fri, 21 Nov 2025 14:02:14 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/11/stress/</guid><description>&lt;p&gt;Lately I&amp;rsquo;ve been running a lot of &lt;code&gt;terraform apply&lt;/code&gt; in &lt;strong&gt;PROD&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Goodness, this is so stressful.&lt;/p&gt;
&lt;p&gt;Even when your brain knows that the plan is safe to apply, your heart completely
ignores all rationality anyway.&lt;/p&gt;</description></item><item><title>new script: PDF remove password</title><link>https://perrotta.dev/2025/11/new-script-pdf-remove-password/</link><pubDate>Sun, 16 Nov 2025 20:19:18 -0300</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/11/new-script-pdf-remove-password/</guid><description>&lt;p&gt;&lt;a href="https://perrotta.dev/2025/11/new-script-copy/"&gt;Previously&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: Given a password-protected &lt;code&gt;.pdf&lt;/code&gt; file, remove its
password. It&amp;rsquo;s indifferent whether the file gets overwritten or whether a new
one is created.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://gist.github.com/pstaender/7412245"&gt;&lt;code&gt;ghostscript&lt;/code&gt;&lt;/a&gt; can do it:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;gs -q -dNOPAUSE -dBATCH -sDEVICE&lt;span class="o"&gt;=&lt;/span&gt;pdfwrite -sOutputFile&lt;span class="o"&gt;=&lt;/span&gt;output.pdf -c .setpdfwrite -f input.pdf&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="https://gist.github.com/raghur/f3eab7297691f2f411eec69b8032daf0"&gt;&lt;code&gt;qpdf&lt;/code&gt;&lt;/a&gt; can do it:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;qpdf --decrypt --password&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;{my pass}&amp;#34;&lt;/span&gt; input.pdf output.pdf&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;I am not expected to memorize these CLI flags.&lt;/p&gt;
&lt;p&gt;I do not want to look them up every time either.&lt;/p&gt;
&lt;p&gt;There are various approaches to tackle this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a shell alias (&lt;code&gt;alias foo=&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;a shell function &lt;code&gt;foo() {}&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;a shell script (&lt;code&gt;*.sh&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;a &lt;a href="https://perrotta.dev/2025/10/comma-scripts/"&gt;comma script&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;a copyable snippet (e.g. stored in Obsidian / LogSeq or some other digital
garden / personal wiki / second brain app)&lt;/li&gt;
&lt;li&gt;a snippet (e.g. in &lt;a href="https://perrotta.dev/2025/10/comma-scripts/"&gt;RayCast&lt;/a&gt; or
&lt;a href="https://perrotta.dev/2025/10/comma-scripts/"&gt;Espanso&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;ask the AI each time&lt;/li&gt;
&lt;li&gt;&lt;del&gt;google&lt;/del&gt; &lt;a href="https://perrotta.dev/2025/05/kagi/"&gt;search&lt;/a&gt; for it each time&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Lately I&amp;rsquo;ve been favouring the &lt;a href="https://perrotta.dev/2025/09/pancake-potpourri-scripts/"&gt;shell script&lt;/a&gt; approach, so &lt;a href="https://github.com/thiagowfx/pancake/tree/c7c3677119c567edc432fcc1f1c0f78c9a5b3c55/pdf_password_remove"&gt;here we go&lt;/a&gt; with &lt;code&gt;pdf_password_remove.sh&lt;/code&gt;:&lt;/p&gt;
&lt;h2 id="usage"&gt;Usage&lt;/h2&gt;
&lt;p&gt;Remove password protection from PDF files.&lt;/p&gt;

&lt;div class="codeblock" data-lang="bash"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;bash&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Interactive password prompt (most secure)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;pdf_password_remove secret.pdf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Process multiple files&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;pdf_password_remove report.pdf invoice.pdf contract.pdf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Provide password via command line&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;pdf_password_remove --password&lt;span class="o"&gt;=&lt;/span&gt;BANANA42SPLIT secret.pdf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Custom output filename (single file only)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;pdf_password_remove -o unlocked.pdf secret.pdf&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="example-output"&gt;Example Output&lt;/h2&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% pdf_password_remove --password=PIZZA69SLICE financial-report.pdf tax-form.pdf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚úì Successfully processed: financial-report.pdf ‚Üí financial-report-unlocked.pdf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚úì Successfully processed: tax-form.pdf ‚Üí tax-form-unlocked.pdf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Summary: Successfully processed 2/2 file(s)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="features"&gt;Features&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Process single or multiple PDF files in one command&lt;/li&gt;
&lt;li&gt;Secure interactive password prompt (hidden input)&lt;/li&gt;
&lt;li&gt;Command-line password option for automation/scripts&lt;/li&gt;
&lt;li&gt;Default output naming: adds &lt;code&gt;-unlocked&lt;/code&gt; suffix&lt;/li&gt;
&lt;li&gt;Custom output filename with &lt;code&gt;-o&lt;/code&gt; flag (single file only)&lt;/li&gt;
&lt;li&gt;Clear success/failure indicators for each file&lt;/li&gt;
&lt;li&gt;Validates PDF files before processing&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="prerequisites"&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;Requires either &lt;code&gt;ghostscript&lt;/code&gt; (preferred) or &lt;code&gt;qpdf&lt;/code&gt; to be installed:&lt;/p&gt;

&lt;div class="codeblock" data-lang="bash"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;bash&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# macOS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;brew install ghostscript &lt;span class="c1"&gt;# Preferred&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;brew install qpdf &lt;span class="c1"&gt;# Alternative&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Linux&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo apt install ghostscript &lt;span class="c1"&gt;# Preferred - Debian/Ubuntu&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo apt install qpdf &lt;span class="c1"&gt;# Alternative&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo dnf install ghostscript &lt;span class="c1"&gt;# Preferred - Fedora&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo dnf install qpdf &lt;span class="c1"&gt;# Alternative&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo pacman -S ghostscript &lt;span class="c1"&gt;# Preferred - Arch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo pacman -S qpdf &lt;span class="c1"&gt;# Alternative&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The script automatically detects and uses whichever tool is available,
preferring ghostscript if both are installed.&lt;/p&gt;
&lt;h2 id="security-note"&gt;Security Note&lt;/h2&gt;
&lt;p&gt;Using &lt;code&gt;--password&lt;/code&gt; on the command line will expose the password in shell history
and process lists. For sensitive documents, use the interactive prompt instead
(default behavior when password is not provided).&lt;/p&gt;</description></item><item><title>new script: copy</title><link>https://perrotta.dev/2025/11/new-script-copy/</link><pubDate>Tue, 04 Nov 2025 14:05:47 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/11/new-script-copy/</guid><description>&lt;p&gt;&lt;a href="https://perrotta.dev/2025/10/new-script-ssh-mux-restart/"&gt;Previously&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I decided to add a new &lt;code&gt;copy&lt;/code&gt; script to
&lt;a href="https://github.com/thiagowfx/pancake"&gt;&lt;code&gt;pancake&lt;/code&gt;&lt;/a&gt; to standardize copying command
output and files to the system clipboard in both macOS and Linux.&lt;/p&gt;
&lt;p&gt;The idea was originally inspired by &lt;a href="https://evanhahn.com/scripts-i-wrote-that-i-use-all-the-time/"&gt;Evan
Hahn&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;copy&lt;/code&gt; and &lt;code&gt;pasta&lt;/code&gt; are simple wrappers around system clipboard managers, like
&lt;code&gt;pbcopy&lt;/code&gt; on macOS and &lt;code&gt;xclip&lt;/code&gt; on Linux. I use these all the time.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://codeberg.org/EvanHahn/dotfiles/src/commit/843b9ee13d949d346a4a73ccee2a99351aed285b/home/bin/bin/copy"&gt;Evan&amp;rsquo;s version&lt;/a&gt; is concise and elegant.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/thiagowfx/pancake/blob/457441b3bc790068ff2618125da08de0effab016/copy/copy.sh"&gt;My version&lt;/a&gt; is more verbose, for the sake of consistency with the rest of my scripts in pancake.&lt;/p&gt;
&lt;h2 id="usage"&gt;Usage&lt;/h2&gt;

&lt;div class="codeblock" data-lang="bash"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;bash&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Copy from stdin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;BANANA42SPLIT88SUNDAE99CHERRY&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; copy
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Copy a file&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;copy notes.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Copy multiple files&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;copy *.md&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="platform-support"&gt;Platform Support&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;macOS&lt;/strong&gt;: Uses &lt;code&gt;pbcopy&lt;/code&gt; (built-in)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Linux&lt;/strong&gt;: Auto-detects first available tool:
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;wl-copy&lt;/code&gt; (Wayland) - prioritized for modern desktops&lt;/li&gt;
&lt;li&gt;&lt;code&gt;xclip&lt;/code&gt; (X11)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;xsel&lt;/code&gt; (X11)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="features"&gt;Features&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Silent on success (Unix philosophy)&lt;/li&gt;
&lt;li&gt;Supports stdin input&lt;/li&gt;
&lt;li&gt;Supports single or multiple files&lt;/li&gt;
&lt;li&gt;Multiple files are concatenated with newline separators&lt;/li&gt;
&lt;li&gt;Clear error messages for missing files or dependencies&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>brew: upgrade HEAD formulas</title><link>https://perrotta.dev/2025/10/brew-upgrade-head-formulas/</link><pubDate>Thu, 23 Oct 2025 12:53:11 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/10/brew-upgrade-head-formulas/</guid><description>&lt;p&gt;&lt;a href="https://perrotta.dev/2025/10/distributing-my-own-scripts-via-homebrew/"&gt;Previously&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When a package is installed with &lt;code&gt;--HEAD&lt;/code&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% brew install --HEAD pancake&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;&lt;code&gt;brew upgrade&lt;/code&gt; won&amp;rsquo;t automatically fetch its latest version.&lt;/p&gt;
&lt;p&gt;In order to do so, run:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% brew upgrade --fetch-HEAD &lt;span class="o"&gt;[&lt;/span&gt;package...&lt;span class="o"&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="https://apple.stackexchange.com/questions/439595/brew-head-update-behaviour"&gt;Source&lt;/a&gt;&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;I answered it there, does that count as linking to the source?&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>ArgoCD: git index.lock issue</title><link>https://perrotta.dev/2025/08/argocd-git-index.lock-issue/</link><pubDate>Sat, 23 Aug 2025 12:39:14 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/argocd-git-index.lock-issue/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: Every ArgoCD application is stuck in &lt;em&gt;Unknown&lt;/em&gt; state,
with the following error:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Failed to load target state: failed to generate manifest for source 1 of 2:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;rpc error: code = Unknown desc = failed to initialize repository resources: rpc
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;error: code = Internal desc = Failed to checkout FETCH_HEAD: failed to checkout
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;FETCH_HEAD: `git checkout --force FETCH_HEAD` failed exit status 128: fatal:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Unable to create &amp;#39;&amp;lt;path to cached source&amp;gt;/.git/index.lock&amp;#39;: File exists. Another
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git process seems to be running in this repository, e.g. an editor opened by
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&amp;#39;git commit&amp;#39;. Please make sure all processes are terminated then try again. If
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;it still fails, a git process may have crashed in this repository earlier:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;remove the file manually to continue.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;It is a lock contention race condition issue within the ArgoCD repo server
component, with the git &lt;code&gt;index.lock&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The easiest way to address it is to restart the repo server:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl rollout restart deploy -n argocd argocd-repo-server&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Afterwards, refresh all applications in the cluster via the web UI:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;click Applications on the left-side nav bar&lt;/li&gt;
&lt;li&gt;click Refresh apps at the top&lt;/li&gt;
&lt;li&gt;select ALL applications, set refresh type to NORMAL&lt;/li&gt;
&lt;li&gt;click refresh&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Kubernetes: list all ImagePullBackOff container images</title><link>https://perrotta.dev/2025/08/kubernetes-list-all-imagepullbackoff-container-images/</link><pubDate>Thu, 21 Aug 2025 13:34:27 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/kubernetes-list-all-imagepullbackoff-container-images/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt; Upgrade the
&lt;a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack"&gt;&lt;code&gt;kube-prometheus-stack&lt;/code&gt;&lt;/a&gt;
helm chart in &lt;a href="https://portal.azure.cn/"&gt;Azure China&lt;/a&gt; to the latest version.
&lt;em&gt;Side effect&lt;/em&gt;: Many container images are now missing from our internal
&lt;a href="https://azure.microsoft.com/en-us/products/container-registry"&gt;ACR&lt;/a&gt; (Azure
Container Registry). They need to be synced with &lt;a href="https://github.com/containers/skopeo"&gt;&lt;code&gt;skopeo&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Which images need to be synced? Use the command below, it is quite readable&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl get pods --all-namespaces -o json &lt;span class="p"&gt;|&lt;/span&gt; jq -r &lt;span class="s1"&gt;&amp;#39;.items[] | select(any(.status.containerStatuses[]; .state.waiting.reason == &amp;#34;ImagePullBackOff&amp;#34;)) | .metadata.namespace + &amp;#34;/&amp;#34; + .metadata.name + &amp;#34;\t&amp;#34; + ( [.status.containerStatuses[] | select(.state.waiting.reason == &amp;#34;ImagePullBackOff&amp;#34;).image] | join(&amp;#34;, &amp;#34;) )&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Sample run:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ubuntu@universe:~ $ kubectl get pods --all-namespaces -o json &lt;span class="p"&gt;|&lt;/span&gt; jq -r &lt;span class="s1"&gt;&amp;#39;.items[]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s1"&gt; | select(any(.status.containerStatuses[]; .state.waiting.reason == &amp;#34;ImagePullBackOff&amp;#34;))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s1"&gt; | .metadata.namespace + &amp;#34;/&amp;#34; + .metadata.name + &amp;#34;\t&amp;#34; +
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s1"&gt; ( [.status.containerStatuses[] | select(.state.waiting.reason == &amp;#34;ImagePullBackOff&amp;#34;).image] | join(&amp;#34;, &amp;#34;) )&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;monitoring/clustermon-kube-prometheus-operator-67c8b6c87c-w72km &lt;span class="o"&gt;{&lt;/span&gt;my-registry-name&lt;span class="o"&gt;}&lt;/span&gt;.azurecr.cn/quay.io/prometheus-operator/prometheus-operator:v0.83.0
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;monitoring/clustermon-prometheus-node-exporter-v7bpt &lt;span class="o"&gt;{&lt;/span&gt;my-registry-name&lt;span class="o"&gt;}&lt;/span&gt;.azurecr.cn/quay.io/prometheus/node-exporter:v1.9.1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;How to &lt;code&gt;skopeo&lt;/code&gt;? First, log in:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;#34;{password}&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; skopeo login &lt;span class="o"&gt;{&lt;/span&gt;my-registry-name&lt;span class="o"&gt;}&lt;/span&gt;.azurecr.cn --password-stdin --username &lt;span class="o"&gt;{&lt;/span&gt;my-username&lt;span class="o"&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;How do you get these credentials? Log in to the Azure China Portal, find the ACR
resource, navigate to Settings &amp;gt; Access keys.&lt;/p&gt;
&lt;p&gt;Then sync each image&lt;sup id="fnref:2"&gt;&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% skopeo sync &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; --override-os linux --override-arch amd64 &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; --src docker --dest docker &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; quay.io/prometheus/node-exporter:v1.9.1 &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;my-registry-name&lt;span class="o"&gt;}&lt;/span&gt;.azurecr.cn/quay.io/prometheus&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;I cannot promise I am able to craft this by hand without looking up man
pages or getting assistance from an LLM. &lt;em&gt;C&amp;rsquo;est la vie&lt;/em&gt;.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;If there are many images, consider using an
&lt;a href="https://www.gnu.org/software/bash/manual/html_node/Arrays.html"&gt;array&lt;/a&gt; +
&lt;code&gt;for&lt;/code&gt; loop.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>XSLT in RSS feed</title><link>https://perrotta.dev/2025/08/xslt-in-rss-feed/</link><pubDate>Wed, 20 Aug 2025 14:03:18 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/xslt-in-rss-feed/</guid><description>&lt;p&gt;&lt;a href="https://www.jwz.org/blog/2025/08/xslt/"&gt;There&amp;rsquo;s&lt;/a&gt;
&lt;a href="https://simonwillison.net/2025/Aug/19/xslt/#atom-everything"&gt;some&lt;/a&gt;
&lt;a href="https://www.osnews.com/story/143123/google-is-killing-the-open-web/"&gt;buzz&lt;/a&gt;
&lt;a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web/"&gt;around&lt;/a&gt;
&lt;a href="https://github.com/whatwg/html/issues/11523"&gt;XSLT&lt;/a&gt;
&lt;a href="https://www.jonmsterling.com/01DI/index.xml"&gt;recently&lt;/a&gt;&lt;a href="https://mastodon.social/@Edent/115048990801167629"&gt;.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I have my own &lt;a href="https://en.wikipedia.org/wiki/Embrace,_extend,_and_extinguish"&gt;opinion&lt;/a&gt; about the topic but I&amp;rsquo;m not here to discuss politics.&lt;/p&gt;
&lt;p&gt;I took the &lt;a href="https://en.wikipedia.org/wiki/Streisand_effect"&gt;opportunity&lt;/a&gt; to style my RSS feed.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://perrotta.dev/index.xml"&gt;result&lt;/a&gt;. Now it looks just like my blog!&lt;/p&gt;</description></item><item><title>ArgoCD: recovery when traefik is broken</title><link>https://perrotta.dev/2025/08/argocd-recovery-when-traefik-is-broken/</link><pubDate>Sat, 09 Aug 2025 15:24:53 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/argocd-recovery-when-traefik-is-broken/</guid><description>&lt;p&gt;It&amp;rsquo;s Friday. The best day to push to prod‚Ñ¢.
An internal scheduled upgrade for &lt;code&gt;traefik&lt;/code&gt; goes awry.
Internal services are no longer accessible.
HTTP requests won&amp;rsquo;t be properly routed.&lt;/p&gt;
&lt;p&gt;The most sensible SRE / DevOps will simply roll it back. Roll back first,
investigate later: it&amp;rsquo;s crucial to minimize downtime.&lt;/p&gt;
&lt;p&gt;How do we roll back?
We&amp;rsquo;re using GitOps, the most sensible approach is to make a new git commit by
submitting a pull request.
However, this is an emergency situation. Can we roll back faster?&lt;/p&gt;
&lt;p&gt;Sure, let&amp;rsquo;s make temporary changes directly in the cluster.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;traefik&lt;/code&gt; app is managed with ArgoCD. Let&amp;rsquo;s log in to the ArgoCD web UI and
roll back to the previous version.&lt;/p&gt;
&lt;p&gt;Oh, wait. We can&amp;rsquo;t. The ArgoCD web UI isn&amp;rsquo;t accessible, because traefik is
broken. &lt;em&gt;Sighs&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s use the ArgoCD CLI then.&lt;/p&gt;
&lt;p&gt;Aaaah, no. The ArgoCD CLI is really a REST client for the ArgoCD API. HTTP(S) is
not accessible, so the CLI won&amp;rsquo;t work either.&lt;/p&gt;
&lt;p&gt;What&amp;rsquo;s next? A plain &lt;code&gt;helm&lt;/code&gt; upgrade should work. But &lt;code&gt;helm&lt;/code&gt; is picky and will
refuse to touch manifests it doesn&amp;rsquo;t own. The manifests are managed by Argo.
&lt;code&gt;helm&lt;/code&gt; won&amp;rsquo;t budge. Oh gosh.&lt;/p&gt;
&lt;p&gt;Last option: the ArgoCD controllers are still running. We don&amp;rsquo;t need the ArgoCD
HTTPS API to communicate with them. Let&amp;rsquo;s simply edit the k8s manifests
directly.&lt;/p&gt;
&lt;p&gt;First we patch the root app (app-of-apps pattern):&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl edit app -n argocd root&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;We remove the &lt;code&gt;automated&lt;/code&gt; block, to effectively pause auto sync, otherwise our
subsequent changes to traefik would be immediately reverted:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;# automated:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;# prune: [..]
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;# selfHeal: [...]&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;You can comment or delete the &lt;code&gt;automated:&lt;/code&gt; block, either is fine.&lt;/p&gt;
&lt;p&gt;Next, we need to remove traefik from all application project (app project) sync
windows, so that changes to it will be immediately applied:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl edit appproject -n argocd cluster&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The traefik entry got removed from all sync windows.&lt;/p&gt;
&lt;p&gt;Now, finally, let&amp;rsquo;s instruct Argo to roll traefik back.&lt;/p&gt;
&lt;p&gt;The broken version is 2.5.1, the previous working version was 2.4.1.&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl edit app -n argocd traefik&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Update &lt;code&gt;targetRevision: 2.4.1&lt;/code&gt; under the &lt;code&gt;helm&lt;/code&gt; block.&lt;/p&gt;
&lt;p&gt;Wait a few seconds. Observe traefik pods as they are rolling restarted:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl get deploy -n kube-system traefik -w&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Finally, all services are once again accessible!&lt;/p&gt;
&lt;p&gt;From this point on, we can go back to &lt;code&gt;git&lt;/code&gt; and do a proper pull request revert
to reconcile the codebase with the live cluster state.&lt;/p&gt;
&lt;p&gt;This was an interesting exercise. I&amp;rsquo;m quite familiar with ArgoCD and GitOps at
this point, and I instinctively knew what to do in this situation, without
needing to consult the official documentation or even an LLM. I wouldn&amp;rsquo;t have
minded doing either of these if needed, but the point is that it feels good to
be well familiar with how a system works and how to apply your knowledge to fix
day-to-day problems.&lt;/p&gt;</description></item><item><title>terraform: bypass lock</title><link>https://perrotta.dev/2025/08/terraform-bypass-lock/</link><pubDate>Mon, 04 Aug 2025 11:49:16 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/terraform-bypass-lock/</guid><description>&lt;p&gt;Terraform supports &lt;a href="https://developer.hashicorp.com/terraform/language/state/locking"&gt;state
locking&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If supported by your backend, Terraform will lock your state for all
operations that could write state. This prevents others from acquiring the
lock and potentially corrupting your state.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Neat, right?&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% op run --env-file&lt;span class="o"&gt;=&lt;/span&gt;.env -- terraform plan
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚ï∑
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Error: Error acquiring the state lock
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Error message: operation error S3: PutObject, https response error
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ StatusCode: 412, RequestID: &lt;span class="o"&gt;{&lt;/span&gt;redacted&lt;span class="o"&gt;}&lt;/span&gt;, HostID:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ &lt;span class="o"&gt;{&lt;/span&gt;redacted&lt;span class="o"&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ api error PreconditionFailed: At least one of the pre-conditions you
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ specified did not hold
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Lock Info:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ ID: &lt;span class="o"&gt;{&lt;/span&gt;redacted&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Path: &lt;span class="o"&gt;{&lt;/span&gt;redacted&lt;span class="o"&gt;}&lt;/span&gt;/chartmuseum.tfstate
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Operation: OperationTypePlan
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Who: &lt;span class="o"&gt;{&lt;/span&gt;redacted&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Version: 1.10.5
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Created: 2025-08-04 09:46:55.995791 +0000 UTC
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Info:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Terraform acquires a state lock to protect the state from being written
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ by multiple users at the same time. Please resolve the issue above and try
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ again. For most commands, you can disable locking with the &lt;span class="s2"&gt;&amp;#34;-lock=false&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ flag, but this is not recommended.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;It even uses a custom &lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/412"&gt;HTTP
Status&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;The HTTP 412 Precondition Failed&lt;/strong&gt; &lt;em&gt;client error response status code&lt;/em&gt;
indicates that access to the target resource was denied. This happens with
conditional requests on methods other than GET or HEAD when the condition
defined by the If-Unmodified-Since or If-Match headers is not fulfilled. In
that case, the request (usually an upload or a modification of a resource)
cannot be made and this error response is sent back.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If you&amp;rsquo;re sure no one else is working on that workspace, you can proceed with
&lt;code&gt;-lock=false&lt;/code&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% op run --env-file&lt;span class="o"&gt;=&lt;/span&gt;.env -- terraform plan -lock&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;uptime_check_http.chartmuseum: Refreshing state... &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;chartmuseum&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;data.aws_availability_zones.available: Reading...
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;data.aws_availability_zones.available: Read &lt;span class="nb"&gt;complete&lt;/span&gt; after 1s &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;us-east-1&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;[&lt;/span&gt;...&lt;span class="o"&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;That&amp;rsquo;s an one-off. A subsequent run without that argument will fail again:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% op run --env-file&lt;span class="o"&gt;=&lt;/span&gt;.env -- terraform plan
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚ï∑
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îÇ Error: Error acquiring the state lock
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;[&lt;/span&gt;...&lt;span class="o"&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;In this case it would be better to simply remove the lock with
&lt;a href="https://developer.hashicorp.com/terraform/language/state/locking#force-unlock"&gt;&lt;code&gt;force-unlock&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% op run --env-file&lt;span class="o"&gt;=&lt;/span&gt;.env -- terraform force-unlock &lt;span class="o"&gt;{&lt;/span&gt;lock-id&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Do you really want to force-unlock?
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Terraform will remove the lock on the remote state.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; This will allow &lt;span class="nb"&gt;local&lt;/span&gt; Terraform commands to modify this state, even though it
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; may still be in use. Only &lt;span class="s1"&gt;&amp;#39;yes&amp;#39;&lt;/span&gt; will be accepted to confirm.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Enter a value: yes
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Terraform state has been successfully unlocked!
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;The state has been unlocked, and Terraform commands should now be able to
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;obtain a new lock on the remote state.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;lock-id&lt;/code&gt; can be obtained from the &lt;code&gt;plan&lt;/code&gt; output.&lt;/p&gt;
&lt;p&gt;Now we can &lt;code&gt;plan&lt;/code&gt; as usual:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% op run --env-file&lt;span class="o"&gt;=&lt;/span&gt;.env -- terraform plan
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;uptime_check_http.chartmuseum: Refreshing state... &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;chartmuseum&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;data.aws_availability_zones.available: Reading...
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;data.aws_availability_zones.available: Read &lt;span class="nb"&gt;complete&lt;/span&gt; after 0s &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;us-east-1&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;[&lt;/span&gt;...&lt;span class="o"&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>ArgoCD: all applications stuck on refresh</title><link>https://perrotta.dev/2025/08/argocd-all-applications-stuck-on-refresh/</link><pubDate>Fri, 01 Aug 2025 14:30:58 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/argocd-all-applications-stuck-on-refresh/</guid><description>&lt;p&gt;The problem is very likely the Application Controller.&lt;/p&gt;
&lt;p&gt;You can restart it:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl rollout restart sts -n argocd argocd-application-controller&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Or inspect its logs:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl logs -n argocd argocd-application-controller-0 --tail&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; less&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;While we&amp;rsquo;re here, make sure there is at least one replica running:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% kubectl get sts -n argocd argocd-application-controller
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;NAME READY AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;argocd-application-controller 1/1 415d&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="https://github.com/argoproj/argo-cd/issues/11831"&gt;Upstream issue&lt;/a&gt;.&lt;/p&gt;</description></item><item><title>Alpine Linux: remove broken packages</title><link>https://perrotta.dev/2025/07/alpine-linux-remove-broken-packages/</link><pubDate>Sun, 20 Jul 2025 10:52:11 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/alpine-linux-remove-broken-packages/</guid><description>&lt;p&gt;In a sunny Sunday morning:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas apk upgrade
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;WARNING: The indexes contain broken packages which might not &lt;span class="k"&gt;function&lt;/span&gt; properly.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;[&lt;/span&gt;...&lt;span class="o"&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;What?! Out of nowhere?&lt;/p&gt;
&lt;p&gt;I tried a couple of basic troubleshooting commands:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas apk update --force-refresh
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas apk fix
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas apk cache clean&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;to no avail.&lt;/p&gt;
&lt;p&gt;Next idea: search engines. Virtually no results on &lt;a href="https://kagi.com/"&gt;Kagi&lt;/a&gt;. No
relevant results on Google either&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;Next idea: LLMs. Nothing useful either.&lt;/p&gt;
&lt;p&gt;This is novel territory! That&amp;rsquo;s what makes it fun to self-host Alpine Linux&lt;sup id="fnref:2"&gt;&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;My intuition tells me to start by searching their
&lt;a href="https://gitlab.alpinelinux.org/alpine"&gt;Gitlab&lt;/a&gt;. Eventually I got linked to
&lt;a href="https://sourcegraph.com/github.com/alpinelinux/apk-tools/-/blob/test/solver/error11.test?L3-5"&gt;this&lt;/a&gt;:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;test/solver/error11.test:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;@ARGS add invalid
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;@REPO error.repo
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;@EXPECT
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;WARNING: The indexes contain broken packages which are not installable.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ERROR: unable to select packages:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; invalid-1:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; error: uninstallable
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; satisfies: world[invalid]&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;From this test file, it seems possible that there&amp;rsquo;s an invalid package in my
&lt;code&gt;/etc/apk/world&lt;/code&gt;. The error message is not quite the same, but it is similar:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% wc -l /etc/apk/world
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="m"&gt;293&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;There are too many packages there to hunt each of them by hand. And I didn&amp;rsquo;t
install any new packages recently.&lt;/p&gt;
&lt;p&gt;So I looked into &lt;code&gt;apk fix --help&lt;/code&gt; and discovered there is a &lt;code&gt;--verbose&lt;/code&gt; flag. I
did not save its output, but there were five packages there:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;- busybox-initscripts
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;- kmod-openrc
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;- libacl
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;- py3-pep517
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;- sensible-utils&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;I ran &lt;code&gt;doas apk del&lt;/code&gt; to remove all of them. That was a sensible cleanup, but it
still has not resolved the issue.&lt;/p&gt;
&lt;p&gt;If I want to dive deeper into this, I&amp;rsquo;ll have to add some debugging logging to
&lt;a href="https://sourcegraph.com/github.com/alpinelinux/apk-tools@bffc60041447cadee5b69c291df8c90eb3b8fe82/-/blob/src/database.c?L2090"&gt;&lt;code&gt;src/database.c&lt;/code&gt;&lt;/a&gt;
in &lt;code&gt;apk-tools&lt;/code&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="c"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;c&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;compat_depversions&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nf"&gt;apk_warn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;out&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s"&gt;&amp;#34;The indexes contain broken packages which %s.&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;compat_notinstallable&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;are not installable&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;might not function properly&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Then one last thought occurred to me:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% apk --version
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;apk-tools 3.0.0_rc5_git20250715-r0, compiled &lt;span class="k"&gt;for&lt;/span&gt; x86_64.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Aha! I am running a release candidate version of &lt;code&gt;apk&lt;/code&gt;, because I am using
Alpine Linux edge repositories:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% cat /etc/apk/repositories
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;http://dl-cdn.alpinelinux.org/alpine/edge/main
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;http://dl-cdn.alpinelinux.org/alpine/edge/community
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;http://dl-cdn.alpinelinux.org/alpine/edge/testing&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;From the
&lt;a href="https://wiki.alpinelinux.org/wiki/Draft_Release_Notes_for_Alpine_3.23.0"&gt;Wiki&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;After 5 years of development in the master branch of apk-tools, apk v3 is now
ready for Alpine v3.23.0. This should be a safe and seamless upgrade from apk
v2, but might has some breaking changes if you use libapk.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;No wonder this is bleeding edge territory!&lt;/p&gt;
&lt;p&gt;I would say that there&amp;rsquo;s nothing to do here, other than waiting for the next
release of Alpine Linux (3.23) with apk-tools v3, and ignoring the warning in
the meantime.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Their AI overview insists on spitting out useless information about
Ubuntu, which is completely unrelated in this case.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;It is &lt;em&gt;fun&lt;/em&gt;. Right? Right?!&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>pq: could not access file "$libdir/dict_snowball": No such file or directory</title><link>https://perrotta.dev/2025/07/pq-could-not-access-file-libdir/dict_snowball-no-such-file-or-directory/</link><pubDate>Thu, 10 Jul 2025 11:14:29 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/pq-could-not-access-file-libdir/dict_snowball-no-such-file-or-directory/</guid><description>&lt;p&gt;My &lt;a href="http://miniflux.app/"&gt;miniflux&lt;/a&gt; instance broke yesterday. All feeds had the
following error:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;3 errors - Database error: store: unable to update entry &amp;#34;{redacted}&amp;#34;: pq: could not access file &amp;#34;$libdir/dict_snowball&amp;#34;: No such file or directory.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The error is from PostgreSQL (&lt;code&gt;pq&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;I recall I did a full system upgrade yesterday (&lt;code&gt;doas apk upgrade&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Upon checking the logs in &lt;code&gt;/var/log/apk.log&lt;/code&gt;&amp;hellip;&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Running `apk upgrade --no-self-upgrade` at 2025-07-09 13:57:09
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;apk-tools 3.0.0_rc5_git20250613-r0, compiled for x86_64.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;( 1/60) Purging postgresql-zsh-completion (5.9-r5)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;( 2/60) Purging postgresql17-contrib (17.5-r2)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;( 3/60) Purging postgresql17-openrc (17.5-r2)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;( 4/60) Purging postgresql17 (17.5-r2)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: Executing script...
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: *
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: * You are uninstalling your default PostgreSQL version (17) which seems to be
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: * in use! If it&amp;#39;s *not* intentional and you want to preserve this version,
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: * install it explicitly: `apk add postgresql17`.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: *
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: * Please note that to upgrade your cluster to a new major version using
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: * pg_upgrade(1), you must have both the old and new versions installed.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r2.pre-deinstall: *
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ERROR: postgresql17-17.5-r2.pre-deinstall: exited with error 1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;For whatever reason (!?), the &lt;code&gt;postgresql17*&lt;/code&gt; packages were removed.&lt;/p&gt;
&lt;p&gt;The fix is straightforward:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas apk add postgresql17
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas service miniflux restart&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Why did it break in the first place?!&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s nothing suspicious on &lt;code&gt;postgresql17&lt;/code&gt; in the
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/commits/master/main/postgresql17"&gt;aports&lt;/a&gt;
repo ü§∑&lt;/p&gt;
&lt;p&gt;What is &lt;code&gt;dict_snowball&lt;/code&gt;?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;dict_snowball&lt;/code&gt; is a PostgreSQL text search dictionary module that uses the
Snowball stemming algorithms for full-text search.&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>ArgoCD: deployment spec.selector: field is immutable</title><link>https://perrotta.dev/2025/06/argocd-deployment-spec.selector-field-is-immutable/</link><pubDate>Mon, 30 Jun 2025 13:04:51 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-deployment-spec.selector-field-is-immutable/</guid><description>&lt;p&gt;When using &lt;a href="https://argo-cd.readthedocs.io/en/stable/"&gt;ArgoCD&lt;/a&gt; to manage an app,
the Deployment manifest needs to undergo significant changes, updating its
selector labels. When trying to sync the argocd app, we get the following error:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;one or more objects failed to apply, reason: error when patching &amp;#34;/dev/shm/3469418025&amp;#34;: Deployment.apps &amp;#34;myapp&amp;#34; is invalid: spec.selector: Invalid value: v1.LabelSelector{MatchLabels:v1.LabelSelectorRequirement(nil)}: field is immutable. Retrying attempt #2 at 11:02AM.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This error doesn&amp;rsquo;t come directly from Argo, it is from &lt;code&gt;kubectl apply&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There are two ways to address it:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Sync the argo app with the
&lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#force-sync"&gt;&amp;ldquo;force&amp;rdquo;&lt;/a&gt;
option enabled&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Run &lt;code&gt;kubectl apply&lt;/code&gt; with &lt;code&gt;--force&lt;/code&gt; (which is ultimately what the
aforementioned option maps to).&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In action (&lt;code&gt;-w&lt;/code&gt; is short for &lt;code&gt;--watch&lt;/code&gt;):&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% kubectl get endpoints -w
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;NAME ENDPOINTS AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;myapp &amp;lt;none&amp;gt; 5y44d
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;myapp 5y44d
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;myapp 10.1.13.40:8080 5y44d&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>Kindle Paperwhite: KOReader: calibre sync</title><link>https://perrotta.dev/2025/06/kindle-paperwhite-koreader-calibre-sync/</link><pubDate>Sun, 15 Jun 2025 03:49:24 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/kindle-paperwhite-koreader-calibre-sync/</guid><description>&lt;p&gt;One of the best reasons to &lt;a href="https://perrotta.dev/2025/05/winterbreak-hello-world/"&gt;jailbreak&lt;/a&gt; a Kindle is to leverage wireless
&lt;a href="https://calibre-ebook.com/"&gt;Calibre&lt;/a&gt; sync via &lt;a href="http://koreader.rocks/"&gt;KOReader&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Instructions:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;from Calibre&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Click Connect/share&lt;/li&gt;
&lt;li&gt;Start wireless device connection&lt;/li&gt;
&lt;li&gt;Set &amp;ldquo;Optional fixed port&amp;rdquo; to 9090 and check off &amp;lsquo;Use a fixed port&amp;rsquo;&lt;/li&gt;
&lt;li&gt;Confirm&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;from KOReader&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Click Settings &amp;gt; Calibre &amp;gt; Wireless Settings
&lt;ul&gt;
&lt;li&gt;Check off &amp;lsquo;Enable wireless client&amp;rsquo;&lt;/li&gt;
&lt;li&gt;Set inbox folder &amp;gt; &lt;code&gt;/mnt/us/documents&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Server address &amp;gt; Add the IP address + port&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; of the calibre server (visible in the calibre UI)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Click Settings &amp;gt; Calibre &amp;gt; Connect&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;At this point, the Calibre UI should change, recognizing the KOReader client.&lt;/p&gt;
&lt;p&gt;From there, it is trivial to send books from the Calibre library to KOReader.
Select the desired books and then click &amp;lsquo;Send to device&amp;rsquo;.&lt;/p&gt;
&lt;p&gt;Stefan Svartling has a great &lt;a href="https://www.youtube.com/watch?v=AQHbOTEJAak"&gt;video
tutorial&lt;/a&gt; about this.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;There&amp;rsquo;s an &amp;ldquo;automatic&amp;rdquo; mode, however it did not work for me.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>Kindle Paperwhite: add custom fonts</title><link>https://perrotta.dev/2025/06/kindle-paperwhite-add-custom-fonts/</link><pubDate>Sun, 15 Jun 2025 02:14:41 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/kindle-paperwhite-add-custom-fonts/</guid><description>&lt;p&gt;First step, download the font you&amp;rsquo;re interested in. In this example, I used
&lt;a href="https://fonts.google.com/specimen/Literata"&gt;Literata&lt;/a&gt;&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;The download will be a &lt;code&gt;.zip&lt;/code&gt; file. Extract it.&lt;/p&gt;
&lt;p&gt;You&amp;rsquo;re looking for &lt;code&gt;.ttf&lt;/code&gt; or &lt;code&gt;.otf&lt;/code&gt; files. I take note of the following font
files in the archive:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-Italic-VariableFont_opsz,wght.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-VariableFont_opsz,wght.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-Black.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-BlackItalic.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-Bold.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-BoldItalic.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-ExtraBold.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-ExtraBoldItalic.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-ExtraLight.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-ExtraLightItalic.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-Italic.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-Light.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-LightItalic.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-Medium.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-MediumItalic.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-Regular.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-SemiBold.ttf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Literata-SemiBoldItalic.ttf&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Second, connect the Kindle to your laptop with a USB cable&lt;sup id="fnref:2"&gt;&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;When using a macbook, you&amp;rsquo;ll need a USB &amp;lt;-&amp;gt; USB-C adapter / dongle.&lt;/p&gt;
&lt;p&gt;Open the mounted directory. There should be a top-level &lt;code&gt;fonts/&lt;/code&gt; directory
within it. Dump all the aforementioned font files there.&lt;/p&gt;
&lt;p&gt;Eject the device.&lt;/p&gt;
&lt;p&gt;Open a book. Select the added font. &lt;del&gt;Profit!&lt;/del&gt; Enjoy your pleasant read!&lt;/p&gt;
&lt;p&gt;An interesting note: the added font has properly showed up in
&lt;a href="http://koreader.rocks/"&gt;KOReader&lt;/a&gt;, but not in the native Kindle Paperwhite
reader. Another reason &lt;a href="https://perrotta.dev/2025/05/winterbreak-hello-world/"&gt;to jailbreak&lt;/a&gt;?&lt;/p&gt;
&lt;h2 id="appendix"&gt;Appendix&lt;/h2&gt;
&lt;p&gt;A verbatim&lt;sup id="fnref:3"&gt;&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref"&gt;3&lt;/a&gt;&lt;/sup&gt; excerpt from the stock &lt;code&gt;Readme.txt&lt;/code&gt; within &lt;code&gt;fonts/&lt;/code&gt;:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;You can now install your favorite fonts on your Kindle and choose one of them to read your eBooks.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Any font you install must be either an OpenType (OTF) or a TrueType (TTF) font. All other font formats are unsupported. Also, fonts are usually available as a font family and may consist of several files for different font styles - one each for Regular, Italic, Bold, BoldItalic, etc. For the best reading experience, we recommend you install all the files in the font family. Supported font files will have .ttf, .otf, or .ttc file extensions.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;How to install fonts on your Kindle:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;1. If the font is packaged into a compressed file (such as a ZIP file), uncompress the files using your favorite file extracting program
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;2. Copy the font files into the &amp;#34;fonts&amp;#34; folder on your Kindle
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;3. Disconnect your Kindle from the computer
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;4. You can now choose a custom font in addition to the Kindle fonts from the Display Settings (Aa) menu
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Once you choose a custom font from the Display Settings (Aa) menu, your Kindle will render the book content using that font for most books. If the font is not able to be used for rendering the book&amp;#39;s content, your Kindle will use the default system font instead. This can happen if the font does not support the characters in the book or if the font is damaged.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Amazon respects the intellectual property of others. You are responsible for ensuring you have obtained the necessary rights and permissions to use any fonts you upload to your Kindle. By using the font upload functionality on Kindle, you agree that your use of the fonts you upload will not infringe or violate the rights of any third party, and that you will indemnify Amazon for all claims resulting from your use of the fonts you upload.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;For further help, please visit: http://amzn.to/2F2DhMK&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Got this suggestion via &lt;a href="https://www.reddit.com/r/kobo/comments/1ijpu75/whats_your_favorite_font/"&gt;Reddit&lt;/a&gt;.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;The first two cables I connected did not work. Only the third one did.
Aren&amp;rsquo;t all USB cables supposed to be fungible and equivalent? Huh.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:3"&gt;
&lt;p&gt;Some blank lines were deleted, the rest is exactly as is.&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>ArgoCD: every application in unknown state</title><link>https://perrotta.dev/2025/06/argocd-every-application-in-unknown-state/</link><pubDate>Fri, 13 Jun 2025 22:34:33 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-every-application-in-unknown-state/</guid><description>&lt;p&gt;&lt;strong&gt;Symptom&lt;/strong&gt;: Every single application in the Kubernetes cluster that is managed
by Argo is in &lt;code&gt;Unknown&lt;/code&gt; sync status. A disaster! üò±&lt;/p&gt;
&lt;p&gt;This has only happened in one of our clusters. More specifically, in an
&lt;a href="https://learn.microsoft.com/en-us/azure/aks/core-aks-concepts"&gt;AKS&lt;/a&gt; cluster
(from Microsoft Azure).&lt;/p&gt;
&lt;p&gt;An observed effect:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% kubectl get --raw&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/openapi/v2&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; head -c &lt;span class="m"&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Error from server &lt;span class="o"&gt;(&lt;/span&gt;ServiceUnavailable&lt;span class="o"&gt;)&lt;/span&gt;: the server is currently unable to handle the request&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Aha! The Kubernetes OpenAPI server is not responding properly.
That explains why Argo is having so much trouble to figure out the state of affairs in
the cluster.&lt;/p&gt;
&lt;p&gt;It was quite difficult to troubleshoot this issue. There are barely any
resources about it in the open web. We filed an Azure Support ticket, but it was
completely useless. They offered to restart&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; the OpenAPI server, but that
didn&amp;rsquo;t help (of course it wouldn&amp;rsquo;t!).&lt;/p&gt;
&lt;p&gt;Because this is a managed Kubernetes cluster, we have limited access to it,
which includes lack of access to raw logs. The Azure portal doesn&amp;rsquo;t make it easy
but, after digging quite deep into it, eventually we found this error message in
the logs:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; {&amp;#34;pod&amp;#34;:&amp;#34;kube-apiserver-7785d59f4f-scqmp&amp;#34;,&amp;#34;stream&amp;#34;:&amp;#34;stderr&amp;#34;,&amp;#34;containerID&amp;#34;:&amp;#34;925345f6501626aa6cd40dd187d5cf57837389eec9cb39b2292fb9ae3f66242f&amp;#34;,&amp;#34;log&amp;#34;:&amp;#34;E0512 12:01:36.876768 1 handler.go:160] Error in OpenAPI handler: failed to build merge specs: unable to merge: duplicated path \/apis\/reports.kyverno.io\/v1\/clusterephemeralreports\n&amp;#34;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;That was the first clue! Now we know it&amp;rsquo;s related to
&lt;a href="https://kyverno.io/"&gt;Kyverno&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;That error eventually led us to
&lt;a href="https://github.com/kubernetes/kubernetes/issues/122668#issuecomment-2531243040"&gt;this&lt;/a&gt;
issue in Kubernetes:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We have the same issue here, actually also triggered by installing the kyverno
reports-server with both apiservices (different groups served by the same
api-server).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Aha!&lt;/p&gt;
&lt;p&gt;Deleting the duplicate CRDs installed by &lt;a href="https://github.com/kyverno/reports-server"&gt;kyverno reports
server&lt;/a&gt; has immediately resolved the
OpenAPI server unresponsiveness. It wasn&amp;rsquo;t even necessary to restart it:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% kubectl delete crd ephemeralreports.reports.kyverno.io clusterephemeralreports.reports.kyverno.io clusterpolicyreports.wgpolicyk8s.io policyreports.wgpolicyk8s.io
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;customresourcedefinition.apiextensions.k8s.io &lt;span class="s2"&gt;&amp;#34;ephemeralreports.reports.kyverno.io&amp;#34;&lt;/span&gt; deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;customresourcedefinition.apiextensions.k8s.io &lt;span class="s2"&gt;&amp;#34;clusterephemeralreports.reports.kyverno.io&amp;#34;&lt;/span&gt; deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;customresourcedefinition.apiextensions.k8s.io &lt;span class="s2"&gt;&amp;#34;clusterpolicyreports.wgpolicyk8s.io&amp;#34;&lt;/span&gt; deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;customresourcedefinition.apiextensions.k8s.io &lt;span class="s2"&gt;&amp;#34;policyreports.wgpolicyk8s.io&amp;#34;&lt;/span&gt; deleted&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;And now:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;$ kubectl get --raw&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/openapi/v2&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; head -c &lt;span class="m"&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;swagger&amp;#34;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;#34;2.0&amp;#34;&lt;/span&gt;,&lt;span class="s2"&gt;&amp;#34;info&amp;#34;&lt;/span&gt;:&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;#34;Kubernetes&amp;#34;&lt;/span&gt;,&lt;span class="s2"&gt;&amp;#34;version&amp;#34;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;#34;v1.30.11&amp;#34;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;,&lt;span class="s2"&gt;&amp;#34;paths&amp;#34;&lt;/span&gt;:&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;/.well-known/openid-configuration/&amp;#34;&lt;/span&gt;:&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;get&amp;#34;&lt;/span&gt;:&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;description&amp;#34;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;#34;get service account issuer OpenID configuration, also known as&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;That was a tricky one! Interestingly: it has only occurred in AKS.
&lt;a href="https://aws.amazon.com/eks/"&gt;EKS&lt;/a&gt; was fine.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;&lt;a href="https://en.wikiquote.org/wiki/The_IT_Crowd"&gt;Hello, IT. Have you tried turning it off and on
again?&lt;/a&gt;.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>ArgoCD: custom health check for StatefulSet (OnDelete)</title><link>https://perrotta.dev/2025/06/argocd-custom-health-check-for-statefulset-ondelete/</link><pubDate>Fri, 13 Jun 2025 21:40:01 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-custom-health-check-for-statefulset-ondelete/</guid><description>&lt;p&gt;It turns out the
&lt;a href="https://github.com/argoproj/gitops-engine/blob/master/pkg/health/health_statefulset.go"&gt;built-in&lt;/a&gt;
health check for
&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/"&gt;StatefulSets&lt;/a&gt;
in ArgoCD is not comprehensive enough.&lt;/p&gt;
&lt;p&gt;It covers
&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#update-strategies"&gt;&lt;code&gt;RollingUpdate&lt;/code&gt;&lt;/a&gt;
well enough, but &lt;code&gt;OnDelete&lt;/code&gt; is incomplete.&lt;/p&gt;
&lt;p&gt;More specifically:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Observed&lt;/strong&gt;: whenever you push an update to an STS whose &lt;code&gt;.spec.updateStrategy&lt;/code&gt;
is &lt;code&gt;OnDelete&lt;/code&gt;, its health status stays as &lt;code&gt;Healthy&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Expected&lt;/strong&gt;: there should be an indication that the STS pods are not
up-to-date, and hence need to be restarted to incorporate the latest changes.&lt;/p&gt;
&lt;p&gt;There is &lt;a href="https://github.com/argoproj/argo-cd/issues/6527"&gt;an open bug&lt;/a&gt;:
&lt;code&gt;Statefulset healthcheck does not work #6527&lt;/code&gt; for it.&lt;/p&gt;
&lt;p&gt;I managed to work around it by defining my own health check. This is an use case
where Gen AI is helpful, though it does not shine. I could not have Gen AI
produce a fully working health check for this scenario. Instead, I used it to
bootstrap a basic example, then had to tweak it until it worked. This has been
tested multiple times, I am reasonably confident it works well (some edge cases
could be missing though).&lt;/p&gt;

&lt;div class="codeblock" data-lang="lua"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;lua&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-lua" data-lang="lua"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;health_status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;obj.status&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Progressing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Waiting for status to be reported&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;health_status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;strategy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj.spec&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;updateStrategy&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;obj.spec&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;updateStrategy.type&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;RollingUpdate&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;spec_replicas&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj.spec&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replicas&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;ready_replicas&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj.status&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readyReplicas&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;updated_replicas&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj.status&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;updatedReplicas&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;status_replicas&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj.status&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replicas&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;current_revision&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj.status&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;currentRevision&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;update_revision&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj.status&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;updateRevision&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;strategy&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;OnDelete&amp;#34;&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ready_replicas&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;status_replicas&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;updated_replicas&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;spec_replicas&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Healthy&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;All replicas are ready and updated (OnDelete strategy)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;elseif&lt;/span&gt; &lt;span class="n"&gt;updated_replicas&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Degraded&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;No replicas have been updated (OnDelete strategy): 0/&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;spec_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34; updated. Still running an old revision!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Progressing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Progressing (OnDelete): &amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;ready_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;status_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34; ready, &amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;updated_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;spec_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34; updated&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ready_replicas&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;status_replicas&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;updated_replicas&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;spec_replicas&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;current_revision&lt;/span&gt; &lt;span class="o"&gt;~=&lt;/span&gt; &lt;span class="n"&gt;update_revision&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Progressing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Waiting for rollout to complete: revision mismatch (&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;current_revision&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34; ‚â† &amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;update_revision&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Healthy&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;All replicas updated, ready, and revisions match&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Progressing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;health_status.message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;RollingUpdate progressing: &amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;ready_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;status_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34; ready, &amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;updated_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;spec_replicas&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34; updated&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;health_status&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;It is necessary to distinguish between &lt;code&gt;OnDelete&lt;/code&gt; and &lt;code&gt;RollingUpdate&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;OnDelete&lt;/code&gt; should not use &lt;code&gt;currentRevision&lt;/code&gt; / &lt;code&gt;update_revision&lt;/code&gt;, as these values
don&amp;rsquo;t mean anything for that update strategy. This can be observed
&lt;a href="https://github.com/argoproj/gitops-engine/blob/f8f1b61ba3fd5fcb647563db3106977e1364de31/pkg/health/health_statefulset.go#L63"&gt;upstream&lt;/a&gt;
as well.&lt;/p&gt;
&lt;p&gt;It is easy to write / tweak the health check when you look at the live STS
resource / manifest in the cluster. &lt;code&gt;obj&lt;/code&gt; refers to the STS manifest (&lt;code&gt;kubectl get sts -o yaml&lt;/code&gt;). The most relevant field is &lt;code&gt;status:&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;If you deploy ArgoCD via its helm chart, add that check for &lt;code&gt;argocd-cm&lt;/code&gt;. The
&lt;code&gt;values.yaml&lt;/code&gt; file:&lt;/p&gt;

&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;argo-cd&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;configs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cm&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;resource.customizations.health.apps_StatefulSet&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="sd"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; health_status = {}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; [...]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This custom health check was partly inspired by a Prometheus alert we have:&lt;/p&gt;

&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;StatefulSetUpdateNotRolledOut&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;expr&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;max without (revision) (kube_statefulset_status_current_revision unless kube_statefulset_status_update_revision) * (kube_statefulset_replicas != kube_statefulset_status_replicas_updated)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;How long will it take until LLMs &lt;del&gt;steal&lt;/del&gt; adopt this novel solution from me?&lt;/p&gt;</description></item><item><title>ArgoCD: application stuck in unknown</title><link>https://perrotta.dev/2025/06/argocd-application-stuck-in-unknown/</link><pubDate>Thu, 12 Jun 2025 11:51:32 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-application-stuck-in-unknown/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: An application in ArgoCD that was previously running
smoothly has suddenly started to fail. Its status has changed to &amp;ldquo;Unknown&amp;rdquo;.
The &amp;ldquo;Refresh&amp;rdquo; button is grayed out in the Argo web UI.&lt;/p&gt;
&lt;p&gt;I found the following works in this scenario, which is typically a transient
issue:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;restart the argo server&lt;/li&gt;
&lt;li&gt;restart the argo repo server&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In terms of commands:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% kubectl rollout restart deployment argocd-server -n argocd
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% kubectl rollout restart deployment argocd-repo-server -n argocd&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>ArgoCD: upgrade to v3, remove helm labels</title><link>https://perrotta.dev/2025/06/argocd-upgrade-to-v3-remove-helm-labels/</link><pubDate>Mon, 02 Jun 2025 13:03:24 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-upgrade-to-v3-remove-helm-labels/</guid><description>&lt;p&gt;I am leading the effort to upgrade ArgoCD to its &lt;a href="https://blog.argoproj.io/announcing-argo-cd-v3-small-but-mighty-df05c0b39ad6"&gt;newest major version
(v3)&lt;/a&gt;
across our fleet.&lt;/p&gt;
&lt;p&gt;One of its &lt;a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/upgrading/2.14-3.0/"&gt;breaking
changes&lt;/a&gt;
is the removal of helm labels from argo applications, like such:&lt;/p&gt;

&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c"&gt;# [...]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app.kubernetes.io/managed-by&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Helm&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Applying a normal sync does not get rid of the label.&lt;/p&gt;
&lt;p&gt;I found out that doing an one-off &lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#server-side-apply"&gt;server-side apply
sync&lt;/a&gt;
addresses the label removal, and it is safe to do (incurs no downtime):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;However, there are some cases where you want to use &lt;code&gt;kubectl apply --server-side&lt;/code&gt; over &lt;code&gt;kubectl apply&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;[&amp;hellip;]&lt;/p&gt;
&lt;p&gt;Patching of existing resources on the cluster that are not fully managed by
Argo CD.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There&amp;rsquo;s no need to make the server-side apply a permanent config, i.e.:&lt;/p&gt;

&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;argoproj.io/v1alpha1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Application&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;syncPolicy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;syncOptions&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;ServerSideApply=true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;though there&amp;rsquo;s no harm either in doing so.&lt;/p&gt;</description></item><item><title>PDB: minAvailable and maxUnavailable cannot be both set</title><link>https://perrotta.dev/2025/06/pdb-minavailable-and-maxunavailable-cannot-be-both-set/</link><pubDate>Mon, 02 Jun 2025 12:00:05 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/pdb-minavailable-and-maxunavailable-cannot-be-both-set/</guid><description>&lt;p&gt;In Kubernetes it&amp;rsquo;s not possible to have a &lt;a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/"&gt;&lt;code&gt;PodDisruptionBudget&lt;/code&gt;
(PDB)&lt;/a&gt; with
both &lt;code&gt;minAvailable&lt;/code&gt; and &lt;code&gt;maxUnavailable&lt;/code&gt; set simultaneously:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;one or more objects failed to apply, reason: PodDisruptionBudget.policy &amp;#34;pgbouncer-pgbouncer&amp;#34; is invalid: spec: Invalid value: policy.PodDisruptionBudgetSpec{MinAvailable:(*intstr.IntOrString)(0xc02c03dd20), Selector:(*v1.LabelSelector)(0xc02c03dd40), MaxUnavailable:(*intstr.IntOrString)(0xc02c03dd60), UnhealthyPodEvictionPolicy:(*policy.UnhealthyPodEvictionPolicyType)(nil)}: minAvailable and maxUnavailable cannot be both set (retried 5 times).&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Our manifests did not violate this rule though. Then where did the error message
come from?&lt;/p&gt;
&lt;p&gt;It turns out &lt;a href="https://argo-cd.readthedocs.io/en/stable/"&gt;ArgoCD&lt;/a&gt; was creating an
intermediate state containing both properties:&lt;/p&gt;

&lt;div class="codeblock" data-lang="yaml"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;yaml&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# [...]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;minAvailable&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;maxUnavailable&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c"&gt;# [...]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;One solution is to sync the underlying application PDB manifest with
&lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#replace-resource-instead-of-applying-changes"&gt;replace&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Warning&lt;/strong&gt;: It&amp;rsquo;s better to &amp;ldquo;sync with replace&amp;rdquo; &lt;strong&gt;only&lt;/strong&gt; the PDB. Do not do it
in the entire application.&lt;/p&gt;</description></item><item><title>pre-commit: add hugo build</title><link>https://perrotta.dev/2025/05/pre-commit-add-hugo-build/</link><pubDate>Sat, 24 May 2025 17:29:48 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/pre-commit-add-hugo-build/</guid><description>&lt;p&gt;Sometimes I make changes to this blog that yield build errors with its static
site generator (&lt;a href="https://gohugo.io/"&gt;hugo&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s trivial to spot these changes with a simple &lt;code&gt;hugo build&lt;/code&gt;, but &lt;a href="https://perrotta.dev/2025/03/yolo-debug-only-after-push/"&gt;I don&amp;rsquo;t always
run it&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s what a typical error looks like:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% hugo build
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Start building sites ‚Ä¶
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo v0.147.5+extended+withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ERROR [en] REF_NOT_FOUND: Ref &amp;#34;nonexistent/2025-03-24-maccy-pin-items&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-16-espanso-hello-world.md:10:14&amp;#34;: page not found
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Total in 242 ms
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Error: error building site: logged 1 error(s)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The same happens when invoking &lt;a href="https://just.systems/man/en/"&gt;&lt;code&gt;just&lt;/code&gt;&lt;/a&gt;, as you
would expect:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% just build
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo --environment production --gc --minify
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Start building sites ‚Ä¶
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo v0.147.5+extended+withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ERROR [en] REF_NOT_FOUND: Ref &amp;#34;nonexistent/2025-03-24-maccy-pin-items&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-16-espanso-hello-world.md:10:14&amp;#34;: page not found
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Total in 280 ms
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Error: error building site: logged 1 error(s)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;error: Recipe `build` failed on line 17 with exit code 1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: catch such build errors at git pre-commit time.&lt;/p&gt;
&lt;p&gt;This is trivial with a &lt;a href="https://pre-commit.com/"&gt;pre-commit.com&lt;/a&gt; hook:&lt;/p&gt;

&lt;div class="codeblock" data-lang="diff"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;diff&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-diff" data-lang="diff"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Author: Thiago Perrotta &amp;lt;{email redacted}&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Date: Sat May 24 17:26:59 2025 +0200
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; pre-commit: add just build
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gh"&gt;diff --git .pre-commit-config.yaml .pre-commit-config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gh"&gt;index 60eb2022..623e135d 100644
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gh"&gt;&lt;/span&gt;&lt;span class="gd"&gt;--- .pre-commit-config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gd"&gt;&lt;/span&gt;&lt;span class="gi"&gt;+++ .pre-commit-config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gi"&gt;&lt;/span&gt;&lt;span class="gu"&gt;@@ -112,5 +112,10 @@ repos:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gu"&gt;&lt;/span&gt; language: pygrep
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; types:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; - markdown
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gi"&gt;+ - id: hugo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gi"&gt;+ name: Hugo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gi"&gt;+ language: system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gi"&gt;+ entry: just build
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="gi"&gt;+ pass_filenames: false
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Here&amp;rsquo;s the end result:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% git commit -m &lt;span class="s2"&gt;&amp;#34;test&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Check hooks apply to the repository.............................................&lt;span class="o"&gt;(&lt;/span&gt;no files to check&lt;span class="o"&gt;)&lt;/span&gt;Skipped
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Check &lt;span class="k"&gt;for&lt;/span&gt; useless excludes......................................................&lt;span class="o"&gt;(&lt;/span&gt;no files to check&lt;span class="o"&gt;)&lt;/span&gt;Skipped
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;[&lt;/span&gt;...&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Forbid usage of UTM analytics / tracking............................................................Passed
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Hugo................................................................................................Failed
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;- hook id: hugo
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;- &lt;span class="nb"&gt;exit&lt;/span&gt; code: &lt;span class="m"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo --environment production --gc --minify
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Start building sites ‚Ä¶
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo v0.147.5+extended+withdeploy darwin/arm64 &lt;span class="nv"&gt;BuildDate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;2025-05-22T11:37:19Z &lt;span class="nv"&gt;VendorInfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;brew
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ERROR &lt;span class="o"&gt;[&lt;/span&gt;en&lt;span class="o"&gt;]&lt;/span&gt; REF_NOT_FOUND: Ref &lt;span class="s2"&gt;&amp;#34;a/2024-12-23-unbuffer&amp;#34;&lt;/span&gt;: &lt;span class="s2"&gt;&amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-24-watch-with-color.md:54:54&amp;#34;&lt;/span&gt;: page not found
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Total in &lt;span class="m"&gt;276&lt;/span&gt; ms
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Error: error building site: logged &lt;span class="m"&gt;1&lt;/span&gt; error&lt;span class="o"&gt;(&lt;/span&gt;s&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;error: Recipe &lt;span class="sb"&gt;`&lt;/span&gt;build&lt;span class="sb"&gt;`&lt;/span&gt; failed on line &lt;span class="m"&gt;19&lt;/span&gt; with &lt;span class="nb"&gt;exit&lt;/span&gt; code &lt;span class="m"&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>PostgreSQL major version upgrade on Alpine Linux</title><link>https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/</link><pubDate>Sat, 24 May 2025 16:00:23 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/</guid><description>&lt;h2 id="problem-statement"&gt;Problem statement&lt;/h2&gt;
&lt;p&gt;Given Alpine Linux 3.22 running PostgreSQL 16, upgrade to PostgreSQL 17. For
this specific example, consider a &lt;a href="https://miniflux.app/"&gt;&lt;code&gt;miniflux&lt;/code&gt;&lt;/a&gt; database.&lt;/p&gt;
&lt;h2 id="procedure"&gt;Procedure&lt;/h2&gt;
&lt;p&gt;Install PostgreSQL 17:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas apk add postgres&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;It can coexist with &lt;code&gt;postgres16&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Stop the PostgreSQL daemon:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas service postgresql stop&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;If you navigate to the Miniflux server with your browser, it will fail, as
expected:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;store: unable to create app session: dial tcp [::1]:5432: connect: connection refused&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Change the PostgreSQL system version to the desired one:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas pg_versions set-default &lt;span class="m"&gt;17&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Change to the root user, for convenience, then change to the existing postgresql
directory:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas su
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% &lt;span class="nb"&gt;cd&lt;/span&gt; /var/lib/postgresql/&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Prepare files and directories for the upgrade:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% &lt;span class="nb"&gt;cd&lt;/span&gt; 16/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% mv data olddata
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% &lt;span class="nb"&gt;cd&lt;/span&gt; ../
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% mkdir 17/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% &lt;span class="nb"&gt;cd&lt;/span&gt; 17/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% mkdir data tmp
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% chown postgres:postgres data tmp&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Change to the &lt;code&gt;postgres&lt;/code&gt; user:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% su postgres
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% &lt;span class="nb"&gt;cd&lt;/span&gt; tmp/&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Initialize the new cluster:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% initdb -D /var/lib/postgresql/17/data --locale&lt;span class="o"&gt;=&lt;/span&gt;en_US.UTF-8 --encoding&lt;span class="o"&gt;=&lt;/span&gt;UTF8 &lt;span class="o"&gt;[&lt;/span&gt;--data-checksums&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;The files belonging to this database system will be owned by user &lt;span class="s2"&gt;&amp;#34;postgres&amp;#34;&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;This user must also own the server process.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;The database cluster will be initialized with locale &lt;span class="s2"&gt;&amp;#34;en_US.UTF-8&amp;#34;&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;The default text search configuration will be &lt;span class="nb"&gt;set&lt;/span&gt; to &lt;span class="s2"&gt;&amp;#34;english&amp;#34;&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Data page checksums are disabled.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;fixing permissions on existing directory /var/lib/postgresql/17/data ... ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;creating subdirectories ... ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;selecting dynamic shared memory implementation ... posix
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;selecting default &lt;span class="s2"&gt;&amp;#34;max_connections&amp;#34;&lt;/span&gt; ... &lt;span class="m"&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;selecting default &lt;span class="s2"&gt;&amp;#34;shared_buffers&amp;#34;&lt;/span&gt; ... 128MB
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;selecting default &lt;span class="nb"&gt;time&lt;/span&gt; zone ... America/Toronto
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;creating configuration files ... ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;running bootstrap script ... ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;performing post-bootstrap initialization ... ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;syncing data to disk ... ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;initdb: warning: enabling &lt;span class="s2"&gt;&amp;#34;trust&amp;#34;&lt;/span&gt; authentication &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;local&lt;/span&gt; connections
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next &lt;span class="nb"&gt;time&lt;/span&gt; you run initdb.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Success.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;In the previous command I chose to omit &lt;code&gt;--data-checksums&lt;/code&gt;, otherwise I get the
following error:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;old cluster does not use data checksums but the new one does
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Failure, exiting&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Upgrade the new cluster:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% pg_upgrade -b /usr/libexec/postgresql16/ -B /usr/libexec/postgresql17/ -d /var/lib/postgresql/16/olddata/ -D /var/lib/postgresql/17/data/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Performing Consistency Checks
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;-----------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking cluster versions ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking database user is the install user ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking database connection settings ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking &lt;span class="k"&gt;for&lt;/span&gt; prepared transactions ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking &lt;span class="k"&gt;for&lt;/span&gt; contrib/isn with bigint-passing mismatch ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking data &lt;span class="nb"&gt;type&lt;/span&gt; usage ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Creating dump of global objects ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Creating dump of database schemas
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking &lt;span class="k"&gt;for&lt;/span&gt; presence of required libraries ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking database user is the install user ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking &lt;span class="k"&gt;for&lt;/span&gt; prepared transactions ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking &lt;span class="k"&gt;for&lt;/span&gt; new cluster tablespace directories ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;If pg_upgrade fails after this point, you must re-initdb the
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;new cluster before continuing.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Performing Upgrade
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Setting locale and encoding &lt;span class="k"&gt;for&lt;/span&gt; new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Analyzing all rows in the new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Freezing all rows in the new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Deleting files from new pg_xact ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Copying old pg_xact to new server ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Setting oldest XID &lt;span class="k"&gt;for&lt;/span&gt; new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Setting next transaction ID and epoch &lt;span class="k"&gt;for&lt;/span&gt; new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Deleting files from new pg_multixact/offsets ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Copying old pg_multixact/offsets to new server ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Deleting files from new pg_multixact/members ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Copying old pg_multixact/members to new server ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Setting next multixact ID and offset &lt;span class="k"&gt;for&lt;/span&gt; new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Resetting WAL archives ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Setting frozenxid and minmxid counters in new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Restoring global objects in the new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Restoring database schemas in the new cluster
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Copying user relation files
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Setting next OID &lt;span class="k"&gt;for&lt;/span&gt; new cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Sync data directory to disk ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Creating script to delete old cluster ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Checking &lt;span class="k"&gt;for&lt;/span&gt; extension updates ok
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Upgrade Complete
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;----------------
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Optimizer statistics are not transferred by pg_upgrade.
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Once you start the new server, consider running:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; /usr/libexec/postgresql17/vacuumdb --all --analyze-in-stages
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Running this script will delete the old cluster&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;s data files:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; ./delete_old_cluster.sh&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Now clean up:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% ^D &lt;span class="c1"&gt;# go back to the root user&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% /var/lib/postgresql/17/tmp/delete_old_cluster.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% rmdir /var/lib/postgresql/16/ &lt;span class="c1"&gt;# it should be empty by now&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;If you&amp;rsquo;re curious about this script, it&amp;rsquo;s a simple one-liner:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;rm -rf &lt;span class="s1"&gt;&amp;#39;/var/lib/postgresql/16/olddata&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Finally, let&amp;rsquo;s get the cluster back up and vacuum it:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% ^D &lt;span class="c1"&gt;# go back to your main user&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas service postgresql start
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas su - postgres -c &lt;span class="s1"&gt;&amp;#39;/usr/libexec/postgresql17/vacuumdb --all --analyze-in-stages&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;miniflux&amp;#34;&lt;/span&gt;: Generating minimal optimizer statistics &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; target&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;postgres&amp;#34;&lt;/span&gt;: Generating minimal optimizer statistics &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; target&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;template1&amp;#34;&lt;/span&gt;: Generating minimal optimizer statistics &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; target&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;miniflux&amp;#34;&lt;/span&gt;: Generating medium optimizer statistics &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt; targets&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;postgres&amp;#34;&lt;/span&gt;: Generating medium optimizer statistics &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt; targets&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;template1&amp;#34;&lt;/span&gt;: Generating medium optimizer statistics &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt; targets&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;miniflux&amp;#34;&lt;/span&gt;: Generating default &lt;span class="o"&gt;(&lt;/span&gt;full&lt;span class="o"&gt;)&lt;/span&gt; optimizer statistics
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;postgres&amp;#34;&lt;/span&gt;: Generating default &lt;span class="o"&gt;(&lt;/span&gt;full&lt;span class="o"&gt;)&lt;/span&gt; optimizer statistics
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;vacuumdb: processing database &lt;span class="s2"&gt;&amp;#34;template1&amp;#34;&lt;/span&gt;: Generating default &lt;span class="o"&gt;(&lt;/span&gt;full&lt;span class="o"&gt;)&lt;/span&gt; optimizer statistics&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;At this point, Miniflux should be working again.
Navigate to &lt;code&gt;/about&lt;/code&gt; and verify its database version: &lt;code&gt;Postgres version: 17.5&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Last step, delete the previous package:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% doas apk del postgresql16 postgres16-contrib&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Double-check the newer version is still installed:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% apk list -I &lt;span class="p"&gt;|&lt;/span&gt; grep postgres
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;libpq-17.5-r0 x86_64 &lt;span class="o"&gt;{&lt;/span&gt;postgresql17&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;PostgreSQL&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;installed&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql-common-1.2-r1 x86_64 &lt;span class="o"&gt;{&lt;/span&gt;postgresql-common&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;MIT&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;installed&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql-common-openrc-1.2-r1 x86_64 &lt;span class="o"&gt;{&lt;/span&gt;postgresql-common&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;MIT&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;installed&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql-zsh-completion-5.9-r5 x86_64 &lt;span class="o"&gt;{&lt;/span&gt;zsh&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;MIT-Modern-Variant AND GPL-2.0-only&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;installed&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-17.5-r0 x86_64 &lt;span class="o"&gt;{&lt;/span&gt;postgresql17&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;PostgreSQL&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;installed&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-client-17.5-r0 x86_64 &lt;span class="o"&gt;{&lt;/span&gt;postgresql17&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;PostgreSQL&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;installed&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-contrib-17.5-r0 x86_64 &lt;span class="o"&gt;{&lt;/span&gt;postgresql17&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;PostgreSQL&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;installed&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;postgresql17-openrc-17.5-r0 x86_64 &lt;span class="o"&gt;{&lt;/span&gt;postgresql17&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;PostgreSQL&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;installed&lt;span class="o"&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;And we&amp;rsquo;re done!&lt;/p&gt;
&lt;h2 id="references"&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://wiki.alpinelinux.org/wiki/Postgresql"&gt;https://wiki.alpinelinux.org/wiki/Postgresql&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://beune.dev/posts/upgrade-alpine-postgresql/"&gt;https://beune.dev/posts/upgrade-alpine-postgresql/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>npx serve</title><link>https://perrotta.dev/2025/05/npx-serve/</link><pubDate>Sat, 24 May 2025 11:14:22 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/npx-serve/</guid><description>&lt;p&gt;&lt;a href="https://perrotta.dev/2024/01/start-an-http-server-asap/"&gt;Previously&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Start an HTTP server ASAP&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="option-5-use-node"&gt;Option #5: use &lt;code&gt;node&lt;/code&gt;&lt;/h2&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% npx serve&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="https://www.npmjs.com/package/serve"&gt;serve&lt;/a&gt; comes from Vercel:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;serve&lt;/code&gt; helps you serve a static site, single page application or just a static
file (no matter if on your device or on the local network). It also provides a
neat interface for listing the directory&amp;rsquo;s contents:&lt;/p&gt;
&lt;p&gt;The quickest way to get started is to just run npx serve in your project&amp;rsquo;s
directory.&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>kubernetes: list pending pods in daemonset</title><link>https://perrotta.dev/2025/05/kubernetes-list-pending-pods-in-daemonset/</link><pubDate>Tue, 20 May 2025 16:41:00 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/kubernetes-list-pending-pods-in-daemonset/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: Given a DaemonSet with a couple of pods stuck in
&amp;ldquo;Pending&amp;rdquo; state during their rollout, find out which nodes did not yet complete
the pod initialization.&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% kubectl get nodes -o name &lt;span class="p"&gt;|&lt;/span&gt; grep -vFf &amp;lt;&lt;span class="o"&gt;(&lt;/span&gt;kubectl get pods -n &lt;span class="o"&gt;{&lt;/span&gt;namespace&lt;span class="o"&gt;}&lt;/span&gt; -l &lt;span class="o"&gt;{&lt;/span&gt;ds-label-selector&lt;span class="o"&gt;}&lt;/span&gt; -o wide --no-headers &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print &amp;#34;node/&amp;#34; $7}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;node/aks-database-12345678-vmss000000
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;node/aks-database-12345678-vmss000002
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;node/aks-systempool-87654321-vmss000000
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;node/aks-systempool-87654321-vmss000001&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Notes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kubectl get nodes -o name&lt;/code&gt;: list all node names in the &lt;code&gt;node/&amp;lt;name&amp;gt;&lt;/code&gt; form&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kubectl get pods [...] -o wide&lt;/code&gt;: get the node name for each running DaemonSet pod&lt;/li&gt;
&lt;li&gt;&lt;code&gt;awk '{print &amp;quot;node/&amp;quot; $7}'&lt;/code&gt;: get the node name matching the output of &lt;code&gt;get nodes&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;grep [...]&lt;/code&gt;: find the nodes we are looking for&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Surely there must be an easier way to accomplish this?&lt;/p&gt;</description></item><item><title>WinterBreak: hello world</title><link>https://perrotta.dev/2025/05/winterbreak-hello-world/</link><pubDate>Sat, 17 May 2025 12:21:26 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/winterbreak-hello-world/</guid><description>&lt;p&gt;I decided to
&lt;a href="https://en.wikipedia.org/wiki/Privilege_escalation#Jailbreaking"&gt;jailbreak&lt;/a&gt; my
Kindle on January 1st this year, once I got aware of the
&lt;a href="https://kindlemodding.org/jailbreaking/WinterBreak/"&gt;WinterBreak&lt;/a&gt;&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; exploit,
via the excellent
&lt;a href="https://www.mobileread.com/forums/showthread.php?t=365372"&gt;MobileRead&lt;/a&gt; forums:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I am proud to present the culmination of over a year of procrastination:
WinterBreak WinterBreak is a new jailbreak which works on ANY KINDLE (from
the K5) on ANY FIRMWARE&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Life happens though, and only now I got time to do so.&lt;/p&gt;
&lt;p&gt;However, I took one important precaution since then, which was &lt;em&gt;essential&lt;/em&gt;:
ensure my Kindle was &lt;em&gt;always&lt;/em&gt; in airplane mode.&lt;/p&gt;
&lt;p&gt;Whenever the Kindle is connected to Wi-Fi, it gets
&lt;a href="https://en.wikipedia.org/wiki/Over-the-air_update"&gt;OTA updates&lt;/a&gt; automatically
from Amazon. This is generally a sensible default and the desired behavior.
However, for jailbreaking purposes, you want your device to stay stuck on time
and &lt;a href="https://www.youtube.com/watch?v=WA4iX5D9Z64"&gt;&lt;em&gt;never ever ever&lt;/em&gt;&lt;/a&gt; get
updates. An update could make the jailbreak cease to work. In fact, that&amp;rsquo;s
exactly what happened during these last 4-5 months:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;*Note that models on 5.18.x no longer work, please check the wiki&amp;rsquo;s model list
for more info&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I was prudent to verify it was still running 5.17.x before proceeding.&lt;/p&gt;
&lt;p&gt;The expected time to do the whole process was about half an hour, and it&amp;rsquo;s super
user-friendly. Seriously, the folks at &lt;a href="https://kindlemodding.org/"&gt;Kindle
Modding&lt;/a&gt; did an amazing documentation job; arguably
the procedures are friendly even to non-developers. The process boils down to
connecting your Kindle to a laptop (the OS doesn&amp;rsquo;t really matter), copying a
bunch of files and directories over to it, ejecting it, tapping some buttons,
and repeating this procedure a couple of times.&lt;/p&gt;
&lt;p&gt;For me it took about one hour, because I was careful to take photos (in case I
screwed up) and notes (for this blog post, and also for the sake of reverting
the process should I want to ‚Äì for example, if I ever sell the device to a third
party).&lt;/p&gt;
&lt;p&gt;Before deciding to do it, I watched
&lt;a href="https://www.youtube.com/watch?v=hJ59M0io6zE"&gt;this&lt;/a&gt; and &lt;a href="https://www.youtube.com/watch?v=Qtk7ERwlIAk"&gt;this
video&lt;/a&gt; which made me feel even more
confident it is the outcome I was longing for. &lt;a href="https://perrotta.dev/2024/12/independence/"&gt;Previously&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I won&amp;rsquo;t document the jailbreak procedure here: there&amp;rsquo;s no point. First, the
upstream documentation is amazing; second, the steps here would likely easily
get outdated. Head over to &lt;a href="https://kindlemodding.org/jailbreaking/WinterBreak/"&gt;the WinterBreak
docs&lt;/a&gt;. Even better, read
the &lt;a href="https://kindlemodding.org/jailbreaking/jailbreak-faq.html"&gt;FAQ&lt;/a&gt; first. That
said, here are a few notes and anecdotes.&lt;/p&gt;
&lt;p&gt;I had to disable parental controls on my Kindle. I had them enabled to prevent
me from accidentally buying books from the Amazon Store&lt;sup id="fnref:2"&gt;&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;. This is the closest
to adblocking I could find, and I was happy with that setting. That said, one of
the jailbreak steps is to open the store, therefore the parental controls must
be turned off. This is not documented upstream ‚Äì to be honest, most people
wouldn&amp;rsquo;t be in that situation anyway.&lt;/p&gt;
&lt;p&gt;The process failed in the first attempt. I am not quite sure why. It got stuck
at the &lt;code&gt;Jailbreaking - please wait...&lt;/code&gt; screen. The docs say:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If you do not see any funky text then make sure Airplane mode is disabled to
avoid any automatic update. Turn it back on after you see the text though!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That was not helpful to me though. What worked was to &lt;a href="https://www.youtube.com/watch?v=5UT8RkSmN4k"&gt;restart the
device&lt;/a&gt; and try again.&lt;/p&gt;
&lt;p&gt;The second attempt worked.&lt;/p&gt;
&lt;p&gt;Once the jailbreak is done, head over to &lt;a href="https://kindlemodding.org/jailbreaking/post-jailbreak/"&gt;Post
Jailbreak&lt;/a&gt;. Steps:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;set up a hotfix: to ensure the jailbreak persists, even after restarting the
device&lt;/li&gt;
&lt;li&gt;install KUAL &amp;amp; MRPI: package managers, basically&lt;/li&gt;
&lt;li&gt;disable OTA updates: important to ensure an automatic update does not revert
the jailbreak&lt;/li&gt;
&lt;li&gt;re-enable the store: not super relevant for me, but why not ‚Äì and then turn
parental controls back on&lt;/li&gt;
&lt;li&gt;install &lt;a href="https://koreader.rocks/"&gt;KOReader&lt;/a&gt;: surely this is the most exciting
part&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;KOReader is a document viewer for E Ink devices. Supported fileformats include
EPUB, PDF, DjVu, XPS, CBT, CBZ, FB2, PDB, TXT, HTML, RTF, CHM, DOC, MOBI and
ZIP files. It&amp;rsquo;s available for Kindle, Kobo, PocketBook, Android and desktop
Linux.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A few highlights from the FAQ:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Is it possible to undo the jailbreak (&amp;ldquo;unjailbreak&amp;rdquo;)?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Yes, perform a factory reset on the device and then install the same firmware
update (or higher).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This makes the action of doing the jailbreak a no-brainer. Sure, there&amp;rsquo;s always
a (small) chance of bricking your device, but I think it&amp;rsquo;s worth the risk.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Will this get my Amazon account banned?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;No reports of Amazon accounts being banned after jailbreaking have been
reported so far. However, please refrain from telling support that you have
modified your device.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Common sense. I never contacted Amazon Support in 11+ years of owning Kindles,
so I don&amp;rsquo;t particularly care about it anyway.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Will this void the warranty on my Kindle device?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Probably.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is always the case with jailbreaking.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s much easier to commit when you have an old device that is already out of
the warranty period.&lt;/p&gt;
&lt;p&gt;Avoid jailbreaking brand new devices. :)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Can I still use the default reader after jailbreaking?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Yes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It&amp;rsquo;s true: I verified it. This is great. In the (unlikely) case I find out that
KOReader sucks&lt;sup id="fnref:3"&gt;&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref"&gt;3&lt;/a&gt;&lt;/sup&gt;, I don&amp;rsquo;t need to regret it.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Is it possible to change screensavers in the native Kindle UI?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Although there are currently no extensions to change the screensavers in
hard-float firmware, it is still possible to change them, but it is not
recommended as it is very easy to brick the device.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Noted. But:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You can easily change screensavers with KOReader (search for the
&amp;ldquo;screensavers&amp;rdquo; feature).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;How can I check if my device is jailbroken?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Type &lt;code&gt;;log&lt;/code&gt; into the search bar, if a message pop ups, you&amp;rsquo;re jailbroken.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;And now I&amp;rsquo;m done.&lt;/p&gt;
&lt;p&gt;I cannot stress this enough: it&amp;rsquo;s very important to read the docs thoroughly
before deciding to jailbreak. &lt;a href="https://en.wikipedia.org/wiki/RTFM"&gt;RTFM&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;Perhaps I&amp;rsquo;ll write a follow-up post-jailbreaking user experience blog post.&lt;/p&gt;
&lt;h2 id="appendix"&gt;Appendix&lt;/h2&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% tree Downloads
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Downloads
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îú‚îÄ‚îÄ koreader-kindlehf-v2025.04.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îú‚îÄ‚îÄ kual-mrinstaller-khf.tar.xz
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îú‚îÄ‚îÄ renameotabin.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îú‚îÄ‚îÄ Update_hotfix_universal.bin
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îú‚îÄ‚îÄ Update_KUALBooklet_ALLDEVICES_KS2_install.bin
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;‚îî‚îÄ‚îÄ WinterBreak.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Yes, it&amp;rsquo;s called WinterBreak because it got released during Winter (in the
Northern hemisphere).&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Even if I were interested in doing so, I&amp;rsquo;d rather use my phone or my
computer for that. The Kindle Store experience &lt;em&gt;from the Kindle&lt;/em&gt; is
horrible.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:3"&gt;
&lt;p&gt;Their domain is &lt;a href="https://koreader.rocks"&gt;https://koreader.rocks&lt;/a&gt;&amp;hellip;&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>Blog directories</title><link>https://perrotta.dev/2025/05/blog-directories/</link><pubDate>Sat, 17 May 2025 01:16:22 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/blog-directories/</guid><description>&lt;p&gt;Without social media algorithms, how can you discover new blogs to follow?&lt;/p&gt;
&lt;p&gt;Enter &lt;a href="https://en.wikipedia.org/wiki/Web_directory"&gt;blog directories&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There are two ways to find information on the Web: by searching or browsing.
Web directories provide links in a structured list to make browsing easier.
Many web directories combine searching and browsing by providing a search
engine to search the directory. Unlike search engines, which base results on
a database of entries gathered automatically by web crawler, most web
directories are built manually by human editors. Many web directories allow
site owners to submit their site for inclusion, and have editors review
submissions for fitness.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A few directories I like&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;‚ú™ &lt;a href="https://diff.blog/"&gt;https://diff.blog/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://512kb.club/"&gt;https://512kb.club/&lt;/a&gt; (Kev)&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://blogroll.org/"&gt;https://blogroll.org/&lt;/a&gt; (Manu)&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://kagi.com/smallweb"&gt;https://kagi.com/smallweb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://marginalia-search.com/"&gt;https://marginalia-search.com/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://clew.se/"&gt;https://clew.se/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://darktheme.club/"&gt;https://darktheme.club/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://powrss.com/"&gt;https://powrss.com/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://feedle.world/"&gt;https://feedle.world/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://static.quest"&gt;https://static.quest&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;‚ú™ &lt;a href="https://rss.social/"&gt;https://rss.social/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ooh.directory/"&gt;https://ooh.directory/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://256kb.club/"&gt;https://256kb.club/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I tend to visit them occasionally, whenever I crave for new content, perhaps like
&lt;a href="https://en.wikipedia.org/wiki/Doomscrolling"&gt;doomscrolling&lt;/a&gt; in social media.&lt;/p&gt;
&lt;p&gt;Most new blogs I subscribe to come from indirect referrals. I read a blog post I
like that links to another blog post, I visit it to find out more and realize
that it&amp;rsquo;s interesting, then I subscribe to it.&lt;/p&gt;
&lt;p&gt;More rarely there&amp;rsquo;s also the direct referral way, for example, when I become
aware that a friend or a coworker has started a blog recently.&lt;/p&gt;
&lt;p&gt;The combination of referrals + directories is quite sustainable.&lt;/p&gt;
&lt;p&gt;See also: &lt;a href="https://nelson.cloud/how-i-discover-new-blogs/"&gt;How I discover new
blogs&lt;/a&gt; by Nelson Figueroa.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://perrotta.dev/2022/02/praise-for-blog-aggregators/"&gt;Previously&lt;/a&gt;.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;My blog is indexed in the ones marked with a ‚ú™ star.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>Logseq: open page in sidebar</title><link>https://perrotta.dev/2025/05/logseq-open-page-in-sidebar/</link><pubDate>Wed, 14 May 2025 00:31:30 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/logseq-open-page-in-sidebar/</guid><description>&lt;p&gt;To open a page in the sidebar in &lt;a href="https://logseq.com/"&gt;Logseq&lt;/a&gt;, hold Shift +
click the &lt;code&gt;[[page]]&lt;/code&gt; / &lt;code&gt;#page&lt;/code&gt; link.&lt;/p&gt;
&lt;p&gt;Pages can be stacked in the sidebar, √† la &lt;a href="https://dwm.suckless.org/"&gt;dwm&lt;/a&gt;.&lt;/p&gt;</description></item><item><title>ByteBurst Brigade</title><link>https://perrotta.dev/2025/05/byteburst-brigade/</link><pubDate>Tue, 06 May 2025 17:56:02 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/byteburst-brigade/</guid><description>&lt;p&gt;If you have Telegram, you&amp;rsquo;re welcome to join &lt;a href="https://t.me/+OzLfJRhjA69iNWFh"&gt;ByteBurst
Brigade&lt;/a&gt;, a supergroup I host with friends to
discuss Tech in general: privacy, self-hosting, news, workflows, etc.&lt;/p&gt;
&lt;p&gt;The noise in the group is low ‚Äì arguably, that&amp;rsquo;s a feature, √† la
&lt;a href="https://lobste.rs/about#invitations"&gt;lobsters&lt;/a&gt;.&lt;/p&gt;</description></item><item><title>Logseq: list all pages of a tag</title><link>https://perrotta.dev/2025/05/logseq-list-all-pages-of-a-tag/</link><pubDate>Sun, 04 May 2025 13:24:52 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/logseq-list-all-pages-of-a-tag/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: Given a couple of pages in &lt;a href="https://logseq.com/"&gt;Logseq&lt;/a&gt;
tagged with a given &lt;code&gt;content&lt;/code&gt; tag:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;tags:: content&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&amp;hellip;dynamically list all of them.&lt;/p&gt;
&lt;p&gt;We can do so with the following logseq query&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;

&lt;div class="codeblock" data-lang="logseq"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;logseq&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;pre tabindex="0"&gt;&lt;code class="language-logseq" data-lang="logseq"&gt;#+BEGIN_QUERY
{
 :title &amp;#34;Ideas üí° (-&amp;gt;)&amp;#34;
 :query (property :tags &amp;#34;idea&amp;#34;)
}
#+END_QUERY&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This is a static query, not meant to be changed.&lt;/p&gt;
&lt;p&gt;Alternatively it&amp;rsquo;s possible to create a live query, which allows one to tweak it
on-the-fly:&lt;/p&gt;

&lt;div class="codeblock" data-lang="logseq"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;logseq&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;pre tabindex="0"&gt;&lt;code class="language-logseq" data-lang="logseq"&gt;{{query (property :tags &amp;#34;idea&amp;#34;)}}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;The query syntax is somewhat a blend of &lt;a href="https://orgmode.org"&gt;orgmode&lt;/a&gt; +
emacs lisp from emacs.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>HashiCorp Vault from helm values</title><link>https://perrotta.dev/2025/04/hashicorp-vault-from-helm-values/</link><pubDate>Wed, 23 Apr 2025 16:56:16 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/04/hashicorp-vault-from-helm-values/</guid><description>&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: Populate HashiCorp Vault with select keys from &lt;code&gt;helm get values&lt;/code&gt; for a given chart release.&lt;/p&gt;
&lt;p&gt;The following script works:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Usage: Tweak entries as needed and then run the script.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;set&lt;/span&gt; -euo pipefail
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# It&amp;#39;s an associative array: a dictionary, a hash map&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Key: the entry to be populated in vault&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Value: a `jq` JSON selector from the output of `helm get values -o json`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;declare&lt;/span&gt; -A &lt;span class="nv"&gt;entries&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c1"&gt;# keep-sorted start&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.aws.accessKey&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.aws.accessKey&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.aws.secretKey&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.aws.secretKey&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.cronjob.apiPassword&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.cronjob.apiPassword&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.cronjob.apiUser&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.cronjob.apiUser&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.postgresql.adminpass&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.postgresql.adminpass&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.postgresql.password&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.postgresql.password&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.postgresql.ropass&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.postgresql.ropass&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.postgresql.rwpass&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.postgresql.rwpass&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.slack.token&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.slack.token&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;[&lt;/span&gt;config.slack.verificationToken&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;.config.slack.verificationToken&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c1"&gt;# keep-sorted end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;main&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; vault login
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nv"&gt;FIRST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; entry in &lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="p"&gt;!entries[@]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nv"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="nv"&gt;$entry&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nv"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;entries&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;$entry&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nv"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;helm get values -n tools mychart -o json &lt;span class="p"&gt;|&lt;/span&gt; jq -r &lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="nv"&gt;$value&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Populating vault &lt;/span&gt;&lt;span class="nv"&gt;$key&lt;/span&gt;&lt;span class="s2"&gt; from helm value &lt;/span&gt;&lt;span class="nv"&gt;$key&lt;/span&gt;&lt;span class="s2"&gt;: &lt;/span&gt;&lt;span class="nv"&gt;$content&lt;/span&gt;&lt;span class="s2"&gt;...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[[&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="nv"&gt;$FIRST&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;1&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;]]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; vault kv put -mount&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;kv-v2&amp;#34;&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;services/mychart/&amp;#34;&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="nv"&gt;$key&lt;/span&gt;&lt;span class="s2"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$content&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nv"&gt;FIRST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; vault kv patch -mount&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;kv-v2&amp;#34;&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;services/mychart/&amp;#34;&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="nv"&gt;$key&lt;/span&gt;&lt;span class="s2"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$content&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; vault kv get -mount&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;kv-v2&amp;#34;&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;services/mychart&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; rm ~/.vault-token
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;main&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;FIRST&lt;/code&gt;: In the first time we need to create an entry (&lt;code&gt;vault kv put&lt;/code&gt;), in the
second time we need to patch it (&lt;code&gt;vault kv patch&lt;/code&gt;).&lt;/p&gt;</description></item><item><title>Alpine Linux: the maintainer workflow</title><link>https://perrotta.dev/2025/04/alpine-linux-the-maintainer-workflow/</link><pubDate>Sun, 20 Apr 2025 15:12:09 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/04/alpine-linux-the-maintainer-workflow/</guid><description>&lt;p&gt;I maintain &lt;a href="https://pkgs.alpinelinux.org/packages?name=&amp;amp;branch=edge&amp;amp;repo=&amp;amp;arch=x86_64&amp;amp;origin=&amp;amp;flagged=&amp;amp;maintainer=Thiago+Perrotta"&gt;a couple of
packages&lt;/a&gt;
on Alpine Linux.&lt;/p&gt;
&lt;p&gt;Every now and then, a new software version is released, and it&amp;rsquo;s my duty&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; as an
active package maintainer to update my packages.&lt;/p&gt;
&lt;p&gt;The typical workflow looks like the following.&lt;/p&gt;
&lt;p&gt;First I get an email notification from &amp;ldquo;Alpine Package DB&amp;rdquo;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Dear Thiago Perrotta&lt;/p&gt;
&lt;p&gt;This is an automatic message send from pkgs.alpinelinux.org
One or more of your aports have been flagged out of date based on
Anitya monitoring system &lt;a href="https://release-monitoring.org/"&gt;https://release-monitoring.org/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;argocd current: 2.14.2-r1 new: 2.14.9&lt;/p&gt;
&lt;p&gt;To update the package you can use our helper script:&lt;/p&gt;
&lt;p&gt;abump aport-version&lt;/p&gt;
&lt;p&gt;If the provided information is incorrect, please let us know on IRC
or &lt;a href="mailto:alpine-infra@alpinelinux.org"&gt;alpine-infra@alpinelinux.org&lt;/a&gt;. Thanks!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It&amp;rsquo;s important not to &lt;a href="https://opensource.com/business/15/12/avoid-burnout-live-happy"&gt;burn oneself
out&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I treat these notifications as an FYI. They &lt;em&gt;are not&lt;/em&gt; prompts to make me
immediately go and update the packages&lt;sup id="fnref:2"&gt;&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;. For packages with frequent updates,
like &lt;code&gt;argocd&lt;/code&gt;, I&amp;rsquo;ll let a few patch versions accumulate before I take action.
Other times it is handy to batch package upgrades together so to do them all at
once. I use my personal judgment here. At the very least, this email will
trigger a TODO in my task list, so that it will not be forgotten. &lt;em&gt;At some
point&lt;/em&gt; it will be taken care of.&lt;/p&gt;
&lt;p&gt;Once I am ready to update the package, I &lt;code&gt;ssh&lt;/code&gt; to my Alpine Linux server. There
is absolutely no requirement to update alpine linux packages from alpine linux,
but it&amp;rsquo;s the most convenient to do, and I already have an alpine linux system
anyway.&lt;/p&gt;
&lt;p&gt;Then &lt;code&gt;cd aports/&lt;/code&gt;. This is a local git clone of the &lt;a href="https://gitlab.alpinelinux.org/alpine/aports"&gt;aports
tree&lt;/a&gt;
(&lt;a href="https://wiki.alpinelinux.org/wiki/Aports_tree"&gt;wiki&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;git pull&lt;/code&gt;. I tend to clean up after myself, so the last branch is likely
already &lt;code&gt;master&lt;/code&gt;. But, if not, then &lt;code&gt;git reset --hard &amp;amp;&amp;amp; git checkout master &amp;amp;&amp;amp; git pull&lt;/code&gt;. Amen.&lt;/p&gt;
&lt;p&gt;Now the real fun starts. And it&amp;rsquo;s surprisingly quick and simple, it feels like
cheating:&lt;/p&gt;

&lt;div class="codeblock" data-lang="shell"&gt;
 &lt;div class="codeblock-header"&gt;
 &lt;span class="codeblock-language"&gt;shell&lt;/span&gt;
 &lt;button class="codeblock-copy" type="button" data-copy-code&gt;Copy&lt;/button&gt;
 &lt;/div&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;% abump argocd-2.14.9&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This will update the version and checksums in the corresponding &lt;code&gt;APKBUILD&lt;/code&gt; and
trigger a package build.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s sensible to check the package release notes or changelog to find potential
incompatibilities and/or updates to the build process. It&amp;rsquo;s also sensible to
look at the package diffs to inspect for potential malware, which is becoming
increasingly more common these days in open source packages. &amp;ldquo;Secure your supply
chain&amp;rdquo;, as they say it.&lt;/p&gt;
&lt;p&gt;If the build completes successfully, create a new branch (&lt;code&gt;git nb argocd&lt;/code&gt;),
commit, push it (&lt;code&gt;git pushm&lt;/code&gt;), then create a merge request (MR) on
&lt;a href="https://gitlab.alpinelinux.org/"&gt;GitLab&lt;/a&gt;. I normally use the Web UI to do so,
but it&amp;rsquo;s also possible to do it with the CLI. A link to create the MR is printed
to stdout upon pushing the branch, which makes the process even easier.&lt;/p&gt;
&lt;p&gt;It could happen that the MR fails CI for some architectures (even if it works
locally on my machine‚Ñ¢). These errors need to be dealt with.&lt;/p&gt;
&lt;p&gt;The commit message must follow a certain style. I have a pre-commit script set
up that does it for me. It is typically in this form:&lt;/p&gt;

&lt;div class="codeblock"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;testing/argocd: upgrade to 2.14.9&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;There&amp;rsquo;s a rule: only one package per merge request.&lt;/p&gt;
&lt;p&gt;If there are more packages to upgrade, I run &lt;code&gt;git bd&lt;/code&gt; (&amp;ldquo;branch delete&amp;rdquo;) and then
restart this process. It&amp;rsquo;s quite manageable, as I don&amp;rsquo;t maintain a lot of
packages. Perhaps it could be further automated if there were more packages
and/or if the package upgrades were more frequent.&lt;/p&gt;
&lt;p&gt;The final MR looks like the following:
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/83026"&gt;!83026&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now I sit tight and wait for approval.&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;On a &lt;a href="https://xkcd.com/2347/"&gt;&lt;em&gt;best-effort&lt;/em&gt;&lt;/a&gt; basis.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Unless it&amp;rsquo;s a security risk or incident (e.g. whenever there&amp;rsquo;s a CVE
associated with it).&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>SAML Chrome Panel</title><link>https://perrotta.dev/2025/03/saml-chrome-panel/</link><pubDate>Wed, 12 Mar 2025 00:51:05 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/03/saml-chrome-panel/</guid><description>&lt;p&gt;&lt;a href="https://chromewebstore.google.com/detail/saml-chrome-panel/paijfdbeoenhembfhkhllainmocckace"&gt;SAML Chrome Panel&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Extends the (Chrome) Developer Tools, adding support for SAML Requests and
Responses to be displayed in the Developer Tools window&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;This is an Open Source SAML debugger for Chrome. It operates as another panel
in the Chrome Developer Tools section, which monitors the traffic in the
current active tab. This panel is trying to replicate what the Firefox version
of SAML Tracer does as there wasn&amp;rsquo;t a good enough one (or any) for Chrome at
the time of writing this.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;It is designed to display all network traffic, along with the request and
response data. If there is a SAML request or response, then it will grab the
message, format it nicely and show it to you in another tab.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Upstream: &lt;a href="https://github.com/milton-lai/saml-chrome-panel"&gt;https://github.com/milton-lai/saml-chrome-panel&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This Chrome extension has proven useful to me at least twice.&lt;/p&gt;
&lt;p&gt;Recently I was integrating &lt;a href="https://argo-cd.readthedocs.io/en/stable/"&gt;ArgoCD&lt;/a&gt;
and &lt;a href="https://www.mongodb.com/atlas"&gt;MongoDB Atlas&lt;/a&gt; with
&lt;a href="https://www.okta.com/"&gt;Okta&lt;/a&gt;. You can do it via SAML or via OIDC.&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s always a chance of having one tiny configuration mistake, perhaps a
typo or a missing field. I found:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ArgoCD: a typo in the callback URL (&lt;code&gt;foo-foo&lt;/code&gt; instead of &lt;code&gt;foo&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;MongoDB Atlas: an &lt;code&gt;acsError&lt;/code&gt; in the response
(&lt;a href="https://www.mongodb.com/community/forums/t/mongodb-atlas-okta-integration-login-error/230897"&gt;example&lt;/a&gt;,
&lt;a href="https://www.mongodb.com/community/forums/t/sso-issue-with-idp-azure-entraid-okta-mongodb-saml/278500"&gt;example&lt;/a&gt;):
&lt;a href="https://cloud.mongodb.com/okta/hooks/acsError"&gt;https://cloud.mongodb.com/okta/hooks/acsError&lt;/a&gt;: it was a certificate error.
Instead of copying and pasting the certificate content (&lt;code&gt;------ BEGIN CERTIFICATE ------&lt;/code&gt;), upload the file directly. The
&lt;a href="https://www.mongodb.com/docs/cloud-manager/security/federated-auth-okta/"&gt;documentation&lt;/a&gt;
(item &lt;code&gt;1.h.&lt;/code&gt;) notes so. Convert it to &lt;code&gt;.pem&lt;/code&gt; prior to uploading it.&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Grayjay</title><link>https://perrotta.dev/2025/03/grayjay/</link><pubDate>Sun, 02 Mar 2025 20:25:16 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/03/grayjay/</guid><description>&lt;p&gt;&lt;a href="https://grayjay.app/"&gt;https://grayjay.app/&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Grayjay enables you to create and watch video content in your own terms, fully
retaining ownership and having control over what you watch. Your content on
your terms.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It has an YouTube plug-in. It behaves similarly to &lt;a href="https://perrotta.dev/2025/01/smarttube/"&gt;SmartTube&lt;/a&gt;: there&amp;rsquo;s built-in adblocking and
&lt;a href="https://sponsor.ajay.app/"&gt;SponsorBlock&lt;/a&gt;. You can log in with your Google
account to integrate history, subscriptions, etc. It acts effectively as a
no-frills YouTube Desktop client. Additionally it supports Chromecast and AirPlay.&lt;/p&gt;
&lt;p&gt;Works as advertised on macOS, and it&amp;rsquo;s super easy to install. There&amp;rsquo;s no Cask
available on Homebrew though (sadly).&lt;/p&gt;</description></item><item><title>Logseq: aliases</title><link>https://perrotta.dev/2025/03/logseq-aliases/</link><pubDate>Sat, 01 Mar 2025 15:55:20 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/03/logseq-aliases/</guid><description>&lt;p&gt;In &lt;a href="https://logseq.com/"&gt;Logseq&lt;/a&gt;, I have an entry called &amp;ldquo;Trips&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;In a topic in my daily note, I want to use the &lt;code&gt;#trip&lt;/code&gt; tag to link to it.&lt;/p&gt;
&lt;p&gt;However, &lt;code&gt;#trip&lt;/code&gt; links to a distinct page, called &amp;ldquo;Trip&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Problem statement&lt;/strong&gt;: How can we &amp;ldquo;merge&amp;rdquo; the two entries, effectively treating
them as one?&lt;/p&gt;
&lt;p&gt;Use &lt;a href="https://unofficial-logseq-docs.gitbook.io/unofficial-logseq-docs/beginner-to-advance-features/aliases"&gt;aliases&lt;/a&gt;: In &amp;ldquo;Trips&amp;rdquo;, in the very first bullet point, type &lt;code&gt;::alias&lt;/code&gt;. The
auto-completion pops up. Type in &amp;ldquo;trip&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s all. Linking with &lt;code&gt;[[trip]]&lt;/code&gt; or &lt;code&gt;#trip&lt;/code&gt; now points out to &amp;ldquo;Trips&amp;rdquo;.&lt;/p&gt;</description></item><item><title>Kill the Newsletter</title><link>https://perrotta.dev/2025/02/kill-the-newsletter/</link><pubDate>Thu, 20 Feb 2025 15:34:30 +0100</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/02/kill-the-newsletter/</guid><description>&lt;p&gt;I don&amp;rsquo;t like to sign up for newsletters. They are too noisy, pollute my inbox,
and have a lot of tracking built-in.&lt;/p&gt;
&lt;p&gt;Instead, I prefer RSS.&lt;/p&gt;
&lt;p&gt;Most newsletters provide a way to subscribe to them via RSS. Notably, Medium and
Substack do so. Most&amp;hellip;but not all.&lt;/p&gt;
&lt;p&gt;What to do when the only option is a newsletter? A popular example: James
Clear, author of Atomic Habits, with his &lt;a href="https://jamesclear.com/newsletter"&gt;3-2-1
Thursday&lt;/a&gt; newsletter.&lt;/p&gt;
&lt;p&gt;Use &lt;a href="https://ktnrs.com/"&gt;Kill the Newsletter&lt;/a&gt; by Leandro Facchinetti.&lt;/p&gt;
&lt;p&gt;Usage is quite simple:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;create a new entry e.g. &amp;ldquo;foo&amp;rdquo;&lt;/li&gt;
&lt;li&gt;it will generate an email e.g. &lt;code&gt;abcdef@ktnrs.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;it will generate a RSS feed e.g. &lt;code&gt;https://ktnrs.com/feeds/abcdef.xml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;use the email to sign up for the newsletter&lt;/li&gt;
&lt;li&gt;use the RSS feed to subscribe to in your feed reader&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And that&amp;rsquo;s it!&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Don&amp;rsquo;t share these addresses.&lt;/p&gt;
&lt;p&gt;They contain an identifier that other people could use to send you spam and to
control your newsletter subscriptions.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It&amp;rsquo;s &lt;a href="https://github.com/leafac/kill-the-newsletter"&gt;open source&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Convert email newsletters into Atom feeds&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Most blogs I subscribe to provide RSS feeds out-of-the-box, therefore I don&amp;rsquo;t
see the need to self-host this service merely for a few one-offs.&lt;/p&gt;</description></item></channel></rss>