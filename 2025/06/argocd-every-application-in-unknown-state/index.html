<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title class=title>ArgoCD: every application in unknown state | ¬¨ just serendipity üçÄ</title><meta name=title content="ArgoCD: every application in unknown state">
<meta name=description content="Symptom: Every single application in the Kubernetes cluster that is managed
by Argo is in Unknown sync status. A disaster! üò±
This has only happened in one of our clusters. More specifically, in an
AKS cluster
(from Microsoft Azure).
An observed effect:
% kubectl get --raw='/openapi/v2' | head -c 200
Error from server (ServiceUnavailable): the server is currently unable to handle the request
Aha! The Kubernetes OpenAPI server is not responding properly.
That explains why Argo is having so much trouble to figure out the state of affairs in
the cluster."><meta name=keywords content="bestof,dev,selfhosted,"><meta property="og:url" content="https://perrotta.dev/2025/06/argocd-every-application-in-unknown-state/"><meta property="og:site_name" content="¬¨ just serendipity üçÄ"><meta property="og:title" content="ArgoCD: every application in unknown state"><meta property="og:description" content="Symptom: Every single application in the Kubernetes cluster that is managed by Argo is in Unknown sync status. A disaster! üò±
This has only happened in one of our clusters. More specifically, in an AKS cluster (from Microsoft Azure).
An observed effect:
% kubectl get --raw='/openapi/v2' | head -c 200 Error from server (ServiceUnavailable): the server is currently unable to handle the request Aha! The Kubernetes OpenAPI server is not responding properly. That explains why Argo is having so much trouble to figure out the state of affairs in the cluster."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-13T22:34:33+02:00"><meta property="article:modified_time" content="2025-06-13T22:34:33+02:00"><meta property="article:tag" content="Bestof"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Selfhosted"><meta name=twitter:card content="summary"><meta name=twitter:title content="ArgoCD: every application in unknown state"><meta name=twitter:description content="Symptom: Every single application in the Kubernetes cluster that is managed by Argo is in Unknown sync status. A disaster! üò±
This has only happened in one of our clusters. More specifically, in an AKS cluster (from Microsoft Azure).
An observed effect:
% kubectl get --raw='/openapi/v2' | head -c 200 Error from server (ServiceUnavailable): the server is currently unable to handle the request Aha! The Kubernetes OpenAPI server is not responding properly. That explains why Argo is having so much trouble to figure out the state of affairs in the cluster."><meta itemprop=name content="ArgoCD: every application in unknown state"><meta itemprop=description content="Symptom: Every single application in the Kubernetes cluster that is managed by Argo is in Unknown sync status. A disaster! üò±
This has only happened in one of our clusters. More specifically, in an AKS cluster (from Microsoft Azure).
An observed effect:
% kubectl get --raw='/openapi/v2' | head -c 200 Error from server (ServiceUnavailable): the server is currently unable to handle the request Aha! The Kubernetes OpenAPI server is not responding properly. That explains why Argo is having so much trouble to figure out the state of affairs in the cluster."><meta itemprop=datePublished content="2025-06-13T22:34:33+02:00"><meta itemprop=dateModified content="2025-06-13T22:34:33+02:00"><meta itemprop=wordCount content="334"><meta itemprop=keywords content="Bestof,Dev,Selfhosted"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/2025/06/argocd-every-application-in-unknown-state/><link rel=stylesheet href=https://perrotta.dev/theme.css><style>body{text-align:left;margin:auto}h1,h2,h3,h4,h5,h6,footer,nav{font-family:var(--font-title)}footer{font-size:smaller;padding:8px;text-align:center}a{color:var(--link-color)}a.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.4}table{width:100%}img{max-width:100%}code{background-color:var(--code-bg)}li code,p code{font-size:.9em}pre code{color:var(--heading-color);display:block;padding:25px;white-space:pre;font-size:17px;overflow-x:auto}code,pre{font-family:var(--font-code)}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:2px solid #999;color:var(--heading-color);padding-left:25px;padding-right:15px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex;gap:8px;margin-bottom:8px}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}.pubdate-list{color:var(--color-gray);font-style:italic}.pubdate-single{color:var(--color-gray);font-style:italic}.social-link-wrapper{display:flex;justify-content:center;align-items:center;gap:8px;margin-top:8px}.social-link{text-decoration:none;font-size:1.4em}sup.gray{color:var(--color-gray)}@media(min-width:601px){.title{font-size:38px}}@media(max-width:600px){.title{font-size:2rem}}@media(prefers-color-scheme:dark){blockquote{color:#ccc}textarea,input{background-color:#252525;color:var(--text-color)}}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.png></head><body><header><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.png alt="thiagowfx's avatar" width=32 height=32><h1 class=title>¬¨ just serendipity üçÄ</h1></a><nav><a href=/>Home</a>
<a href=/posts/>Blog</a>
<a href=/tags/coding/>Coding</a>
<a href=/tags/bestof/>‚òÖ</a></nav></header><main><h2><span>‚òÖ</span> ArgoCD: every application in unknown state</h2><p><span class=pubdate-single><time datetime=2025-06-13 pubdate>13 Jun, 2025
</time>‚Ä¢ 334 words ‚Ä¢ 2 min</span></p><content><p><strong>Symptom</strong>: Every single application in the Kubernetes cluster that is managed
by Argo is in <code>Unknown</code> sync status. A disaster! üò±</p><p>This has only happened in one of our clusters. More specifically, in an
<a href=https://learn.microsoft.com/en-us/azure/aks/core-aks-concepts>AKS</a> cluster
(from Microsoft Azure).</p><p>An observed effect:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% kubectl get --raw<span style=color:#56b6c2>=</span><span style=color:#98c379>&#39;/openapi/v2&#39;</span> | head -c <span style=color:#d19a66>200</span>
</span></span><span style=display:flex><span>Error from server <span style=color:#56b6c2>(</span>ServiceUnavailable<span style=color:#56b6c2>)</span>: the server is currently unable to handle the request
</span></span></code></pre></div><p>Aha! The Kubernetes OpenAPI server is not responding properly.
That explains why Argo is having so much trouble to figure out the state of affairs in
the cluster.</p><p>It was quite difficult to troubleshoot this issue. There are barely any
resources about it in the open web. We filed an Azure Support ticket, but it was
completely useless. They offered to restart<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> the OpenAPI server, but that
didn&rsquo;t help (of course it wouldn&rsquo;t!).</p><p>Because this is a managed Kubernetes cluster, we have limited access to it,
which includes lack of access to raw logs. The Azure portal doesn&rsquo;t make it easy
but, after digging quite deep into it, eventually we found this error message in
the logs:</p><pre tabindex=0><code> {&#34;pod&#34;:&#34;kube-apiserver-7785d59f4f-scqmp&#34;,&#34;stream&#34;:&#34;stderr&#34;,&#34;containerID&#34;:&#34;925345f6501626aa6cd40dd187d5cf57837389eec9cb39b2292fb9ae3f66242f&#34;,&#34;log&#34;:&#34;E0512 12:01:36.876768       1 handler.go:160] Error in OpenAPI handler: failed to build merge specs: unable to merge: duplicated path \/apis\/reports.kyverno.io\/v1\/clusterephemeralreports\n&#34;}
</code></pre><p>That was the first clue! Now we know it&rsquo;s related to
<a href=https://kyverno.io/>Kyverno</a>.</p><p>That error eventually led us to
<a href=https://github.com/kubernetes/kubernetes/issues/122668#issuecomment-2531243040>this</a>
issue in Kubernetes:</p><blockquote><p>We have the same issue here, actually also triggered by installing the kyverno
reports-server with both apiservices (different groups served by the same
api-server).</p></blockquote><p>Aha!</p><p>Deleting the duplicate CRDs installed by <a href=https://github.com/kyverno/reports-server>kyverno reports
server</a> has immediately resolved the
OpenAPI server unresponsiveness. It wasn&rsquo;t even necessary to restart it:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% kubectl delete crd ephemeralreports.reports.kyverno.io clusterephemeralreports.reports.kyverno.io clusterpolicyreports.wgpolicyk8s.io policyreports.wgpolicyk8s.io
</span></span><span style=display:flex><span>customresourcedefinition.apiextensions.k8s.io <span style=color:#98c379>&#34;ephemeralreports.reports.kyverno.io&#34;</span> deleted
</span></span><span style=display:flex><span>customresourcedefinition.apiextensions.k8s.io <span style=color:#98c379>&#34;clusterephemeralreports.reports.kyverno.io&#34;</span> deleted
</span></span><span style=display:flex><span>customresourcedefinition.apiextensions.k8s.io <span style=color:#98c379>&#34;clusterpolicyreports.wgpolicyk8s.io&#34;</span> deleted
</span></span><span style=display:flex><span>customresourcedefinition.apiextensions.k8s.io <span style=color:#98c379>&#34;policyreports.wgpolicyk8s.io&#34;</span> deleted
</span></span></code></pre></div><p>And now:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get --raw<span style=color:#56b6c2>=</span><span style=color:#98c379>&#39;/openapi/v2&#39;</span> | head -c <span style=color:#d19a66>200</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>{</span><span style=color:#98c379>&#34;swagger&#34;</span>:<span style=color:#98c379>&#34;2.0&#34;</span>,<span style=color:#98c379>&#34;info&#34;</span>:<span style=color:#56b6c2>{</span><span style=color:#98c379>&#34;title&#34;</span>:<span style=color:#98c379>&#34;Kubernetes&#34;</span>,<span style=color:#98c379>&#34;version&#34;</span>:<span style=color:#98c379>&#34;v1.30.11&#34;</span><span style=color:#56b6c2>}</span>,<span style=color:#98c379>&#34;paths&#34;</span>:<span style=color:#56b6c2>{</span><span style=color:#98c379>&#34;/.well-known/openid-configuration/&#34;</span>:<span style=color:#56b6c2>{</span><span style=color:#98c379>&#34;get&#34;</span>:<span style=color:#56b6c2>{</span><span style=color:#98c379>&#34;description&#34;</span>:<span style=color:#98c379>&#34;get service account issuer OpenID configuration, also known as
</span></span></span></code></pre></div><p>That was a tricky one! Interestingly: it has only occurred in AKS.
<a href=https://aws.amazon.com/eks/>EKS</a> was fine.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://en.wikiquote.org/wiki/The_IT_Crowd>Hello, IT. Have you tried turning it off and on
again?</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></content><div style=display:flex;justify-content:space-between><p>Reply via
<a href="mailto:serendipity@perrotta.dev?subject=Reply to: ArgoCD%3a%20every%20application%20in%20unknown%20state">email</a></p><p><a href=https://perrotta.dev/tags/bestof/>#bestof</a>
<a href=https://perrotta.dev/tags/dev/>#dev</a>
<a href=https://perrotta.dev/tags/selfhosted/>#selfhosted</a></p></div></main><hr><footer><span>¬© 2021 - 2025 Thiago Perrotta ¬∑
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ¬∑
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo  ï‚Ä¢·¥•‚Ä¢ î bear</a></span><div class=social-link-wrapper><a target=_blank rel=noopener class=social-link href=mailto:serendipity@perrotta.dev title="Email address"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 24 24" height="1.3em" width="1.3em"><g transform="translate(0.000000,24.000000) scale(0.100000,-0.100000)"><path d="M26 191c-4-5 16-23 44-40l50-31 50 31c28 17 48 35 44 40-7 12-181 12-188 0z"/><path d="M22 103l3-58 93-3c104-3 105-3 1e2 71l-3 46-48-29-47-30-38 23c-20 13-43 27-50 31-10 6-12-5-10-51z"/></g></svg>
</a><a target=_blank rel=noopener class=social-link href=https://perrotta.dev/index.xml title="RSS feed"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 56.693 56.693" height="1em" width="1em"><path d="M3.428 31.085c6.19.0 12.009 2.418 16.382 6.816 4.381 4.398 6.793 10.256 6.793 16.492h9.539c0-18.113-14.676-32.848-32.714-32.848v9.54zM3.443 14.174c22.061.0 40.01 18.047 40.01 40.231h9.539c0-27.445-22.229-49.77-49.549-49.77v9.539zM16.634 47.741c0 3.648-2.959 6.607-6.607 6.607S3.42 51.39 3.42 47.741c0-3.65 2.958-6.607 6.606-6.607s6.608 2.957 6.608 6.607z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://github.com/thiagowfx title="Github profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://goodreads.com/user/show/7873832-thiago title="Goodreads profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 50 50" height="1em" width="1em"><path d="M25 2c-4.541.0-8.41336 1.9082151-11.017578 4.9453125C11.378203 9.9824099 10 14.07975 10 18.5s1.378203 8.517589 3.982422 11.554688C16.58664 33.091785 20.459 35 25 35c4.531588.0 8.395936-1.901605 11-4.927734V35c0 2.598543-.818503 4.764071-2.451172 6.339844C31.91616 42.915616 29.363725 44 25.5 44 17.784314 44 15 39.933333 15 36H11c0 6.066667 5.215686 12 14.5 12 4.636275.0 8.33384-1.377726 10.826172-3.783203C38.818503 41.811319 40 38.476457 40 35V18.5 3H36V6.9277344C33.395936 3.9016049 29.531588 2 25 2zm0 4c3.459.0 6.08664 1.3379255 7.982422 3.5488281C34.878203 11.759731 36 14.91225 36 18.5s-1.121797 6.740269-3.017578 8.951172C31.08664 29.662074 28.459 31 25 31s-6.08664-1.337926-7.982422-3.548828C15.121797 25.240269 14 22.08775 14 18.5s1.121797-6.740269 3.017578-8.9511719C18.91336 7.3379255 21.541 6 25 6z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://linkedin.com/in/thiagoperrotta title="LinkedIn profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 30 30" height="1.2em" width="1.2em"><path d="M24 4H6C4.895 4 4 4.895 4 6v18c0 1.105.895 2 2 2h18c1.105.0 2-.895 2-2V6c0-1.105-.895-2-2-2zM10.954 22h-2.95v-9.492h2.95V22zM9.449 11.151c-.951.0-1.72-.771-1.72-1.72s.77-1.719 1.72-1.719c.948.0 1.719.771 1.719 1.719C11.168 10.38 10.397 11.151 9.449 11.151zM22.004 22h-2.948v-4.616c0-1.101-.02-2.517-1.533-2.517-1.535.0-1.771 1.199-1.771 2.437V22h-2.948v-9.492h2.83v1.297h.04c.394-.746 1.356-1.533 2.791-1.533 2.987.0 3.539 1.966 3.539 4.522V22z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://stackoverflow.com/users/1745064/thiagowfx title="StackOverflow profile"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em"><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 3e2zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-2e2v39.7h2e2zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg></a></div><a target=_blank href=https://512kb.club title="512kb.club badge"><img src=https://perrotta.dev/green-team.gif alt="a proud member of the green team of 512KB club"></a></footer></body></html>