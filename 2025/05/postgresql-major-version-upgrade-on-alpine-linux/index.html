<!doctype html><html lang=en id=root-html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title class=title>PostgreSQL major version upgrade on Alpine Linux | ¬¨ just serendipity üçÄ</title><meta name=title content="PostgreSQL major version upgrade on Alpine Linux"><meta name=description content="Problem statement
Given Alpine Linux 3.22 running PostgreSQL 16, upgrade to PostgreSQL 17. For
this specific example, consider a miniflux database.
Procedure
Install PostgreSQL 17:


   
     shell
     Copy
   
   % doas apk add postgres

It can coexist with postgres16.
Stop the PostgreSQL daemon:


   
     shell
     Copy
   
   % doas service postgresql stop

If you navigate to the Miniflux server with your browser, it will fail, as
expected:


   store: unable to create app session: dial tcp [::1]:5432: connect: connection refused

Change the PostgreSQL system version to the desired one:"><meta name=keywords content="bestof,dev,"><meta property="og:url" content="https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/"><meta property="og:site_name" content="¬¨ just serendipity üçÄ"><meta property="og:title" content="PostgreSQL major version upgrade on Alpine Linux"><meta property="og:description" content="Problem statement Given Alpine Linux 3.22 running PostgreSQL 16, upgrade to PostgreSQL 17. For this specific example, consider a miniflux database.
Procedure Install PostgreSQL 17:
shell Copy % doas apk add postgres It can coexist with postgres16.
Stop the PostgreSQL daemon:
shell Copy % doas service postgresql stop If you navigate to the Miniflux server with your browser, it will fail, as expected:
store: unable to create app session: dial tcp [::1]:5432: connect: connection refused Change the PostgreSQL system version to the desired one:"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-24T16:00:23+02:00"><meta property="article:modified_time" content="2025-12-25T17:27:49-03:00"><meta property="article:tag" content="Bestof"><meta property="article:tag" content="Dev"><meta name=twitter:card content="summary"><meta name=twitter:title content="PostgreSQL major version upgrade on Alpine Linux"><meta name=twitter:description content="Problem statement Given Alpine Linux 3.22 running PostgreSQL 16, upgrade to PostgreSQL 17. For this specific example, consider a miniflux database.
Procedure Install PostgreSQL 17:
shell Copy % doas apk add postgres It can coexist with postgres16.
Stop the PostgreSQL daemon:
shell Copy % doas service postgresql stop If you navigate to the Miniflux server with your browser, it will fail, as expected:
store: unable to create app session: dial tcp [::1]:5432: connect: connection refused Change the PostgreSQL system version to the desired one:"><meta name=referrer content="no-referrer-when-downgrade"><link rel="shortcut icon" href=https://perrotta.dev/favicon.ico><link rel=canonical href=https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/><link rel=alternate type=text/plain href=https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/index.txt title="PostgreSQL major version upgrade on Alpine Linux"><link rel=alternate type=text/markdown href=https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/index.md title="PostgreSQL major version upgrade on Alpine Linux"><link rel=preconnect href=https://perrotta.dev/><link rel=stylesheet href=https://perrotta.dev/theme.css><style>body{text-align:left;margin:auto}h1,h2,h3,h4,h5,h6,footer,nav{font-family:var(--font-title)}footer{font-size:smaller;text-align:center;display:flex;flex-direction:column;gap:6px}footer>a{text-decoration:none}a{color:var(--link-color)}.header-top{display:flex;align-items:center;justify-content:space-between;gap:12px}.header-buttons{display:flex;align-items:center;gap:8px}#lang-toggle{display:inline-flex;align-items:center;padding:4px 10px;background:var(--code-bg);border-radius:12px;text-decoration:none;color:var(--link-color);font-family:inherit;font-size:.85em;transition:all .2s ease}#lang-toggle:hover{transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.1)}a.title{text-decoration:none;border:0;display:flex;align-items:center;column-gap:10px}nav a{margin-right:12px;display:inline-block}.nav-dropdown{display:inline-block;position:relative;margin-right:12px}.nav-dropdown-trigger{background:0 0;border:none;cursor:pointer;color:var(--link-color);font-family:inherit;font-size:inherit;padding:0;display:flex;align-items:center;gap:4px}.nav-dropdown-trigger:hover{text-decoration:underline}.nav-dropdown-arrow{display:inline-block;font-size:.7em;transition:transform .2s ease}.nav-dropdown.open .nav-dropdown-arrow{transform:rotate(180deg)}.nav-dropdown-menu{position:absolute;top:100%;left:0;background-color:var(--bg-color);border:1px solid var(--border-color);border-radius:4px;min-width:150px;box-shadow:0 4px 6px rgba(0,0,0,.1);z-index:1000;display:none;margin-top:4px}.nav-dropdown.open .nav-dropdown-menu{display:block}.nav-dropdown-item{display:block;padding:10px 16px;color:var(--link-color);text-decoration:none;white-space:nowrap;font-size:.95em}.nav-dropdown-item-coding{padding-left:1.5em}.nav-dropdown-item:hover{background-color:var(--code-bg);text-decoration:underline}.nav-dropdown-item:first-child{border-radius:3px 3px 0 0}.nav-dropdown-item:last-child{border-radius:0 0 3px 3px}.lang-dropdown{display:inline-block;position:relative;margin-right:12px}.lang-toggle-button{background:0 0;border:none;cursor:pointer;color:var(--link-color);font-family:inherit;font-size:inherit;padding:0;display:flex;align-items:center;gap:4px}.lang-toggle-button:hover{text-decoration:underline}.lang-dropdown-arrow{display:inline-block;font-size:.7em;transition:transform .2s ease}.lang-dropdown.open .lang-dropdown-arrow{transform:rotate(180deg)}.lang-dropdown-menu{position:absolute;top:100%;left:0;background-color:var(--bg-color);border:1px solid var(--border-color);border-radius:4px;min-width:100px;box-shadow:0 4px 6px rgba(0,0,0,.1);z-index:1000;display:none;margin-top:4px}.lang-dropdown.open .lang-dropdown-menu{display:block}.lang-dropdown-item{display:block;padding:10px 16px;color:var(--link-color);text-decoration:none;white-space:nowrap;font-size:.95em}.lang-dropdown-item:hover{background-color:var(--code-bg);text-decoration:underline}.lang-dropdown-item:first-child{border-radius:3px 3px 0 0}.lang-dropdown-item:last-child{border-radius:0 0 3px 3px}.lang-active{font-weight:700}hr{border:none;border-top:1px dashed var(--border-color)}nav a.has-emoji .nav-emoji{display:none}nav a.has-emoji:hover .nav-emoji,nav a.active-star .nav-emoji{display:inline}nav a.has-emoji:hover .nav-text,nav a.active-star .nav-text{display:none}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.4}table{width:100%}img{max-width:100%}code{background-color:var(--code-bg)}li code,p code{font-size:.9em}pre{margin:1.5rem 0;border-radius:10px;background-color:var(--code-bg);overflow-x:auto}pre code{display:block;padding:18px 22px;white-space:pre;font-size:17px;overflow-x:auto;background:0 0;color:inherit}code,pre{font-family:var(--font-code)}.rss-link{display:inline-flex;align-items:center;justify-content:center;width:1em;height:1em;overflow:hidden}.rss-link svg{width:100%;height:100%}.codeblock{margin:1.5rem 0;border-radius:12px;border:1px solid var(--border-color);background:var(--code-bg);overflow:hidden}.codeblock-header{display:flex;justify-content:space-between;align-items:center;font-size:.85em;padding:10px 16px;background:rgba(0,0,0,2%);border-bottom:1px solid var(--border-color);color:var(--color-gray)}.codeblock-language{font-weight:600}.codeblock-copy{background:0 0;border:none;color:inherit;padding:2px 6px;font-size:.9em;cursor:pointer}.codeblock pre{margin:0;border-radius:0;background:0 0}.codeblock pre code{padding:18px 22px}blockquote{border-left:2px solid #999;color:var(--heading-color);padding-left:25px;padding-right:15px;font-style:italic}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex;gap:8px;margin-bottom:8px}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}.pubdate-list{color:var(--color-gray);font-style:italic;font-size:.85em}.pubdate-single{color:var(--color-gray);font-style:italic}.social-link-wrapper{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap}.social-link{text-decoration:none;font-size:1.4em;display:inline-flex;align-items:center;justify-content:center;padding:.3em;border-radius:50%;background-color:var(--code-bg);color:var(--text-color);transition:all .3s ease;position:relative}.social-link:hover{transform:translateY(-4px);background-color:var(--link-color);color:#fff;box-shadow:0 4px 12px rgba(0,0,0,.15)}.social-link:active{transform:translateY(-2px)}#theme-toggle{background:0 0;border:none;padding:0;cursor:pointer;font-size:1.2em;display:inline-block;vertical-align:middle;transition:transform .2s ease}#theme-toggle:hover{transform:scale(1.15)}#theme-toggle:active{transform:scale(.95)}.badge-wrapper{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap}.badge-wrapper a{display:inline-block;text-decoration:none;transition:transform .2s ease}.badge-wrapper a:hover{transform:translateY(-2px)}.badge-wrapper img{display:block;height:auto}.footer-statement{font-size:.75em;margin:0}sup.gray{color:var(--color-gray)}.tag-cloud{display:flex;flex-wrap:wrap;gap:12px;margin-top:16px}.tag-pill{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;background:var(--code-bg);border-radius:6px;text-decoration:none;transition:all .2s ease}.tag-pill:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.tag-count{color:var(--color-gray);font-size:.9em}.rss-link{display:inline-flex;align-items:center;justify-content:center;margin-left:12px;padding:4px 6px;text-decoration:none;border-radius:4px;font-size:1em;transition:all .2s ease;vertical-align:middle}.rss-link svg{height:1.2em;width:1.2em}.rss-link:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.year-group{margin:20px 0;border:1px solid var(--border-color);border-radius:8px;background:var(--bg-color);overflow:hidden;transition:box-shadow .3s ease,border-color .3s ease}.year-group:hover{border-color:var(--link-color);box-shadow:0 4px 12px rgba(0,0,0,8%)}html[data-theme=dark] .year-group:hover{box-shadow:0 4px 12px rgba(0,0,0,.3)}.year-group summary{cursor:pointer;user-select:none;padding:16px 20px;font-size:1.5rem;transition:background-color .2s ease;list-style:none;display:flex;align-items:center;gap:12px}.year-group summary::-webkit-details-marker{display:none}.year-group summary:hover{background-color:var(--code-bg)}.year-group summary .chevron-icon{flex-shrink:0;transition:transform .3s ease;color:var(--link-color)}.year-group[open] summary .chevron-icon{transform:rotate(90deg)}.year-group summary strong{font-weight:600}.year-group .year-content{display:grid;grid-template-rows:0fr;transition:grid-template-rows .3s ease-out}.year-group[open] .year-content{grid-template-rows:1fr}.year-group .year-content-inner{overflow:hidden;opacity:0;transition:opacity .3s ease}.year-group[open] .year-content-inner{opacity:1}.year-group ul.blog-posts{margin-top:0;padding:0 20px 20px}.year-group ul.blog-posts li{margin-bottom:8px;padding:10px 14px;border-radius:6px;transition:background-color .2s ease,transform .15s ease}.year-group ul.blog-posts li:hover{background-color:var(--code-bg);transform:translateX(4px)}.year-group ul.blog-posts li a{text-decoration:none;transition:color .2s ease}.year-group ul.blog-posts li a:hover{text-decoration:underline}@media(prefers-reduced-motion:reduce){.year-group,.year-group summary,.year-group summary .chevron-icon,.year-group .year-content,.year-group .year-content-inner,.year-group ul.blog-posts li{transition:none}}@media(min-width:601px){.title{font-size:38px}}@media(max-width:600px){body{font-size:18px}.title{font-size:1.35rem}.header-top{gap:6px}a.title{column-gap:6px}#lang-toggle{padding:4px 6px}.header-buttons{gap:4px}.lang-dropdown{margin-right:0}h1{font-size:1.65rem}h2{font-size:1.4rem}h3{font-size:1.2rem}h4{font-size:1.1rem}h5,h6{font-size:1rem}nav a,.nav-dropdown-trigger{margin-right:8px;font-size:.9em}pre code{font-size:15px;padding:14px 18px}.year-group{margin:16px 0}.year-group summary{font-size:1.15rem;padding:12px 16px;gap:10px}.year-group ul.blog-posts{padding:0 16px 16px}.year-group ul.blog-posts li{flex-direction:column;gap:4px;margin-bottom:12px;padding:8px 12px}.year-group ul.blog-posts li:hover{transform:translateX(2px)}.year-group ul.blog-posts li span,ul.blog-posts li span{flex:unset}}html[data-theme=dark] blockquote{color:#ccc}html[data-theme=dark] textarea,html[data-theme=dark] input{background-color:#252525;color:var(--text-color)}@media(prefers-color-scheme:dark){html:not([data-theme]) blockquote{color:#ccc}html:not([data-theme]) textarea,html:not([data-theme]) input{background-color:#252525;color:var(--text-color)}}.search-container{margin-bottom:1.5rem}#search-input{width:100%;padding:12px 16px;font-size:1rem;border:1px solid var(--border-color);border-radius:8px;background-color:var(--bg-color);color:var(--text-color);transition:border-color .2s ease,box-shadow .2s ease;box-sizing:border-box}#search-input:focus{outline:none;border-color:var(--link-color);box-shadow:0 0 0 3px rgba(50,115,220,.15)}#search-input::placeholder{color:var(--color-gray)}.search-info{margin-top:8px;font-size:.85em;color:var(--color-gray)}.search-results{margin-top:1rem}.search-result{padding:16px 0;border-bottom:1px solid var(--border-color)}.search-result:last-child{border-bottom:none}.search-result-title{font-size:1.1em;font-weight:600;text-decoration:none;display:block;margin-bottom:6px}.search-result-title:hover{text-decoration:underline}.search-result-meta{font-size:.85em;color:var(--color-gray);margin-bottom:8px}.search-result-date{font-style:italic}.search-result-tags{margin-left:8px}.search-tag{color:var(--link-color);text-decoration:none;margin-right:6px}.search-tag:hover{text-decoration:underline}.search-result-summary{font-size:.9em;color:var(--text-color);margin:0;line-height:1.5}.search-result mark{background-color:rgba(255,220,0,.4);color:inherit;padding:1px 2px;border-radius:2px}html[data-theme=dark] .search-result mark{background-color:rgba(255,180,0,.35)}@media(prefers-color-scheme:dark){html:not([data-theme]) .search-result mark{background-color:rgba(255,180,0,.35)}}.no-results{color:var(--color-gray);font-style:italic}.toc{margin:1.5rem 0;padding:.75rem 1rem;background:var(--code-bg);border-radius:4px;border:1px solid var(--border-color)}.toc summary{cursor:pointer;user-select:none;font-weight:600;list-style:none;position:relative;padding-left:24px}.toc summary::-webkit-details-marker{display:none}.toc summary::before{content:'‚ñ∂';position:absolute;left:0;top:50%;transform:translateY(-50%);transition:transform .3s ease;color:var(--link-color);font-size:.7em}.toc[open] summary::before{transform:translateY(-50%)rotate(90deg)}.toc nav ul{list-style:none;padding-left:0;margin:.75rem 0 0}.toc nav ul ul{padding-left:1.25rem}.toc nav li{margin:.25rem 0}.toc nav a{text-decoration:none;color:var(--text-color)}.toc nav a:hover{color:var(--link-color)}</style><link rel=apple-touch-icon href=https://perrotta.dev/apple-touch-icon.webp></head><body><div class=h-card style=display:none><a class="p-name u-url" href=https://perrotta.dev/>Thiago Perrotta</a>
<span class=p-nickname>thiagowfx</span>
<a class=u-email href=mailto:serendipity@perrotta.dev>serendipity@perrotta.dev</a>
<img class=u-photo src=https://perrotta.dev/thiagowfx.webp alt="Thiago Perrotta"></div><header><div class=header-top><a href=/ class=title><img src=https://perrotta.dev/thiagowfx.webp alt="thiagowfx's avatar" width=32 height=32><h1 class=title>¬¨ just serendipity üçÄ</h1></a><div class=header-buttons><button id=theme-toggle aria-label="Toggle dark mode" title="Toggle dark mode">
<span id=theme-toggle-icon>‚òÄÔ∏è</span></button></div></div><nav><a href=/tags/bestof/ class="has-emoji active-star"><span class=nav-emoji>‚≠ê</span>
<span class=nav-text>‚òÖ</span>
</a><a href=/search/><span class=nav-text>üîç</span>
</a><a href=/posts/><span class=nav-text>Blog</span></a><div class=nav-dropdown><button class=nav-dropdown-trigger>
<span class=nav-text>Explore</span>
<span class=nav-dropdown-arrow>‚ñº</span></button><div class=nav-dropdown-menu><a href=/projects/ class=nav-dropdown-item>Projects</a>
<a href=/blogroll/ class=nav-dropdown-item>Blogroll</a>
<a href=/tags/ class=nav-dropdown-item>Tags</a>
<a href=/categories/ class=nav-dropdown-item>Categories</a>
<a href=/categories/coding/ class="nav-dropdown-item nav-dropdown-item-coding">‚ñ∏ Coding</a></div></div></nav></header><main><script>document.addEventListener("keydown",function(e){if(e.key==="j"||e.key==="ArrowLeft"){const e=document.querySelector('[data-nav="prev"]');e&&e.href&&(window.location.href=e.href)}else if(e.key==="k"||e.key==="ArrowRight"){const e=document.querySelector('[data-nav="next"]');e&&e.href&&(window.location.href=e.href)}})</script><a href=https://perrotta.dev/2025/05/tailspin/ data-nav=prev style=display:none></a><a href=https://perrotta.dev/2025/05/pre-commit-add-hugo-build/ data-nav=next style=display:none></a><article class=h-entry><h2><span>‚òÖ</span> <span class=p-name>PostgreSQL major version upgrade on Alpine Linux</span></h2><p><span class=pubdate-single><time class=dt-published datetime=2025-05-24T16:00:23+02:00 pubdate>24 May, 2025
</time>‚Ä¢ 888 words ‚Ä¢ 5 min
‚Ä¢ updated <time datetime=2025-12-25>25 Dec, 2025</time></span></p><details class=toc><summary>Table of Contents</summary><nav id=TableOfContents><ul><li><a href=#problem-statement>Problem statement</a></li><li><a href=#procedure>Procedure</a></li><li><a href=#references>References</a></li></ul></nav></details><div class=e-content><h2 id=problem-statement>Problem statement</h2><p>Given Alpine Linux 3.22 running PostgreSQL 16, upgrade to PostgreSQL 17. For
this specific example, consider a <a href=https://miniflux.app/><code>miniflux</code></a> database.</p><h2 id=procedure>Procedure</h2><p>Install PostgreSQL 17:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% doas apk add postgres</code></pre></div><p>It can coexist with <code>postgres16</code>.</p><p>Stop the PostgreSQL daemon:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% doas service postgresql stop</code></pre></div><p>If you navigate to the Miniflux server with your browser, it will fail, as
expected:</p><div class=codeblock><pre><code class=language-plaintext>store: unable to create app session: dial tcp [::1]:5432: connect: connection refused</code></pre></div><p>Change the PostgreSQL system version to the desired one:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% doas pg_versions set-default 17</code></pre></div><p>Change to the root user, for convenience, then change to the existing postgresql
directory:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% doas su
% cd /var/lib/postgresql/</code></pre></div><p>Prepare files and directories for the upgrade:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% cd 16/
% mv data olddata
% cd ../
% mkdir 17/
% cd 17/
% mkdir data tmp
% chown postgres:postgres data tmp</code></pre></div><p>Change to the <code>postgres</code> user:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% su postgres
% cd tmp/</code></pre></div><p>Initialize the new cluster:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% initdb -D /var/lib/postgresql/17/data --locale=en_US.UTF-8 --encoding=UTF8 [--data-checksums]
The files belonging to this database system will be owned by user &#34;postgres&#34;.
This user must also own the server process.

The database cluster will be initialized with locale &#34;en_US.UTF-8&#34;.
The default text search configuration will be set to &#34;english&#34;.

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/postgresql/17/data ... ok
creating subdirectories ... ok
selecting dynamic shared memory implementation ... posix
selecting default &#34;max_connections&#34; ... 100
selecting default &#34;shared_buffers&#34; ... 128MB
selecting default time zone ... America/Toronto
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok

initdb: warning: enabling &#34;trust&#34; authentication for local connections
initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.

Success.</code></pre></div><p>In the previous command I chose to omit <code>--data-checksums</code>, otherwise I get the
following error:</p><div class=codeblock><pre><code class=language-plaintext>old cluster does not use data checksums but the new one does
Failure, exiting</code></pre></div><p>Upgrade the new cluster:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% pg_upgrade -b /usr/libexec/postgresql16/ -B /usr/libexec/postgresql17/ -d /var/lib/postgresql/16/olddata/ -D /var/lib/postgresql/17/data/
Performing Consistency Checks
-----------------------------
Checking cluster versions                                     ok
Checking database user is the install user                    ok
Checking database connection settings                         ok
Checking for prepared transactions                            ok
Checking for contrib/isn with bigint-passing mismatch         ok
Checking data type usage                                      ok
Creating dump of global objects                               ok
Creating dump of database schemas
                                                              ok
Checking for presence of required libraries                   ok
Checking database user is the install user                    ok
Checking for prepared transactions                            ok
Checking for new cluster tablespace directories               ok

If pg_upgrade fails after this point, you must re-initdb the
new cluster before continuing.

Performing Upgrade
------------------
Setting locale and encoding for new cluster                   ok
Analyzing all rows in the new cluster                         ok
Freezing all rows in the new cluster                          ok
Deleting files from new pg_xact                               ok
Copying old pg_xact to new server                             ok
Setting oldest XID for new cluster                            ok
Setting next transaction ID and epoch for new cluster         ok
Deleting files from new pg_multixact/offsets                  ok
Copying old pg_multixact/offsets to new server                ok
Deleting files from new pg_multixact/members                  ok
Copying old pg_multixact/members to new server                ok
Setting next multixact ID and offset for new cluster          ok
Resetting WAL archives                                        ok
Setting frozenxid and minmxid counters in new cluster         ok
Restoring global objects in the new cluster                   ok
Restoring database schemas in the new cluster
                                                              ok
Copying user relation files
                                                              ok
Setting next OID for new cluster                              ok
Sync data directory to disk                                   ok
Creating script to delete old cluster                         ok
Checking for extension updates                                ok

Upgrade Complete
----------------
Optimizer statistics are not transferred by pg_upgrade.
Once you start the new server, consider running:
    /usr/libexec/postgresql17/vacuumdb --all --analyze-in-stages
Running this script will delete the old cluster&#39;s data files:
    ./delete_old_cluster.sh</code></pre></div><p>Now clean up:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% ^D  # go back to the root user
% /var/lib/postgresql/17/tmp/delete_old_cluster.sh
% rmdir /var/lib/postgresql/16/  # it should be empty by now</code></pre></div><p>If you&rsquo;re curious about this script, it&rsquo;s a simple one-liner:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>#!/bin/sh

rm -rf &#39;/var/lib/postgresql/16/olddata&#39;</code></pre></div><p>Finally, let&rsquo;s get the cluster back up and vacuum it:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% ^D  # go back to your main user
% doas service postgresql start
% doas su - postgres -c &#39;/usr/libexec/postgresql17/vacuumdb --all --analyze-in-stages&#39;
vacuumdb: processing database &#34;miniflux&#34;: Generating minimal optimizer statistics (1 target)
vacuumdb: processing database &#34;postgres&#34;: Generating minimal optimizer statistics (1 target)
vacuumdb: processing database &#34;template1&#34;: Generating minimal optimizer statistics (1 target)
vacuumdb: processing database &#34;miniflux&#34;: Generating medium optimizer statistics (10 targets)
vacuumdb: processing database &#34;postgres&#34;: Generating medium optimizer statistics (10 targets)
vacuumdb: processing database &#34;template1&#34;: Generating medium optimizer statistics (10 targets)
vacuumdb: processing database &#34;miniflux&#34;: Generating default (full) optimizer statistics
vacuumdb: processing database &#34;postgres&#34;: Generating default (full) optimizer statistics
vacuumdb: processing database &#34;template1&#34;: Generating default (full) optimizer statistics</code></pre></div><p>At this point, Miniflux should be working again.
Navigate to <code>/about</code> and verify its database version: <code>Postgres version: 17.5</code>.</p><p>Last step, delete the previous package:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% doas apk del postgresql16 postgres16-contrib</code></pre></div><p>Double-check the newer version is still installed:</p><div class=codeblock data-lang=shell><div class=codeblock-header><span class=codeblock-language>shell</span>
<button class=codeblock-copy type=button data-copy-code>Copy</button></div><pre><code class=language-bash>% apk list -I | grep postgres
libpq-17.5-r0 x86_64 {postgresql17} (PostgreSQL) [installed]
postgresql-common-1.2-r1 x86_64 {postgresql-common} (MIT) [installed]
postgresql-common-openrc-1.2-r1 x86_64 {postgresql-common} (MIT) [installed]
postgresql-zsh-completion-5.9-r5 x86_64 {zsh} (MIT-Modern-Variant AND GPL-2.0-only) [installed]
postgresql17-17.5-r0 x86_64 {postgresql17} (PostgreSQL) [installed]
postgresql17-client-17.5-r0 x86_64 {postgresql17} (PostgreSQL) [installed]
postgresql17-contrib-17.5-r0 x86_64 {postgresql17} (PostgreSQL) [installed]
postgresql17-openrc-17.5-r0 x86_64 {postgresql17} (PostgreSQL) [installed]</code></pre></div><p>And we&rsquo;re done!</p><h2 id=references>References</h2><ul><li><a href=https://wiki.alpinelinux.org/wiki/Postgresql>https://wiki.alpinelinux.org/wiki/Postgresql</a></li><li><a href=https://beune.dev/posts/upgrade-alpine-postgresql/>https://beune.dev/posts/upgrade-alpine-postgresql/</a></li></ul></div><p style="text-align:center;margin:2em 0 1em">‚Äî ¬ß ‚Äî</p><div style=display:flex;justify-content:space-between><p style=margin:0>Reply via
<a href="mailto:serendipity@perrotta.dev?subject=Reply to: PostgreSQL%20major%20version%20upgrade%20on%20Alpine%20Linux">email</a></p><p style=margin:0><a href=https://perrotta.dev/tags/bestof/>#bestof</a> <a href=https://perrotta.dev/tags/dev/>#dev</a></p></div><div style="border:2px solid var(--border-color);border-radius:.5rem;padding:1.5rem;margin-top:1.5rem"><h4 style=margin-top:0>Related Posts</h4><section style="display:flex;flex-wrap:wrap;gap:1rem;margin:1rem 0"><article style="flex:1 1 250px;padding:1rem;background:var(--code-bg);border-radius:.25rem;color:var(--text-color)"><h5 style=margin-top:0;margin-bottom:.5rem;color:var(--heading-color)><a href=https://perrotta.dev/2025/06/alpine-linux-packaging-track-new-software-releases/>Alpine Linux packaging: track new software releases</a></h5><p style="margin:.5rem 0;font-size:.9rem">Problem statement: You maintain packages for a Linux distribution, for example, Alpine Linux. Find a way to keep track of new software releases, to ‚Ä¶</p><small style=color:var(--color-gray)>Jun 03, 2025</small></article><article style="flex:1 1 250px;padding:1rem;background:var(--code-bg);border-radius:.25rem;color:var(--text-color)"><h5 style=margin-top:0;margin-bottom:.5rem;color:var(--heading-color)><a href=https://perrotta.dev/2025/04/alpine-linux-the-maintainer-workflow/>Alpine Linux: the maintainer workflow</a></h5><p style="margin:.5rem 0;font-size:.9rem">I maintain a couple of packages on Alpine Linux.
Every now and then, a new software version is released, and it&rsquo;s my duty1 as an active package ‚Ä¶</p><small style=color:var(--color-gray)>Apr 20, 2025</small></article></section></div><a class=u-url href=https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/ aria-hidden=true style=display:none></a><a class="u-author h-card" href=https://perrotta.dev/ rel=author style=display:none>Thiago Perrotta</a></article></main><hr><footer><span>¬© 2021 - 2026 Thiago Perrotta ¬∑
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>some rights reserved</a> ¬∑
a fork of <a href=https://github.com/janraasch/hugo-bearblog/>hugo  ï‚Ä¢·¥•‚Ä¢ î bear</a> ¬∑ <a href=/canary>üê¶</a> ¬∑ <a href=https://uptime.perrotta.dev/status/serendipity>status</a></span><div class=social-link-wrapper><a target=_blank rel=noopener class=social-link href=mailto:serendipity@perrotta.dev title="Email address"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" height="1.2em" width="1.2em"><path d="M3 8l7.89 5.26a2 2 0 002.22.0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v10a2 2 0 002 2z"/></svg>
</a><a target=_blank rel=noopener class=social-link href=https://perrotta.dev/index.xml title="RSS feed"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" height="1.2em" width="1.2em"><path d="M4 11a9 9 0 019 9M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg>
</a><a target=_blank rel="me noopener" class=social-link href=https://github.com/thiagowfx title="Github profile"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a target=_blank rel="me noopener" class=social-link href=https://goodreads.com/user/show/7873832-thiago title="Goodreads profile"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 50 50" height="1em" width="1em"><path d="M25 2c-4.541.0-8.41336 1.9082151-11.017578 4.9453125C11.378203 9.9824099 10 14.07975 10 18.5s1.378203 8.517589 3.982422 11.554688C16.58664 33.091785 20.459 35 25 35c4.531588.0 8.395936-1.901605 11-4.927734V35c0 2.598543-.818503 4.764071-2.451172 6.339844C31.91616 42.915616 29.363725 44 25.5 44 17.784314 44 15 39.933333 15 36H11c0 6.066667 5.215686 12 14.5 12 4.636275.0 8.33384-1.377726 10.826172-3.783203C38.818503 41.811319 40 38.476457 40 35V18.5 3H36V6.9277344C33.395936 3.9016049 29.531588 2 25 2zm0 4c3.459.0 6.08664 1.3379255 7.982422 3.5488281C34.878203 11.759731 36 14.91225 36 18.5s-1.121797 6.740269-3.017578 8.951172C31.08664 29.662074 28.459 31 25 31s-6.08664-1.337926-7.982422-3.548828C15.121797 25.240269 14 22.08775 14 18.5s1.121797-6.740269 3.017578-8.9511719C18.91336 7.3379255 21.541 6 25 6z"/></svg>
</a><a target=_blank rel="me noopener" class=social-link href=https://linkedin.com/in/thiagoperrotta title="LinkedIn profile"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 30 30" height="1.2em" width="1.2em"><path d="M24 4H6C4.895 4 4 4.895 4 6v18c0 1.105.895 2 2 2h18c1.105.0 2-.895 2-2V6c0-1.105-.895-2-2-2zM10.954 22h-2.95v-9.492h2.95V22zM9.449 11.151c-.951.0-1.72-.771-1.72-1.72s.77-1.719 1.72-1.719c.948.0 1.719.771 1.719 1.719C11.168 10.38 10.397 11.151 9.449 11.151zM22.004 22h-2.948v-4.616c0-1.101-.02-2.517-1.533-2.517-1.535.0-1.771 1.199-1.771 2.437V22h-2.948v-9.492h2.83v1.297h.04c.394-.746 1.356-1.533 2.791-1.533 2.987.0 3.539 1.966 3.539 4.522V22z"/></svg>
</a><a target=_blank rel="me noopener" class=social-link href=https://stackoverflow.com/users/1745064/thiagowfx title="StackOverflow profile"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em"><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 3e2zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-2e2v39.7h2e2zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg></a></div><div class=badge-wrapper><a target=_blank href=https://indieweb.org/ title=IndieWebCamp><img src=https://perrotta.dev/indieweb88x31-flat.webp width=88 height=31 alt=IndieWebCamp>
</a><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/ title="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License"><img src=https://perrotta.dev/cc-by-nc-sa-4.0-88x31.webp width=88 height=31 alt="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License">
</a><a target=_blank href=https://512kb.club title="512kb.club badge"><img src=https://perrotta.dev/green-team.webp width=88 height=31 alt="a proud member of the green team of 512KB club">
</a><a target=_blank href=https://powrss.com/ title=powRSS><img src=https://perrotta.dev/powrss-88-31.webp width=88 height=31 alt=powRSS>
</a><a target=_blank href=https://www.vim.org/ title="Vim text editor"><img src=https://perrotta.dev/vim.webp width=88 height=31 alt="Vim text editor">
</a><a target=_blank href=https://edleeman.co.uk/cookie-zero/ title="Cookie Zero"><img src=https://perrotta.dev/cookiezero.webp width=88 height=31 alt="Cookie Zero">
</a><a target=_blank href="https://validator.w3.org/nu/?doc=https://perrotta.dev/" title="Valid HTML5"><img src=https://perrotta.dev/html5-validator-badge.webp width=88 height=31 alt="Valid HTML5">
</a><a target=_blank href="https://validator.w3.org/feed/check.cgi?url=https://perrotta.dev/index.xml" title="Valid RSS feed"><img src=https://perrotta.dev/valid-rss-rogers.webp width=88 height=31 alt="Valid RSS feed"></a></div><p class=webring><a href=https://xn--sr8hvo.ws/previous>‚Üê</a>
An <a href=https://xn--sr8hvo.ws>IndieWeb Webring</a> üï∏üíç
<a href=https://xn--sr8hvo.ws/next>‚Üí</a></p><p class=footer-statement>This site respects your privacy by not containing <a href=https://www.nevermonetize.com/>ads</a>,
not using tracking cookies,
and not collecting any personally identifiable information.
<a href=/ai>Gen AI policy</a>.</p></footer><script>function setTheme(e){e==="auto"?(document.documentElement.removeAttribute("data-theme"),localStorage.removeItem("theme")):(document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)),updateThemeIcon()}function getCurrentThemeState(){return localStorage.getItem("theme")||"auto"}function updateThemeIcon(){const e=getCurrentThemeState(),t={auto:"üåì",dark:"üåô",light:"‚òÄÔ∏è"};document.getElementById("theme-toggle-icon").textContent=t[e]}const saved=localStorage.getItem("theme");saved&&document.documentElement.setAttribute("data-theme",saved),updateThemeIcon(),document.getElementById("theme-toggle").addEventListener("click",function(){const e=getCurrentThemeState(),t={auto:"light",light:"dark",dark:"auto"},n=t[e];setTheme(n)});const dropdownTriggers=document.querySelectorAll(".nav-dropdown-trigger");dropdownTriggers.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.closest(".nav-dropdown"),n=t.classList.contains("open");document.querySelectorAll(".nav-dropdown.open").forEach(e=>{e.classList.remove("open")}),n||t.classList.add("open")})});const langToggle=document.getElementById("lang-toggle");langToggle&&langToggle.addEventListener("click",function(e){e.preventDefault();const t=this.closest(".lang-dropdown"),n=t.classList.contains("open");document.querySelectorAll(".lang-dropdown.open").forEach(e=>{e.classList.remove("open")}),n||t.classList.add("open")}),document.addEventListener("click",function(e){!e.target.closest(".nav-dropdown")&&!e.target.closest(".lang-dropdown")&&(document.querySelectorAll(".nav-dropdown.open").forEach(e=>{e.classList.remove("open")}),document.querySelectorAll(".lang-dropdown.open").forEach(e=>{e.classList.remove("open")}))}),document.addEventListener("click",function(e){if(!e.target.matches("[data-copy-code]"))return;const t=e.target,n=t.closest(".codeblock");if(!n)return;const s=n.querySelector("pre code");if(!s)return;const o=s.innerText;if(!navigator.clipboard||!navigator.clipboard.writeText)return;navigator.clipboard.writeText(o).then(function(){t.dataset.originalLabel=t.textContent,t.textContent="Copied!",setTimeout(function(){t.textContent=t.dataset.originalLabel||"Copy"},1500)}).catch(function(){t.textContent="Failed",setTimeout(function(){t.textContent=t.dataset.originalLabel||"Copy"},1500)})})</script></body></html>