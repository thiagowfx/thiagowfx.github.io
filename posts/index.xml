<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>¬ just serendipity 🍀</title><link>https://perrotta.dev/posts/</link><description>Recent content on ¬ just serendipity 🍀</description><generator>Hugo</generator><language>en-us</language><managingEditor>serendipity@perrotta.dev (Thiago Perrotta)</managingEditor><webMaster>serendipity@perrotta.dev (Thiago Perrotta)</webMaster><copyright>© 2021 - 2025 Thiago Perrotta ·
[some rights reserved](https://creativecommons.org/licenses/by-nc-sa/4.0/) ·
a fork of [hugo ʕ•ᴥ•ʔ bear](https://github.com/janraasch/hugo-bearblog/)</copyright><lastBuildDate>Thu, 24 Jul 2025 12:37:31 +0200</lastBuildDate><atom:link href="https://perrotta.dev/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>git: developer certificate of origin (DCO) sign-off</title><link>https://perrotta.dev/2025/07/git-developer-certificate-of-origin-dco-sign-off/</link><pubDate>Thu, 24 Jul 2025 12:37:31 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/git-developer-certificate-of-origin-dco-sign-off/</guid><description>&lt;p>The &lt;a href="https://developercertificate.org/">Developer Certificate of Origin&lt;/a> (DCO
for short) is often required when sending out PRs upstream.&lt;/p>
&lt;p>For example, contributions to the Linux kernel
&lt;a href="https://wiki.linuxfoundation.org/dco">mandate&lt;/a> it.
&lt;a href="https://cert-manager.io/docs/contributing/sign-off/">Other&lt;/a>
&lt;a href="https://gcc.gnu.org/dco.html">projects&lt;/a>
&lt;a href="https://docs.pi-hole.net/guides/github/dco/">too&lt;/a>.&lt;/p>
&lt;p>It&amp;rsquo;s even possible to enforce it via &lt;a href="https://github.com/apps/dco">Github
Actions&lt;/a>.&lt;/p>
&lt;p>Suppose that you sent a PR with a single commit but forgot to sign it off. You
can amend it with:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>git rebase HEAD~1 --signoff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git push --force-with-lease origin &lt;span style="color:#56b6c2">[&lt;/span>branch&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or you can do it proactively, at commit time:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>git commit &lt;span style="color:#56b6c2">[&lt;/span>-s | --signoff&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It is
&lt;a href="https://stackoverflow.com/questions/77279077/how-to-sign-off-every-git-commit">often&lt;/a>
&lt;a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-formatsignOff">discouraged&lt;/a>
to have &lt;code>git&lt;/code> automatically do it:&lt;/p>
&lt;blockquote>
&lt;p>Adding the Signed-off-by trailer to a patch should be a conscious act and means
that you certify you have the rights to submit this work under the same open
source license.&lt;/p>
&lt;/blockquote>
&lt;p>In practice, a sign-off is an ordinary &lt;a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/git-footers.html">git
footer&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>Signed-off-by: John Doe &amp;lt;john@example.com&amp;gt;
&lt;/code>&lt;/pre></description></item><item><title>Reader's block</title><link>https://perrotta.dev/2025/07/readers-block/</link><pubDate>Wed, 23 Jul 2025 13:35:47 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/readers-block/</guid><description>&lt;p>You have probably heard of &lt;em>writer&amp;rsquo;s block&lt;/em>:&lt;/p>
&lt;blockquote>
&lt;p>a non-medical condition, primarily associated with writing, in which an author
is either unable to produce new work or experiences a creative slowdown.&lt;/p>
&lt;/blockquote>
&lt;p>But have you heard of &lt;em>reader&amp;rsquo;s block&lt;/em>?&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>&lt;/p>
&lt;p>&lt;strong>Definition&lt;/strong>: a condition wherein a reader is unable to start a new book for a
certain period upon finishing another book.&lt;/p>
&lt;p>Once you reach the end of a good book, there are often two feelings you will
experience:&lt;/p>
&lt;p>One is pure joy, a sense of accomplishment that feels oddly satisfying. It&amp;rsquo;s an
addiction, part of the machinery of your brain rewarding circuitry that makes
you crave for more.&lt;/p>
&lt;p>The other one? You know it already.&lt;/p>
&lt;p>It takes a while to &amp;ldquo;recover&amp;rdquo; from a good book. It&amp;rsquo;s as if the brain didn&amp;rsquo;t want
to forget it too soon, needing some time to process and &amp;ldquo;engrave&amp;rdquo; it in your
mind.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Probably not, because I am making it up.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>vim: join lines without producing a space</title><link>https://perrotta.dev/2025/07/vim-join-lines-without-producing-a-space/</link><pubDate>Tue, 22 Jul 2025 11:50:28 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/vim-join-lines-without-producing-a-space/</guid><description>&lt;p>Here&amp;rsquo;s a common issue I have when blogging, when inserting a markdown link with
&lt;code>vim&lt;/code>. The edit progression is as follows, wherein &lt;code>|&lt;/code> represents the cursor:&lt;/p>
&lt;p>First, blank:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>|
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then, type out the hyperlink label and prepare to insert the link:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">|
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now go to another buffer (window) and copy the link (with &lt;code>y&lt;/code> + motion).&lt;/p>
&lt;p>Go back to the original buffer and paste it with &lt;code>p&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">|https://example.com/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Press &lt;code>kJ&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">| https://example.com/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Press &lt;code>J&lt;/code> again:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">| https://example.com/&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>J&lt;/code> is for &amp;ldquo;join lines&amp;rdquo; (&lt;code>:help J&lt;/code>).&lt;/p>
&lt;p>Do you see the issue above? The first &lt;code>J&lt;/code> inserts a space, the second one does
not. This inconsistency is frustrating.&lt;/p>
&lt;p>This &lt;a href="https://vi.stackexchange.com/questions/439/how-to-join-lines-without-producing-a-space">vi stack
exchange&lt;/a>
question seeks to address it:&lt;/p>
&lt;blockquote>
&lt;p>The standard J command for joining lines replaces the newline character(s)
with a space. It&amp;rsquo;s useful when editing &amp;rsquo;literature&amp;rsquo; but can be troublesome if
I, say, edit a hex dump by hand if I forget to remove the superfluous space.&lt;/p>
&lt;p>Is there a quick &amp;amp; easy method to join two lines without producing a space
between them?&lt;/p>
&lt;/blockquote>
&lt;p>The standard recommendation is to use &lt;code>gJ&lt;/code> to do so. From &lt;code>:help gJ&lt;/code>:&lt;/p>
&lt;blockquote>
&lt;p>Join [count] lines, with a minimum of two lines. Don&amp;rsquo;t insert or remove any
spaces.&lt;/p>
&lt;/blockquote>
&lt;p>But it&amp;rsquo;s harder to memorize than simply &lt;code>J&lt;/code>. Plus, it&amp;rsquo;s an extra keystroke. I&amp;rsquo;d
rather unconditionally use &lt;code>J&lt;/code>.&lt;/p>
&lt;p>It turns out it&amp;rsquo;s possible to do so with a simple config setting, added to
&lt;code>~/.vimrc&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-vim" data-lang="vim">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">nnoremap&lt;/span> &lt;span style="color:#e06c75">J&lt;/span> &lt;span style="color:#e06c75">gJ&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>When repeating the original link insertion sequence, it yields the following
result, as desired (no spaces anywhere!):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">|https://example.com/&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Ghostty: migrating config to dotfiles</title><link>https://perrotta.dev/2025/07/ghostty-migrating-config-to-dotfiles/</link><pubDate>Mon, 21 Jul 2025 14:56:27 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/ghostty-migrating-config-to-dotfiles/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2024/12/ghostty/">This year&lt;/a> I migrated my terminal
application from &lt;a href="https://iterm2.com/">iTerm2&lt;/a> to
&lt;a href="https://ghostty.org/">Ghostty&lt;/a> on macOS.&lt;/p>
&lt;p>Ghostty has great defaults; I find that there are only a handful of
customizations that I need to make to satisfy my needs.&lt;/p>
&lt;p>One can configure ghostty by opening its config file with &lt;code>Cmd + ,&lt;/code>, the typical
preferences shortcut on macOS.&lt;/p>
&lt;p>In a vanilla system, that config file is initially &lt;code>$HOME/Library/Application\ Support/com.mitchellh.ghostty/config&lt;/code>
(&lt;a href="https://ghostty.org/docs/config#macos-specific-path-(macos-only):">docs&lt;/a>).&lt;/p>
&lt;p>That location is not convenient / accessible though.&lt;/p>
&lt;p>Upon digging the &lt;a href="https://ghostty.org/docs/config">ghostty config docs&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>$XDG_CONFIG_HOME/ghostty/config.
if XDG_CONFIG_HOME is not defined, it defaults to $HOME/.config/ghostty/config.

macOS-specific Path (macOS only):
$HOME/Library/Application\ Support/com.mitchellh.ghostty/config
macOS also supports the XDG configuration path mentioned above.
&lt;/code>&lt;/pre>&lt;p>I prefer the &lt;code>~/.config/ghostty&lt;/code> location: it is cross-platform, compatible with
Linux as well, and I can easily add it to my
&lt;a href="https://github.com/thiagowfx/.dotfiles/blob/master/ghostty/config">dotfiles&lt;/a>.&lt;/p>
&lt;p>Moving the file to that location yields a no-frills migration:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% mv &lt;span style="color:#e06c75">$HOME&lt;/span>/Library/Application&lt;span style="color:#98c379">\ &lt;/span>Support/com.mitchellh.ghostty/config &lt;span style="color:#e06c75">$HOME&lt;/span>/.config/ghostty/config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>As of today, the config looks like this:&lt;/p>
&lt;pre tabindex="0">&lt;code># https://ghostty.org/docs/config
# keep-sorted start
cursor-style-blink = false
keybind = shift+enter=text:\n
macos-icon = chalkboard
shell-integration-features = no-cursor
theme = catppuccin-macchiato
# keep-sorted end
&lt;/code>&lt;/pre>&lt;p>The first line is a handy shortcut to the config documentation.&lt;/p>
&lt;p>The &lt;a href="https://github.com/google/keep-sorted">&lt;code>keep-sorted&lt;/code>&lt;/a> stanzas stem from my
tendency to keep the house tidy. They are not merely comments: the sorting is
actually enforced via a git &lt;a href="https://pre-commit.com/">pre-commit&lt;/a> hook.&lt;/p>
&lt;p>&lt;code>cursor-style-blink = false&lt;/code>: blinking cursor is unnecessarily distracting.&lt;/p>
&lt;p>&lt;code>keybind = shift+enter=text:\n&lt;/code>: &lt;a href="https://www.anthropic.com/claude-code">Claude Code&lt;/a> added this, it&amp;rsquo;s &lt;a href="https://github.com/ghostty-org/ghostty/discussions/7780">surprising&lt;/a> it&amp;rsquo;s not the default:&lt;/p>
&lt;pre tabindex="0">&lt;code>[...]
│ &amp;gt; /termi │
───────────────────────────────────────────────────────────────╯
 /terminal-setup Install Shift+Enter key binding for newlines
&lt;/code>&lt;/pre>&lt;p>&lt;code>macos-icon = chalkboard&lt;/code>: bells and whistles.&lt;/p>
&lt;p>&lt;code>shell-integration-features = no-cursor&lt;/code>: some
&lt;a href="https://github.com/ghostty-org/ghostty/discussions/2812#discussioncomment-11686920">context&lt;/a>.&lt;/p>
&lt;p>&lt;code>theme = catppuccin-macchiato&lt;/code>: more bells and whistles. You may like: &lt;code>ghostty +list-themes&lt;/code>.&lt;/p></description></item><item><title>Steam Deck: 640x480 external monitor resolution</title><link>https://perrotta.dev/2025/07/steam-deck-640x480-external-monitor-resolution/</link><pubDate>Sun, 20 Jul 2025 12:12:05 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/steam-deck-640x480-external-monitor-resolution/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: When connecting the Steam Deck to a TV via a dock + HDMI
cable, the display resolution is stuck at 640x480.&lt;/p>
&lt;p>No other resolutions are available, in both gaming mode and in desktop mode.&lt;/p>
&lt;p>A few
&lt;a href="https://geekygorevan.co.uk/how-to-fix-the-640x480-external-monitor-issue-on-your-steam-deck/">anecdotes&lt;/a>
in the internets™ suggest to&amp;hellip;&lt;/p>
&lt;blockquote>
&lt;p>After thoroughly exploring various troubleshooting options and attempting
different approaches such as disconnecting cables and power cycling the Steam
Deck, I eventually discovered the simplest solution to this problem: &lt;strong>removing
power from the dock.&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;p>It sounds disingenuous, but I verified it works indeed:&lt;/p>
&lt;ol>
&lt;li>TV off, steam deck off.&lt;/li>
&lt;li>Plug in the dock + the HDMI cable. &lt;strong>DO NOT&lt;/strong> connect the power (yet).&lt;/li>
&lt;li>Turn the TV on.&lt;/li>
&lt;li>Turn the steam deck on.&lt;/li>
&lt;li>Verify (hope, pray, wish) the resolution, it should be 1920x1080 (or
similar).&lt;/li>
&lt;li>Plug the power.&lt;/li>
&lt;/ol>
&lt;p>Your Steam Deck is connected to the TV, therefore you will need an external
Bluetooth controller to interact with it and play games. I like the
&lt;a href="https://stadia.google.com/controller/">Stadia&lt;/a> controller. It is still possible
to find a few units in the aftermarket.&lt;/p>
&lt;p>Now go play your game and have fun 🎮.&lt;/p></description></item><item><title>Alpine Linux: remove broken packages</title><link>https://perrotta.dev/2025/07/alpine-linux-remove-broken-packages/</link><pubDate>Sun, 20 Jul 2025 10:52:11 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/alpine-linux-remove-broken-packages/</guid><description>&lt;p>In a sunny Sunday morning:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk upgrade
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARNING: The indexes contain broken packages which might not &lt;span style="color:#c678dd">function&lt;/span> properly.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What?! Out of nowhere?&lt;/p>
&lt;p>I tried a couple of basic troubleshooting commands:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk update --force-refresh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas apk fix
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas apk cache clean
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&amp;hellip;to no avail.&lt;/p>
&lt;p>Next idea: search engines. Virtually no results on &lt;a href="https://kagi.com/">Kagi&lt;/a>. No
relevant results on Google either&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>Next idea: LLMs. Nothing useful either.&lt;/p>
&lt;p>This is novel territory! That&amp;rsquo;s what makes it fun to self-host Alpine Linux&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>My intuition tells me to start by searching their
&lt;a href="https://gitlab.alpinelinux.org/alpine">Gitlab&lt;/a>. Eventually I got linked to
&lt;a href="https://sourcegraph.com/github.com/alpinelinux/apk-tools/-/blob/test/solver/error11.test?L3-5">this&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>test/solver/error11.test:

@ARGS add invalid
@REPO error.repo
@EXPECT
WARNING: The indexes contain broken packages which are not installable.
ERROR: unable to select packages:
 invalid-1:
 error: uninstallable
 satisfies: world[invalid]
&lt;/code>&lt;/pre>&lt;p>From this test file, it seems possible that there&amp;rsquo;s an invalid package in my
&lt;code>/etc/apk/world&lt;/code>. The error message is not quite the same, but it is similar:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% wc -l /etc/apk/world
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d19a66">293&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>There are too many packages there to hunt each of them by hand. And I didn&amp;rsquo;t
install any new packages recently.&lt;/p>
&lt;p>So I looked into &lt;code>apk fix --help&lt;/code> and discovered there is a &lt;code>--verbose&lt;/code> flag. I
did not save its output, but there were five packages there:&lt;/p>
&lt;pre tabindex="0">&lt;code>- busybox-initscripts
- kmod-openrc
- libacl
- py3-pep517
- sensible-utils
&lt;/code>&lt;/pre>&lt;p>I ran &lt;code>doas apk del&lt;/code> to remove all of them. That was a sensible cleanup, but it
still has not resolved the issue.&lt;/p>
&lt;p>If I want to dive deeper into this, I&amp;rsquo;ll have to add some debugging logging to
&lt;a href="https://sourcegraph.com/github.com/alpinelinux/apk-tools@bffc60041447cadee5b69c291df8c90eb3b8fe82/-/blob/src/database.c?L2090">&lt;code>src/database.c&lt;/code>&lt;/a>
in &lt;code>apk-tools&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> (&lt;span style="color:#e06c75">db&lt;/span>&lt;span style="color:#56b6c2">-&amp;gt;&lt;/span>&lt;span style="color:#e06c75">compat_depversions&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#61afef;font-weight:bold">apk_warn&lt;/span>(&lt;span style="color:#e06c75">out&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;The indexes contain broken packages which %s.&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">db&lt;/span>&lt;span style="color:#56b6c2">-&amp;gt;&lt;/span>&lt;span style="color:#e06c75">compat_notinstallable&lt;/span> &lt;span style="color:#56b6c2">?&lt;/span> &lt;span style="color:#98c379">&amp;#34;are not installable&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">:&lt;/span> &lt;span style="color:#98c379">&amp;#34;might not function properly&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then one last thought occurred to me:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% apk --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apk-tools 3.0.0_rc5_git20250715-r0, compiled &lt;span style="color:#c678dd">for&lt;/span> x86_64.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aha! I am running a release candidate version of &lt;code>apk&lt;/code>, because I am using
Alpine Linux edge repositories:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat /etc/apk/repositories
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://dl-cdn.alpinelinux.org/alpine/edge/main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://dl-cdn.alpinelinux.org/alpine/edge/community
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://dl-cdn.alpinelinux.org/alpine/edge/testing
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>From the
&lt;a href="https://wiki.alpinelinux.org/wiki/Draft_Release_Notes_for_Alpine_3.23.0">Wiki&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>After 5 years of development in the master branch of apk-tools, apk v3 is now
ready for Alpine v3.23.0. This should be a safe and seamless upgrade from apk
v2, but might has some breaking changes if you use libapk.&lt;/p>
&lt;/blockquote>
&lt;p>No wonder this is bleeding edge territory!&lt;/p>
&lt;p>I would say that there&amp;rsquo;s nothing to do here, other than waiting for the next
release of Alpine Linux (3.23) with apk-tools v3, and ignoring the warning in
the meantime.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Their AI overview insists on spitting out useless information about
Ubuntu, which is completely unrelated in this case.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>It is &lt;em>fun&lt;/em>. Right? Right?!&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>check-json-schema: pre-commit hook</title><link>https://perrotta.dev/2025/07/check-json-schema-pre-commit-hook/</link><pubDate>Fri, 11 Jul 2025 22:05:32 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/check-json-schema-pre-commit-hook/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: given an &lt;code>entry.json&lt;/code> file, validate it against a given
&lt;code>schema.json&lt;/code> file (for example, found via the &lt;a href="https://www.schemastore.org/">schema
store&lt;/a>).&lt;/p>
&lt;p>I like the
&lt;a href="https://github.com/python-jsonschema/check-jsonschema">check-jsonschema&lt;/a> python
package:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>pipx run check-jsonschema --schemafile schema.json entry.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What if we want to do the validation via a
&lt;a href="https://pre-commit.com">pre-commit.com&lt;/a> hook?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">repo&lt;/span>: https://github.com/python-jsonschema/check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">rev&lt;/span>: &lt;span style="color:#d19a66">0.33.2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: ^entry\.json$
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">args&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --schemafile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - schema.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This approach works well, but it requires the upkeep of a mapping from JSON file
to JSON schema.&lt;/p>
&lt;p>If we had various JSON files within a single repository, this would result in a
maintenance burden in the pre-commit config file.&lt;/p>
&lt;p>For example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">repo&lt;/span>: https://github.com/python-jsonschema/check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">rev&lt;/span>: &lt;span style="color:#d19a66">0.33.2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">alias&lt;/span>: check-jsonschema-entry1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: ^entry1\.json$
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">args&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --schemafile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - schema1.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">alias&lt;/span>: check-jsonschema-entry2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: ^entry2\.json$
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">args&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --schemafile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - schema2.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s somewhat annoying to maintain multiple entries in that fashion. Furthermore
it can easily get outdated: upon the deletion of &lt;code>entry1.json&lt;/code> from the
repository, you&amp;rsquo;d need to remember to manually delete its corresponding entry
from the pre-commit config file.&lt;/p>
&lt;p>Can we do better?&lt;/p>
&lt;p>What if we embedded the schema reference within the JSON file itself?&lt;/p>
&lt;p>For example, with a local schema:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">&amp;#34;$schema&amp;#34;&lt;/span>: &lt;span style="color:#98c379">&amp;#34;schema.json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or with a remote schema URI, via HTTPS:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">&amp;#34;$schema&amp;#34;&lt;/span>: &lt;span style="color:#98c379">&amp;#34;https://example.com/schema.json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now the JSON file is self-contained, and there&amp;rsquo;s no need to define a mapping
from it to its JSON schema elsewhere.&lt;/p>
&lt;p>How can we integrate this approach within pre-commit?&lt;/p>
&lt;p>Initially I thought that
&lt;a href="https://github.com/python-jsonschema/check-jsonschema/blob/8900e07e2002c4b073e1dca7969ce81a19fcb142/.pre-commit-hooks.yaml#L10C7-L10C23">&lt;code>check-metaschema&lt;/code>&lt;/a>
from the &lt;code>check-jsonschema&lt;/code> python package was the answer, but it turns out it
isn&amp;rsquo;t.&lt;/p>
&lt;p>In fact, this isn&amp;rsquo;t currently possible. There&amp;rsquo;s a &lt;a href="https://github.com/python-jsonschema/check-jsonschema/issues/310">feature
request&lt;/a>,
filed ~2 years ago, with no consensus yet on how move forward. Its maintainer
seems helpful and concerned with backwards compatibility.&lt;/p>
&lt;p>For the sake of unblocking myself, I decided to wrap the ability to do so within
my own pre-commit hook definition.&lt;/p>
&lt;p>This gave birth to the following repository:
&lt;a href="https://github.com/thiagowfx/check-json-schema-meta">&lt;code>thiagowfx/check-json-schema-meta&lt;/code>&lt;/a>, which I also &lt;a href="https://github.com/python-jsonschema/check-jsonschema/issues/310#issuecomment-3062174357">announced&lt;/a> in the original feature request thread.&lt;/p>
&lt;p>Usage:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">repo&lt;/span>: https://github.com/thiagowfx/check-json-schema-meta
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">rev&lt;/span>: v0.0.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: check-json-schema-meta
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It goes through each JSON file in the repository, looking for an optional
top-level &lt;code>$schema&lt;/code> key. When found, the file is validated against the defined
schema.&lt;/p>
&lt;p>A &lt;code>--strict&lt;/code> command-line flag enforces the presence of the &lt;code>$schema&lt;/code> key,
otherwise the default behavior is to skip files that do not have it.&lt;/p>
&lt;p>The underlying schema validation defers the work to the same python package
first mentioned in this post. Because it uses
&lt;a href="https://github.com/python-jsonschema/check-jsonschema/blob/8900e07e2002c4b073e1dca7969ce81a19fcb142/src/check_jsonschema/schema_loader/main.py#L74">&lt;code>SchemaLoader&lt;/code>&lt;/a>,
both local and remote (http(s)) file references are supported.&lt;/p>
&lt;p>This is the first original pre-commit hook I have written. By original I mean
that I couldn&amp;rsquo;t find any pre-existing open source hook that accomplishes this
task. The entire repository was developed with AI assistance (&lt;a href="https://www.anthropic.com/claude-code">Claude
Code&lt;/a>), but I wasn&amp;rsquo;t satisfied with
out-of-the-box defaults; I had to heavily modify it to shape it to my taste –
which was achieved with a mix of follow-up prompting and local edits.&lt;/p></description></item><item><title>pq: could not access file "$libdir/dict_snowball": No such file or directory</title><link>https://perrotta.dev/2025/07/pq-could-not-access-file-libdir/dict_snowball-no-such-file-or-directory/</link><pubDate>Thu, 10 Jul 2025 11:14:29 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/pq-could-not-access-file-libdir/dict_snowball-no-such-file-or-directory/</guid><description>&lt;p>My &lt;a href="http://miniflux.app/">miniflux&lt;/a> instance broke yesterday. All feeds had the
following error:&lt;/p>
&lt;pre tabindex="0">&lt;code>3 errors - Database error: store: unable to update entry &amp;#34;{redacted}&amp;#34;: pq: could not access file &amp;#34;$libdir/dict_snowball&amp;#34;: No such file or directory.
&lt;/code>&lt;/pre>&lt;p>The error is from PostgreSQL (&lt;code>pq&lt;/code>).&lt;/p>
&lt;p>I recall I did a full system upgrade yesterday (&lt;code>doas apk upgrade&lt;/code>).&lt;/p>
&lt;p>Upon checking the logs in &lt;code>/var/log/apk.log&lt;/code>&amp;hellip;&lt;/p>
&lt;pre tabindex="0">&lt;code>Running `apk upgrade --no-self-upgrade` at 2025-07-09 13:57:09
apk-tools 3.0.0_rc5_git20250613-r0, compiled for x86_64.
( 1/60) Purging postgresql-zsh-completion (5.9-r5)
( 2/60) Purging postgresql17-contrib (17.5-r2)
( 3/60) Purging postgresql17-openrc (17.5-r2)
( 4/60) Purging postgresql17 (17.5-r2)
postgresql17-17.5-r2.pre-deinstall: Executing script...
postgresql17-17.5-r2.pre-deinstall: *
postgresql17-17.5-r2.pre-deinstall: * You are uninstalling your default PostgreSQL version (17) which seems to be
postgresql17-17.5-r2.pre-deinstall: * in use! If it&amp;#39;s *not* intentional and you want to preserve this version,
postgresql17-17.5-r2.pre-deinstall: * install it explicitly: `apk add postgresql17`.
postgresql17-17.5-r2.pre-deinstall: *
postgresql17-17.5-r2.pre-deinstall: * Please note that to upgrade your cluster to a new major version using
postgresql17-17.5-r2.pre-deinstall: * pg_upgrade(1), you must have both the old and new versions installed.
postgresql17-17.5-r2.pre-deinstall: *
ERROR: postgresql17-17.5-r2.pre-deinstall: exited with error 1
&lt;/code>&lt;/pre>&lt;p>For whatever reason (!?), the &lt;code>postgresql17*&lt;/code> packages were removed.&lt;/p>
&lt;p>The fix is straightforward:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk add postgresql17
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas service miniflux restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Why did it break in the first place?!&lt;/p>
&lt;p>There&amp;rsquo;s nothing suspicious on &lt;code>postgresql17&lt;/code> in the
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/commits/master/main/postgresql17">aports&lt;/a>
repo 🤷&lt;/p>
&lt;p>What is &lt;code>dict_snowball&lt;/code>?&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>dict_snowball&lt;/code> is a PostgreSQL text search dictionary module that uses the
Snowball stemming algorithms for full-text search.&lt;/p>
&lt;/blockquote></description></item><item><title>Markdown headings and git comments</title><link>https://perrotta.dev/2025/07/markdown-headings-and-git-comments/</link><pubDate>Tue, 08 Jul 2025 13:18:09 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/markdown-headings-and-git-comments/</guid><description>&lt;p>Our team uses a PR template that resembles the following:&lt;/p>
&lt;pre tabindex="0">&lt;code>% cat .github/pull_request_template.md
## Summary

&amp;lt;!-- Provide a clear and concise description of the changes.
Provide a link to the corresponding PR in other repositories if applicable. --&amp;gt;

## Jira Task

- [ ] No ticket needed

https://acme.atlassian.net/browse/XXX

## Cluster(s) Affected

&amp;lt;!-- List the clusters affected by this change --&amp;gt;

## Impact

&amp;lt;!-- Describe the impact of these changes. Will this require downtime? Are there
any performance considerations? --&amp;gt;

## Testing

&amp;lt;!-- Describe how you&amp;#39;ve tested these changes --&amp;gt;
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://perrotta.dev/2025/05/github-pull-request-template/">Previously&lt;/a> I wrote
about how to automatically incorporate github pull request templates in &lt;code>git commit&lt;/code> (&lt;code>COMMIT_EDITMSG&lt;/code>).&lt;/p>
&lt;p>It turns out there&amp;rsquo;s one caveat with this approach.&lt;/p>
&lt;p>Markdown headings&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> (&lt;code>##&lt;/code> for &lt;code>&amp;lt;h2&amp;gt;&lt;/code>) use the same character as git line comments
(&lt;code>#&lt;/code>) for commit messages.&lt;/p>
&lt;p>As a side effect, when pulling up the template locally with a plain git commit,
the headings do not show up in the final commit message.&lt;/p>
&lt;p>This can be worked around by using &lt;code>gh pr create&lt;/code> instead, but it &lt;a href="https://xkcd.com/1172/">breaks my
setup&lt;/a>.&lt;/p>
&lt;p>Another workaround is to convert the headings to use &lt;code>----&lt;/code> markers, for example:&lt;/p>
&lt;pre tabindex="0">&lt;code>Summary
-------

&amp;lt;!-- Provide a clear and concise description of the changes.
Provide a link to the corresponding PR in other repositories if applicable. --&amp;gt;
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Update&lt;/strong>: A teammate pointed out the following workaround, which is the most
elegant of them:&lt;/p>
&lt;p>&lt;a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-corecommentChar">&lt;code>core.commentChar&lt;/code>&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Commands such as &lt;code>commit&lt;/code> and &lt;code>tag&lt;/code> that let you edit messages consider a line
that begins with this character commented, and removes them after the editor
returns (default &lt;code>#&lt;/code>).&lt;/p>
&lt;p>If set to &amp;ldquo;auto&amp;rdquo;, git-commit would select a character that is not the
beginning character of any line in existing commit messages.&lt;/p>
&lt;/blockquote>
&lt;p>And that&amp;rsquo;s exactly what I did:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% git config &lt;span style="color:#e5c07b">set&lt;/span> --global core.commentChar &lt;span style="color:#98c379">&amp;#34;auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The effect, it automatically picks &lt;code>;&lt;/code> as the comment character:&lt;/p>
&lt;pre tabindex="0">&lt;code>## Summary

&amp;lt;!-- Provide a clear and concise description of the changes.
Provide a link to the corresponding PR in other repositories if applicable. --&amp;gt;

; Please enter the commit message for your changes. Lines starting
; with &amp;#39;;&amp;#39; will be ignored, and an empty message aborts the commit.
;
; On branch master
; Your branch is up to date with &amp;#39;origin/master&amp;#39;.
;
; ------------------------ &amp;gt;8 ------------------------
; Do not modify or remove the line above.
; Everything below it will be ignored.
&lt;/code>&lt;/pre>&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>I am always forgetting whether to call them &amp;ldquo;headings&amp;rdquo; or &amp;ldquo;headers&amp;rdquo;.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>ArgoCD: deployment spec.selector: field is immutable</title><link>https://perrotta.dev/2025/06/argocd-deployment-spec.selector-field-is-immutable/</link><pubDate>Mon, 30 Jun 2025 13:04:51 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-deployment-spec.selector-field-is-immutable/</guid><description>&lt;p>When using &lt;a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD&lt;/a> to manage an app,
the Deployment manifest needs to undergo significant changes, updating its
selector labels. When trying to sync the argocd app, we get the following error:&lt;/p>
&lt;pre tabindex="0">&lt;code>one or more objects failed to apply, reason: error when patching &amp;#34;/dev/shm/3469418025&amp;#34;: Deployment.apps &amp;#34;myapp&amp;#34; is invalid: spec.selector: Invalid value: v1.LabelSelector{MatchLabels:v1.LabelSelectorRequirement(nil)}: field is immutable. Retrying attempt #2 at 11:02AM.
&lt;/code>&lt;/pre>&lt;p>This error doesn&amp;rsquo;t come directly from Argo, it is from &lt;code>kubectl apply&lt;/code>.&lt;/p>
&lt;p>There are two ways to address it:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Sync the argo app with the
&lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#force-sync">&amp;ldquo;force&amp;rdquo;&lt;/a>
option enabled&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Run &lt;code>kubectl apply&lt;/code> with &lt;code>--force&lt;/code> (which is ultimately what the
aforementioned option maps to).&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>In action (&lt;code>-w&lt;/code> is short for &lt;code>--watch&lt;/code>):&lt;/p>
&lt;pre tabindex="0">&lt;code>% kubectl get endpoints -w
NAME ENDPOINTS AGE
myapp &amp;lt;none&amp;gt; 5y44d
myapp 5y44d
myapp 10.1.13.40:8080 5y44d
&lt;/code>&lt;/pre></description></item><item><title>Steam ratings</title><link>https://perrotta.dev/2025/06/steam-ratings/</link><pubDate>Mon, 30 Jun 2025 00:43:40 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/steam-ratings/</guid><description>&lt;p>The &lt;a href="https://store.steampowered.com/">Steam Summer Sale&lt;/a> is going on, as usual.&lt;/p>
&lt;p>I never understood how their rating system works. Until now:&lt;/p>
&lt;pre tabindex="0">&lt;code>95 - 100 | 500+ reviews | positive | overwhelming
85 - 100 | 50+ reviews | positive | very
80 - 100 | 1+ reviews | positive
70 - 79 | 1+ reviews | positive | mostly
40 - 69 | 1+ reviews | mixed
20 - 39 | 1+ reviews | negative | mostly
 0 - 19 | 1+ reviews | negative
 0 - 19 | 50+ reviews | negative | very
 0 - 19 | 500+ reviews | negative | overwhelming
&lt;/code>&lt;/pre>&lt;p>Basically, look for games with &amp;ldquo;overwhelmingly positive&amp;rdquo; or &amp;ldquo;very positive&amp;rdquo;
reviews.&lt;/p>
&lt;h2 id="sources">Sources&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://steamcommunity.com/discussions/forum/0/1744482869761322402/">https://steamcommunity.com/discussions/forum/0/1744482869761322402/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.reddit.com/r/Steam/comments/ivz45n/what_does_the_steam_ratings_like_very_negative_or/">https://www.reddit.com/r/Steam/comments/ivz45n/what_does_the_steam_ratings_like_very_negative_or/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Resize image to make an avatar</title><link>https://perrotta.dev/2025/06/resize-image-to-make-an-avatar/</link><pubDate>Tue, 24 Jun 2025 17:50:31 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/resize-image-to-make-an-avatar/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given a &lt;code>.png&lt;/code> image suitable to be used as a profile
picture (an avatar in a forum, for example), convert it to 80x80, ensure its
file size is under 10KiB and keep its transparency when existing. The extension
should remain &lt;code>.png&lt;/code>.&lt;/p>
&lt;p>This kind of task is perfect for the LLM™. It took me a few round-trip prompts
to achieve the desired outcome:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% magick image.png -resize 80x80 -fuzz 10% -transparent white
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% pngquant --quality&lt;span style="color:#56b6c2">=&lt;/span>70-85 --force --output image.png
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>magick&lt;/code> comes from &lt;a href="https://imagemagick.org/index.php">ImageMagick&lt;/a>. Most
likely you already have it installed if you&amp;rsquo;re in Linux or macOS.&lt;/p>
&lt;p>&lt;strong>Fun fact&lt;/strong>: the command used to be called &lt;code>convert&lt;/code> (it is still in my muscle
memory!) but not in newer versions of ImageMagick:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% convert
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARNING: The convert &lt;span style="color:#e5c07b">command&lt;/span> is deprecated in IMv7, use &lt;span style="color:#98c379">&amp;#34;magick&amp;#34;&lt;/span> instead of &lt;span style="color:#98c379">&amp;#34;convert&amp;#34;&lt;/span> or &lt;span style="color:#98c379">&amp;#34;magick convert&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://pngquant.org/">&lt;code>pngquant&lt;/code>&lt;/a> is new to me:&lt;/p>
&lt;blockquote>
&lt;p>pngquant is a command-line utility and a library for lossy compression of PNG
images.&lt;/p>
&lt;p>The conversion reduces file sizes significantly (often as much as 70%) and
preserves full alpha transparency. Generated images are compatible with all
web browsers and operating systems.&lt;/p>
&lt;/blockquote>
&lt;p>In my little experiment:&lt;/p>
&lt;ul>
&lt;li>input: 52KB, 256 x 256 pixels&lt;/li>
&lt;li>&lt;a href="https://bbs.archlinux.org/img/avatars/73061.png?m=1750766467">output&lt;/a>: 4.1KB, 80 x 80 pixels, with transparent background&lt;/li>
&lt;/ul></description></item><item><title>M1 Macbook Air keeps disconnecting from Wi-Fi</title><link>https://perrotta.dev/2025/06/m1-macbook-air-keeps-disconnecting-from-wi-fi/</link><pubDate>Tue, 24 Jun 2025 13:34:50 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/m1-macbook-air-keeps-disconnecting-from-wi-fi/</guid><description>&lt;p>&lt;a href="https://www.reddit.com/r/mac/comments/vv5day/m1_macbook_air_keeps_disconnecting_from_wifi/">M1 Macbook air keeps disconnecting from
wifi&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>I&amp;rsquo;ve had this mac for a few months and never had this issue until today. It
will disconnect every 1 minute it&amp;rsquo;s really frustrating.&lt;/p>
&lt;/blockquote>
&lt;p>Lately I&amp;rsquo;ve been having the same issue, more or less. Also in a M1 Macbook Air.&lt;/p>
&lt;p>There&amp;rsquo;s also &lt;a href="https://discussions.apple.com/thread/255556937?sortBy=rank">this
thread&lt;/a> in the Apple
Community forums.&lt;/p>
&lt;blockquote>
&lt;p>I&amp;rsquo;ve tried forgetting the network then adding it again, checking for any
updates but it&amp;rsquo;s all up to date.&lt;/p>
&lt;/blockquote>
&lt;p>Right. Times of desperation call for desperate measures, but those don&amp;rsquo;t really
help.&lt;/p>
&lt;p>In that thread, there is a suggestion to run Wireless diagnostics: &lt;code>Option + Wi-Fi &amp;gt; &amp;quot;Open Wireless Diagnostics...&amp;quot;&lt;/code>. This is a good idea, but it also
appeared not to work in my case.&lt;/p>
&lt;p>I got reminded of a &lt;a href="https://bbs.archlinux.org/viewtopic.php?id=270326">thread&lt;/a>
I posted a few years ago in the Arch Linux forums:&lt;/p>
&lt;blockquote>
&lt;p>Whenever I turn my desktop on and log in with my primary user, internet is
usually available. I can &lt;code>sudo pacman -Syu&lt;/code>, &lt;code>ping google.com&lt;/code>, etc.&lt;/p>
&lt;p>Occasionally though, when I turn my desktop on, internet isn&amp;rsquo;t available. My
go-to &amp;ldquo;fix&amp;rdquo; (it&amp;rsquo;s more like a workaround, really) is to simply do:&lt;/p>
&lt;p>&lt;code>% systemctl restart iwd&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>&amp;hellip;which was quite similar, albeit on Linux.&lt;/p>
&lt;p>It&amp;rsquo;s just so frustrating whenever this happens, and it&amp;rsquo;s hard to even know where
to start troubleshooting. My setup is the same as always, there was no change to
ISPs, hardware, software, or anything else, really.&lt;/p>
&lt;p>There was a light at the end of the tunnel: I found this &lt;a href="https://superuser.com/questions/826338/macbook-air-constantly-drops-wifi-connection">superuser
thread&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>My MacBook Air keeps dropping wifi connection on my home network. When I
connect to my network, it remains connected for a few minutes, then it drops
the connection. I have no idea what&amp;rsquo;s the problem. I found several forums on
the internet discussing this, but none of them really gave a working solution.&lt;/p>
&lt;/blockquote>
&lt;p>Ah yes, buddy. I feel you. We are &lt;a href="https://xkcd.com/979/">soulmates&lt;/a>.&lt;/p>
&lt;p>Someone suggested the following:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>% ping -i 0.2 192.168.1.1&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>And, to my abysmal surprise, that seems to have worked&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>. Rationale:&lt;/p>
&lt;blockquote>
&lt;p>The problem is that OS X tries to put the WiFi antenna into a power saving
mode if there&amp;rsquo;s no data being sent or received, but with some WiFi APs, this
leads to disconnecting. That ping command will ping your router every 0.2
seconds, preventing OS X from turning off the WiFi.&lt;/p>
&lt;p>This is not a brilliant solution, but it will work until Apple does something
about this.&lt;/p>
&lt;/blockquote>
&lt;p>I need to make a few more experiments before I can conclude it is a reliable
solution, but so far I am sold, as I ran out of ideas. The &lt;code>0.2s&lt;/code> interval is
too frequent though; &lt;code>0.5s&lt;/code> appears to be enough.&lt;/p>
&lt;p>The answer author suggested to wrap the script in an Automator app. This is
quite elegant, should we ever deem it as a long-term &amp;ldquo;solution&amp;rdquo;. I suppose that
a &lt;a href="https://www.hammerspoon.org/">Hammerspoon&lt;/a> spoon would also be elegant in
this context.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>It could simply be placebo, as far as I&amp;rsquo;m concerned&amp;hellip;&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Helm repository with a trailing slash</title><link>https://perrotta.dev/2025/06/helm-repository-with-a-trailing-slash/</link><pubDate>Tue, 24 Jun 2025 11:32:50 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/helm-repository-with-a-trailing-slash/</guid><description>&lt;p>&lt;a href="https://github.com/argoproj/argo-cd/issues/9857">A repository URL with a trailing slash, and the same URL without a trailing
slash, are treated as different
repos&lt;/a>. We found this out the
hard way:&lt;/p>
&lt;pre tabindex="0">&lt;code>Failed to load target state: failed to generate manifest for source 1 of 2: rpc error: code = Unknown desc = error building helm chart dependencies: failed to add helm repository https://chartmuseum.{corp intranet}/orgs/{corp}/: failed to add repository: failed to get command args to log: `helm repo add https:--chartmuseum.{corp intranet}-orgs-{corp}- https://chartmuseum.{corp intranet}/orgs/{corp}/` failed exit status 1: Error: looks like &amp;#34;https://chartmuseum.{corp intranet}/orgs/{corp}/&amp;#34; is not a valid chart repository or cannot be reached: failed to fetch https://chartmuseum.{corp intranet}/orgs/{corp}/index.yaml : 401 Unauthorized
&lt;/code>&lt;/pre>&lt;p>Let&amp;rsquo;s put aside the fact the error message REALLY likes to repeat the repo name.&lt;/p>
&lt;p>This is a repository that we&amp;rsquo;ve already configured, with proper authentication
credentials. Why would it start to fail now, all of a sudden?&lt;/p>
&lt;p>You already got spoiled in the post title. Given &lt;code>Chart.yaml&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">apiVersion&lt;/span>: v2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">name&lt;/span>: corp-postgres-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">description&lt;/span>: Corp Postgres Operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">type&lt;/span>: application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">version&lt;/span>: &lt;span style="color:#d19a66">1.1.13&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">dependencies&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">name&lt;/span>: postgres-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">repository&lt;/span>: https://chartmuseum.{corp intranet}/orgs/archive
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And also:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">apiVersion&lt;/span>: v2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">name&lt;/span>: corp-postgres-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">description&lt;/span>: Corp Postgres Operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">type&lt;/span>: application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">version&lt;/span>: &lt;span style="color:#d19a66">1.1.13&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">dependencies&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">name&lt;/span>: postgres-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">repository&lt;/span>: https://chartmuseum.{corp intranet}/orgs/archive/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>These two dependencies end up being treated differently by Argo, even though
they are effectively the same. It&amp;rsquo;s an upstream bug.&lt;/p>
&lt;p>To work around it, I decided to simply remove all trailing slashes from
helm repository dependencies. Canonicalize everything!&lt;/p>
&lt;p>A git &lt;a href="https://pre-commit.com">pre-commit.com hook&lt;/a> is a good mechanism to do so:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">repo&lt;/span>: local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: helm-repo-trailing-slash
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">name&lt;/span>: Helm repositories must not contain trailing slashes in Chart.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: Chart.yaml$
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">language&lt;/span>: pygrep
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">entry: &amp;#39;\s*repository&lt;/span>: [\w:/.]+/$&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Run &lt;code>pre-commit run -a helm-repo-trailing-slash&lt;/code>, fix all violations, and then
never think about this again.&lt;/p>
&lt;p>Should the upstream bug ever be fixed, we can remove this workaround.&lt;/p></description></item><item><title>Logseq template for working out</title><link>https://perrotta.dev/2025/06/logseq-template-for-working-out/</link><pubDate>Sun, 22 Jun 2025 02:19:09 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/logseq-template-for-working-out/</guid><description>&lt;p>Lately I&amp;rsquo;ve been tracking my gym sessions in &lt;a href="https://logseq.com/">Logseq&lt;/a>.&lt;/p>
&lt;p>This workflow has been in place for at least three months, therefore it&amp;rsquo;s stable
enough by now. Here&amp;rsquo;s the rough idea.&lt;/p>
&lt;p>First, create a &lt;code>[[Templates]]&lt;/code> page.&lt;/p>
&lt;p>How to remember whether it&amp;rsquo;s &lt;code>Templates&lt;/code> or &lt;code>Template&lt;/code>? Simple: add an
&lt;code>alias::template&lt;/code> attribute to the page. It should be the first bullet point.
Now there&amp;rsquo;s no need to remember: any of them will do.&lt;/p>
&lt;p>Then add a &lt;code>[[Gym 💪]]&lt;/code> bullet point&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> with &lt;code>alias::gym&lt;/code>. In it, add a
&lt;code>template::gym&lt;/code> attribute. Within it, add the template content. This is the part
where you should adapt it to your own desires and goals, but I&amp;rsquo;ll share mine:&lt;/p>
&lt;pre tabindex="0">&lt;code>- Location
	- [[mygym]] (mylocation1 | mylocation2)
- Defaults
	- 3-4x 8-12
- Warm-up
	- XX min what
- Upper
	- Exercise: 25 -&amp;gt; 30
- Lower
	-
- Cooldown
	- XX min what
- Protein recovery
	- XX g (what)
- Body weight
	- XX kg (gym | home)
&lt;/code>&lt;/pre>&lt;p>A brief explanation:&lt;/p>
&lt;ul>
&lt;li>location: links to the page of each gym, where I can add details such as its
Wi-Fi password, how much drinks cost there, etc.&lt;/li>
&lt;li>defaults: the baseline for the session – how many sets, how many repetitions
in each?&lt;/li>
&lt;li>warm-up: what did I do, for how many minutes?&lt;/li>
&lt;li>upper: a bucket to group upper-body exercises: arms, chest, abs, etc.&lt;/li>
&lt;li>lower: a bucket to group lower-body exercises: legs, calves, glutes, etc.&lt;/li>
&lt;li>cooldown: what did I do, for how many minutes?&lt;/li>
&lt;li>protein recovery: in grams, what did I drink or eat?&lt;/li>
&lt;li>body weight: in kilos, and where did I measure it?&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>&lt;/li>
&lt;/ul>
&lt;p>This template has served me well. The most important part is the one that
contains the exercises (upper and lower).&lt;/p>
&lt;p>Now, let&amp;rsquo;s say I am going to the gym today.&lt;/p>
&lt;p>First, I open the journal page (&lt;code>[[2025-06-22]]&lt;/code>).
Then I type in &lt;code>/template gym&lt;/code>. This inserts the template above.&lt;/p>
&lt;p>Now I click &lt;code>[[Gym 💪]]&lt;/code> to open up the gym page.&lt;/p>
&lt;p>The gym page contains a detailed explanation of my current goals and workflows.
In particular, it has an exercises reference section that looks like this (the
numbers are made up):&lt;/p>
&lt;pre tabindex="0">&lt;code>* # Exercises
* Upper
 * Biceps: 10 -&amp;gt; 12
 * Triceps: 18 -&amp;gt; 20
 * Butterfly normal: 20 -&amp;gt; 25
 * Butterfly reverse: 20 -&amp;gt; 25
 [...]
* Lower
 * Hip addiction: 17 -&amp;gt; 20
 * Hip abduction: 15 -&amp;gt; 20
&lt;/code>&lt;/pre>&lt;p>Each entry tracks the latest weight and the one before it, which makes the
progression explicit (and doubles-down as a motivation factor!).&lt;/p>
&lt;p>Now, because this is an advanced PKM, the backlink we inserted earlier with the
template shows up under &amp;ldquo;linked references&amp;rdquo; at the bottom. And this is the magic
that makes Logseq useful for this kind of tracking: all gym entries are
accessible at a glance, connected to the main &lt;code>[[Gym 💪]]&lt;/code> page.&lt;/p>
&lt;p>During the workout, I use the appropriate weight from the gym page as an input
to the corresponding daily note entry, and slowly increase it in-between sets.&lt;/p>
&lt;p>For example, let&amp;rsquo;s say that for biceps the reference entry is &lt;code>Biceps: 10 -&amp;gt; 12&lt;/code>. Then, for today&amp;rsquo;s workout, I will add an entry like &lt;code>Biceps: 12 -&amp;gt; 13 -&amp;gt; 14&lt;/code>, starting with &lt;code>12&lt;/code>, the latest reference value.&lt;/p>
&lt;p>Repeat for each exercise.&lt;/p>
&lt;p>At the end of the workout, I update the reference entries with the progress of
the day. For example, the updated entry for biceps becomes &lt;code>* Biceps: 12 -&amp;gt; 14&lt;/code>.&lt;/p>
&lt;p>I never liked to go to the gym, but now I am starting to enjoy it, because I
feel this approach brings many self-motivating benefits:&lt;/p>
&lt;ul>
&lt;li>there&amp;rsquo;s a detailed record of every single workout that I do, down to the day
and the exercise / weight in each set. These entries are psychologically
powerful, they motivate me more than smartwatches and/or gym / workouts apps&lt;/li>
&lt;li>the progression ensures I am consistent and pick up where I left off in the
previous session. There&amp;rsquo;s no need to guess any longer which weight to use, I
know exactly which one to use, and whether it was difficult or easy last time
(as I also track this information in the reference).&lt;/li>
&lt;li>reduced risk of injury as I am increasing the weights slowly, and being
mindful of the ones that incur a lot of stress and/or strain on my muscles&lt;/li>
&lt;li>ability to track goals and be realistic about them, and even estimate when
I&amp;rsquo;ll be able to reach them, based on historical progression.&lt;/li>
&lt;/ul>
&lt;p>I tried to use gym apps before, but they were never effective. They are often
complicated and bloated. The advantage of keeping the format plain and flexible
in the PKM is that it can suit all my needs. In fact, I could even bring pen and
paper to the gym instead of my smartphone if needed, as there&amp;rsquo;s absolutely no
need for internet access when updating these entries, and no lock-in whatsoever.&lt;/p>
&lt;p>There&amp;rsquo;s nothing revolutionary in my approach. Its core is merely: (i)
(annotated!) consistency and (ii) ability to shape the system to the format that
suits/fits my needs.&lt;/p>
&lt;p>Consistency is very important. Before adopting this system, I would always guess
which weight to use for each exercise. But there are too many of them, and as
such it&amp;rsquo;s quite difficult to keep track of them all in my head.&lt;/p>
&lt;p>The format flexibility is also important. The key is to shape a system to your
needs, not the other way around. With smartphone and smartwatch apps, I always
felt that I had to adapt myself to the input format the app expects, which is
painful from an UX perspective.&lt;/p>
&lt;p>And now it is time to work out again 💪&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Yes, including the emoji. Life is short to skip having fun.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>There are tiny differences, therefore I like to note down whether I used
the scale from the gym or the one at home.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Oh Shit, Git!?!</title><link>https://perrotta.dev/2025/06/oh-shit-git/</link><pubDate>Thu, 19 Jun 2025 13:55:45 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/oh-shit-git/</guid><description>&lt;p>&lt;a href="https://ohshitgit.com/">https://ohshitgit.com/&lt;/a> by Katie Sylor-Miller:&lt;/p>
&lt;blockquote>
&lt;p>Git is hard: screwing up is easy, and figuring out how to fix your mistakes is
fucking impossible. Git documentation has this chicken and egg problem where
you can&amp;rsquo;t search for how to get yourself out of a mess, unless you already
know the name of the thing you need to know about in order to fix your
problem.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>So here are some bad situations I&amp;rsquo;ve gotten myself into, and how I eventually
got myself out of them in plain english.&lt;/p>
&lt;/blockquote>
&lt;p>I love these websites created with the sole purpose of filling in the void of
tool usability.&lt;/p>
&lt;p>Other notable examples from the top of my head:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://git-send-email.io/">https://git-send-email.io/&lt;/a> by &lt;a href="https://drewdevault.com/">Drew DeVault&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://yaml-multiline.info/">https://yaml-multiline.info/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Slack: reacji channeller</title><link>https://perrotta.dev/2025/06/slack-reacji-channeller/</link><pubDate>Tue, 17 Jun 2025 11:32:50 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/slack-reacji-channeller/</guid><description>&lt;p>Consider an organization that uses &lt;a href="https://slack.com/">Slack&lt;/a>.&lt;/p>
&lt;p>There are many channels. There is chatter, everywhere, all the time. There is
noise. It&amp;rsquo;s hard to find a given thread after two or three days, lost in the sea
of scrollback message threads.&lt;/p>
&lt;p>&lt;strong>Problem statement&lt;/strong>: How to cherry-pick certain messages, intended for a
periodic review meeting?&lt;/p>
&lt;p>For example, maybe you want to collect all issues your fellow coworkers
complained about in your support channel, to file bugs/tickets about them.&lt;/p>
&lt;p>Or perhaps you want to collect all on-call and outage issues experienced during
the week.&lt;/p>
&lt;p>Or even gather future product roadmap ideas in a board somewhere.&lt;/p>
&lt;p>It is super tedious to copy and paste messages one by one. Also, to do so incurs
a non-trivial cost in terms of context switching.&lt;/p>
&lt;p>Enter &lt;a href="https://slack.com/intl/en-gb/help/articles/360000482666-Reacji-Channeller-for-Slack">Reacji
Channeler&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>With the Reacji Channeller app, you can instantly copy a message from one
public channel to another using specific reaction emoji, or &amp;lsquo;reacji&amp;rsquo;. This
comes in handy when something posted to a channel could be useful to
conversations happening elsewhere across your workspace.&lt;/p>
&lt;/blockquote>
&lt;p>It is one of these simple-but-effective clever ideas, it almost feels like
cheating.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>The benefits&lt;/strong> 👍&lt;/p>
&lt;ul>
&lt;li>Move a message automatically from one public channel to another.&lt;/li>
&lt;li>Redirect ideas and feedback or organise stray requests into relevant channels.&lt;/li>
&lt;li>Increase a message&amp;rsquo;s visibility by copying it to a channel with more members&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>For example, you can map/assign the ⭐️ (star) emoji to automatically relay
messages to the &lt;code>#idea&lt;/code> channel. Or 🐛 (insect) to &lt;code>#bugs&lt;/code>.&lt;/p>
&lt;p>And then it becomes much easier to process all these messages at once, for
upcoming review meetings. The less context switching, the better!&lt;/p>
&lt;p>✨&lt;/p></description></item><item><title>Speaking to myself</title><link>https://perrotta.dev/2025/06/speaking-to-myself/</link><pubDate>Mon, 16 Jun 2025 16:26:51 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/speaking-to-myself/</guid><description>&lt;p>Lately I&amp;rsquo;ve been stealing &lt;a href="https://simonwillison.net/">Simon Willison&lt;/a>&amp;rsquo;s
playbook of &lt;a href="https://simonwillison.net/2025/May/19/#:~:text=My%20habit%20of%20creating%20long,new%20generation%20of%20coding%20assistants">taking to oneself&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>My habit of &lt;a href="https://simonwillison.net/2022/Nov/26/productivity/#issue-thread">creating long issue
threads&lt;/a>
where I talk to myself about the features I&amp;rsquo;m planning is proving to be a good
fit for outsourcing implementation work to this new generation of coding
assistants.&lt;/p>
&lt;/blockquote>
&lt;p>I am mostly interested in leaving a paper trail of my actions and decisions
whilst debugging and investigating a problem or implementing a feature.&lt;/p>
&lt;p>The paper trail doubles down as:&lt;/p>
&lt;ul>
&lt;li>(i) documentation for my teammates, so that I don&amp;rsquo;t need to repeat myself
during code reviews;&lt;/li>
&lt;li>(ii) context for me and my teammates&amp;rsquo;&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> future selves, so that we can
understand &lt;em>why&lt;/em> I chose to do something in a certain way at the time;&lt;/li>
&lt;li>(iii) as Simon suggests, context for LLM agents so that I don&amp;rsquo;t need to repeat
myself to them.&lt;/li>
&lt;/ul>
&lt;p>I find it useful to do so in chat apps (e.g. Slack threads), in addition to bug
trackers (e.g. GitHub Issues or JIRA tickets). Be verbose! The more context the
better.&lt;/p>
&lt;p>As a side note, blog posts yield the same benefit. The more the merrier!&lt;/p>
&lt;p>&lt;strong>Reference&lt;/strong>: &lt;a href="https://simonwillison.net/2025/May/26/notes/">https://simonwillison.net/2025/May/26/notes/&lt;/a>&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Your periodic reminder that &amp;ldquo;teammates&amp;rdquo; sounds much better than
&amp;ldquo;colleagues&amp;rdquo;. Or you can use &amp;ldquo;coworkers&amp;rdquo; too. Though I tend to use
&amp;ldquo;teammates&amp;rdquo; as &amp;ldquo;coworkers in my immediate team&amp;rdquo;.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Espanso for Github PR templates</title><link>https://perrotta.dev/2025/06/espanso-for-github-pr-templates/</link><pubDate>Mon, 16 Jun 2025 14:04:36 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/espanso-for-github-pr-templates/</guid><description>&lt;p>It is super tedious to fill in &lt;a href="https://perrotta.dev/2025/05/github-pull-request-template/">github PR templates&lt;/a> manually.&lt;/p>
&lt;p>It is more efficient to use a text snippet expander such as &lt;a href="https://perrotta.dev/2025/05/espanso-hello-world/">Espanso&lt;/a>.&lt;/p>
&lt;p>I found the following trigger works well:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% espanso edit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Editing file: /Users/thiago.perrotta/Library/Application Support/espanso/match/base.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">matches&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">trigger&lt;/span>: &lt;span style="color:#98c379">&amp;#34;:github:repo1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">replace&lt;/span>: |&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Summary
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> $|$
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Jira Task
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [ ] No ticket needed (check only if level of impact is No-op)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> https://corp.atlassian.net/browse/XXX
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Level of Impact
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> Please select exactly one option. To change the level of impact, first
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> unselect the current level of impact and then select the new level of
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> impact.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [ ] 1 - High
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [ ] 2 - Medium
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [ ] 3 - Low
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [x] 4 - No-op
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Impact Analysis
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> N/A
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Test Plan
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> TODO Insert test plan here.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Checklist
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> Check each when they are done or confirmed to not apply. If something
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> here isn&amp;#39;t checked, this isn&amp;#39;t ready to be merged. Seriously. You are
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> making your teammates lives a lot easier by doing this consistently.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [x] Test Plan Fully Executed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [x] Does not require security review or security review complete&lt;/span> 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Usage:&lt;/p>
&lt;ul>
&lt;li>create a PR via the github UI&lt;/li>
&lt;li>type in &lt;code>:github:repo1&lt;/code> in the PR description text area&lt;/li>
&lt;li>the cursor will automatically move to the Summary section (that&amp;rsquo;s what &lt;code>$|$&lt;/code>
does as per &lt;a href="https://espanso.org/docs/matches/basics/#cursor-hints">docs&lt;/a>).&lt;/li>
&lt;/ul>
&lt;p>It&amp;rsquo;s much quicker to trigger that expansion than to fill in the PR template
manually every single time. Of course, I still need to update the JIRA ticket
and the test plan in each PR.&lt;/p>
&lt;p>Each repository has its own template. I use the repo name as the trigger. For
example: to trigger the template expansion for &lt;code>https://github.com/corp/foo&lt;/code>,
map it to &lt;code>:github:foo&lt;/code>.&lt;/p></description></item><item><title>Diffoscope: exclude directory metadata</title><link>https://perrotta.dev/2025/06/diffoscope-exclude-directory-metadata/</link><pubDate>Mon, 16 Jun 2025 11:58:02 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/diffoscope-exclude-directory-metadata/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2024/08/diffoscope-recursive-diffs/">Previously&lt;/a>,
&lt;a href="https://perrotta.dev/2024/08/diffoscope-recursive-diffs/">previously&lt;/a>.&lt;/p>
&lt;p>If you simply run &lt;code>diffoscope dir1/ dir2/&lt;/code>, a lot of noise could be added to the
output due to metadata such as timestamps:&lt;/p>
&lt;pre tabindex="0">&lt;code>│ --- dir1/foo.yaml
│ ├── +++ dir2/foo.yaml
│ │ ├── stat {}
│ │ │ @@ -1,8 +1,8 @@
│ │ │
│ │ │ Size: 314 Blocks: 8 IO Block: 4096 regular file
│ │ │ Device: 1,17 Links: 1
│ │ │ Access: (0644/-rw-r--r--) Uid: ( 501/thiago.perrotta) Gid: ( 20/ staff)
│ │ │
│ │ │ +Modify: 2025-06-16 09:53:55.107373563 +0000
│ │ │ -Modify: 2025-04-04 14:37:59.032398559 +0000
│ │ --- dir1/bar.yaml
│ ├── +++ dir2/bar.yaml
│ │ ├── stat {}
│ │ │ @@ -1,8 +1,8 @@
│ │ │
│ │ │ Size: 444 Blocks: 8 IO Block: 4096 regular file
│ │ │ Device: 1,17 Links: 1
│ │ │ Access: (0644/-rw-r--r--) Uid: ( 501/thiago.perrotta) Gid: ( 20/ staff)
│ │ │
│ │ │ +Modify: 2025-06-16 09:53:55.107527976 +0000
│ │ │ -Modify: 2025-03-05 13:37:47.461442994 +0000
&lt;/code>&lt;/pre>&lt;p>These timestamps are relevant in the context of &lt;a href="https://reproducible-builds.org/">reproducible
builds&lt;/a>, however we don&amp;rsquo;t particularly care
about them when we&amp;rsquo;re merely interested in diffing directory and file contents.&lt;/p>
&lt;p>Thankfully, &lt;code>diffoscope&lt;/code> has a flag to ignore these:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>diffoscope dir1/ dir2/ --exclude-directory-metadata&lt;span style="color:#56b6c2">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>SSH: hash known hosts</title><link>https://perrotta.dev/2025/06/ssh-hash-known-hosts/</link><pubDate>Sun, 15 Jun 2025 12:05:11 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/ssh-hash-known-hosts/</guid><description>&lt;p>A security / privacy tip: hash ssh hosts, especially in machines you have
access to that are in the cloud.
&lt;a href="https://github.com/thiagowfx/.dotfiles/blob/6a5bb6a20eeede82dfcbbc56ef4db91ffe2dd65d/ssh/.ssh/config#L40-L42">&lt;code>~/.ssh/config&lt;/code>&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>Host *
	# Automatically hash new host keys added to ~/.ssh/known_hosts.
	# Manually for pre-existing hosts: ssh-keygen -H
	HashKnownHosts yes
&lt;/code>&lt;/pre>&lt;p>The default is not to hash.&lt;/p>
&lt;p>As a side effect, &lt;code>~/.ssh/known_hosts&lt;/code> (sample entry):&lt;/p>
&lt;pre tabindex="0">&lt;code>|1|F1E1KeoE/eEWhi10WpGv4OdiO6Y=|3988QV0VE8wmZL7suNrYQLITLCg= sh-ed25519 [...]
&lt;/code>&lt;/pre>&lt;p>Why do this? As per &lt;a href="https://security.stackexchange.com/questions/56268/ssh-benefits-of-using-hashed-known-hosts">Security Stack Exchange&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>The only change is that if a machine is compromised, the idea is to minimize
how much usable information is given to an attacker.&lt;/p>
&lt;/blockquote>
&lt;p>To retroactively hash existing entries, run:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ssh-keygen -H
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/Users/tperrotta/.ssh/known_hosts updated.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Original contents retained as /Users/tperrotta/.ssh/known_hosts.old
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Kindle Paperwhite: KOReader: calibre sync</title><link>https://perrotta.dev/2025/06/kindle-paperwhite-koreader-calibre-sync/</link><pubDate>Sun, 15 Jun 2025 03:49:24 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/kindle-paperwhite-koreader-calibre-sync/</guid><description>&lt;p>One of the best reasons to &lt;a href="https://perrotta.dev/2025/05/winterbreak-hello-world/">jailbreak&lt;/a> a Kindle is to leverage wireless
&lt;a href="https://calibre-ebook.com/">Calibre&lt;/a> sync via &lt;a href="http://koreader.rocks/">KOReader&lt;/a>.&lt;/p>
&lt;p>Instructions:&lt;/p>
&lt;p>&lt;strong>from Calibre&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>Click Connect/share&lt;/li>
&lt;li>Start wireless device connection&lt;/li>
&lt;li>Set &amp;ldquo;Optional fixed port&amp;rdquo; to 9090 and check off &amp;lsquo;Use a fixed port&amp;rsquo;&lt;/li>
&lt;li>Confirm&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>from KOReader&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>Click Settings &amp;gt; Calibre &amp;gt; Wireless Settings
&lt;ul>
&lt;li>Check off &amp;lsquo;Enable wireless client&amp;rsquo;&lt;/li>
&lt;li>Set inbox folder &amp;gt; &lt;code>/mnt/us/documents&lt;/code>&lt;/li>
&lt;li>Server address &amp;gt; Add the IP address + port&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> of the calibre server (visible in the calibre UI)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Click Settings &amp;gt; Calibre &amp;gt; Connect&lt;/li>
&lt;/ul>
&lt;p>At this point, the Calibre UI should change, recognizing the KOReader client.&lt;/p>
&lt;p>From there, it is trivial to send books from the Calibre library to KOReader.
Select the desired books and then click &amp;lsquo;Send to device&amp;rsquo;.&lt;/p>
&lt;p>Stefan Svartling has a great &lt;a href="https://www.youtube.com/watch?v=AQHbOTEJAak">video
tutorial&lt;/a> about this.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>There&amp;rsquo;s an &amp;ldquo;automatic&amp;rdquo; mode, however it did not work for me.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Kindle Paperwhite: add custom fonts</title><link>https://perrotta.dev/2025/06/kindle-paperwhite-add-custom-fonts/</link><pubDate>Sun, 15 Jun 2025 02:14:41 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/kindle-paperwhite-add-custom-fonts/</guid><description>&lt;p>First step, download the font you&amp;rsquo;re interested in. In this example, I used
&lt;a href="https://fonts.google.com/specimen/Literata">Literata&lt;/a>&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>The download will be a &lt;code>.zip&lt;/code> file. Extract it.&lt;/p>
&lt;p>You&amp;rsquo;re looking for &lt;code>.ttf&lt;/code> or &lt;code>.otf&lt;/code> files. I take note of the following font
files in the archive:&lt;/p>
&lt;pre tabindex="0">&lt;code>Literata-Italic-VariableFont_opsz,wght.ttf
Literata-VariableFont_opsz,wght.ttf
Literata-Black.ttf
Literata-BlackItalic.ttf
Literata-Bold.ttf
Literata-BoldItalic.ttf
Literata-ExtraBold.ttf
Literata-ExtraBoldItalic.ttf
Literata-ExtraLight.ttf
Literata-ExtraLightItalic.ttf
Literata-Italic.ttf
Literata-Light.ttf
Literata-LightItalic.ttf
Literata-Medium.ttf
Literata-MediumItalic.ttf
Literata-Regular.ttf
Literata-SemiBold.ttf
Literata-SemiBoldItalic.ttf
&lt;/code>&lt;/pre>&lt;p>Second, connect the Kindle to your laptop with a USB cable&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>When using a macbook, you&amp;rsquo;ll need a USB &amp;lt;-&amp;gt; USB-C adapter / dongle.&lt;/p>
&lt;p>Open the mounted directory. There should be a top-level &lt;code>fonts/&lt;/code> directory
within it. Dump all the aforementioned font files there.&lt;/p>
&lt;p>Eject the device.&lt;/p>
&lt;p>Open a book. Select the added font. &lt;del>Profit!&lt;/del> Enjoy your pleasant read!&lt;/p>
&lt;p>An interesting note: the added font has properly showed up in
&lt;a href="http://koreader.rocks/">KOReader&lt;/a>, but not in the native Kindle Paperwhite
reader. Another reason &lt;a href="https://perrotta.dev/2025/05/winterbreak-hello-world/">to jailbreak&lt;/a>?&lt;/p>
&lt;h2 id="appendix">Appendix&lt;/h2>
&lt;p>A verbatim&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup> excerpt from the stock &lt;code>Readme.txt&lt;/code> within &lt;code>fonts/&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>You can now install your favorite fonts on your Kindle and choose one of them to read your eBooks.

Any font you install must be either an OpenType (OTF) or a TrueType (TTF) font. All other font formats are unsupported. Also, fonts are usually available as a font family and may consist of several files for different font styles - one each for Regular, Italic, Bold, BoldItalic, etc. For the best reading experience, we recommend you install all the files in the font family. Supported font files will have .ttf, .otf, or .ttc file extensions.

How to install fonts on your Kindle:

1. If the font is packaged into a compressed file (such as a ZIP file), uncompress the files using your favorite file extracting program

2. Copy the font files into the &amp;#34;fonts&amp;#34; folder on your Kindle

3. Disconnect your Kindle from the computer

4. You can now choose a custom font in addition to the Kindle fonts from the Display Settings (Aa) menu

Once you choose a custom font from the Display Settings (Aa) menu, your Kindle will render the book content using that font for most books. If the font is not able to be used for rendering the book&amp;#39;s content, your Kindle will use the default system font instead. This can happen if the font does not support the characters in the book or if the font is damaged.

Amazon respects the intellectual property of others. You are responsible for ensuring you have obtained the necessary rights and permissions to use any fonts you upload to your Kindle. By using the font upload functionality on Kindle, you agree that your use of the fonts you upload will not infringe or violate the rights of any third party, and that you will indemnify Amazon for all claims resulting from your use of the fonts you upload.

For further help, please visit: http://amzn.to/2F2DhMK
&lt;/code>&lt;/pre>&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Got this suggestion via &lt;a href="https://www.reddit.com/r/kobo/comments/1ijpu75/whats_your_favorite_font/">Reddit&lt;/a>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>The first two cables I connected did not work. Only the third one did.
Aren&amp;rsquo;t all USB cables supposed to be fungible and equivalent? Huh.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>Some blank lines were deleted, the rest is exactly as is.&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>ArgoCD: every application in unknown state</title><link>https://perrotta.dev/2025/06/argocd-every-application-in-unknown-state/</link><pubDate>Fri, 13 Jun 2025 22:34:33 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-every-application-in-unknown-state/</guid><description>&lt;p>&lt;strong>Symptom&lt;/strong>: Every single application in the Kubernetes cluster that is managed
by Argo is in &lt;code>Unknown&lt;/code> sync status. A disaster! 😱&lt;/p>
&lt;p>This has only happened in one of our clusters. More specifically, in an
&lt;a href="https://learn.microsoft.com/en-us/azure/aks/core-aks-concepts">AKS&lt;/a> cluster
(from Microsoft Azure).&lt;/p>
&lt;p>An observed effect:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% kubectl get --raw&lt;span style="color:#56b6c2">=&lt;/span>&lt;span style="color:#98c379">&amp;#39;/openapi/v2&amp;#39;&lt;/span> | head -c &lt;span style="color:#d19a66">200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Error from server &lt;span style="color:#56b6c2">(&lt;/span>ServiceUnavailable&lt;span style="color:#56b6c2">)&lt;/span>: the server is currently unable to handle the request
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aha! The Kubernetes OpenAPI server is not responding properly.
That explains why Argo is having so much trouble to figure out the state of affairs in
the cluster.&lt;/p>
&lt;p>It was quite difficult to troubleshoot this issue. There are barely any
resources about it in the open web. We filed an Azure Support ticket, but it was
completely useless. They offered to restart&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> the OpenAPI server, but that
didn&amp;rsquo;t help (of course it wouldn&amp;rsquo;t!).&lt;/p>
&lt;p>Because this is a managed Kubernetes cluster, we have limited access to it,
which includes lack of access to raw logs. The Azure portal doesn&amp;rsquo;t make it easy
but, after digging quite deep into it, eventually we found this error message in
the logs:&lt;/p>
&lt;pre tabindex="0">&lt;code> {&amp;#34;pod&amp;#34;:&amp;#34;kube-apiserver-7785d59f4f-scqmp&amp;#34;,&amp;#34;stream&amp;#34;:&amp;#34;stderr&amp;#34;,&amp;#34;containerID&amp;#34;:&amp;#34;925345f6501626aa6cd40dd187d5cf57837389eec9cb39b2292fb9ae3f66242f&amp;#34;,&amp;#34;log&amp;#34;:&amp;#34;E0512 12:01:36.876768 1 handler.go:160] Error in OpenAPI handler: failed to build merge specs: unable to merge: duplicated path \/apis\/reports.kyverno.io\/v1\/clusterephemeralreports\n&amp;#34;}
&lt;/code>&lt;/pre>&lt;p>That was the first clue! Now we know it&amp;rsquo;s related to
&lt;a href="https://kyverno.io/">Kyverno&lt;/a>.&lt;/p>
&lt;p>That error eventually led us to
&lt;a href="https://github.com/kubernetes/kubernetes/issues/122668#issuecomment-2531243040">this&lt;/a>
issue in Kubernetes:&lt;/p>
&lt;blockquote>
&lt;p>We have the same issue here, actually also triggered by installing the kyverno
reports-server with both apiservices (different groups served by the same
api-server).&lt;/p>
&lt;/blockquote>
&lt;p>Aha!&lt;/p>
&lt;p>Deleting the duplicate CRDs installed by &lt;a href="https://github.com/kyverno/reports-server">kyverno reports
server&lt;/a> has immediately resolved the
OpenAPI server unresponsiveness. It wasn&amp;rsquo;t even necessary to restart it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% kubectl delete crd ephemeralreports.reports.kyverno.io clusterephemeralreports.reports.kyverno.io clusterpolicyreports.wgpolicyk8s.io policyreports.wgpolicyk8s.io
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>customresourcedefinition.apiextensions.k8s.io &lt;span style="color:#98c379">&amp;#34;ephemeralreports.reports.kyverno.io&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>customresourcedefinition.apiextensions.k8s.io &lt;span style="color:#98c379">&amp;#34;clusterephemeralreports.reports.kyverno.io&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>customresourcedefinition.apiextensions.k8s.io &lt;span style="color:#98c379">&amp;#34;clusterpolicyreports.wgpolicyk8s.io&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>customresourcedefinition.apiextensions.k8s.io &lt;span style="color:#98c379">&amp;#34;policyreports.wgpolicyk8s.io&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And now:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ kubectl get --raw&lt;span style="color:#56b6c2">=&lt;/span>&lt;span style="color:#98c379">&amp;#39;/openapi/v2&amp;#39;&lt;/span> | head -c &lt;span style="color:#d19a66">200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;swagger&amp;#34;&lt;/span>:&lt;span style="color:#98c379">&amp;#34;2.0&amp;#34;&lt;/span>,&lt;span style="color:#98c379">&amp;#34;info&amp;#34;&lt;/span>:&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;title&amp;#34;&lt;/span>:&lt;span style="color:#98c379">&amp;#34;Kubernetes&amp;#34;&lt;/span>,&lt;span style="color:#98c379">&amp;#34;version&amp;#34;&lt;/span>:&lt;span style="color:#98c379">&amp;#34;v1.30.11&amp;#34;&lt;/span>&lt;span style="color:#56b6c2">}&lt;/span>,&lt;span style="color:#98c379">&amp;#34;paths&amp;#34;&lt;/span>:&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;/.well-known/openid-configuration/&amp;#34;&lt;/span>:&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;get&amp;#34;&lt;/span>:&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;description&amp;#34;&lt;/span>:&lt;span style="color:#98c379">&amp;#34;get service account issuer OpenID configuration, also known as
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>That was a tricky one! Interestingly: it has only occurred in AKS.
&lt;a href="https://aws.amazon.com/eks/">EKS&lt;/a> was fine.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;a href="https://en.wikiquote.org/wiki/The_IT_Crowd">Hello, IT. Have you tried turning it off and on
again?&lt;/a>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>ArgoCD: custom health check for StatefulSet (OnDelete)</title><link>https://perrotta.dev/2025/06/argocd-custom-health-check-for-statefulset-ondelete/</link><pubDate>Fri, 13 Jun 2025 21:40:01 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-custom-health-check-for-statefulset-ondelete/</guid><description>&lt;p>It turns out the
&lt;a href="https://github.com/argoproj/gitops-engine/blob/master/pkg/health/health_statefulset.go">built-in&lt;/a>
health check for
&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSets&lt;/a>
in ArgoCD is not comprehensive enough.&lt;/p>
&lt;p>It covers
&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#update-strategies">&lt;code>RollingUpdate&lt;/code>&lt;/a>
well enough, but &lt;code>OnDelete&lt;/code> is incomplete.&lt;/p>
&lt;p>More specifically:&lt;/p>
&lt;p>&lt;strong>Observed&lt;/strong>: whenever you push an update to an STS whose &lt;code>.spec.updateStrategy&lt;/code>
is &lt;code>OnDelete&lt;/code>, its health status stays as &lt;code>Healthy&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Expected&lt;/strong>: there should be an indication that the STS pods are not
up-to-date, and hence need to be restarted to incorporate the latest changes.&lt;/p>
&lt;p>There is &lt;a href="https://github.com/argoproj/argo-cd/issues/6527">an open bug&lt;/a>:
&lt;code>Statefulset healthcheck does not work #6527&lt;/code> for it.&lt;/p>
&lt;p>I managed to work around it by defining my own health check. This is an use case
where Gen AI is helpful, though it does not shine. I could not have Gen AI
produce a fully working health check for this scenario. Instead, I used it to
bootstrap a basic example, then had to tweak it until it worked. This has been
tested multiple times, I am reasonably confident it works well (some edge cases
could be missing though).&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-lua" data-lang="lua">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">health_status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e5c07b">nil&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Waiting for status to be reported&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">return&lt;/span> &lt;span style="color:#e06c75">health_status&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">strategy&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.spec&lt;/span>.&lt;span style="color:#e06c75">updateStrategy&lt;/span> &lt;span style="color:#56b6c2">and&lt;/span> &lt;span style="color:#e06c75">obj.spec&lt;/span>.&lt;span style="color:#e06c75">updateStrategy.type&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#98c379">&amp;#34;RollingUpdate&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.spec&lt;/span>.&lt;span style="color:#e06c75">replicas&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">readyReplicas&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">updatedReplicas&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">replicas&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">current_revision&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">currentRevision&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#98c379">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">update_revision&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">updateRevision&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#98c379">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">strategy&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#98c379">&amp;#34;OnDelete&amp;#34;&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">and&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Healthy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;All replicas are ready and updated (OnDelete strategy)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">elseif&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#d19a66">0&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Degraded&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;No replicas have been updated (OnDelete strategy): 0/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; updated. Still running an old revision!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing (OnDelete): &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; ready, &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; updated&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">and&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">current_revision&lt;/span> &lt;span style="color:#56b6c2">~=&lt;/span> &lt;span style="color:#e06c75">update_revision&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Waiting for rollout to complete: revision mismatch (&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">current_revision&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; ≠ &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">update_revision&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Healthy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;All replicas updated, ready, and revisions match&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;RollingUpdate progressing: &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; ready, &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; updated&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">return&lt;/span> &lt;span style="color:#e06c75">health_status&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It is necessary to distinguish between &lt;code>OnDelete&lt;/code> and &lt;code>RollingUpdate&lt;/code>.&lt;/p>
&lt;p>&lt;code>OnDelete&lt;/code> should not use &lt;code>currentRevision&lt;/code> / &lt;code>update_revision&lt;/code>, as these values
don&amp;rsquo;t mean anything for that update strategy. This can be observed
&lt;a href="https://github.com/argoproj/gitops-engine/blob/f8f1b61ba3fd5fcb647563db3106977e1364de31/pkg/health/health_statefulset.go#L63">upstream&lt;/a>
as well.&lt;/p>
&lt;p>It is easy to write / tweak the health check when you look at the live STS
resource / manifest in the cluster. &lt;code>obj&lt;/code> refers to the STS manifest (&lt;code>kubectl get sts -o yaml&lt;/code>). The most relevant field is &lt;code>status:&lt;/code>.&lt;/p>
&lt;p>If you deploy ArgoCD via its helm chart, add that check for &lt;code>argocd-cm&lt;/code>. The
&lt;code>values.yaml&lt;/code> file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">argo-cd&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">cm&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">resource.customizations.health.apps_StatefulSet&lt;/span>: |&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> health_status = {}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> [...]&lt;/span> 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This custom health check was partly inspired by a Prometheus alert we have:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">alert&lt;/span>: StatefulSetUpdateNotRolledOut
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">expr&lt;/span>: max without (revision) (kube_statefulset_status_current_revision unless kube_statefulset_status_update_revision) * (kube_statefulset_replicas != kube_statefulset_status_replicas_updated)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>How long will it take until LLMs &lt;del>steal&lt;/del> adopt this novel solution from me?&lt;/p></description></item><item><title>Slack: public chats first</title><link>https://perrotta.dev/2025/06/slack-public-chats-first/</link><pubDate>Fri, 13 Jun 2025 20:01:10 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/slack-public-chats-first/</guid><description>&lt;p>&lt;a href="https://www.mooreds.com/wordpress/archives/3706">Why Public Slack Chats are Better than Direct Messages&lt;/a> by Dan Moore:&lt;/p>
&lt;p>&lt;strong>Bad&lt;/strong>™:&lt;/p>
&lt;blockquote>
&lt;p>I&amp;rsquo;ve noticed that I sometimes use direct messages when I should be asking a
question in a public channel. Upon examination, direct messages have the
following attributes:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Less intrusive. I sometimes worry about an excessive amount of chatter
bothering other team members.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Protect my ego. When I ask a question it is admitting that I don&amp;rsquo;t know the
answer. As a &amp;ldquo;director of engineering&amp;rdquo; it can be humbling to admit
ignorance. But of course I don&amp;rsquo;t know everything! It&amp;rsquo;s just my ego talking.
However, it still stings a bit sometimes to ask publicly–it&amp;rsquo;s easier to just
side chat.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>&lt;strong>Good&lt;/strong>™:&lt;/p>
&lt;blockquote>
&lt;p>However, the benefits of posting in a public channel are many. A message in a
public channel is:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Viewable. This means that others can chime in (as opposed to just the person
I DMed). And that others can learn in the present as they read my question
and the answers.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Linkable. This means that if I want to reference the conversation (in a PR,
trello card or elsewhere), I can. Of course, I should extract info into
documentation (future me will thank past me) but for context around a
decision, a link to a slack chat can be very helpful.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Searchable. This means that others in the future who are searching for this
information can find it. Yes, slack&amp;rsquo;s search leaves something to be desired,
but if the conversation is private, that&amp;rsquo;s a guarantee that no one else will
be able to search and find it.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Vulnerable. I want everyone to feel comfortable asking questions. That leads
to better outcomes for clients and for team members. How can I expect that
behavior of others if I don&amp;rsquo;t do it myself?&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>Surprisingly, I&amp;rsquo;ve had many teammates throughout the years that are unaware of
these benefits.&lt;/p>
&lt;p>One more for &lt;strong>Bad&lt;/strong> (direct messages):&lt;/p>
&lt;ul>
&lt;li>&lt;strong>No load balancing&lt;/strong>. Risk of bothering one person instead of distributing
question load amongst the team.&lt;/li>
&lt;/ul>
&lt;p>One more for &lt;strong>Good&lt;/strong> (public messages):&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Knowledge sharing&lt;/strong>. What you ask, you learn. What you learn, your teammates
also learn. Win-win!&lt;/li>
&lt;/ul></description></item><item><title>.gitignore .claude/settings.local.json</title><link>https://perrotta.dev/2025/06/.gitignore-.claude/settings.local.json/</link><pubDate>Thu, 12 Jun 2025 22:17:43 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/.gitignore-.claude/settings.local.json/</guid><description>&lt;p>The initial attempt:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat ~/.gitignore
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.claude/settings.local.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>However, it doesn&amp;rsquo;t work when you run &lt;a href="https://www.anthropic.com/claude-code">claude
code&lt;/a> in a subdirectory of your git
repository root. &lt;code>git diff&lt;/code> still surfaces it.&lt;/p>
&lt;p>The correct form is:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">-.claude/settings.local.json
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+**/.claude/settings.local.json
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Add &lt;code>**&lt;/code> to include subdirectories as well.&lt;/p></description></item><item><title>Paolo the plumber</title><link>https://perrotta.dev/2025/06/paolo-the-plumber/</link><pubDate>Thu, 12 Jun 2025 21:48:48 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/paolo-the-plumber/</guid><description>&lt;p>&lt;a href="https://endler.dev/2025/paolo/">Paolo the plumber&lt;/a> by Matthias Endler.&lt;/p>
&lt;p>It&amp;rsquo;s hard to quote bits from that article, just go read the whole thing.&lt;/p>
&lt;p>Surely the optimal kind of person that one should aspire to be in 2025 and
beyond is a hybrid between Paolo and Mario.
&lt;a href="https://en.wikipedia.org/wiki/Wario">Pario&lt;/a>?&lt;/p></description></item><item><title>git commit: automatically add pull request template</title><link>https://perrotta.dev/2025/06/git-commit-automatically-add-pull-request-template/</link><pubDate>Thu, 12 Jun 2025 21:09:36 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/git-commit-automatically-add-pull-request-template/</guid><description>&lt;p>GitHub supports &lt;a href="https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/creating-a-pull-request-template-for-your-repository">pull request
templates&lt;/a>.
Define a &lt;code>.github/PULL_REQUEST_TEMPLATE.md&lt;/code> directory in your git repo, and it
will be automatically used when creating PRs via the GitHub web UI and via the
CLI tool (&lt;a href="https://cli.github.com/">&lt;code>gh&lt;/code>&lt;/a>).&lt;/p>
&lt;p>But what about commits created locally, via a plain &lt;code>git commit&lt;/code>?&lt;/p>
&lt;p>As per &lt;a href="https://git-scm.com/docs/git-commit/2.49.0#Documentation/git-commit.txt-code--templateltfilegtcode">git
docs&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>commit.template&lt;/code>&lt;/p>
&lt;p>Specify the pathname of a file to use as the template for new commit messages.&lt;/p>
&lt;/blockquote>
&lt;p>Therefore, the following &lt;code>~/.gitconfig&lt;/code> works:&lt;/p>
&lt;pre tabindex="0">&lt;code>[commit]
 template = .github/PULL_REQUEST_TEMPLATE.md
&lt;/code>&lt;/pre>&lt;p>The file path (pathname) is relative to the git repository root.&lt;/p>
&lt;p>However, this will fail in repositories that do not have a template:&lt;/p>
&lt;pre tabindex="0">&lt;code>% git commit
fatal: could not read &amp;#39;.github/PULL_REQUEST_TEMPLATE.md&amp;#39;: No such file or directory
&lt;/code>&lt;/pre>&lt;p>There&amp;rsquo;s a workaround: use &lt;a href="https://git-scm.com/docs/git-config#_includes">&lt;code>includeIf&lt;/code>&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% tail -3 ~/.gitconfig
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># Import corp configs if any.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>include&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">path&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> .gitconfig_corp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat ~/.gitconfig_corp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>includeIf &lt;span style="color:#98c379">&amp;#34;gitdir:~/mycompany/**&amp;#34;&lt;/span>&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">path&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> .gitconfig_mycompany
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>includeIf &lt;span style="color:#98c379">&amp;#34;hasconfig:remote.*.url:git@github.com:mycompany/**&amp;#34;&lt;/span>&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">path&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> .gitconfig_mycompany
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat ~/.gitconfig_mycompany
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>commit&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">template&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> .github/PULL_REQUEST_TEMPLATE.md
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This way, the github PR template is only included for git repositories from my
company.&lt;/p></description></item><item><title>ArgoCD: application stuck in unknown</title><link>https://perrotta.dev/2025/06/argocd-application-stuck-in-unknown/</link><pubDate>Thu, 12 Jun 2025 11:51:32 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-application-stuck-in-unknown/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: An application in ArgoCD that was previously running
smoothly has suddenly started to fail. Its status has changed to &amp;ldquo;Unknown&amp;rdquo;.
The &amp;ldquo;Refresh&amp;rdquo; button is grayed out in the Argo web UI.&lt;/p>
&lt;p>I found the following works in this scenario, which is typically a transient
issue:&lt;/p>
&lt;ul>
&lt;li>restart the argo server&lt;/li>
&lt;li>restart the argo repo server&lt;/li>
&lt;/ul>
&lt;p>In terms of commands:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% kubectl rollout restart deployment argocd-server -n argocd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% kubectl rollout restart deployment argocd-repo-server -n argocd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>JIRA Service Management search is terrible</title><link>https://perrotta.dev/2025/06/jira-service-management-search-is-terrible/</link><pubDate>Tue, 10 Jun 2025 13:49:28 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/jira-service-management-search-is-terrible/</guid><description>&lt;p>&lt;a href="https://www.atlassian.com/software/jira/service-management">JIRA Service
Management&lt;/a> is a
platform that tries to do way too many things (poorly) and has been plagued with
AI hype, but today we&amp;rsquo;re only concerned with its Alerting platform (think
PagerDuty).&lt;/p>
&lt;p>An anecdote from today:&lt;/p>
&lt;p>I searched for the list of all alerts (open and closed) that match
&lt;a href="https://chartmuseum.com/">&lt;code>chartmuseum&lt;/code>&lt;/a>. Simple, right? That is one of the
main user journeys of the platform.&lt;/p>
&lt;p>It returned no results. Zero. Nada. Zilch.&lt;/p>
&lt;p>That cannot be! I just received an alert about chartmuseum. What gives?&lt;/p>
&lt;p>The alerts have this title form:&lt;/p>
&lt;ul>
&lt;li>&lt;code>[AWS CloudWatch]: chartmuseum-cpu-alarm-container-insights&lt;/code>&lt;/li>
&lt;li>&lt;code>[AWS CloudWatch]: chartmuseum-cpu-alarm&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>Surely &lt;code>chartmuseum&lt;/code> should match them?&lt;/p>
&lt;p>After some back-and-forth, I realized that searching for &lt;code>chartmuseum-cpu-alarm&lt;/code>
would work, as well as &lt;code>chartmuseum-cpu-alarm-container-insights&lt;/code>.&lt;/p>
&lt;p>Aha! So they are doing an implicit word boundary search (think &lt;code>\bterm\b&lt;/code> in
PCRE regex terms).&lt;/p>
&lt;p>This is, frankly, a horrible default. I could not find any way to make a
substring match. Yet, it is unreasonable to expect us users to search for the
whole word like that. Sometimes I don&amp;rsquo;t know what alert I am looking for.&lt;/p>
&lt;p>There&amp;rsquo;s a workaround. From their &lt;a href="https://support.atlassian.com/jira-service-management-cloud/docs/search-syntax-for-alerts/">docs&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Using asterisk (*) as a wildcard&lt;/strong>&lt;/p>
&lt;p>Wildcards can only be used after characters and will only match from the start
of character sequences. Character sequences need to be separated by a space
for the wildcard to try and match to each sequence of characters.&lt;/p>
&lt;/blockquote>
&lt;p>Therefore &lt;code>chartmuseum*&lt;/code> works. Or, even better: &lt;code>*chartmuseum*&lt;/code>.&lt;/p>
&lt;p>It&amp;rsquo;s a pity, but the way forward here is to memorize that I need to add &lt;code>*&lt;/code>
every single time.&lt;/p>
&lt;p>Come on Atlassian, surely you can do better than this?&lt;/p></description></item><item><title>bad interpreter: perl: no such file or directory</title><link>https://perrotta.dev/2025/06/bad-interpreter-perl-no-such-file-or-directory/</link><pubDate>Sun, 08 Jun 2025 17:48:35 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/bad-interpreter-perl-no-such-file-or-directory/</guid><description>&lt;p>The full error message is:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ack -i nmap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zsh: /opt/homebrew/bin/ack: bad interpreter: /opt/homebrew/opt/perl/bin/perl: no such file or directory
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This keeps happening, I am not sure why. &lt;a href="https://perrotta.dev/2024/09/life-without-ack/">Previously&lt;/a>.&lt;/p>
&lt;p>The fix is quite simple though:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% brew reinstall perl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apple App Store Geo-blocking</title><link>https://perrotta.dev/2025/06/apple-app-store-geo-blocking/</link><pubDate>Thu, 05 Jun 2025 19:22:15 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/apple-app-store-geo-blocking/</guid><description>&lt;p>Apple Accounts are tied to a specific country. You can have one and only one
country associated with an account at any given time.&lt;/p>
&lt;p>This is a problem whenever certain apps are restricted to &lt;em>only&lt;/em> certain countries
(&lt;a href="https://en.wikipedia.org/wiki/Geo-blocking">geo-blocking&lt;/a>).&lt;/p>
&lt;p>For example, an app from a bank or a financial broker may be made available
&lt;em>only&lt;/em> in the country wherein it operates, thereby completely ignoring the
existence and needs of expats.&lt;/p>
&lt;p>How do you know in which countries certain apps are made available? Here&amp;rsquo;s one
way:&lt;/p>
&lt;ul>
&lt;li>Brazil: &lt;a href="https://www.apple.com/br/search/">https://www.apple.com/br/search/&lt;/a>&lt;/li>
&lt;li>Canada: &lt;a href="https://www.apple.com/ca/search/">https://www.apple.com/ca/search/&lt;/a>&lt;/li>
&lt;li>Germany: &lt;a href="https://www.apple.com/de/search/">https://www.apple.com/de/search/&lt;/a>&lt;/li>
&lt;li>USA: &lt;a href="https://www.apple.com/us/search/">https://www.apple.com/us/search/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Wanna see examples? Try searching for these apps in different stores&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.apple.com/de/search/commerzbank?src=serp">Commerzbank&lt;/a> is only available in Germany.&lt;/li>
&lt;li>&lt;a href="https://www.apple.com/br/search/MEI?src=serp">MEI&lt;/a> is only available in Brazil.&lt;/li>
&lt;li>&lt;a href="https://www.apple.com/us/search/venmo?src=serp">Venmo&lt;/a> is only available in the USA.&lt;/li>
&lt;li>&lt;a href="https://www.apple.com/ca/search/wealthsimple?src=serp">WealthSimple&lt;/a> is only available in Canada.&lt;/li>
&lt;/ul>
&lt;p>You can change the country associated with your App Store by following Apple&amp;rsquo;s
&lt;a href="https://support.apple.com/en-us/118283">official documentation&lt;/a>.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>For the sake of basic
&lt;a href="https://en.wikipedia.org/wiki/Operations_security">OpSec&lt;/a>, I don&amp;rsquo;t have an
account in any of these services, in case you were wondering :-)&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Alpine Linux: Dockerfile: install package from edge</title><link>https://perrotta.dev/2025/06/alpine-linux-dockerfile-install-package-from-edge/</link><pubDate>Wed, 04 Jun 2025 12:37:47 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/alpine-linux-dockerfile-install-package-from-edge/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given a &lt;code>Dockerfile&lt;/code> based on a fixed release of Alpine
Linux (e.g. &lt;code>FROM alpine:3.22&lt;/code>), install a package from &lt;code>edge&lt;/code> (i.e. a package
that did not yet make it to a fixed release).&lt;/p>
&lt;p>The approach is similar to package &lt;a href="https://perrotta.dev/2025/01/alpine-linux-install-/-pin-old-packages/">pinning&lt;/a>, by providing a custom
&lt;code>--repository&lt;/code> to &lt;code>apk add&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">RUN&lt;/span> apk add --no-cache --repository&lt;span style="color:#56b6c2">=&lt;/span>https://dl-cdn.alpinelinux.org/alpine/edge/testing gliderlabs-sigil vals
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Replace &amp;ldquo;testing&amp;rdquo; with &amp;ldquo;community&amp;rdquo; or &amp;ldquo;main&amp;rdquo; as needed.&lt;/p></description></item><item><title>Alpine Linux: package is gone?!</title><link>https://perrotta.dev/2025/06/alpine-linux-package-is-gone/</link><pubDate>Wed, 04 Jun 2025 11:43:05 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/alpine-linux-package-is-gone/</guid><description>&lt;p>Upon upgrading one of our Dockerfiles from Alpine Linux 3.21 to 3.22, we noticed
that the &lt;code>ruby-json&lt;/code> package no longer exists:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% docker build -t myproject -f Dockerfile .
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;gt; &lt;span style="color:#56b6c2">[&lt;/span> 2/10&lt;span style="color:#56b6c2">]&lt;/span> RUN apk add --update --no-cache ruby-json&lt;span style="color:#56b6c2">=&lt;/span>~&lt;span style="color:#98c379">&amp;#34;3.4&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2.371 ERROR: unable to &lt;span style="color:#c678dd">select&lt;/span> packages:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2.371 ruby-json &lt;span style="color:#56b6c2">(&lt;/span>no such package&lt;span style="color:#56b6c2">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2.371 required by: world&lt;span style="color:#56b6c2">[&lt;/span>ruby-json~3.4&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Why??&lt;/p>
&lt;p>First, look into &lt;a href="https://pkgs.alpinelinux.org/packages">Alpine Linux Packages&lt;/a>:
&lt;a href="https://pkgs.alpinelinux.org/packages?name=ruby-json&amp;amp;branch=v3.22&amp;amp;repo=&amp;amp;arch=&amp;amp;origin=&amp;amp;flagged=&amp;amp;maintainer=">query&lt;/a>.
Ensure to set branch to v3.22 and architecture to All. And it&amp;rsquo;s indeed not
there anymore:&lt;/p>
&lt;blockquote>
&lt;p>No matching packages found&amp;hellip;&lt;/p>
&lt;/blockquote>
&lt;p>Next, do a bit of digging in the
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports">aports&lt;/a> repository on the &lt;a href="https://gitlab.alpinelinux.org/">Alpine
Linux GitLab&lt;/a>:
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/?sort=created_date&amp;amp;state=all&amp;amp;search=ruby-json&amp;amp;first_page_size=20">query&lt;/a>.
Search for &lt;code>ruby-json&lt;/code> in &amp;ldquo;All&amp;rdquo; Merge requests.&lt;/p>
&lt;p>That leads to
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/80599">&lt;code>!80599&lt;/code>&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>community/ruby-json: remove&lt;/p>
&lt;p>&lt;code>ruby-json&lt;/code> is already bundled with &lt;code>main/ruby&lt;/code>. The &lt;code>community/ruby-json&lt;/code>
could never be installed due to conflicts.&lt;/p>
&lt;/blockquote>
&lt;p>Aha, then there&amp;rsquo;s nothing to do here. Installing the base &lt;code>ruby&lt;/code> package should
be enough from now on.&lt;/p>
&lt;p>&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/issues/16938">#16938&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>I think it&amp;rsquo;s safe to say community/ruby-json does literally nothing, has never been installed, and does not work.&lt;/p>
&lt;/blockquote>
&lt;p>Oh well.&lt;/p></description></item><item><title>git pull: authentication issues</title><link>https://perrotta.dev/2025/06/git-pull-authentication-issues/</link><pubDate>Tue, 03 Jun 2025 14:35:04 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/git-pull-authentication-issues/</guid><description>&lt;p>&lt;code>git pull&lt;/code> authentication issues is &lt;em>really&lt;/em> a disguise for &lt;code>ssh&lt;/code> auth issues.&lt;/p>
&lt;p>Today a teammate could not &lt;code>git pull&lt;/code> one of our internal repos:&lt;/p>
&lt;pre tabindex="0">&lt;code>% git pull
Enter passphrase for key &amp;#39;/Users/user/.ssh/id_ed25519&amp;#39;:
git@github.com: Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
&lt;/code>&lt;/pre>&lt;p>The first thing we verified was that his public key was
&lt;a href="https://github.com/settings/keys">added&lt;/a> to his github profile, and that the
private key was present in &lt;code>~/.ssh/id_ed25519&lt;/code>.&lt;/p>
&lt;p>Next, verify &lt;code>~/.ssh/config&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>Host github.com
AddKeysToAgent yes
UseKeychain yes
IdentityFile ~/.ssh/id_ed25519
&lt;/code>&lt;/pre>&lt;p>Looks fine. Then:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">export&lt;/span> &lt;span style="color:#e06c75">GIT_SSH_COMMAND&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>&lt;span style="color:#98c379">&amp;#34;ssh -vvv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% git pull
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug3: Search &lt;span style="color:#c678dd">for&lt;/span> item with query: &lt;span style="color:#56b6c2">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">acct&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;/Users/user/.ssh/id_ed25519&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">agrp&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;com.apple.ssh.passphrases&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">class&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> genp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">labl&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;SSH: /Users/user/.ssh/id_ed25519&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">nleg&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;r_Data&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">svce&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> OpenSSH;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;u_AuthUI&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;u_AuthUIF&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug2: Unexpected keychain error &lt;span style="color:#c678dd">while&lt;/span> searching &lt;span style="color:#c678dd">for&lt;/span> an item: User interaction is not allowed.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Herein lies the error! The interaction with the system keychain in macOS was not
successful.&lt;/p>
&lt;p>I suggested him to remove &lt;code>AddKeysToAgent&lt;/code> and &lt;code>UseKeychain&lt;/code> from this config
file, but that did not work either:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% git pull
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Enter passphrase &lt;span style="color:#c678dd">for&lt;/span> key &lt;span style="color:#98c379">&amp;#39;/Users/user/.ssh/id_ed25519&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug2: no passphrase given, try next key
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug2: we did not send a packet, disable method
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>debug1: No more authentication methods to try.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git@github.com: Permission denied &lt;span style="color:#56b6c2">(&lt;/span>publickey&lt;span style="color:#56b6c2">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fatal: Could not &lt;span style="color:#e5c07b">read&lt;/span> from remote repository.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Please make sure you have the correct access rights
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>and the repository exists.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The ssh key is protected with a passphrase.&lt;/p>
&lt;p>In this case, it&amp;rsquo;s better to fix the keychain issue. We readd the two deleted
lines.&lt;/p>
&lt;p>Restart the &lt;code>ssh-agent&lt;/code> and readd the key there:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">eval&lt;/span> &lt;span style="color:#98c379">&amp;#34;&lt;/span>&lt;span style="color:#c678dd">$(&lt;/span>ssh-agent -s&lt;span style="color:#c678dd">)&lt;/span>&lt;span style="color:#98c379">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% ssh-add -K ~/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Problem resolved! &lt;code>git pull&lt;/code> works now.&lt;/p></description></item><item><title>Alpine Linux packaging: track new software releases</title><link>https://perrotta.dev/2025/06/alpine-linux-packaging-track-new-software-releases/</link><pubDate>Tue, 03 Jun 2025 01:36:53 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/alpine-linux-packaging-track-new-software-releases/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: You maintain packages for a Linux distribution, for
example, &lt;a href="https://www.alpinelinux.org/">Alpine Linux&lt;/a>. Find a way to keep track
of new software releases, to ensure your packages are kept up-to-date.&lt;/p>
&lt;p>The &lt;a href="https://release-monitoring.org/">Release Monitoring&lt;/a> project (codename
&lt;em>Anitya&lt;/em>), part of the &lt;a href="https://www.fedoraproject.org/">Fedora Linux&lt;/a> distro,
can accomplish that:&lt;/p>
&lt;blockquote>
&lt;p>Watch for releases of your favorite projects&lt;/p>
&lt;p>We all have our favorite projects and we all like to use their latest versions
with their latest features. However, it is hard to keep in touch with all of
them and be informed when they release a new version. Anitya can help!&lt;/p>
&lt;p>We monitor upstream releases and broadcast them on Fedora messaging bus.&lt;/p>
&lt;/blockquote>
&lt;p>The underlying project:&lt;/p>
&lt;blockquote>
&lt;p>Anitya is a release monitoring project.&lt;/p>
&lt;p>Its goal is to regularly check if a project has made a new release. When
Anitya discovers a new release for a project, it publishes a RabbitMQ message
via fedora messaging. This makes it easy to integrate with Anitya and perform
actions when a new release is created for a project. For example, the Fedora
project runs a service called the-new-hotness which files a Bugzilla bug
against a package when the upstream project makes a new release.&lt;/p>
&lt;p>Anitya provides a user-friendly interface to add, edit, or browse projects.&lt;/p>
&lt;/blockquote>
&lt;p>Even though it is part of Fedora, we can use it for Alpine Linux just fine!&lt;/p>
&lt;p>Recently I packaged &lt;a href="https://github.com/zizmorcore/zizmor/issues/780">zizmor&lt;/a>. I
noticed there was no entry for it in Anitya. I added one. It&amp;rsquo;s very
straightforward:&lt;/p>
&lt;ul>
&lt;li>head to &lt;a href="https://release-monitoring.org/">https://release-monitoring.org/&lt;/a>&lt;/li>
&lt;li>ensure the project you want to monitor isn&amp;rsquo;t already present there&lt;/li>
&lt;li>log in (e.g. via GitHub)&lt;/li>
&lt;li>click &lt;a href="https://release-monitoring.org/project/new">add project&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Fill in the form:&lt;/p>
&lt;ul>
&lt;li>Project name: zizmor&lt;/li>
&lt;li>Homepage: &lt;a href="https://docs.zizmor.sh">https://docs.zizmor.sh&lt;/a>&lt;/li>
&lt;li>BackEnd: GitHub&lt;/li>
&lt;li>Version scheme: Semantic&lt;/li>
&lt;li>Github owner/project: &lt;a href="https://github.com/zizmorcore/zizmor">zizmorcore/zizmor&lt;/a>&lt;/li>
&lt;li>Version prefix: &lt;code>v&lt;/code>&lt;/li>
&lt;li>Pre-release filter: &lt;code>rc&lt;/code>&lt;/li>
&lt;li>Version filter: &lt;code>rc&lt;/code> (excludes &lt;a href="https://github.com/zizmorcore/zizmor/releases/tag/v1.8.0-rc0">&lt;code>1.8.0-rc0&lt;/code>&lt;/a>) and the like&lt;/li>
&lt;li>Check off &amp;ldquo;check releases instead of tags&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;p>Once the project is &lt;a href="https://release-monitoring.org/project/378497/">created&lt;/a>,
add a new distribution mapping:&lt;/p>
&lt;ul>
&lt;li>Distribution: Alpine&lt;/li>
&lt;li>Package name: &lt;a href="https://pkgs.alpinelinux.org/package/edge/testing/x86_64/zizmor">zizmor&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>And we&amp;rsquo;re done!&lt;/p>
&lt;p>As per &lt;a href="https://pkgs.alpinelinux.org/flagging">https://pkgs.alpinelinux.org/flagging&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Package flagging&lt;/p>
&lt;p>Manual package flagging has been disabled in favour of automatic flagging
based on Anitya.&lt;/p>
&lt;p>If you want a package to be up-to-date or to inform the maintainer about the
package status, please feel free to create a package mapping on Anitya. Once
the mapping is made, it should automatically send an email to the maintainer
whenever a new version is available.&lt;/p>
&lt;p>For details on how to create a project mapping for Alpine Linux, please refer
to the &lt;a href="https://release-monitoring.org/static/docs/user-guide.html">release monitoring
documentation&lt;/a>.&lt;/p>
&lt;/blockquote></description></item><item><title>ArgoCD: upgrade to v3, remove helm labels</title><link>https://perrotta.dev/2025/06/argocd-upgrade-to-v3-remove-helm-labels/</link><pubDate>Mon, 02 Jun 2025 13:03:24 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-upgrade-to-v3-remove-helm-labels/</guid><description>&lt;p>I am leading the effort to upgrade ArgoCD to its &lt;a href="https://blog.argoproj.io/announcing-argo-cd-v3-small-but-mighty-df05c0b39ad6">newest major version
(v3)&lt;/a>
across our fleet.&lt;/p>
&lt;p>One of its &lt;a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/upgrading/2.14-3.0/">breaking
changes&lt;/a>
is the removal of helm labels from argo applications, like such:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># [...]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">app.kubernetes.io/managed-by&lt;/span>: Helm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Applying a normal sync does not get rid of the label.&lt;/p>
&lt;p>I found out that doing an one-off &lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#server-side-apply">server-side apply
sync&lt;/a>
addresses the label removal, and it is safe to do (incurs no downtime):&lt;/p>
&lt;blockquote>
&lt;p>However, there are some cases where you want to use &lt;code>kubectl apply --server-side&lt;/code> over &lt;code>kubectl apply&lt;/code>:&lt;/p>
&lt;p>[&amp;hellip;]&lt;/p>
&lt;p>Patching of existing resources on the cluster that are not fully managed by
Argo CD.&lt;/p>
&lt;/blockquote>
&lt;p>There&amp;rsquo;s no need to make the server-side apply a permanent config, i.e.:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">apiVersion&lt;/span>: argoproj.io/v1alpha1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">kind&lt;/span>: Application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">syncPolicy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">syncOptions&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - ServerSideApply=true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&amp;hellip;though there&amp;rsquo;s no harm either in doing so.&lt;/p></description></item><item><title>PDB: minAvailable and maxUnavailable cannot be both set</title><link>https://perrotta.dev/2025/06/pdb-minavailable-and-maxunavailable-cannot-be-both-set/</link><pubDate>Mon, 02 Jun 2025 12:00:05 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/pdb-minavailable-and-maxunavailable-cannot-be-both-set/</guid><description>&lt;p>In Kubernetes it&amp;rsquo;s not possible to have a &lt;a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">&lt;code>PodDisruptionBudget&lt;/code>
(PDB)&lt;/a> with
both &lt;code>minAvailable&lt;/code> and &lt;code>maxUnavailable&lt;/code> set simultaneously:&lt;/p>
&lt;pre tabindex="0">&lt;code>one or more objects failed to apply, reason: PodDisruptionBudget.policy &amp;#34;pgbouncer-pgbouncer&amp;#34; is invalid: spec: Invalid value: policy.PodDisruptionBudgetSpec{MinAvailable:(*intstr.IntOrString)(0xc02c03dd20), Selector:(*v1.LabelSelector)(0xc02c03dd40), MaxUnavailable:(*intstr.IntOrString)(0xc02c03dd60), UnhealthyPodEvictionPolicy:(*policy.UnhealthyPodEvictionPolicyType)(nil)}: minAvailable and maxUnavailable cannot be both set (retried 5 times).
&lt;/code>&lt;/pre>&lt;p>Our manifests did not violate this rule though. Then where did the error message
come from?&lt;/p>
&lt;p>It turns out &lt;a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD&lt;/a> was creating an
intermediate state containing both properties:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># [...]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">minAvailable&lt;/span>: &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">maxUnavailable&lt;/span>: &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># [...]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>One solution is to sync the underlying application PDB manifest with
&lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#replace-resource-instead-of-applying-changes">replace&lt;/a>.&lt;/p>
&lt;p>&lt;strong>Warning&lt;/strong>: It&amp;rsquo;s better to &amp;ldquo;sync with replace&amp;rdquo; &lt;strong>only&lt;/strong> the PDB. Do not do it
in the entire application.&lt;/p></description></item><item><title>Replace text in PDFs</title><link>https://perrotta.dev/2025/06/replace-text-in-pdfs/</link><pubDate>Sun, 01 Jun 2025 22:39:36 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/replace-text-in-pdfs/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given an existing PDF file, replace text in it.&lt;/p>
&lt;p>&lt;code>Preview.app&lt;/code> on macOS cannot replace text; it can only add annotations. It is
possible to use it in a hacky way: add a white square on top of the text you
want to replace, then add another piece of text atop.&lt;/p>
&lt;p>I found that &lt;a href="https://www.pdfgear.com/">PDFGear&lt;/a> does the job well. It is not
open source, but it is free. On macOS it needs to be manually downloaded and
installed from the &lt;a href="https://apps.apple.com/us/app/pdfgear-pdf-editor-reader/id6469021132?mt=12&amp;amp;os=mac&amp;amp;lang=en">Mac App
Store&lt;/a>,
as it&amp;rsquo;s not in Homebrew. It&amp;rsquo;s also available on Windows. It is quite well-rated
in &lt;a href="https://www.trustpilot.com/review/pdfgear.com">Trustpilot&lt;/a> (4.9 stars, 6500+
reviews).&lt;/p>
&lt;p>On Linux I would probably try &lt;a href="https://xournalpp.github.io/">Xournal++&lt;/a>, however
it is really a PDF &lt;em>annotation&lt;/em> tool.&lt;/p></description></item><item><title>Kagi trial expires</title><link>https://perrotta.dev/2025/05/kagi-trial-expires/</link><pubDate>Sat, 31 May 2025 16:44:02 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/kagi-trial-expires/</guid><description>&lt;p>My Kagi trial is going to expire within 2 days.&lt;/p>
&lt;p>&lt;a href="https://perrotta.dev/2025/05/kagi/">Previously&lt;/a>, I wrote:&lt;/p>
&lt;blockquote>
&lt;p>The question to ask yourself is whether it&amp;rsquo;s worth paying $10 / month for
their professional plan, or whether DuckDuckGo is enough for you. If you can
have your company expense them, then it&amp;rsquo;s definitely a no-brainer.&lt;/p>
&lt;/blockquote>
&lt;p>My company approved my request to expense it, therefore I am going to buy their
&lt;a href="https://kagi.com/pricing">1-year Professional plan&lt;/a>.&lt;/p>
&lt;p>Now, a few observations:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Would I pay for it out of my own pocket? Probably no. It&amp;rsquo;s perfectly
reasonable and enough for my purposes to use a blend of &lt;a href="https://perrotta.dev/2024/12/switching-from-google-to-chatgpt-search/">DuckDuckGo + ChatGPT
Search&lt;/a>.
That said, Kagi provides extra value to me on top of that duo; I prefer using
it.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Once you grow accustomed with search results without ads it&amp;rsquo;s very, very hard
to go back. Searching on Google suddenly feels like a thing of the past. It&amp;rsquo;s
very similar to the experience of getting used to ad-blocking software in the
web browser and then suddenly turning them off. The Web feels messy and
bloated.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>I did 961 searches at the time of this post, with 18 assistant interactions. I
barely use their AI features because I prefer the OpenAI ChatGPT experience.
Nonetheless, their AI features are occasionally handy and I find them to be
integrated in a non-intrusive way.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>TL;DR&lt;/strong>: Go for Kagi iff you can expense it. This is not a sponsored post. :)&lt;/p></description></item><item><title>Limited creativity</title><link>https://perrotta.dev/2025/05/limited-creativity/</link><pubDate>Sat, 31 May 2025 16:20:54 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/limited-creativity/</guid><description>&lt;p>I feel I got to a point where my own environment is limiting my creativity. And
this is something I would like to change. Allow me to explain.&lt;/p>
&lt;p>I have a myriad of ideas in my head. Recently I&amp;rsquo;ve been noting down some of them
in my &lt;a href="https://logseq.com/">PKM&lt;/a>, which reduces stress. On the other hand, most
of these ideas ended up becoming abandoned bullet points, lost in the sea of
interconnected pages in my knowledge graph.&lt;/p>
&lt;p>I know what to do when I want to convert an idea into reality: the very first
step is to add it to my &lt;a href="https://culturedcode.com/things/">task manager&lt;/a>, and
then schedule / prioritize it. This is a superpower that I love: it&amp;rsquo;s virtually
impossible to forget anything that ends up in the task manager. Whether it&amp;rsquo;s tax
season, or a random deadline to apply for something, or to cancel a recurring
subscription, or to buy tickets for a concert&amp;hellip;full stop. The difficulty lies
in breaking down a large(r) and/or long(er)-term project into smaller,
actionable pieces.&lt;/p>
&lt;p>There is at least one missing piece in my current workflow (and environment),
which I am still trying to figure out, to close the loop and become 10x more
productive, reducing the time between the conception of an idea and its
implementation.&lt;/p>
&lt;p>The best example that illustrates it is &lt;a href="https://perrotta.dev/2024/10/new-series-raspberry-pi-fun-with-devops/">that post&lt;/a> about the Raspberry
Pi. It never took off (and it&amp;rsquo;s still in my backlog!). Another example is the
&lt;a href="https://perrotta.dev/2025/05/winterbreak-hello-world/">Kindle jailbreak&lt;/a> – it took
me 4-5 months to do it. Once I started it, it took me only a few minutes to
start it&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>. So the major bottleneck is to kick start a project. I am very
confident in my current skill set and knowledge for the execution once it has
taken off.&lt;/p>
&lt;p>What can I do in order to be more effective in terms of converting abstract
ideas into small, concrete and actionable items?&lt;/p>
&lt;p>The discovery journey continues&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;em>Hours&lt;/em>, if you account for taking notes plus waiting for the process to
complete.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>Why is the title &amp;ldquo;limited creativity&amp;rdquo; if, apparently, the flow of ideas
doesn&amp;rsquo;t stop? Isn&amp;rsquo;t this somewhat paradoxical? I take a practical
standpoint: it&amp;rsquo;s useless to have a myriad of ideas if they do not become
concrete. Virtual ideas are essentially the same as nothing. Output (or
deliverables, if you will) is the metric that matters most of the time.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Golang fuzzing</title><link>https://perrotta.dev/2025/05/golang-fuzzing/</link><pubDate>Wed, 28 May 2025 17:37:06 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/golang-fuzzing/</guid><description>&lt;p>Given &lt;code>go.mod&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat go.mod
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>module testfuzzing
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go 1.24.3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Given &lt;code>fuzz_test.go&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat fuzz_test.go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>package testfuzzing
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>import &lt;span style="color:#56b6c2">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;encoding/json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;testing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>func FuzzJsonIsValid&lt;span style="color:#56b6c2">(&lt;/span>f *testing.F&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f.Fuzz&lt;span style="color:#56b6c2">(&lt;/span>func&lt;span style="color:#56b6c2">(&lt;/span>t *testing.T, data &lt;span style="color:#56b6c2">[]&lt;/span>byte&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> json.Valid&lt;span style="color:#56b6c2">(&lt;/span>data&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#56b6c2">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Run:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% go &lt;span style="color:#e5c07b">test&lt;/span> -fuzz&lt;span style="color:#56b6c2">=&lt;/span>FuzzJsonIsValid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 0s, gathering baseline coverage: 0/325 completed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 0s, gathering baseline coverage: 325/325 completed, now fuzzing with &lt;span style="color:#d19a66">12&lt;/span> workers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 3s, execs: &lt;span style="color:#d19a66">1193906&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>397950/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 6s, execs: &lt;span style="color:#d19a66">2450910&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>419012/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 9s, execs: &lt;span style="color:#d19a66">3720167&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>423002/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 12s, execs: &lt;span style="color:#d19a66">4994906&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>424923/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 15s, execs: &lt;span style="color:#d19a66">6159087&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>388000/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 18s, execs: &lt;span style="color:#d19a66">7364384&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>401883/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 21s, execs: &lt;span style="color:#d19a66">8588030&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>407881/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 24s, execs: &lt;span style="color:#d19a66">9826978&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>412996/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">2&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 327&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 27s, execs: &lt;span style="color:#d19a66">11093873&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>422306/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">3&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 328&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fuzz: elapsed: 30s, execs: &lt;span style="color:#d19a66">12359227&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>421773/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">3&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 328&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>^Cfuzz: elapsed: 31s, execs: &lt;span style="color:#d19a66">12650530&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>403107/sec&lt;span style="color:#56b6c2">)&lt;/span>, new interesting: &lt;span style="color:#d19a66">3&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>total: 328&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PASS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ok testfuzzing 31.154s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go &lt;span style="color:#e5c07b">test&lt;/span> -fuzz&lt;span style="color:#56b6c2">=&lt;/span>FuzzJsonIsValid 286.93s user 61.51s system 1105% cpu 31.505 total
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s very cool (and convenient!) that golang supports fuzzing natively, and
integrated with its test framework. &lt;a href="https://go.dev/doc/security/fuzz/">Docs&lt;/a>.&lt;/p></description></item><item><title>Which book should I read next?</title><link>https://perrotta.dev/2025/05/which-book-should-i-read-next/</link><pubDate>Sat, 24 May 2025 22:54:30 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/which-book-should-i-read-next/</guid><description>&lt;p>Find your &lt;a href="https://nextread.info/">Next Read&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Easily discover your next read by using your GoodReads data&lt;/p>
&lt;p>Simply upload your CSV file and explore your long list off want-to-reads. Set
a minimum age to ensure your next read has survived the hype&lt;/p>
&lt;p>Use more parameters than those available in GoodReads. Combine multiple filters and sorting options at the same time to find a book that suits you.&lt;/p>
&lt;/blockquote>
&lt;p>As someone with more than 700 books marked as &amp;ldquo;to read&amp;rdquo; on
&lt;a href="https://www.goodreads.com/">Goodreads&lt;/a>, I appreciate this little tool.&lt;/p>
&lt;p>All you need to do is export your goodreads CSV data (with one click!) and then
import it on Next Read.&lt;/p>
&lt;p>The provided filtering options are quite handy.&lt;/p>
&lt;p>Note that this is a disposable tool – you&amp;rsquo;re supposed to save your (s)elected
next reads elsewhere (I do it in my current PKM of choice,
&lt;a href="https://logseq.com/">LogSeq&lt;/a>). Account state is not persisted.&lt;/p></description></item><item><title>Our most powerful model yet</title><link>https://perrotta.dev/2025/05/our-most-powerful-model-yet/</link><pubDate>Sat, 24 May 2025 20:05:20 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/our-most-powerful-model-yet/</guid><description>&lt;p>&lt;em>Add quotation marks to the title&lt;/em>.&lt;/p>
&lt;p>&lt;strong>Google&lt;/strong>:&lt;/p>
&lt;blockquote>
&lt;p>Try out Gemini 2.5 Pro (Preview), our most powerful model yet.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>User&lt;/strong>:&lt;/p>
&lt;blockquote>
&lt;p>How many Rs in RaspBerry?&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>Model&lt;/strong>:&lt;/p>
&lt;p>Thinking:&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Interpreting the user&amp;rsquo;s intent&lt;/strong>&lt;/p>
&lt;p>I&amp;rsquo;m currently focused on dissecting the user&amp;rsquo;s query. The unconventional
capitalization in &amp;ldquo;RaspBerry&amp;rdquo; has piqued my interest. I&amp;rsquo;m wondering if there&amp;rsquo;s
a specific reason for this. Perhaps it&amp;rsquo;s a stylistic choice, or it could
subtly influence the desired outcome.&lt;/p>
&lt;p>&lt;strong>Determining the final answer&lt;/strong>&lt;/p>
&lt;p>Now that I&amp;rsquo;ve analyzed the query, and determined the intended word, I&amp;rsquo;ve
confirmed the spelling is r-a-s-p-b-e-r-r-y. I&amp;rsquo;ve conducted the letter count
and it&amp;rsquo;s clear there are three &amp;lsquo;R&amp;rsquo;s in total. I&amp;rsquo;m formulating the answer,
keeping in mind the unusual capitalization but leaning towards simplicity.
Since the question is about an entity, the answer is three.&lt;/p>
&lt;/blockquote>
&lt;p>Output:&lt;/p>
&lt;blockquote>
&lt;p>Even with the capitalization as &amp;ldquo;RaspBerry,&amp;rdquo; there are still two Rs in the word.&lt;/p>
&lt;p>Let&amp;rsquo;s break it down:&lt;/p>
&lt;p>R-a-s-p-B-e-r-r-y&lt;/p>
&lt;p>The capitalization doesn&amp;rsquo;t change the letters that make up the word.&lt;/p>
&lt;/blockquote>
&lt;p>Despite using chain-of-thought (&amp;ldquo;thinking mode&amp;rdquo;) and correctly getting the right
answer (&lt;strong>three&lt;/strong>) – a significant improvement compared to previous models – the
final answer is still &lt;strong>two&lt;/strong>. The &amp;ldquo;thinking&amp;rdquo; part is hidden from the user by
default.&lt;/p>
&lt;p>If I do an exam in university and produce an incorrect final answer, despite
giving a correct answer in the middle (whilst babbling my reasoning), my final
grade is &lt;strong>zero&lt;/strong>. Just saying.&lt;/p>
&lt;p>Yes, I know how an LLM works (next token prediction, tokenizer, et cetera) but
we&amp;rsquo;re in 2025 and this is a thinking model, aggressively marketed and shoveled
everywhere, even when unprompted (pun intended). To say it does not meet
expectations is an understatement.&lt;/p>
&lt;p>For comparison: &lt;a href="https://chatgpt.com/share/68320d74-9310-8009-874c-adde37eeb810">OpenAI /
ChatGPT&lt;/a> gets it
right. They don&amp;rsquo;t make it clear which model that is though.&lt;/p></description></item><item><title>pre-commit: add hugo build</title><link>https://perrotta.dev/2025/05/pre-commit-add-hugo-build/</link><pubDate>Sat, 24 May 2025 17:29:48 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/pre-commit-add-hugo-build/</guid><description>&lt;p>Sometimes I make changes to this blog that yield build errors with its static
site generator (&lt;a href="https://gohugo.io/">hugo&lt;/a>).&lt;/p>
&lt;p>It&amp;rsquo;s trivial to spot these changes with a simple &lt;code>hugo build&lt;/code>, but &lt;a href="https://perrotta.dev/2025/03/yolo-debug-only-after-push/">I don&amp;rsquo;t always
run it&lt;/a>.&lt;/p>
&lt;p>Here&amp;rsquo;s what a typical error looks like:&lt;/p>
&lt;pre tabindex="0">&lt;code>% hugo build
Start building sites …
hugo v0.147.5+extended+withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew

ERROR [en] REF_NOT_FOUND: Ref &amp;#34;nonexistent/2025-03-24-maccy-pin-items&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-16-espanso-hello-world.md:10:14&amp;#34;: page not found
Total in 242 ms
Error: error building site: logged 1 error(s)
&lt;/code>&lt;/pre>&lt;p>The same happens when invoking &lt;a href="https://just.systems/man/en/">&lt;code>just&lt;/code>&lt;/a>, as you
would expect:&lt;/p>
&lt;pre tabindex="0">&lt;code>% just build
hugo --environment production --gc --minify
Start building sites …
hugo v0.147.5+extended+withdeploy darwin/arm64 BuildDate=2025-05-22T11:37:19Z VendorInfo=brew

ERROR [en] REF_NOT_FOUND: Ref &amp;#34;nonexistent/2025-03-24-maccy-pin-items&amp;#34;: &amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-16-espanso-hello-world.md:10:14&amp;#34;: page not found
Total in 280 ms
Error: error building site: logged 1 error(s)
error: Recipe `build` failed on line 17 with exit code 1
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Problem statement&lt;/strong>: catch such build errors at git pre-commit time.&lt;/p>
&lt;p>This is trivial with a &lt;a href="https://pre-commit.com/">pre-commit.com&lt;/a> hook:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>Author: Thiago Perrotta &amp;lt;{email redacted}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Date: Sat May 24 17:26:59 2025 +0200
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pre-commit: add just build
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>diff --git .pre-commit-config.yaml .pre-commit-config.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>index 60eb2022..623e135d 100644
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">--- .pre-commit-config.yaml
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+++ .pre-commit-config.yaml
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">&lt;/span>@@ -112,5 +112,10 @@ repos:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> language: pygrep
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> types:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - markdown
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ - id: hugo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ name: Hugo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ language: system
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ entry: just build
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379;font-weight:bold">+ pass_filenames: false
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here&amp;rsquo;s the end result:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% git commit -m &lt;span style="color:#98c379">&amp;#34;test&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Check hooks apply to the repository.............................................&lt;span style="color:#56b6c2">(&lt;/span>no files to check&lt;span style="color:#56b6c2">)&lt;/span>Skipped
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Check &lt;span style="color:#c678dd">for&lt;/span> useless excludes......................................................&lt;span style="color:#56b6c2">(&lt;/span>no files to check&lt;span style="color:#56b6c2">)&lt;/span>Skipped
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Forbid usage of UTM analytics / tracking............................................................Passed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Hugo................................................................................................Failed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- hook id: hugo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#e5c07b">exit&lt;/span> code: &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hugo --environment production --gc --minify
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Start building sites …
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hugo v0.147.5+extended+withdeploy darwin/arm64 &lt;span style="color:#e06c75">BuildDate&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>2025-05-22T11:37:19Z &lt;span style="color:#e06c75">VendorInfo&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>brew
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ERROR &lt;span style="color:#56b6c2">[&lt;/span>en&lt;span style="color:#56b6c2">]&lt;/span> REF_NOT_FOUND: Ref &lt;span style="color:#98c379">&amp;#34;a/2024-12-23-unbuffer&amp;#34;&lt;/span>: &lt;span style="color:#98c379">&amp;#34;/Users/tperrotta/Workspace/perrotta.dev/content/posts/2025-05-24-watch-with-color.md:54:54&amp;#34;&lt;/span>: page not found
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Total in &lt;span style="color:#d19a66">276&lt;/span> ms
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Error: error building site: logged &lt;span style="color:#d19a66">1&lt;/span> error&lt;span style="color:#56b6c2">(&lt;/span>s&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>error: Recipe &lt;span style="color:#98c379">`&lt;/span>build&lt;span style="color:#98c379">`&lt;/span> failed on line &lt;span style="color:#d19a66">19&lt;/span> with &lt;span style="color:#e5c07b">exit&lt;/span> code &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>PostgreSQL major version upgrade on Alpine Linux</title><link>https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/</link><pubDate>Sat, 24 May 2025 16:00:23 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/postgresql-major-version-upgrade-on-alpine-linux/</guid><description>&lt;h2 id="problem-statement">Problem statement&lt;/h2>
&lt;p>Given Alpine Linux 3.22 running PostgreSQL 16, upgrade to PostgreSQL 17. For
this specific example, consider a &lt;a href="https://miniflux.app/">&lt;code>miniflux&lt;/code>&lt;/a> database.&lt;/p>
&lt;h2 id="procedure">Procedure&lt;/h2>
&lt;p>Install PostgreSQL 17:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk add postgres
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It can coexist with &lt;code>postgres16&lt;/code>.&lt;/p>
&lt;p>Stop the PostgreSQL daemon:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas service postgresql stop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you navigate to the Miniflux server with your browser, it will fail, as
expected:&lt;/p>
&lt;pre tabindex="0">&lt;code>store: unable to create app session: dial tcp [::1]:5432: connect: connection refused
&lt;/code>&lt;/pre>&lt;p>Change the PostgreSQL system version to the desired one:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas pg_versions set-default &lt;span style="color:#d19a66">17&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Change to the root user, for convenience, then change to the existing postgresql
directory:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas su
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> /var/lib/postgresql/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Prepare files and directories for the upgrade:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> 16/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% mv data olddata
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> ../
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% mkdir 17/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> 17/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% mkdir data tmp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% chown postgres:postgres data tmp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Change to the &lt;code>postgres&lt;/code> user:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% su postgres
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">cd&lt;/span> tmp/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Initialize the new cluster:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% initdb -D /var/lib/postgresql/17/data --locale&lt;span style="color:#56b6c2">=&lt;/span>en_US.UTF-8 --encoding&lt;span style="color:#56b6c2">=&lt;/span>UTF8 &lt;span style="color:#56b6c2">[&lt;/span>--data-checksums&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The files belonging to this database system will be owned by user &lt;span style="color:#98c379">&amp;#34;postgres&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>This user must also own the server process.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The database cluster will be initialized with locale &lt;span style="color:#98c379">&amp;#34;en_US.UTF-8&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The default text search configuration will be &lt;span style="color:#e5c07b">set&lt;/span> to &lt;span style="color:#98c379">&amp;#34;english&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Data page checksums are disabled.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fixing permissions on existing directory /var/lib/postgresql/17/data ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>creating subdirectories ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>selecting dynamic shared memory implementation ... posix
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>selecting default &lt;span style="color:#98c379">&amp;#34;max_connections&amp;#34;&lt;/span> ... &lt;span style="color:#d19a66">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>selecting default &lt;span style="color:#98c379">&amp;#34;shared_buffers&amp;#34;&lt;/span> ... 128MB
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>selecting default &lt;span style="color:#e5c07b">time&lt;/span> zone ... America/Toronto
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>creating configuration files ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>running bootstrap script ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>performing post-bootstrap initialization ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>syncing data to disk ... ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>initdb: warning: enabling &lt;span style="color:#98c379">&amp;#34;trust&amp;#34;&lt;/span> authentication &lt;span style="color:#c678dd">for&lt;/span> &lt;span style="color:#e5c07b">local&lt;/span> connections
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next &lt;span style="color:#e5c07b">time&lt;/span> you run initdb.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Success.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In the previous command I chose to omit &lt;code>--data-checksums&lt;/code>, otherwise I get the
following error:&lt;/p>
&lt;pre tabindex="0">&lt;code>old cluster does not use data checksums but the new one does
Failure, exiting
&lt;/code>&lt;/pre>&lt;p>Upgrade the new cluster:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% pg_upgrade -b /usr/libexec/postgresql16/ -B /usr/libexec/postgresql17/ -d /var/lib/postgresql/16/olddata/ -D /var/lib/postgresql/17/data/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Performing Consistency Checks
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-----------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking cluster versions ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking database user is the install user ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking database connection settings ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> prepared transactions ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> contrib/isn with bigint-passing mismatch ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking data &lt;span style="color:#e5c07b">type&lt;/span> usage ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Creating dump of global objects ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Creating dump of database schemas
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> presence of required libraries ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking database user is the install user ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> prepared transactions ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> new cluster tablespace directories ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>If pg_upgrade fails after this point, you must re-initdb the
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>new cluster before continuing.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Performing Upgrade
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting locale and encoding &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Analyzing all rows in the new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Freezing all rows in the new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Deleting files from new pg_xact ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copying old pg_xact to new server ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting oldest XID &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting next transaction ID and epoch &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Deleting files from new pg_multixact/offsets ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copying old pg_multixact/offsets to new server ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Deleting files from new pg_multixact/members ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copying old pg_multixact/members to new server ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting next multixact ID and offset &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Resetting WAL archives ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting frozenxid and minmxid counters in new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Restoring global objects in the new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Restoring database schemas in the new cluster
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Copying user relation files
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Setting next OID &lt;span style="color:#c678dd">for&lt;/span> new cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Sync data directory to disk ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Creating script to delete old cluster ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Checking &lt;span style="color:#c678dd">for&lt;/span> extension updates ok
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Upgrade Complete
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>----------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Optimizer statistics are not transferred by pg_upgrade.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Once you start the new server, consider running:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> /usr/libexec/postgresql17/vacuumdb --all --analyze-in-stages
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Running this script will delete the old cluster&amp;#39;s data files:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ./delete_old_cluster.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now clean up:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ^D &lt;span style="color:#7f848e"># go back to the root user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% /var/lib/postgresql/17/tmp/delete_old_cluster.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% rmdir /var/lib/postgresql/16/ &lt;span style="color:#7f848e"># it should be empty by now&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you&amp;rsquo;re curious about this script, it&amp;rsquo;s a simple one-liner:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rm -rf &lt;span style="color:#98c379">&amp;#39;/var/lib/postgresql/16/olddata&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Finally, let&amp;rsquo;s get the cluster back up and vacuum it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ^D &lt;span style="color:#7f848e"># go back to your main user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas service postgresql start
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas su - postgres -c &lt;span style="color:#98c379">&amp;#39;/usr/libexec/postgresql17/vacuumdb --all --analyze-in-stages&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;miniflux&amp;#34;&lt;/span>: Generating minimal optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">1&lt;/span> target&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;postgres&amp;#34;&lt;/span>: Generating minimal optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">1&lt;/span> target&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;template1&amp;#34;&lt;/span>: Generating minimal optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">1&lt;/span> target&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;miniflux&amp;#34;&lt;/span>: Generating medium optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">10&lt;/span> targets&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;postgres&amp;#34;&lt;/span>: Generating medium optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">10&lt;/span> targets&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;template1&amp;#34;&lt;/span>: Generating medium optimizer statistics &lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#d19a66">10&lt;/span> targets&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;miniflux&amp;#34;&lt;/span>: Generating default &lt;span style="color:#56b6c2">(&lt;/span>full&lt;span style="color:#56b6c2">)&lt;/span> optimizer statistics
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;postgres&amp;#34;&lt;/span>: Generating default &lt;span style="color:#56b6c2">(&lt;/span>full&lt;span style="color:#56b6c2">)&lt;/span> optimizer statistics
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vacuumdb: processing database &lt;span style="color:#98c379">&amp;#34;template1&amp;#34;&lt;/span>: Generating default &lt;span style="color:#56b6c2">(&lt;/span>full&lt;span style="color:#56b6c2">)&lt;/span> optimizer statistics
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>At this point, Miniflux should be working again.
Navigate to &lt;code>/about&lt;/code> and verify its database version: &lt;code>Postgres version: 17.5&lt;/code>.&lt;/p>
&lt;p>Last step, delete the previous package:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk del postgresql16 postgres16-contrib
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Double-check the newer version is still installed:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% apk list -I | grep postgres
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>libpq-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql-common-1.2-r1 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql-common&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>MIT&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql-common-openrc-1.2-r1 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql-common&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>MIT&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql-zsh-completion-5.9-r5 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>zsh&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>MIT-Modern-Variant AND GPL-2.0-only&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql17-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql17-client-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql17-contrib-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>postgresql17-openrc-17.5-r0 x86_64 &lt;span style="color:#56b6c2">{&lt;/span>postgresql17&lt;span style="color:#56b6c2">}&lt;/span> &lt;span style="color:#56b6c2">(&lt;/span>PostgreSQL&lt;span style="color:#56b6c2">)&lt;/span> &lt;span style="color:#56b6c2">[&lt;/span>installed&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And we&amp;rsquo;re done!&lt;/p>
&lt;h2 id="references">References&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wiki.alpinelinux.org/wiki/Postgresql">https://wiki.alpinelinux.org/wiki/Postgresql&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://beune.dev/posts/upgrade-alpine-postgresql/">https://beune.dev/posts/upgrade-alpine-postgresql/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Tailspin</title><link>https://perrotta.dev/2025/05/tailspin/</link><pubDate>Sat, 24 May 2025 15:17:27 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/tailspin/</guid><description>&lt;p>&lt;a href="https://github.com/bensadeh/tailspin">tailspin&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>tailspin&lt;/code> works by reading through a log file line by line, running a series
of regexes against each line. The regexes recognize patterns you expect to
find in a logfile, like dates, numbers, severity keywords and more.&lt;/p>
&lt;p>&lt;code>tailspin&lt;/code> does not make any assumptions on the format or position of the
items it wants to highlight. For this reason, it requires no configuration and
the highlighting will work consistently across different logfiles.&lt;/p>
&lt;/blockquote>
&lt;p>The binary name is &lt;code>tspin(1)&lt;/code>, not &lt;code>tailspin(1)&lt;/code> (confusing!). MacOS has an
existing &lt;code>/usr/bin/tailspin&lt;/code> binary, which appears to be kernel-related.&lt;/p>
&lt;p>It supports &lt;code>-f&lt;/code> (&lt;code>--follow&lt;/code>), just like &lt;code>tail(1)&lt;/code>. In fact, you can think of
&lt;code>tspin -f&lt;/code> as a drop-in replacement for &lt;code>tail -f&lt;/code>.&lt;/p>
&lt;p>It is available in &lt;a href="https://repology.org/project/tailspin/versions">most package
managers&lt;/a>.&lt;/p>
&lt;p>It supports custom highlight rules (groups) via a &lt;code>~/.config/tailspin&lt;/code> file.&lt;/p>
&lt;p>Usage:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># against a log file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% tspin -f /var/log/system.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># against a command&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% kubectl logs mypod -n myns -f | tspin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e"># built-in highlighters showcase&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% &lt;span style="color:#e5c07b">echo&lt;/span> &lt;span style="color:#98c379">&amp;#34;2025-01-01 hello null true false 42 https://example.com?param1=foo&amp;amp;param2=bar ERROR WARNING WARN INFO 127.0.0.1 /etc/passwd foo=&amp;#39;bar&amp;#39;&amp;#34;&lt;/span> | tspin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s possible to add one-off highlighters from the command line (note: case
sensitive).&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% tspin --highlight&lt;span style="color:#56b6c2">=&lt;/span>red:err,error,fail --highlight&lt;span style="color:#56b6c2">=&lt;/span>green:success,ok
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>watch with --color</title><link>https://perrotta.dev/2025/05/watch-with--color/</link><pubDate>Sat, 24 May 2025 14:40:07 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/watch-with--color/</guid><description>&lt;p>When using &lt;code>watch(1)&lt;/code> to monitor program output, colors will not be emitted by
default.&lt;/p>
&lt;p>Thankfully &lt;a href="https://man.archlinux.org/man/watch.1">&lt;code>watch(1)&lt;/code>&lt;/a> has a &lt;code>--color&lt;/code>
(or &lt;code>-c&lt;/code> flag).&lt;/p>
&lt;p>Still, when using it with e.g. &lt;a href="https://nodejs.org/api/test.html">&lt;code>node&lt;/code> tests&lt;/a>,
colors are not emitted:&lt;/p>
&lt;pre tabindex="0">&lt;code>% watch --color -- node mytest.js
Every 2.0s: node ex5.js MacBookAir: 14:43:06
 in 0.107s (0)
✔ toWasm (0.865792ms)
ℹ tests 1
ℹ suites 0
ℹ pass 1
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 3.8805
&lt;/code>&lt;/pre>&lt;p>The command detects that it&amp;rsquo;s not attached to the terminal. :(&lt;/p>
&lt;p>How can we &lt;strong>force color output&lt;/strong> in this case?&lt;/p>
&lt;p>There&amp;rsquo;s no universal answer:&lt;/p>
&lt;ul>
&lt;li>Set &lt;a href="https://bixense.com/clicolors/">&lt;code>CLICOLOR=1&lt;/code>, &lt;code>CLICOLOR_FORCE=1&lt;/code>&lt;/a>&lt;/li>
&lt;li>See whether the program has a &lt;code>--color&lt;/code> flag. For example:
&lt;a href="https://git-scm.com/book/sv/v2/Customizing-Git-Git-Configuration">&lt;code>git&lt;/code>&lt;/a> and
&lt;a href="https://superuser.com/questions/665274/how-to-make-ls-color-its-output-by-default-without-setting-up-an-alias">&lt;code>ls&lt;/code>&lt;/a>
both support &lt;code>--color=always&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>Another possibility, which is program agnostic, is to use an utility such as
&lt;a href="https://man.archlinux.org/man/unbuffer.1">&lt;code>unbuffer(1)&lt;/code>&lt;/a> from the &lt;a href="https://wiki.tcl-lang.org/page/Expect">TCL
Expect&lt;/a> package:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% watch --color -- unbuffer node mytest.js
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The &lt;code>unbuffer&lt;/code> solution is my favorite (&lt;a href="https://perrotta.dev/2024/12/unbuffer/">previously&lt;/a>).&lt;/p>
&lt;p>&lt;strong>Reference&lt;/strong>: &lt;a href="https://stackoverflow.com/questions/3793126/colors-with-unix-command-watch">Stack
Overflow&lt;/a>.&lt;/p></description></item><item><title>npx serve</title><link>https://perrotta.dev/2025/05/npx-serve/</link><pubDate>Sat, 24 May 2025 11:14:22 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/05/npx-serve/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2024/01/start-an-http-server-asap/">Previously&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Start an HTTP server ASAP&lt;/p>
&lt;/blockquote>
&lt;h2 id="option-5-use-node">Option #5: use &lt;code>node&lt;/code>&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% npx serve
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://www.npmjs.com/package/serve">serve&lt;/a> comes from Vercel:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>serve&lt;/code> helps you serve a static site, single page application or just a static
file (no matter if on your device or on the local network). It also provides a
neat interface for listing the directory&amp;rsquo;s contents:&lt;/p>
&lt;p>The quickest way to get started is to just run npx serve in your project&amp;rsquo;s
directory.&lt;/p>
&lt;/blockquote></description></item></channel></rss>