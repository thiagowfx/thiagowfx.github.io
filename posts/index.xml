<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>¬ just serendipity 🍀</title><link>https://perrotta.dev/posts/</link><description>Recent content on ¬ just serendipity 🍀</description><generator>Hugo</generator><language>en-us</language><managingEditor>serendipity@perrotta.dev (Thiago Perrotta)</managingEditor><webMaster>serendipity@perrotta.dev (Thiago Perrotta)</webMaster><copyright>© 2021 - 2025 Thiago Perrotta ·
[some rights reserved](https://creativecommons.org/licenses/by-nc-sa/4.0/) ·
a fork of [hugo ʕ•ᴥ•ʔ bear](https://github.com/janraasch/hugo-bearblog/)</copyright><lastBuildDate>Thu, 14 Aug 2025 17:46:27 +0200</lastBuildDate><atom:link href="https://perrotta.dev/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>GNU sed: follow symlinks</title><link>https://perrotta.dev/2025/08/gnu-sed-follow-symlinks/</link><pubDate>Thu, 14 Aug 2025 17:46:27 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/gnu-sed-follow-symlinks/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2025/08/fd-with-xargs-filenames-with-spaces/">Previously&lt;/a>.&lt;/p>
&lt;p>Today we will upgrade Terraform in the entire codebase:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>fd -e tf | ifne xargs gsed -i -e &lt;span style="color:#98c379">&amp;#39;s/required_version = &amp;#34;~&amp;gt; 1.6.6/required_version = &amp;#34;~&amp;gt; 1.10.0/g&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Easy, right?&lt;/p>
&lt;p>During code review, a teammate has pointed out that I replaced many symlinks.
How?! This was completely unintended!&lt;/p>
&lt;p>Eventually I figured out the reason. From &lt;a href="https://man.archlinux.org/man/sed.1">&lt;code>sed(1)&lt;/code>&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>--follow-symlinks&lt;/code>
follow symlinks when processing in place&lt;/p>
&lt;/blockquote>
&lt;p>It turns out it is necessary to pass &lt;code>--follow-symlinks&lt;/code> to preserve symlinks
when using &lt;code>-i&lt;/code> with GNU &lt;code>sed&lt;/code>.&lt;/p></description></item><item><title>Daily log</title><link>https://perrotta.dev/2025/08/daily-log/</link><pubDate>Wed, 13 Aug 2025 12:02:03 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/daily-log/</guid><description>&lt;p>It&amp;rsquo;s easy to get distracted when using computers connected to the internet.
Like, errhmm, when you are doing your job.&lt;/p>
&lt;p>I tend to minimize some distractions by reducing notifications and by
turning on do not disturb on my phone. Having / using less social media also
helps.&lt;/p>
&lt;p>What about Internet distractions in my work laptop though?&lt;/p>
&lt;p>Lately I&amp;rsquo;ve been trying out a new habit that appears to keep me more focused
throughout the day.&lt;/p>
&lt;p>First, I open my note-taking / second brain app (&lt;a href="https://logseq.com/">LogSeq&lt;/a>).&lt;/p>
&lt;p>Next, create a new journal page for it (&lt;code>Aug 13th, 2025&lt;/code> or &lt;code>2025-08-13&lt;/code>).&lt;/p>
&lt;p>One reason I like LogSeq is that it does it automatically for me, every day.&lt;/p>
&lt;p>Then I create a heading called &amp;ldquo;Daily log&amp;rdquo;&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>I think about what to work on next, typically based on ticket prioritization or
sprint planning or dealing with whatever fire is going on at the moment or a
&amp;ldquo;20%&amp;rdquo; project to improve overall code health.&lt;/p>
&lt;p>Then I type in &lt;code>/time&amp;lt;ENTER&amp;gt;&lt;/code>. LogSeq helpfully inserts the current time e.g.
&lt;code>13:14&lt;/code>. Afterwards, I write a single sentence about what I&amp;rsquo;m going to do. For
example:&lt;/p>
&lt;ul>
&lt;li>14:18 Sync docker images for bitnamilegacy&lt;/li>
&lt;li>14:45 Experiment with pruning in Argo&lt;/li>
&lt;/ul>
&lt;p>This is not intended to be a meticulous report, as it doesn&amp;rsquo;t impact me in any
way (e.g. for performance reviews).&lt;/p>
&lt;p>I merely observed that jotting one slice of idea down makes my intent concrete,
clear(er), and helps me stay focused on it, instead of thinking on the next
procrastination browser tab to open to get distracted with.&lt;/p>
&lt;p>There&amp;rsquo;s also a psychological effect wherein observing my accomplishments at the
end of the day simply feels good.&lt;/p>
&lt;p>And last but not least, it becomes easier for me to remember what I worked on
during the day, making my stand-up meetings more comprehensive.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Or &amp;ldquo;Daily&amp;rdquo;. The name is not important.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>"Fix typo"</title><link>https://perrotta.dev/2025/08/fix-typo/</link><pubDate>Wed, 13 Aug 2025 11:13:35 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/fix-typo/</guid><description>&lt;p>You, too, can make the &lt;del>word&lt;/del> world a better place,
&lt;a href="https://github.com/codespell-project/codespell/pull/3758">one&lt;/a>
&lt;a href="https://github.com/codespell-project/codespell/pull/3759">typo&lt;/a> at a time.&lt;/p>
&lt;p>The &lt;a href="https://github.com/codespell-project/codespell/">codespell&lt;/a> project can be
trivially adopted in a git repository via a &lt;a href="https://pre-commit.com/">pre-commit
hook&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>repos:
 - repo: https://github.com/codespell-project/codespell
 rev: 63c8f8312b7559622c0d82815639671ae42132ac # frozen: v2.4.1
 hooks:
 - id: codespell
&lt;/code>&lt;/pre></description></item><item><title>git ll</title><link>https://perrotta.dev/2025/08/git-ll/</link><pubDate>Tue, 12 Aug 2025 12:50:09 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/git-ll/</guid><description>&lt;p>In my &lt;code>~/.gitconfig&lt;/code> there&amp;rsquo;s an alias for &lt;code>git log&lt;/code>, inspired by &lt;a href="https://registerspill.thorstenball.com/p/how-i-use-git">Thorsten
Ball&lt;/a>&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">[alias]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">ll&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;!f() { git log --graph --pretty=&amp;#39;tformat:%C(always,yellow)%h%C(always,reset) %C(always,green)%ar%C(always,reset){%C(always,bold blue)%an%C(always,reset){%C(always,red)%d%C(always,reset) %s&amp;#39; \&amp;#34;$@\&amp;#34; | column -t -s &amp;#39;{&amp;#39; | less -XS; }; f&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I wish I could get rid of the shell utilities (&lt;code>column&lt;/code> and &lt;code>less&lt;/code>), but they&amp;rsquo;re
necessary to properly align the columns.&lt;/p>
&lt;p>I also tried to get rid of the function wrapper (&lt;code>f()&lt;/code>): it works when you run
&lt;code>git ll&lt;/code>. However when you run &lt;code>git ll .&lt;/code> (=display the commit history from
files underneath the current directory only) it fails:&lt;/p>
&lt;pre tabindex="0">&lt;code>% git ll .
. is a directory
&lt;/code>&lt;/pre>&lt;p>Therefore it&amp;rsquo;s better to keep it around. I am satisfied with the current form.&lt;/p>
&lt;p>The output looks like this (image from upstream):&lt;/p>
&lt;p>&lt;img src="https://substackcdn.com/image/fetch/$s_!1Mdk!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf41b48e-523f-4f82-abc0-db4b1d27c689_2310x1374.png" alt="git ll output">&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>His original configuration is a separate shell function, which is
completely unnecessary. A git alias suffices. Keep it simple!&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>git: --no-pager</title><link>https://perrotta.dev/2025/08/git--no-pager/</link><pubDate>Tue, 12 Aug 2025 12:21:22 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/git--no-pager/</guid><description>&lt;p>Let&amp;rsquo;s say you use color highlighting to visually inspect diffs with &lt;code>git&lt;/code>, such
as &lt;a href="https://github.com/dandavison/delta">&lt;code>delta&lt;/code>&lt;/a> or
&lt;a href="https://github.com/git/git/blob/master/contrib/diff-highlight/README">&lt;code>diff-highlight&lt;/code>&lt;/a>
or &lt;a href="https://github.com/mookid/diffr">&lt;code>diffr&lt;/code>&lt;/a>.&lt;/p>
&lt;p>&lt;strong>Implication&lt;/strong>: whenever you run &lt;code>git diff&lt;/code>, &lt;code>git show&lt;/code>, or any other &lt;code>git&lt;/code>
command that produces a diff, it will emit colors (typically red and green).&lt;/p>
&lt;p>Colors are great for local visual inspection, but they are terrible for sharing.
They won&amp;rsquo;t be carried over with copy-and-paste.&lt;/p>
&lt;p>If you intend to share diff output (e.g. to a Q&amp;amp;A site, with teammates), it&amp;rsquo;s
better to emit &lt;code>-&lt;/code> and &lt;code>+&lt;/code>, as vanilla &lt;code>diff&lt;/code> does.&lt;/p>
&lt;p>The easiest way to do so is to pass &lt;code>--no-pager&lt;/code> to &lt;code>git&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>git --no-pager diff a83bc395
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git --no-pager show HEAD
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For example, a recent commit in my
&lt;a href="https://github.com/thiagowfx/.dotfiles">dotfiles&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% git --no-pager show HEAD~1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>commit 52b1e91b0f1d93176ec768aa6158974fc401f335
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Author: Thiago Perrotta &amp;lt;&lt;span style="color:#56b6c2">{&lt;/span>redacted&lt;span style="color:#56b6c2">}&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Date: Thu Aug &lt;span style="color:#d19a66">7&lt;/span> 12:00:47 &lt;span style="color:#d19a66">2025&lt;/span> +0200
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fix mr
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>diff --git bin/.bin/sd-world bin/.bin/sd-world
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>index c46be0e..44c0b47 &lt;span style="color:#d19a66">100755&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>--- bin/.bin/sd-world
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+++ bin/.bin/sd-world
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>@@ -58,7 +58,7 @@ &lt;span style="color:#c678dd">esac&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> run_if_exists &lt;span style="color:#98c379">&amp;#34;claude&amp;#34;&lt;/span> claude update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># myrepos&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-run_if_exists &lt;span style="color:#98c379">&amp;#34;mr&amp;#34;&lt;/span> mr -d ~ update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+&lt;span style="color:#56b6c2">(&lt;/span>&lt;span style="color:#e5c07b">cd&lt;/span> ~ &lt;span style="color:#56b6c2">&amp;amp;&amp;amp;&lt;/span> run_if_exists &lt;span style="color:#98c379">&amp;#34;mr&amp;#34;&lt;/span> mr update&lt;span style="color:#56b6c2">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#7f848e"># source corp updates if any&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> run_if_exists &lt;span style="color:#98c379">&amp;#34;sd-world-corp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Note that &lt;code>--no-pager&lt;/code> is a &lt;code>git&lt;/code>-level option: it should be specified before
the git subcommand. The following does not work:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% git show HEAD~1 --no-pager
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fatal: unrecognized argument: --no-pager
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ArgoCD: app version notifications</title><link>https://perrotta.dev/2025/08/argocd-app-version-notifications/</link><pubDate>Tue, 12 Aug 2025 12:07:20 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/argocd-app-version-notifications/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: when using &lt;a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/notifications/">ArgoCD
notifications&lt;/a>,
starting off from their
&lt;a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/notifications/catalog/">catalog&lt;/a>,
print the app chart version in addition to existing information.&lt;/p>
&lt;p>More specifically, currently, a Slack notification message from Argo looks like
the following:&lt;/p>
&lt;pre tabindex="0">&lt;code>Cluster 37: Application heart-of-gold is unhealthy.
&lt;/code>&lt;/pre>&lt;p>We want to improve it to:&lt;/p>
&lt;pre tabindex="0">&lt;code>Cluster 37: Application heart-of-gold (~1.18.3) is unhealthy.
&lt;/code>&lt;/pre>&lt;p>The following diff (under a &lt;code>template&lt;/code> block) accomplishes that:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">- {{if eq .serviceType &amp;#34;slack&amp;#34;}}:interrobang:{{end}} Cluster &amp;lt;{{.context.argocdUrl}}|*{{.context.clusterId}}*&amp;gt;: Application &amp;lt;{{.context.argocdUrl}}/applications/{{.app.metadata.name}}|`{{.app.metadata.name}}`&amp;gt; _sync_ by {{.app.status.operationState.operation.initiatedBy.username | default &amp;#34;_automation_&amp;#34; }} is _unknown_.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+ {{if eq .serviceType &amp;#34;slack&amp;#34;}}:interrobang:{{end}} Cluster &amp;lt;{{.context.argocdUrl}}|*{{.context.clusterId}}*&amp;gt;: Application &amp;lt;{{.context.argocdUrl}}/applications/{{.app.metadata.name}}|`{{.app.metadata.name}}`&amp;gt;{{if .app.spec.source.targetRevision}} ({{.app.spec.source.targetRevision}}){{else}}{{range .app.spec.sources}}{{if .targetRevision}} ({{.targetRevision}}){{break}}{{end}}{{end}}{{end}} _sync_ by {{.app.status.operationState.operation.initiatedBy.username | default &amp;#34;_automation_&amp;#34; }} is _unknown_.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Diving into it with pretty-printing&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-gotemplate" data-lang="gotemplate">{{if .app.spec.source.targetRevision}}
 ({{.app.spec.source.targetRevision}})
{{else}}
 {{range .app.spec.sources}}
 {{if .targetRevision}}
 ({{.targetRevision}})
 {{break}}
 {{end}}
 {{end}}
{{end}}
&lt;/code>&lt;/pre>&lt;p>If there&amp;rsquo;s a single source in the helm chart, we extract its &lt;code>targetRevision&lt;/code>.&lt;/p>
&lt;p>Otherwise, when using a &lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/multiple_sources/">multi-source
app&lt;/a>, we
extract the first available &lt;code>targetRevision&lt;/code>.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>These are
&lt;a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/GoTemplate/">golang&lt;/a>
&lt;a href="https://pkg.go.dev/text/template">templates&lt;/a>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>JIRA: create an issue with pre-populated fields</title><link>https://perrotta.dev/2025/08/jira-create-an-issue-with-pre-populated-fields/</link><pubDate>Mon, 11 Aug 2025 14:31:09 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/jira-create-an-issue-with-pre-populated-fields/</guid><description>&lt;p>It is somewhat tedious to create issues&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> in JIRA. It is a bloated and complex web
app, slow to load, with a myriad of fields to fill in.&lt;/p>
&lt;p>Most of these input fields do not significantly change when working within a
single team. The common exceptions are the &lt;strong>Summary&lt;/strong> (Issue title) and
&lt;strong>Description&lt;/strong>. Priority and Assignee can be determined later on, during bug
triage.&lt;/p>
&lt;p>It turns out JIRA supports &lt;a href="https://confluence.atlassian.com/jirakb/how-to-create-issues-using-direct-html-links-in-jira-159474.html">creating issues using direct links&lt;/a>.&lt;/p>
&lt;p>The documentation isn&amp;rsquo;t the most user-friendly&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup> but, upon figuring it out, you
can build a URL such as:&lt;/p>
&lt;pre tabindex="0">&lt;code>https://{company}.atlassian.net/secure/CreateIssueDetails!init.jspa?pid={project-id}&amp;amp;issuetype=10003&amp;amp;summary=Component%3A%20Title&amp;amp;description=&amp;amp;customfield_10249=SRE&amp;amp;labels=quick-win
&lt;/code>&lt;/pre>&lt;p>Notes:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Project ID&lt;/strong>: you can figure out which one to use by following their
&lt;a href="https://support.atlassian.com/jira/kb/how-to-get-the-id-of-a-jira-project-from-a-web-browser/">docs&lt;/a>.
&lt;strong>TL;DR&lt;/strong>: Navigate to &lt;code>&amp;lt;JIRA_BASE_URL&amp;gt;/rest/api/latest/project/{project-key}&lt;/code>, wherein
the project key is something such as &lt;code>INFRA&lt;/code> or &lt;code>POPS&lt;/code>. This returns a JSON
object, look for its top-level &lt;code>id&lt;/code> field.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Issue Type&lt;/strong>: 10003 = Story, 10004 = Task. If you want another type, see
&lt;a href="https://support.atlassian.com/jira/kb/finding-the-id-for-issue-types-in-jira-server-or-data-center/">docs&lt;/a>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Summary&lt;/strong> and &lt;strong>Description&lt;/strong> are self-descriptive. They need to be URL-escaped.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>customfield_12345&lt;/code> is for&amp;hellip;well, custom fields. For example, we have a
custom field to track which team the work item is assigned to.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Bookmark the URL for quick access from your web browser bookmarks bar&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup>, or
perhaps from an app such as &lt;a href="https://www.raycast.com/">RayCast&lt;/a>.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&amp;ldquo;Issues&amp;rdquo; were &lt;a href="https://community.atlassian.com/forums/Jira-articles/It-s-here-Work-is-the-new-collective-term-for-all-items-you/ba-p/2954892">recently
renamed&lt;/a>
to &amp;ldquo;Work items&amp;rdquo;. Do you have an issue with this?&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>Google&amp;rsquo;s &lt;a href="https://developers.google.com/issue-tracker/guides/access-ui">Issue Tracker&lt;/a> (&lt;em>Buganizer&lt;/em>) supports a similar approach. For example, &lt;a href="https://goo.gle/cftbug">https://goo.gle/cftbug&lt;/a> redirects to &lt;a href="https://issues.chromium.org/issues/new?component=1456689&amp;amp;title=Chrome%20for%20Testing:%20&amp;amp;noWizard=true&amp;amp;pli=1&amp;amp;template=0">https://issues.chromium.org/issues/new?component=1456689&amp;amp;title=Chrome%20for%20Testing:%20&amp;amp;noWizard=true&amp;amp;pli=1&amp;amp;template=0&lt;/a> (I created this link back in the &lt;a href="https://goo.gle/chrome-for-testing">CfT&lt;/a> days).&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>I prefer this option. The bookmark label (name) is &lt;code>+&lt;/code>, very mnemonic.&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>docker: dive into images</title><link>https://perrotta.dev/2025/08/docker-dive-into-images/</link><pubDate>Mon, 11 Aug 2025 13:20:08 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/docker-dive-into-images/</guid><description>&lt;p>Recently bitnami has &lt;a href="https://github.com/bitnami/charts/issues/35164">pulled the
plug&lt;/a> off their public docker
images offering&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>We are relying on their
&lt;a href="https://hub.docker.com/r/bitnami/kubectl">&lt;code>bitnami/kubectl&lt;/code>&lt;/a> image. Now what?&lt;/p>
&lt;p>We could build our own, or use another upstream image. Looking at the &lt;a href="https://hub.docker.com/search?q=kubectl">Docker
Hub&lt;/a> catalog, I was pleased to find
&lt;a href="https://hub.docker.com/r/rancher/kubectl">&lt;code>rancher/kubectl&lt;/code>&lt;/a> (backed by SUSE)
there.&lt;/p>
&lt;p>This is enough for our needs.&lt;/p>
&lt;p>It would have been trivial to build our own image otherwise if needed:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">FROM&lt;/span>&lt;span style="color:#98c379"> alpine:3.22&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">RUN&lt;/span> apk add --no-cache kubectl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>How can we ensure these images are equivalent, for practical purposes?&lt;/p>
&lt;p>One way is to use &lt;a href="https://github.com/wagoodman/dive">&lt;code>dive&lt;/code>&lt;/a> to introspect
each of them:&lt;/p>
&lt;blockquote>
&lt;p>A tool for exploring each layer in a docker image&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% dive bitnami/kubectl:latest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% dive rancher/kubectl:v1.30.14
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The rancher image has 50MB in size and contains &lt;em>only&lt;/em> the &lt;code>kubectl&lt;/code> binary.
There&amp;rsquo;s no shell, not even &lt;code>/bin/sh&lt;/code>.&lt;/p>
&lt;p>The bitnami image has 326MB and contains a bunch of other stuff.&lt;/p>
&lt;p>It turns out we will get some (unexpected) efficiency gains out of this
migration!&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Enshittification">&amp;ldquo;&amp;ldquo;&amp;ldquo;Recession&amp;rdquo;&amp;rdquo;&amp;rdquo;&lt;/a>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Silence unknown callers</title><link>https://perrotta.dev/2025/08/silence-unknown-callers/</link><pubDate>Sat, 09 Aug 2025 18:11:39 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/silence-unknown-callers/</guid><description>&lt;p>I absolutely &lt;strong>never&lt;/strong> get any spam calls. This has been true for &lt;em>many and
many&lt;/em> years now.&lt;/p>
&lt;p>What is the formula to do so? Just be an uninteresting, boring person. Be
invisible. !next&lt;/p>
&lt;p>Sure, this is one way, but let&amp;rsquo;s get more practical and realistic. I have &lt;em>only&lt;/em>
three guidelines, assuming you do not want to live as an hermit&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>:&lt;/p>
&lt;h2 id="1-silence-unknown-callers">1) Silence unknown callers&lt;/h2>
&lt;p>Apple, &lt;a href="https://support.apple.com/en-ca/guide/iphone/iphe4b3f7823/ios">Block or avoid unwanted calls on iPhone&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>You can avoid unwanted calls by identifying callers, blocking certain people,
and sending unknown and spam callers directly to voicemail.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>&lt;strong>Turn on Call Identification&lt;/strong>&lt;/p>
&lt;p>iPhone can help identify incoming calls using information from Apple Business
Connect, supported carriers, and supported call identification apps.&lt;/p>
&lt;p>Go to Settings &amp;gt; Apps &amp;gt; Phone, then tap &amp;ldquo;Silence Unknown Callers&amp;rdquo;.&lt;/p>
&lt;/blockquote>
&lt;p>A must-have.
There&amp;rsquo;s absolutely &lt;em>no reason&lt;/em> to let strangers be able to interrupt you on a
whim.&lt;/p>
&lt;p>This can only work effectively if you do not feel
&lt;a href="https://en.wikipedia.org/wiki/Fear_of_missing_out">FOMO&lt;/a>. My philosophy is: if
there is a pressing matter, people or institutions will make an effort to reach
out, whether by multiple attempts or by employing alternate means (e.g. email?
WhatsApp?) to do so.&lt;/p>
&lt;p>&lt;strong>Exception&lt;/strong>: If you are waiting for a phone call but do not know the origin
number (e.g. from a pharmacy, medical doctor, job interview, prospective
landlord). In this case, turn this setting off temporarily.&lt;/p>
&lt;h2 id="2-disable-most-app-notifications">2) Disable most app notifications&lt;/h2>
&lt;p>There&amp;rsquo;s no reason to let your phone disturb you. It &lt;em>should&lt;/em> be a tool that
&lt;em>you&lt;/em> control, not the other way around. Disable notifications for most apps,
especially social media.&lt;/p>
&lt;p>&lt;strong>Alternatively&lt;/strong>: Enable &lt;a href="https://support.apple.com/en-us/105112">&amp;ldquo;Do Not
Disturb&amp;rdquo;&lt;/a> most of the time. These days
most phones can be configured to enable it on a configurable schedule, or based
on location (e.g. when you&amp;rsquo;re home, or at work).&lt;/p>
&lt;p>&lt;strong>Exception&lt;/strong>: Let your loved ones be able to reach you. iOS has settings to
allow certain apps and/or contacts to bypass DNS. Being reachable by loved ones
doesn&amp;rsquo;t need to entail emergencies only. Note that this only works if this is a
small list. If you decide that you love everyone (noble!), then you&amp;rsquo;ll need a
two-tier love system to decide who you love the most.&lt;/p>
&lt;h2 id="3-protect-your-crown-jewels">3) Protect your Crown Jewels!&lt;/h2>
&lt;p>Tate Jarrow, &lt;a href="https://web.archive.org/web/20230204060013/https://onlinesafety.substack.com/p/protect-your-crown-jewels">Protect your Crown
Jewels!&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>[&amp;hellip;] you can reduce the majority of your risk by protecting the handful of
your most important assets – I call these your crown jewels. These are
probably only a fraction of your digital assets, and can be done much more
easily and quickly — so start there.&lt;/p>
&lt;/blockquote>
&lt;p>I rarely hand out my main phone number when signing up for various online
accounts. I don&amp;rsquo;t want to be reachable in the first place (see guideline #1), so
why expose my number to third parties?&lt;/p>
&lt;p>I have a second phone number that I use only for chat apps (WhatsApp, Telegram,
etc), so that there is no need to leak my main phone number to acquaintances.
And I have a third phone number that I use whenever signup forms make it
mandatory to provide a number and when &amp;ldquo;0000000000&amp;rdquo; or &amp;ldquo;+12131234567&amp;rdquo; or similar
do not work.&lt;/p>
&lt;hr>
&lt;p>#3 is the most important. There was a point in my life when I would use my main
phone number for everything. Then I kept getting spam phone calls (and texts). I
would still ignore them anyway (#1) – it feels that I&amp;rsquo;ve been doing so since
forever – but it was annoying to get spammed.&lt;/p>
&lt;p>It&amp;rsquo;s never too late to do #3: you can always get a new phone number and start
over.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;a href="https://pcaro.es/hermit/">Hermit&lt;/a>: One of my favorite monospace fonts,
mind you.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>ArgoCD: recovery when traefik is broken</title><link>https://perrotta.dev/2025/08/argocd-recovery-when-traefik-is-broken/</link><pubDate>Sat, 09 Aug 2025 15:24:53 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/argocd-recovery-when-traefik-is-broken/</guid><description>&lt;p>It&amp;rsquo;s Friday. The best day to push to prod™.
An internal scheduled upgrade for &lt;code>traefik&lt;/code> goes awry.
Internal services are no longer accessible.
HTTP requests won&amp;rsquo;t be properly routed.&lt;/p>
&lt;p>The most sensible SRE / DevOps will simply roll it back. Roll back first,
investigate later: it&amp;rsquo;s crucial to minimize downtime.&lt;/p>
&lt;p>How do we roll back?
We&amp;rsquo;re using GitOps, the most sensible approach is to make a new git commit by
submitting a pull request.
However, this is an emergency situation. Can we roll back faster?&lt;/p>
&lt;p>Sure, let&amp;rsquo;s make temporary changes directly in the cluster.&lt;/p>
&lt;p>The &lt;code>traefik&lt;/code> app is managed with ArgoCD. Let&amp;rsquo;s log in to the ArgoCD web UI and
roll back to the previous version.&lt;/p>
&lt;p>Oh, wait. We can&amp;rsquo;t. The ArgoCD web UI isn&amp;rsquo;t accessible, because traefik is
broken. &lt;em>Sighs&lt;/em>.&lt;/p>
&lt;p>Let&amp;rsquo;s use the ArgoCD CLI then.&lt;/p>
&lt;p>Aaaah, no. The ArgoCD CLI is really a REST client for the ArgoCD API. HTTP(S) is
not accessible, so the CLI won&amp;rsquo;t work either.&lt;/p>
&lt;p>What&amp;rsquo;s next? A plain &lt;code>helm&lt;/code> upgrade should work. But &lt;code>helm&lt;/code> is picky and will
refuse to touch manifests it doesn&amp;rsquo;t own. The manifests are managed by Argo.
&lt;code>helm&lt;/code> won&amp;rsquo;t budge. Oh gosh.&lt;/p>
&lt;p>Last option: the ArgoCD controllers are still running. We don&amp;rsquo;t need the ArgoCD
HTTPS API to communicate with them. Let&amp;rsquo;s simply edit the k8s manifests
directly.&lt;/p>
&lt;p>First we patch the root app (app-of-apps pattern):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl edit app -n argocd root
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We remove the &lt;code>automated&lt;/code> block, to effectively pause auto sync, otherwise our
subsequent changes to traefik would be immediately reverted:&lt;/p>
&lt;pre tabindex="0">&lt;code>spec:
# automated:
# prune: [..]
# selfHeal: [...]
&lt;/code>&lt;/pre>&lt;p>You can comment or delete the &lt;code>automated:&lt;/code> block, either is fine.&lt;/p>
&lt;p>Next, we need to remove traefik from all application project (app project) sync
windows, so that changes to it will be immediately applied:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl edit appproject -n argocd cluster
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The traefik entry got removed from all sync windows.&lt;/p>
&lt;p>Now, finally, let&amp;rsquo;s instruct Argo to roll traefik back.&lt;/p>
&lt;p>The broken version is 2.5.1, the previous working version was 2.4.1.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl edit app -n argocd traefik
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Update &lt;code>targetRevision: 2.4.1&lt;/code> under the &lt;code>helm&lt;/code> block.&lt;/p>
&lt;p>Wait a few seconds. Observe traefik pods as they are rolling restarted:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl get deploy -n kube-system traefik -w
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Finally, all services are once again accessible!&lt;/p>
&lt;p>From this point on, we can go back to &lt;code>git&lt;/code> and do a proper pull request revert
to reconcile the codebase with the live cluster state.&lt;/p>
&lt;p>This was an interesting exercise. I&amp;rsquo;m quite familiar with ArgoCD and GitOps at
this point, and I instinctively knew what to do in this situation, without
needing to consult the official documentation or even an LLM. I wouldn&amp;rsquo;t have
minded doing either of these if needed, but the point is that it feels good to
be well familiar with how a system works and how to apply your knowledge to fix
day-to-day problems.&lt;/p></description></item><item><title>fd with xargs: filenames with spaces</title><link>https://perrotta.dev/2025/08/fd-with-xargs-filenames-with-spaces/</link><pubDate>Fri, 08 Aug 2025 14:33:27 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/fd-with-xargs-filenames-with-spaces/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: find all &lt;code>base/mongo&lt;/code> occurrences in &lt;code>kustomization.yaml&lt;/code>
files in the codebase.&lt;/p>
&lt;p>&lt;a href="https://perrotta.dev/2025/04/the-ack--xargs--sed-pattern/">My favorite approach&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% fd kustomization.yaml | ifne xargs -n &lt;span style="color:#d19a66">1&lt;/span> ack &lt;span style="color:#98c379">&amp;#34;base/mongo&amp;#34;&lt;/span> -l
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ack: scaffolding/cookiecutter/base/&lt;span style="color:#56b6c2">{{&lt;/span>: No such file or directory
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ack: cookiecutter.app_name: No such file or directory
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ack: &lt;span style="color:#56b6c2">}}&lt;/span>/kustomization.yaml: No such file or directory
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>But it looks horrible!&lt;/p>
&lt;p>The problem is that there is a file named as follows:&lt;/p>
&lt;pre tabindex="0">&lt;code>scaffolding/cookiecutter/base/{{ cookiecutter.app_name }}/kustomization.yaml
&lt;/code>&lt;/pre>&lt;p>&amp;hellip;more specifically, the spaces are the problem. It&amp;rsquo;s easy to fix it though:&lt;/p>
&lt;pre tabindex="0">&lt;code>% fd -0 kustomization.yaml | ifne xargs -0 -n 1 ack &amp;#34;base/mongo&amp;#34; -l
&lt;/code>&lt;/pre>&lt;p>&amp;hellip;adding &lt;code>-0&lt;/code> to &lt;code>fd&lt;/code> instructs it to print the results null-separated (&lt;code>\0&lt;/code>)
instead of newline (&lt;code>\n&lt;/code>) separated. And the corresponding switch in &lt;code>xargs&lt;/code>
instructs it to expect null-separated input.&lt;/p>
&lt;p>I especially like this approach because it&amp;rsquo;s easy to memorize.&lt;/p></description></item><item><title>GitHub: set up scheduled reminders on Slack</title><link>https://perrotta.dev/2025/08/github-set-up-scheduled-reminders-on-slack/</link><pubDate>Tue, 05 Aug 2025 12:03:10 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/github-set-up-scheduled-reminders-on-slack/</guid><description>&lt;p>If your organization uses GitHub and Slack, it&amp;rsquo;s neat to have daily
notifications be delivered to you, to remind you of pending pull request
reviews.&lt;/p>
&lt;p>How to configure: start from &lt;a href="https://github.com/settings/reminders">https://github.com/settings/reminders&lt;/a>. There will be
an entry in &amp;ldquo;Available organizations&amp;rdquo;. Click (+) &amp;ldquo;Configure reminder&amp;rdquo;.&lt;/p>
&lt;p>In the next screen (&lt;code>https://github.com/settings/reminders/{organization}&lt;/code>),
you&amp;rsquo;ll need to authorize the slack workspace integration.&lt;/p>
&lt;p>Once that is done, pick your settings. I like:&lt;/p>
&lt;ul>
&lt;li>Weekdays&lt;/li>
&lt;li>Times: 09:00 AM in your local timezone&lt;/li>
&lt;li>Check off &amp;ldquo;Review requests assigned to you&amp;rdquo;&lt;/li>
&lt;li>Optionally check off &amp;ldquo;Review requests assigned to your team&amp;rdquo; (I leave this
disabled as it&amp;rsquo;s too noisy)&lt;/li>
&lt;li>Check off &amp;ldquo;Enable real-time alerts for pull requests&amp;rdquo;
&lt;ul>
&lt;li>Then check off all checkboxes under it except &amp;ldquo;Your team&amp;rsquo;s pull request
review is requested&amp;rdquo; (no team notifications) and Your pull request has
failed checks (CI is too noisy).&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Now, once a weekday, the github app will slack you messages like these:&lt;/p>
&lt;pre tabindex="0">&lt;code>Reviews assigned to you on {org}/gitops
[gitops#13172] Forget the old RabbitMQ instance (jason-bourne)
 2 hours stale · 2 hours old · Waiting on @Thiago Perrotta, SRE

Reviews assigned to you on {org}/secret-project
[secret-project#49852] Deploy Container: Mooney&amp;#39;s proxy (joe-goldberg)
 5 days stale · 6 days old · Waiting on @Love Quinn
&lt;/code>&lt;/pre>&lt;p>Be kind to your teammates. Don&amp;rsquo;t leave them blocked on your reviews for more
than 24 hours!&lt;/p></description></item><item><title>terraform: bypass lock</title><link>https://perrotta.dev/2025/08/terraform-bypass-lock/</link><pubDate>Mon, 04 Aug 2025 11:49:16 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/terraform-bypass-lock/</guid><description>&lt;p>Terraform supports &lt;a href="https://developer.hashicorp.com/terraform/language/state/locking">state
locking&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>If supported by your backend, Terraform will lock your state for all
operations that could write state. This prevents others from acquiring the
lock and potentially corrupting your state.&lt;/p>
&lt;/blockquote>
&lt;p>Neat, right?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% op run --env-file&lt;span style="color:#56b6c2">=&lt;/span>.env -- terraform plan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>╷
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Error: Error acquiring the state lock
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Error message: operation error S3: PutObject, https response error
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ StatusCode: 412, RequestID: &lt;span style="color:#56b6c2">{&lt;/span>redacted&lt;span style="color:#56b6c2">}&lt;/span>, HostID:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ &lt;span style="color:#56b6c2">{&lt;/span>redacted&lt;span style="color:#56b6c2">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ api error PreconditionFailed: At least one of the pre-conditions you
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ specified did not hold
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Lock Info:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ ID: &lt;span style="color:#56b6c2">{&lt;/span>redacted&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Path: &lt;span style="color:#56b6c2">{&lt;/span>redacted&lt;span style="color:#56b6c2">}&lt;/span>/chartmuseum.tfstate
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Operation: OperationTypePlan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Who: &lt;span style="color:#56b6c2">{&lt;/span>redacted&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Version: 1.10.5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Created: 2025-08-04 09:46:55.995791 +0000 UTC
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Info:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Terraform acquires a state lock to protect the state from being written
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ by multiple users at the same time. Please resolve the issue above and try
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ again. For most commands, you can disable locking with the &lt;span style="color:#98c379">&amp;#34;-lock=false&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ flag, but this is not recommended.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It even uses a custom &lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/412">HTTP
Status&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>The HTTP 412 Precondition Failed&lt;/strong> &lt;em>client error response status code&lt;/em>
indicates that access to the target resource was denied. This happens with
conditional requests on methods other than GET or HEAD when the condition
defined by the If-Unmodified-Since or If-Match headers is not fulfilled. In
that case, the request (usually an upload or a modification of a resource)
cannot be made and this error response is sent back.&lt;/p>
&lt;/blockquote>
&lt;p>If you&amp;rsquo;re sure no one else is working on that workspace, you can proceed with
&lt;code>-lock=false&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% op run --env-file&lt;span style="color:#56b6c2">=&lt;/span>.env -- terraform plan -lock&lt;span style="color:#56b6c2">=&lt;/span>&lt;span style="color:#e5c07b">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uptime_check_http.chartmuseum: Refreshing state... &lt;span style="color:#56b6c2">[&lt;/span>&lt;span style="color:#e06c75">name&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>chartmuseum&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data.aws_availability_zones.available: Reading...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data.aws_availability_zones.available: Read &lt;span style="color:#e5c07b">complete&lt;/span> after 1s &lt;span style="color:#56b6c2">[&lt;/span>&lt;span style="color:#e06c75">id&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>us-east-1&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>That&amp;rsquo;s an one-off. A subsequent run without that argument will fail again:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% op run --env-file&lt;span style="color:#56b6c2">=&lt;/span>.env -- terraform plan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>╷
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│ Error: Error acquiring the state lock
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this case it would be better to simply remove the lock with
&lt;a href="https://developer.hashicorp.com/terraform/language/state/locking#force-unlock">&lt;code>force-unlock&lt;/code>&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% op run --env-file&lt;span style="color:#56b6c2">=&lt;/span>.env -- terraform force-unlock &lt;span style="color:#56b6c2">{&lt;/span>lock-id&lt;span style="color:#56b6c2">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Do you really want to force-unlock?
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Terraform will remove the lock on the remote state.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> This will allow &lt;span style="color:#e5c07b">local&lt;/span> Terraform commands to modify this state, even though it
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> may still be in use. Only &lt;span style="color:#98c379">&amp;#39;yes&amp;#39;&lt;/span> will be accepted to confirm.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Enter a value: yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Terraform state has been successfully unlocked!
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The state has been unlocked, and Terraform commands should now be able to
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>obtain a new lock on the remote state.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The &lt;code>lock-id&lt;/code> can be obtained from the &lt;code>plan&lt;/code> output.&lt;/p>
&lt;p>Now we can &lt;code>plan&lt;/code> as usual:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% op run --env-file&lt;span style="color:#56b6c2">=&lt;/span>.env -- terraform plan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uptime_check_http.chartmuseum: Refreshing state... &lt;span style="color:#56b6c2">[&lt;/span>&lt;span style="color:#e06c75">name&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>chartmuseum&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data.aws_availability_zones.available: Reading...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>data.aws_availability_zones.available: Read &lt;span style="color:#e5c07b">complete&lt;/span> after 0s &lt;span style="color:#56b6c2">[&lt;/span>&lt;span style="color:#e06c75">id&lt;/span>&lt;span style="color:#56b6c2">=&lt;/span>us-east-1&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Dune 2000 soundtrack</title><link>https://perrotta.dev/2025/08/dune-2000-soundtrack/</link><pubDate>Mon, 04 Aug 2025 11:32:06 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/dune-2000-soundtrack/</guid><description>&lt;p>In my humble opinion, the original soundtrack (OST) of the
&lt;a href="https://dune2k.com/Duniverse/">dune2k&lt;/a> videogame is one of the best to listen
to while coding.&lt;/p>
&lt;p>&lt;a href="https://music.youtube.com/watch?v=l_yuGtZ9U0Y&amp;amp;list=RDAMVMl_yuGtZ9U0Y">YouTube
Music&lt;/a>.&lt;/p>
&lt;p>&lt;em>Long live the fighters!&lt;/em>&lt;/p></description></item><item><title>Block "Sign in to XXX with google.com"</title><link>https://perrotta.dev/2025/08/block-sign-in-to-xxx-with-google.com/</link><pubDate>Sat, 02 Aug 2025 21:26:25 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/block-sign-in-to-xxx-with-google.com/</guid><description>&lt;p>Jeff Johnson, &lt;a href="https://underpassapp.com/news/2025/7/5.html">Sign in with Google in Chrome&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Many websites such as Yelp show an annoying &amp;ldquo;Sign in with Google&amp;rdquo; banner when
you visit.&lt;/p>
&lt;p>&lt;img src="https://underpassapp.com/news/2025/7/5-images/Safari.png" alt="Sign in with Google
banner">&lt;/p>
&lt;p>This is what Google calls the One Tap user experience. Fortunately, my web
browser extension StopTheMadness Pro hides &amp;ldquo;Sign in with Google&amp;rdquo; banners.&lt;/p>
&lt;/blockquote>
&lt;p>Annoying is an understatement.&lt;/p>
&lt;blockquote>
&lt;p>Although Chrome avoids the &amp;ldquo;Sign in with Google&amp;rdquo; banners, Google&amp;rsquo;s browser
still has its own custom annoyance. If you&amp;rsquo;re already signed in to your Google
account when you visit a participating website such as Yelp, Chrome will
display a One Tap dialog.&lt;/p>
&lt;/blockquote>
&lt;p>Jeff helpfully points out how to block these banners in Google Chrome:&lt;/p>
&lt;ul>
&lt;li>Navigate to &lt;code>chrome://settings/content/federatedIdentityApi&lt;/code>&lt;/li>
&lt;li>Switch the default behavior to &amp;ldquo;Block sign-in prompts from identity services&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>If the courts and antitrust regulators are reading—they probably won&amp;rsquo;t read my
blog, but one can dream—this is yet another example of Google advantaging its
own browser Chrome over other web browsers.&lt;/p>
&lt;/blockquote></description></item><item><title>ArgoCD: all applications stuck on refresh</title><link>https://perrotta.dev/2025/08/argocd-all-applications-stuck-on-refresh/</link><pubDate>Fri, 01 Aug 2025 14:30:58 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/argocd-all-applications-stuck-on-refresh/</guid><description>&lt;p>The problem is very likely the Application Controller.&lt;/p>
&lt;p>You can restart it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl rollout restart sts -n argocd argocd-application-controller
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or inspect its logs:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl logs -n argocd argocd-application-controller-0 --tail&lt;span style="color:#56b6c2">=&lt;/span>&lt;span style="color:#d19a66">100&lt;/span> | less
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>While we&amp;rsquo;re here, make sure there is at least one replica running:&lt;/p>
&lt;pre tabindex="0">&lt;code>% kubectl get sts -n argocd argocd-application-controller
NAME READY AGE
argocd-application-controller 1/1 415d
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://github.com/argoproj/argo-cd/issues/11831">Upstream issue&lt;/a>.&lt;/p></description></item><item><title>PR reviews after vacation</title><link>https://perrotta.dev/2025/08/pr-reviews-after-vacation/</link><pubDate>Fri, 01 Aug 2025 02:15:02 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/08/pr-reviews-after-vacation/</guid><description>&lt;p>You send in a couple of pull requests for your teammates to review.&lt;/p>
&lt;p>Then you go on a break. Vacation. Time-off. Holiday. PTO. Pleasure has many
names.&lt;/p>
&lt;p>They had a lot of time to review your PRs. Surely there will be various comments
by the time you&amp;rsquo;re back, right?&lt;/p>
&lt;p>Several action items to be addressed. You&amp;rsquo;re already excited to &lt;del>move
mountains&lt;/del> move more protos, eh?!&lt;/p>
&lt;p>Certainly you will be 100% (&lt;em>hundred per-cent!&lt;/em>) unblocked the first day you&amp;rsquo;re
back to work, correct!?&lt;/p>
&lt;p>There will be no need to &amp;ldquo;friendly&amp;rdquo; ping anyone. Aaaah, so peaceful. So
productive. Corporate paradise.&lt;/p>
&lt;p>Do we live in the same world?&lt;/p>
&lt;hr>
&lt;h3 id="master-foo-and-the-absent-pull-requests1">Master Foo and the Absent Pull Requests&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>&lt;/h3>
&lt;p>A novice once sent two pull‑requests before departing for a long holiday.&lt;/p>
&lt;p>Upon their return they asked the Master, &amp;ldquo;Have my PRs been reviewed?&amp;rdquo;&lt;/p>
&lt;p>The Master sat quietly. At last he said, &amp;ldquo;I sent no pings.&amp;rdquo;&lt;/p>
&lt;p>The novice frowned and said, &amp;ldquo;But my colleagues had all the time. There must be comments, requests, feedback.&amp;rdquo;&lt;/p>
&lt;p>The Master looked at the floor and replied, &amp;ldquo;What is unreviewed code?&amp;rdquo;&lt;/p>
&lt;p>The novice said nothing.&lt;/p>
&lt;p>Then the Master added: &amp;ldquo;What is urgent code that never landed?&amp;rdquo;&lt;/p>
&lt;p>An instant later, the novice was enlightened.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;em>Prompt&lt;/em>: Write an &amp;ldquo;unix koan&amp;rdquo; out of this.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>direnv: automatically load .env everywhere</title><link>https://perrotta.dev/2025/07/direnv-automatically-load-.env-everywhere/</link><pubDate>Thu, 31 Jul 2025 14:26:37 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/direnv-automatically-load-.env-everywhere/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2024/08/direnv-nested/">Previously&lt;/a>,
&lt;a href="https://perrotta.dev/2025/03/1password-cli--direnv-integration/">previously&lt;/a>.&lt;/p>
&lt;p>&lt;strong>Problem statement&lt;/strong>: Given a monorepo with various scattered &lt;code>.env&lt;/code> files, how
to ensure each one of them is automatically loaded when changing directories?&lt;/p>
&lt;p>We could create sibling &lt;code>.envrc&lt;/code> files in each directory, with the following
content:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7f848e">&lt;/span>dotenv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://direnv.net/man/direnv-stdlib.1.html#codedotenv-ltdotenvpathgtcode">Documentation&lt;/a>.&lt;/p>
&lt;p>But this is cumbersome!&lt;/p>
&lt;p>Also, perhaps your teammates simply do not want to use direnv.&lt;/p>
&lt;p>Here&amp;rsquo;s a more robust approach:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat ~/.config/direnv/direnv.toml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>global&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">load_dotenv&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e5c07b">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This ensures every &lt;code>.env&lt;/code> file is automatically loaded. No need to splatter
&lt;code>dotenv&lt;/code> everywhere!&lt;/p>
&lt;p>I have accidentally discovered this is possible via &lt;a href="https://github.com/direnv/direnv/issues/1478">this
issue&lt;/a>.&lt;/p></description></item><item><title>Writing blog posts on the go</title><link>https://perrotta.dev/2025/07/writing-blog-posts-on-the-go/</link><pubDate>Tue, 29 Jul 2025 13:23:10 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/writing-blog-posts-on-the-go/</guid><description>&lt;p>By design, and to introduce intentional friction, I am only allowed to blog with
a laptop. A new post necessarily involves a git commit of a new markdown file.&lt;/p>
&lt;p>Lately I&amp;rsquo;ve been experimenting with writing blog posts on the go. From my phone,
I simply open the Notes app and start to write.&lt;/p>
&lt;p>Text (and hypertext) is the only medium I need. The occasional markup is also
fine.&lt;/p>
&lt;p>It is harder to write technical posts on the go though. This is not necessarily
a caveat: it means I can focus instead on writing non-technical posts, like this
one. This is akin to how non-fiction books are better suited for audiobooks than
fiction ones. Sometimes form (and medium) shapes content.&lt;/p>
&lt;p>The draft notes are then eventually transcribed to Markdown and published.&lt;/p></description></item><item><title>Okta: enroll into 2FA</title><link>https://perrotta.dev/2025/07/okta-enroll-into-2fa/</link><pubDate>Sun, 27 Jul 2025 18:49:30 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/okta-enroll-into-2fa/</guid><description>&lt;p>More specifically, enroll into 2FA other than
&lt;a href="https://en.wikipedia.org/wiki/One-time_password">OTP&lt;/a>.&lt;/p>
&lt;ul>
&lt;li>Log into https://{company}.okta.com/&lt;/li>
&lt;li>Go to Settings (https://{company}.okta.com/enduser/settings)&lt;/li>
&lt;li>Under &amp;ldquo;Security Key or Biometric Authenticator&amp;rdquo;, click &amp;ldquo;Set up another&amp;rdquo;&lt;/li>
&lt;li>From this point, you could add &lt;em>either&lt;/em>:
&lt;ul>
&lt;li>a hardware security key (e.g. &lt;a href="https://www.yubico.com/">YubiCo&lt;/a>)&lt;/li>
&lt;li>a &lt;a href="http://passkeys.dev/">passkey&lt;/a>, which will be stored in your password
manager, iCloud Keychain (Apple devices) or web browser profile&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>A hardware security key needs to be plugged in during authentication, when it
needs to be gently tapped.&lt;/p>
&lt;p>A passkey does not require external hardware, but it requires you to be logged
into wherever it is stored (e.g. your password manager or your Apple ID).&lt;/p>
&lt;p>What is the motivation to do this?&lt;/p>
&lt;p>Previously, I would need to open up my laptop lid to touch ID, which is quite
inconvenient in clamshell mode (i.e. with the laptop lid closed).&lt;/p>
&lt;p>Now, touching the security key or signing in with the passkey eliminates the
need to do so.&lt;/p></description></item><item><title>Smartwatches</title><link>https://perrotta.dev/2025/07/smartwatches/</link><pubDate>Sat, 26 Jul 2025 12:30:57 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/smartwatches/</guid><description>&lt;p>Kev Quirk, &lt;a href="https://kevquirk.com/blog/i-don-t-see-the-point-of-smartwatches">I Don&amp;rsquo;t See the Point of
Smartwatches&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Whether it&amp;rsquo;s Apple, Samsung, Google, Garmin, or any other &lt;em>smartwatch&lt;/em>
brand—they&amp;rsquo;re all utterly pointless as watches, in my opinion. Let&amp;rsquo;s call them
what they are: not &lt;em>smart watches&lt;/em>, but &lt;em>wrist phones&lt;/em>.&lt;/p>
&lt;p>[&amp;hellip;]&lt;/p>
&lt;p>&lt;strong>What are they good for?&lt;/strong>&lt;/p>
&lt;p>Activity tracking. That&amp;rsquo;s it.&lt;/p>
&lt;/blockquote>
&lt;p>I second this.&lt;/p>
&lt;p>Having used various smartwatches throughout the years&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>, eventually I &amp;ldquo;downgraded&amp;rdquo;
to a &amp;ldquo;dumb&amp;rdquo; / vanilla / plain watch.&lt;/p>
&lt;p>It &lt;a href="https://en.wikipedia.org/wiki/Unix_philosophy">does one thing, and does it
well&lt;/a>: it is a reliable
timekeeper!&lt;/p>
&lt;p>There&amp;rsquo;s no need to charge it. It just works. Technology™.&lt;/p>
&lt;p>Why are smartwatches inconvenient (not so great, if you will)? Because they
create more problems than they solve:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>They need to be &lt;strong>constantly charged&lt;/strong>. The upscale ones (e.g. Apple Watch) need
to be charged &lt;em>every single day&lt;/em>. Fitness tracker models need to be juiced
&lt;em>every week&lt;/em>, but that&amp;rsquo;s still quite frequent. The situation will change if
there&amp;rsquo;s ever a smartwatch that needs charging &lt;em>every month&lt;/em>, comparable to
e-book readers (e.g. the Kindle Paperwhite). It&amp;rsquo;s just much more practical not
to have to worry about charging.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Notifications&lt;/strong>. They are supposedly a feature, but we&amp;rsquo;re already so
bombarded with notifications on our phones and laptops all the time. Do we
really need yet another device to bring hourly anxiety to our lives, which are
already too busy and digital? There&amp;rsquo;s a way to partially address this, other
than simply disabling all notifications on the watch: get a fitness tracker
instead. Our attention span is already not so great nowadays; let&amp;rsquo;s not make
it even worse.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Durability&lt;/strong>. I assure you: regardless of whatever model you get today, in
two or three years from now you&amp;rsquo;ll feel
&lt;a href="https://en.wikipedia.org/wiki/Fear_of_missing_out">FOMO&lt;/a> when a newer version
gets released. Back when I owned them, don&amp;rsquo;t think I&amp;rsquo;ve ever kept a smartwatch
for more than 1-2 years. Sure, you can sell them, instead of simply disposing
of them; nonetheless, they will still lose a lot of their MSRP value, and
their maximum battery capacity will be reduced. They are not meant to
&lt;a href="https://en.wikipedia.org/wiki/Enshittification">last&lt;/a>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Security&lt;/strong>: If you have a dumb watch, you can travel pretty much anywhere
without worrying much about it getting stolen. It will likely not attract a
lot of attention in the first place; but, even if it gets stolen, it could be
easily replaced. Whereas a smartwatch tends to be flashier and more expensive
to replace. I used to intentionally leave my smartwatch at home when
travelling to more dangerous places (relatively speaking) – but then, what&amp;rsquo;s
the point of having one, right?&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Earlier this year I was quite excited about the new
&lt;a href="https://store.repebble.com/">Pebble&lt;/a> watches. They were supposed to address
most of the aforementioned issues:&lt;/p>
&lt;blockquote>
&lt;p>For those unfamiliar with Pebble, it&amp;rsquo;s an e-paper smartwatch with simple
functionality, long battery life and a fun, quirky design. It first launched
on Kickstarter in 2012. The company was sold in 2016 to Fitbit. In January
2025, Google graciously open sourced PebbleOS, enabling anyone to build upon
the amazing Pebble software foundation.&lt;/p>
&lt;/blockquote>
&lt;p>Then, once their feature list got announced, my enthusiasm vanished. It doesn&amp;rsquo;t
feel that special anymore, especially not for the price point they&amp;rsquo;re asking.
Back in 2015-2016 I got a used Pebble Time for about $60. Now they&amp;rsquo;re trying to
sell a new model for $149. It simply doesn&amp;rsquo;t seem worth it.&lt;/p>
&lt;p>In the meantime, I&amp;rsquo;ll keep wearing my good ol&amp;rsquo; plain watch.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Pebble Time, Fitbit Blaze, Fitbit Charge 2 (or 3?), Apple Watch SE, Fitbit
Inspire 2, Garmin.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>vim: add word to spellchecker</title><link>https://perrotta.dev/2025/07/vim-add-word-to-spellchecker/</link><pubDate>Sat, 26 Jul 2025 12:13:42 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/vim-add-word-to-spellchecker/</guid><description>&lt;p>When you have the spellchecker from &lt;code>vim&lt;/code> turned on (&lt;code>:set spell&lt;/code>), it
highlights words that are not in the dictionary.&lt;/p>
&lt;p>False positives will occasionally be flagged.&lt;/p>
&lt;p>To
&lt;a href="https://superuser.com/questions/133208/how-to-make-vim-spellcheck-remember-a-new-word">add&lt;/a>
the current word under the cursor to the dictionary, hit &lt;code>zg&lt;/code>. From the &lt;code>vim&lt;/code>
manual:&lt;/p>
&lt;blockquote>
&lt;p>To add words to your own word list:&lt;/p>
&lt;p>zg Add word under the cursor as a good word to the first
name in &amp;lsquo;spellfile&amp;rsquo;. A count may precede the command
to indicate the entry in &amp;lsquo;spellfile&amp;rsquo; to be used. A
count of two uses the second entry.&lt;/p>
&lt;/blockquote>
&lt;p>Once you do so, you&amp;rsquo;ll see feedback text in the status bar:&lt;/p>
&lt;pre tabindex="0">&lt;code>Word &amp;#39;hacky&amp;#39; added to ~/.vim/spell/en.utf-8.add
&lt;/code>&lt;/pre>&lt;p>This file can be easily tracked in your dotfiles.&lt;/p>
&lt;pre tabindex="0">&lt;code>Word &amp;#39;dotfiles&amp;#39; added to ~/.vim/spell/en.utf-8.add
&lt;/code>&lt;/pre></description></item><item><title>Bicycle: replacing an inner tube</title><link>https://perrotta.dev/2025/07/bicycle-replacing-an-inner-tube/</link><pubDate>Fri, 25 Jul 2025 12:48:43 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/bicycle-replacing-an-inner-tube/</guid><description>&lt;p>Flat tires happen sooner or later&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>; in my case, every few months.&lt;/p>
&lt;p>You can either patch (fix) the existing inner tube, or replace it with a new one
(&amp;lt;5€). In this post, &lt;a href="https://www.youtube.com/watch?v=T0F_hibWHlU">patching&lt;/a> is
out of scope.&lt;/p>
&lt;p>I keep forgetting the right technique to do so, hence here are a few notes.&lt;/p>
&lt;p>Whenever time is pressing or patience is low, just pay someone to do it for you.
In my experience, in Germany, the labor costs ~15-20€. For example, it&amp;rsquo;s
possible to do it at &lt;a href="https://www.decathlon.de/">Decathlon&lt;/a>, though typically
only during weekdays. With that said, it&amp;rsquo;s more economical (and satisfying!) to
do it yourself.&lt;/p>
&lt;p>&lt;strong>Sequence&lt;/strong>: (inner) tube -&amp;gt; wheel (rim) -&amp;gt; tire (or tyre)&lt;/p>
&lt;p>&lt;strong>Tools&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>2 tire levelers. It&amp;rsquo;s possible to do it with a single one, but it&amp;rsquo;s harder.&lt;/li>
&lt;li>A pump. It&amp;rsquo;s possible to postpone filling the tube to the end, but it&amp;rsquo;s
slightly harder.&lt;/li>
&lt;/ul>
&lt;h2 id="remove-the-tube">Remove the tube&lt;/h2>
&lt;p>&lt;a href="https://www.youtube.com/shorts/YpP9qi5fawU">Video&lt;/a>.&lt;/p>
&lt;p>This is the easier step.&lt;/p>
&lt;p>One tire lever is enough.&lt;/p>
&lt;p>Hold the lever facing away from you, insert it in the right orientation, and
then slide it alongside the tire.&lt;/p>
&lt;h2 id="get-the-right-tube">Get the right tube&lt;/h2>
&lt;p>&lt;a href="https://www.insportline.eu/advisor/168-how-to-pick-the-correct-tire-and-tube-size">How To Pick the Correct Tire and Tube Size?&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Tire size&lt;/strong> is mainly given in inches, with the tires being made in diameters of 12, 14, 16, 18, 20, 22, 24, 26, 27.5, &lt;strong>28&lt;/strong> and 29 inches.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>&lt;strong>700&lt;/strong>: This denotes the wheel diameter, specifically 700c, which is a common
size for road, hybrid, and gravel bikes. In the ISO/ETRTO system, this
corresponds to a 622 mm bead seat diameter.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://www.bicycling.com/repair/a20048610/the-difference-between-a-schrader-valve-and-a-presta/">Types of Bike Tire Valves Available&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Bicycles typically come with one of two types of valves. Schrader valves are
the most common; they&amp;rsquo;re the same as those used on cars and are found on many
inexpensive bike models. Most higher-end bicycle tires use Presta, a valve
specifically designed for bikes. Here&amp;rsquo;s how to tell the difference:&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>You can put a Presta-specific tube in a rim drilled for Schrader valves, but
it&amp;rsquo;s not advisable for anything more than an emergency fix. Tubes and tires
tend to move slightly on the rim.&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>&lt;strong>Schrader&lt;/strong>: most common, thicker. Harder to deflate (need a thin, pointy
object to press down its inner pin).&lt;/li>
&lt;li>Presta: thinner, with a nut at its tip, more modern. Easier to deflate (just
press down its tip).&lt;/li>
&lt;/ul>
&lt;p>There&amp;rsquo;s also another type called &amp;ldquo;Dunlop&amp;rdquo;, it has similar thickness to
Schrader.&lt;/p>
&lt;p>My air pump supports both valve types.&lt;/p>
&lt;h2 id="insert-the-tube">Insert the tube&lt;/h2>
&lt;p>&lt;a href="https://www.youtube.com/watch?v=tnP6coXzbLY">Video&lt;/a>.&lt;/p>
&lt;p>First of all: pay attention to the rotation direction of the wheel and the tire:
they
&lt;a href="https://www.reddit.com/r/bikewrench/comments/q61zqa/how_much_does_the_rotation_direction_matter_in/">should&lt;/a>
align. You only commit this mistake once.&lt;/p>
&lt;p>I have more luck by slightly inflating the tube first, and then inserting it in
the wheel (start with the valve). Afterwards, insert the tire in the wheel,
wrapping up the tube.&lt;/p>
&lt;p>Inserting the tire first, before the tube, yields failure and despair more often
than I would like.&lt;/p>
&lt;p>Do not inflate the tube too much, otherwise it becomes quite hard to add the
tire around it.&lt;/p>
&lt;p>Once everything is done, fill in the tube. Pay attention to how much air to pump
in.&lt;/p>
&lt;p>See also: &lt;a href="https://www.youtube.com/watch?v=hKvnaQ_9nG0">How to change an inner
tube&lt;/a> end-to-end
(&lt;a href="https://www.evanscycles.com/buying-guides/inner-tubes">via&lt;/a>).&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>And even sooner than &lt;a href="https://en.wikipedia.org/wiki/Meet_Joe_Black">death and taxes&lt;/a>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>git: developer certificate of origin (DCO) sign-off</title><link>https://perrotta.dev/2025/07/git-developer-certificate-of-origin-dco-sign-off/</link><pubDate>Thu, 24 Jul 2025 12:37:31 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/git-developer-certificate-of-origin-dco-sign-off/</guid><description>&lt;p>The &lt;a href="https://developercertificate.org/">Developer Certificate of Origin&lt;/a> (DCO
for short) is often required when sending out PRs upstream.&lt;/p>
&lt;p>For example, contributions to the Linux kernel
&lt;a href="https://wiki.linuxfoundation.org/dco">mandate&lt;/a> it.
&lt;a href="https://cert-manager.io/docs/contributing/sign-off/">Other&lt;/a>
&lt;a href="https://gcc.gnu.org/dco.html">projects&lt;/a>
&lt;a href="https://docs.pi-hole.net/guides/github/dco/">too&lt;/a>.&lt;/p>
&lt;p>It&amp;rsquo;s even possible to enforce it via &lt;a href="https://github.com/apps/dco">Github
Actions&lt;/a>.&lt;/p>
&lt;p>Suppose that you sent a PR with a single commit but forgot to sign it off. You
can amend it with:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>git rebase HEAD~1 --signoff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git push --force-with-lease origin &lt;span style="color:#56b6c2">[&lt;/span>branch&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or you can do it proactively, at commit time:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>git commit &lt;span style="color:#56b6c2">[&lt;/span>-s | --signoff&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It is
&lt;a href="https://stackoverflow.com/questions/77279077/how-to-sign-off-every-git-commit">often&lt;/a>
&lt;a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-formatsignOff">discouraged&lt;/a>
to have &lt;code>git&lt;/code> automatically do it:&lt;/p>
&lt;blockquote>
&lt;p>Adding the Signed-off-by trailer to a patch should be a conscious act and means
that you certify you have the rights to submit this work under the same open
source license.&lt;/p>
&lt;/blockquote>
&lt;p>In practice, a sign-off is an ordinary &lt;a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/git-footers.html">git
footer&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>Signed-off-by: John Doe &amp;lt;john@example.com&amp;gt;
&lt;/code>&lt;/pre></description></item><item><title>Reader's block</title><link>https://perrotta.dev/2025/07/readers-block/</link><pubDate>Wed, 23 Jul 2025 13:35:47 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/readers-block/</guid><description>&lt;p>You have probably heard of &lt;em>writer&amp;rsquo;s block&lt;/em>:&lt;/p>
&lt;blockquote>
&lt;p>a non-medical condition, primarily associated with writing, in which an author
is either unable to produce new work or experiences a creative slowdown.&lt;/p>
&lt;/blockquote>
&lt;p>But have you heard of &lt;em>reader&amp;rsquo;s block&lt;/em>?&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>&lt;/p>
&lt;p>&lt;strong>Definition&lt;/strong>: a condition wherein a reader is unable to start a new book for a
certain period upon finishing another book.&lt;/p>
&lt;p>Once you reach the end of a good book, there are often two feelings you will
experience:&lt;/p>
&lt;p>One is pure joy, a sense of accomplishment that feels oddly satisfying. It&amp;rsquo;s an
addiction, part of the machinery of your brain rewarding circuitry that makes
you crave for more.&lt;/p>
&lt;p>The other one? You know it already.&lt;/p>
&lt;p>It takes a while to &amp;ldquo;recover&amp;rdquo; from a good book. It&amp;rsquo;s as if the brain didn&amp;rsquo;t want
to forget it too soon, needing some time to process and &amp;ldquo;engrave&amp;rdquo; it in your
mind.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Probably not, because I am making it up.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>vim: join lines without producing a space</title><link>https://perrotta.dev/2025/07/vim-join-lines-without-producing-a-space/</link><pubDate>Tue, 22 Jul 2025 11:50:28 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/vim-join-lines-without-producing-a-space/</guid><description>&lt;p>Here&amp;rsquo;s a common issue I have when blogging, when inserting a markdown link with
&lt;code>vim&lt;/code>. The edit progression is as follows, wherein &lt;code>|&lt;/code> represents the cursor:&lt;/p>
&lt;p>First, blank:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>|
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then, type out the hyperlink label and prepare to insert the link:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">|
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now go to another buffer (window) and copy the link (with &lt;code>y&lt;/code> + motion).&lt;/p>
&lt;p>Go back to the original buffer and paste it with &lt;code>p&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">|https://example.com/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Press &lt;code>kJ&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">| https://example.com/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Press &lt;code>J&lt;/code> again:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">| https://example.com/&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>J&lt;/code> is for &amp;ldquo;join lines&amp;rdquo; (&lt;code>:help J&lt;/code>).&lt;/p>
&lt;p>Do you see the issue above? The first &lt;code>J&lt;/code> inserts a space, the second one does
not. This inconsistency is frustrating.&lt;/p>
&lt;p>This &lt;a href="https://vi.stackexchange.com/questions/439/how-to-join-lines-without-producing-a-space">vi stack
exchange&lt;/a>
question seeks to address it:&lt;/p>
&lt;blockquote>
&lt;p>The standard J command for joining lines replaces the newline character(s)
with a space. It&amp;rsquo;s useful when editing &amp;rsquo;literature&amp;rsquo; but can be troublesome if
I, say, edit a hex dump by hand if I forget to remove the superfluous space.&lt;/p>
&lt;p>Is there a quick &amp;amp; easy method to join two lines without producing a space
between them?&lt;/p>
&lt;/blockquote>
&lt;p>The standard recommendation is to use &lt;code>gJ&lt;/code> to do so. From &lt;code>:help gJ&lt;/code>:&lt;/p>
&lt;blockquote>
&lt;p>Join [count] lines, with a minimum of two lines. Don&amp;rsquo;t insert or remove any
spaces.&lt;/p>
&lt;/blockquote>
&lt;p>But it&amp;rsquo;s harder to memorize than simply &lt;code>J&lt;/code>. Plus, it&amp;rsquo;s an extra keystroke. I&amp;rsquo;d
rather unconditionally use &lt;code>J&lt;/code>.&lt;/p>
&lt;p>It turns out it&amp;rsquo;s possible to do so with a simple config setting, added to
&lt;code>~/.vimrc&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-vim" data-lang="vim">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">nnoremap&lt;/span> &lt;span style="color:#e06c75">J&lt;/span> &lt;span style="color:#e06c75">gJ&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>When repeating the original link insertion sequence, it yields the following
result, as desired (no spaces anywhere!):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e06c75">example&lt;/span>](&lt;span style="color:#e06c75">|https://example.com/&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Ghostty: migrating config to dotfiles</title><link>https://perrotta.dev/2025/07/ghostty-migrating-config-to-dotfiles/</link><pubDate>Mon, 21 Jul 2025 14:56:27 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/ghostty-migrating-config-to-dotfiles/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2024/12/ghostty/">This year&lt;/a> I migrated my terminal
application from &lt;a href="https://iterm2.com/">iTerm2&lt;/a> to
&lt;a href="https://ghostty.org/">Ghostty&lt;/a> on macOS.&lt;/p>
&lt;p>Ghostty has great defaults; I find that there are only a handful of
customizations that I need to make to satisfy my needs.&lt;/p>
&lt;p>One can configure ghostty by opening its config file with &lt;code>Cmd + ,&lt;/code>, the typical
preferences shortcut on macOS.&lt;/p>
&lt;p>In a vanilla system, that config file is initially &lt;code>$HOME/Library/Application\ Support/com.mitchellh.ghostty/config&lt;/code>
(&lt;a href="https://ghostty.org/docs/config#macos-specific-path-(macos-only):">docs&lt;/a>).&lt;/p>
&lt;p>That location is not convenient / accessible though.&lt;/p>
&lt;p>Upon digging the &lt;a href="https://ghostty.org/docs/config">ghostty config docs&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>$XDG_CONFIG_HOME/ghostty/config.
if XDG_CONFIG_HOME is not defined, it defaults to $HOME/.config/ghostty/config.

macOS-specific Path (macOS only):
$HOME/Library/Application\ Support/com.mitchellh.ghostty/config
macOS also supports the XDG configuration path mentioned above.
&lt;/code>&lt;/pre>&lt;p>I prefer the &lt;code>~/.config/ghostty&lt;/code> location: it is cross-platform, compatible with
Linux as well, and I can easily add it to my
&lt;a href="https://github.com/thiagowfx/.dotfiles/blob/master/ghostty/config">dotfiles&lt;/a>.&lt;/p>
&lt;p>Moving the file to that location yields a no-frills migration:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% mv &lt;span style="color:#e06c75">$HOME&lt;/span>/Library/Application&lt;span style="color:#98c379">\ &lt;/span>Support/com.mitchellh.ghostty/config &lt;span style="color:#e06c75">$HOME&lt;/span>/.config/ghostty/config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>As of today, the config looks like this:&lt;/p>
&lt;pre tabindex="0">&lt;code># https://ghostty.org/docs/config
# keep-sorted start
cursor-style-blink = false
keybind = shift+enter=text:\n
macos-icon = chalkboard
shell-integration-features = no-cursor
theme = catppuccin-macchiato
# keep-sorted end
&lt;/code>&lt;/pre>&lt;p>The first line is a handy shortcut to the config documentation.&lt;/p>
&lt;p>The &lt;a href="https://github.com/google/keep-sorted">&lt;code>keep-sorted&lt;/code>&lt;/a> stanzas stem from my
tendency to keep the house tidy. They are not merely comments: the sorting is
actually enforced via a git &lt;a href="https://pre-commit.com/">pre-commit&lt;/a> hook.&lt;/p>
&lt;p>&lt;code>cursor-style-blink = false&lt;/code>: blinking cursor is unnecessarily distracting.&lt;/p>
&lt;p>&lt;code>keybind = shift+enter=text:\n&lt;/code>: &lt;a href="https://www.anthropic.com/claude-code">Claude Code&lt;/a> added this, it&amp;rsquo;s &lt;a href="https://github.com/ghostty-org/ghostty/discussions/7780">surprising&lt;/a> it&amp;rsquo;s not the default:&lt;/p>
&lt;pre tabindex="0">&lt;code>[...]
│ &amp;gt; /termi │
───────────────────────────────────────────────────────────────╯
 /terminal-setup Install Shift+Enter key binding for newlines
&lt;/code>&lt;/pre>&lt;p>&lt;code>macos-icon = chalkboard&lt;/code>: bells and whistles.&lt;/p>
&lt;p>&lt;code>shell-integration-features = no-cursor&lt;/code>: some
&lt;a href="https://github.com/ghostty-org/ghostty/discussions/2812#discussioncomment-11686920">context&lt;/a>.&lt;/p>
&lt;p>&lt;code>theme = catppuccin-macchiato&lt;/code>: more bells and whistles. You may like: &lt;code>ghostty +list-themes&lt;/code>.&lt;/p></description></item><item><title>Steam Deck: 640x480 external monitor resolution</title><link>https://perrotta.dev/2025/07/steam-deck-640x480-external-monitor-resolution/</link><pubDate>Sun, 20 Jul 2025 12:12:05 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/steam-deck-640x480-external-monitor-resolution/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: When connecting the Steam Deck to a TV via a dock + HDMI
cable, the display resolution is stuck at 640x480.&lt;/p>
&lt;p>No other resolutions are available, in both gaming mode and in desktop mode.&lt;/p>
&lt;p>A few
&lt;a href="https://geekygorevan.co.uk/how-to-fix-the-640x480-external-monitor-issue-on-your-steam-deck/">anecdotes&lt;/a>
in the internets™ suggest to&amp;hellip;&lt;/p>
&lt;blockquote>
&lt;p>After thoroughly exploring various troubleshooting options and attempting
different approaches such as disconnecting cables and power cycling the Steam
Deck, I eventually discovered the simplest solution to this problem: &lt;strong>removing
power from the dock.&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;p>It sounds disingenuous, but I verified it works indeed:&lt;/p>
&lt;ol>
&lt;li>TV off, steam deck off.&lt;/li>
&lt;li>Plug in the dock + the HDMI cable. &lt;strong>DO NOT&lt;/strong> connect the power (yet).&lt;/li>
&lt;li>Turn the TV on.&lt;/li>
&lt;li>Turn the steam deck on.&lt;/li>
&lt;li>Verify (hope, pray, wish) the resolution, it should be 1920x1080 (or
similar).&lt;/li>
&lt;li>Plug the power.&lt;/li>
&lt;/ol>
&lt;p>Your Steam Deck is connected to the TV, therefore you will need an external
Bluetooth controller to interact with it and play games. I like the
&lt;a href="https://stadia.google.com/controller/">Stadia&lt;/a> controller. It is still possible
to find a few units in the aftermarket.&lt;/p>
&lt;p>Now go play your game and have fun 🎮.&lt;/p></description></item><item><title>Alpine Linux: remove broken packages</title><link>https://perrotta.dev/2025/07/alpine-linux-remove-broken-packages/</link><pubDate>Sun, 20 Jul 2025 10:52:11 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/alpine-linux-remove-broken-packages/</guid><description>&lt;p>In a sunny Sunday morning:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk upgrade
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARNING: The indexes contain broken packages which might not &lt;span style="color:#c678dd">function&lt;/span> properly.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What?! Out of nowhere?&lt;/p>
&lt;p>I tried a couple of basic troubleshooting commands:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk update --force-refresh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas apk fix
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas apk cache clean
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&amp;hellip;to no avail.&lt;/p>
&lt;p>Next idea: search engines. Virtually no results on &lt;a href="https://kagi.com/">Kagi&lt;/a>. No
relevant results on Google either&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>Next idea: LLMs. Nothing useful either.&lt;/p>
&lt;p>This is novel territory! That&amp;rsquo;s what makes it fun to self-host Alpine Linux&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>My intuition tells me to start by searching their
&lt;a href="https://gitlab.alpinelinux.org/alpine">Gitlab&lt;/a>. Eventually I got linked to
&lt;a href="https://sourcegraph.com/github.com/alpinelinux/apk-tools/-/blob/test/solver/error11.test?L3-5">this&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>test/solver/error11.test:

@ARGS add invalid
@REPO error.repo
@EXPECT
WARNING: The indexes contain broken packages which are not installable.
ERROR: unable to select packages:
 invalid-1:
 error: uninstallable
 satisfies: world[invalid]
&lt;/code>&lt;/pre>&lt;p>From this test file, it seems possible that there&amp;rsquo;s an invalid package in my
&lt;code>/etc/apk/world&lt;/code>. The error message is not quite the same, but it is similar:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% wc -l /etc/apk/world
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d19a66">293&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>There are too many packages there to hunt each of them by hand. And I didn&amp;rsquo;t
install any new packages recently.&lt;/p>
&lt;p>So I looked into &lt;code>apk fix --help&lt;/code> and discovered there is a &lt;code>--verbose&lt;/code> flag. I
did not save its output, but there were five packages there:&lt;/p>
&lt;pre tabindex="0">&lt;code>- busybox-initscripts
- kmod-openrc
- libacl
- py3-pep517
- sensible-utils
&lt;/code>&lt;/pre>&lt;p>I ran &lt;code>doas apk del&lt;/code> to remove all of them. That was a sensible cleanup, but it
still has not resolved the issue.&lt;/p>
&lt;p>If I want to dive deeper into this, I&amp;rsquo;ll have to add some debugging logging to
&lt;a href="https://sourcegraph.com/github.com/alpinelinux/apk-tools@bffc60041447cadee5b69c291df8c90eb3b8fe82/-/blob/src/database.c?L2090">&lt;code>src/database.c&lt;/code>&lt;/a>
in &lt;code>apk-tools&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> (&lt;span style="color:#e06c75">db&lt;/span>&lt;span style="color:#56b6c2">-&amp;gt;&lt;/span>&lt;span style="color:#e06c75">compat_depversions&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#61afef;font-weight:bold">apk_warn&lt;/span>(&lt;span style="color:#e06c75">out&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#34;The indexes contain broken packages which %s.&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">db&lt;/span>&lt;span style="color:#56b6c2">-&amp;gt;&lt;/span>&lt;span style="color:#e06c75">compat_notinstallable&lt;/span> &lt;span style="color:#56b6c2">?&lt;/span> &lt;span style="color:#98c379">&amp;#34;are not installable&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">:&lt;/span> &lt;span style="color:#98c379">&amp;#34;might not function properly&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then one last thought occurred to me:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% apk --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apk-tools 3.0.0_rc5_git20250715-r0, compiled &lt;span style="color:#c678dd">for&lt;/span> x86_64.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aha! I am running a release candidate version of &lt;code>apk&lt;/code>, because I am using
Alpine Linux edge repositories:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat /etc/apk/repositories
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://dl-cdn.alpinelinux.org/alpine/edge/main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://dl-cdn.alpinelinux.org/alpine/edge/community
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://dl-cdn.alpinelinux.org/alpine/edge/testing
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>From the
&lt;a href="https://wiki.alpinelinux.org/wiki/Draft_Release_Notes_for_Alpine_3.23.0">Wiki&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>After 5 years of development in the master branch of apk-tools, apk v3 is now
ready for Alpine v3.23.0. This should be a safe and seamless upgrade from apk
v2, but might has some breaking changes if you use libapk.&lt;/p>
&lt;/blockquote>
&lt;p>No wonder this is bleeding edge territory!&lt;/p>
&lt;p>I would say that there&amp;rsquo;s nothing to do here, other than waiting for the next
release of Alpine Linux (3.23) with apk-tools v3, and ignoring the warning in
the meantime.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Their AI overview insists on spitting out useless information about
Ubuntu, which is completely unrelated in this case.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>It is &lt;em>fun&lt;/em>. Right? Right?!&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>check-json-schema: pre-commit hook</title><link>https://perrotta.dev/2025/07/check-json-schema-pre-commit-hook/</link><pubDate>Fri, 11 Jul 2025 22:05:32 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/check-json-schema-pre-commit-hook/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: given an &lt;code>entry.json&lt;/code> file, validate it against a given
&lt;code>schema.json&lt;/code> file (for example, found via the &lt;a href="https://www.schemastore.org/">schema
store&lt;/a>).&lt;/p>
&lt;p>I like the
&lt;a href="https://github.com/python-jsonschema/check-jsonschema">check-jsonschema&lt;/a> python
package:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>pipx run check-jsonschema --schemafile schema.json entry.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What if we want to do the validation via a
&lt;a href="https://pre-commit.com">pre-commit.com&lt;/a> hook?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">repo&lt;/span>: https://github.com/python-jsonschema/check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">rev&lt;/span>: &lt;span style="color:#d19a66">0.33.2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: ^entry\.json$
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">args&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --schemafile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - schema.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This approach works well, but it requires the upkeep of a mapping from JSON file
to JSON schema.&lt;/p>
&lt;p>If we had various JSON files within a single repository, this would result in a
maintenance burden in the pre-commit config file.&lt;/p>
&lt;p>For example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">repo&lt;/span>: https://github.com/python-jsonschema/check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">rev&lt;/span>: &lt;span style="color:#d19a66">0.33.2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">alias&lt;/span>: check-jsonschema-entry1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: ^entry1\.json$
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">args&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --schemafile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - schema1.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: check-jsonschema
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">alias&lt;/span>: check-jsonschema-entry2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: ^entry2\.json$
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">args&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --schemafile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - schema2.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s somewhat annoying to maintain multiple entries in that fashion. Furthermore
it can easily get outdated: upon the deletion of &lt;code>entry1.json&lt;/code> from the
repository, you&amp;rsquo;d need to remember to manually delete its corresponding entry
from the pre-commit config file.&lt;/p>
&lt;p>Can we do better?&lt;/p>
&lt;p>What if we embedded the schema reference within the JSON file itself?&lt;/p>
&lt;p>For example, with a local schema:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">&amp;#34;$schema&amp;#34;&lt;/span>: &lt;span style="color:#98c379">&amp;#34;schema.json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or with a remote schema URI, via HTTPS:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">&amp;#34;$schema&amp;#34;&lt;/span>: &lt;span style="color:#98c379">&amp;#34;https://example.com/schema.json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now the JSON file is self-contained, and there&amp;rsquo;s no need to define a mapping
from it to its JSON schema elsewhere.&lt;/p>
&lt;p>How can we integrate this approach within pre-commit?&lt;/p>
&lt;p>Initially I thought that
&lt;a href="https://github.com/python-jsonschema/check-jsonschema/blob/8900e07e2002c4b073e1dca7969ce81a19fcb142/.pre-commit-hooks.yaml#L10C7-L10C23">&lt;code>check-metaschema&lt;/code>&lt;/a>
from the &lt;code>check-jsonschema&lt;/code> python package was the answer, but it turns out it
isn&amp;rsquo;t.&lt;/p>
&lt;p>In fact, this isn&amp;rsquo;t currently possible. There&amp;rsquo;s a &lt;a href="https://github.com/python-jsonschema/check-jsonschema/issues/310">feature
request&lt;/a>,
filed ~2 years ago, with no consensus yet on how move forward. Its maintainer
seems helpful and concerned with backwards compatibility.&lt;/p>
&lt;p>For the sake of unblocking myself, I decided to wrap the ability to do so within
my own pre-commit hook definition.&lt;/p>
&lt;p>This gave birth to the following repository:
&lt;a href="https://github.com/thiagowfx/check-json-schema-meta">&lt;code>thiagowfx/check-json-schema-meta&lt;/code>&lt;/a>, which I also &lt;a href="https://github.com/python-jsonschema/check-jsonschema/issues/310#issuecomment-3062174357">announced&lt;/a> in the original feature request thread.&lt;/p>
&lt;p>Usage:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">repo&lt;/span>: https://github.com/thiagowfx/check-json-schema-meta
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">rev&lt;/span>: v0.0.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: check-json-schema-meta
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It goes through each JSON file in the repository, looking for an optional
top-level &lt;code>$schema&lt;/code> key. When found, the file is validated against the defined
schema.&lt;/p>
&lt;p>A &lt;code>--strict&lt;/code> command-line flag enforces the presence of the &lt;code>$schema&lt;/code> key,
otherwise the default behavior is to skip files that do not have it.&lt;/p>
&lt;p>The underlying schema validation defers the work to the same python package
first mentioned in this post. Because it uses
&lt;a href="https://github.com/python-jsonschema/check-jsonschema/blob/8900e07e2002c4b073e1dca7969ce81a19fcb142/src/check_jsonschema/schema_loader/main.py#L74">&lt;code>SchemaLoader&lt;/code>&lt;/a>,
both local and remote (http(s)) file references are supported.&lt;/p>
&lt;p>This is the first original pre-commit hook I have written. By original I mean
that I couldn&amp;rsquo;t find any pre-existing open source hook that accomplishes this
task. The entire repository was developed with AI assistance (&lt;a href="https://www.anthropic.com/claude-code">Claude
Code&lt;/a>), but I wasn&amp;rsquo;t satisfied with
out-of-the-box defaults; I had to heavily modify it to shape it to my taste –
which was achieved with a mix of follow-up prompting and local edits.&lt;/p></description></item><item><title>pq: could not access file "$libdir/dict_snowball": No such file or directory</title><link>https://perrotta.dev/2025/07/pq-could-not-access-file-libdir/dict_snowball-no-such-file-or-directory/</link><pubDate>Thu, 10 Jul 2025 11:14:29 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/pq-could-not-access-file-libdir/dict_snowball-no-such-file-or-directory/</guid><description>&lt;p>My &lt;a href="http://miniflux.app/">miniflux&lt;/a> instance broke yesterday. All feeds had the
following error:&lt;/p>
&lt;pre tabindex="0">&lt;code>3 errors - Database error: store: unable to update entry &amp;#34;{redacted}&amp;#34;: pq: could not access file &amp;#34;$libdir/dict_snowball&amp;#34;: No such file or directory.
&lt;/code>&lt;/pre>&lt;p>The error is from PostgreSQL (&lt;code>pq&lt;/code>).&lt;/p>
&lt;p>I recall I did a full system upgrade yesterday (&lt;code>doas apk upgrade&lt;/code>).&lt;/p>
&lt;p>Upon checking the logs in &lt;code>/var/log/apk.log&lt;/code>&amp;hellip;&lt;/p>
&lt;pre tabindex="0">&lt;code>Running `apk upgrade --no-self-upgrade` at 2025-07-09 13:57:09
apk-tools 3.0.0_rc5_git20250613-r0, compiled for x86_64.
( 1/60) Purging postgresql-zsh-completion (5.9-r5)
( 2/60) Purging postgresql17-contrib (17.5-r2)
( 3/60) Purging postgresql17-openrc (17.5-r2)
( 4/60) Purging postgresql17 (17.5-r2)
postgresql17-17.5-r2.pre-deinstall: Executing script...
postgresql17-17.5-r2.pre-deinstall: *
postgresql17-17.5-r2.pre-deinstall: * You are uninstalling your default PostgreSQL version (17) which seems to be
postgresql17-17.5-r2.pre-deinstall: * in use! If it&amp;#39;s *not* intentional and you want to preserve this version,
postgresql17-17.5-r2.pre-deinstall: * install it explicitly: `apk add postgresql17`.
postgresql17-17.5-r2.pre-deinstall: *
postgresql17-17.5-r2.pre-deinstall: * Please note that to upgrade your cluster to a new major version using
postgresql17-17.5-r2.pre-deinstall: * pg_upgrade(1), you must have both the old and new versions installed.
postgresql17-17.5-r2.pre-deinstall: *
ERROR: postgresql17-17.5-r2.pre-deinstall: exited with error 1
&lt;/code>&lt;/pre>&lt;p>For whatever reason (!?), the &lt;code>postgresql17*&lt;/code> packages were removed.&lt;/p>
&lt;p>The fix is straightforward:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% doas apk add postgresql17
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% doas service miniflux restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Why did it break in the first place?!&lt;/p>
&lt;p>There&amp;rsquo;s nothing suspicious on &lt;code>postgresql17&lt;/code> in the
&lt;a href="https://gitlab.alpinelinux.org/alpine/aports/-/commits/master/main/postgresql17">aports&lt;/a>
repo 🤷&lt;/p>
&lt;p>What is &lt;code>dict_snowball&lt;/code>?&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>dict_snowball&lt;/code> is a PostgreSQL text search dictionary module that uses the
Snowball stemming algorithms for full-text search.&lt;/p>
&lt;/blockquote></description></item><item><title>Markdown headings and git comments</title><link>https://perrotta.dev/2025/07/markdown-headings-and-git-comments/</link><pubDate>Tue, 08 Jul 2025 13:18:09 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/07/markdown-headings-and-git-comments/</guid><description>&lt;p>Our team uses a PR template that resembles the following:&lt;/p>
&lt;pre tabindex="0">&lt;code>% cat .github/pull_request_template.md
## Summary

&amp;lt;!-- Provide a clear and concise description of the changes.
Provide a link to the corresponding PR in other repositories if applicable. --&amp;gt;

## Jira Task

- [ ] No ticket needed

https://acme.atlassian.net/browse/XXX

## Cluster(s) Affected

&amp;lt;!-- List the clusters affected by this change --&amp;gt;

## Impact

&amp;lt;!-- Describe the impact of these changes. Will this require downtime? Are there
any performance considerations? --&amp;gt;

## Testing

&amp;lt;!-- Describe how you&amp;#39;ve tested these changes --&amp;gt;
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://perrotta.dev/2025/05/github-pull-request-template/">Previously&lt;/a> I wrote
about how to automatically incorporate github pull request templates in &lt;code>git commit&lt;/code> (&lt;code>COMMIT_EDITMSG&lt;/code>).&lt;/p>
&lt;p>It turns out there&amp;rsquo;s one caveat with this approach.&lt;/p>
&lt;p>Markdown headings&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> (&lt;code>##&lt;/code> for &lt;code>&amp;lt;h2&amp;gt;&lt;/code>) use the same character as git line comments
(&lt;code>#&lt;/code>) for commit messages.&lt;/p>
&lt;p>As a side effect, when pulling up the template locally with a plain git commit,
the headings do not show up in the final commit message.&lt;/p>
&lt;p>This can be worked around by using &lt;code>gh pr create&lt;/code> instead, but it &lt;a href="https://xkcd.com/1172/">breaks my
setup&lt;/a>.&lt;/p>
&lt;p>Another workaround is to convert the headings to use &lt;code>----&lt;/code> markers, for example:&lt;/p>
&lt;pre tabindex="0">&lt;code>Summary
-------

&amp;lt;!-- Provide a clear and concise description of the changes.
Provide a link to the corresponding PR in other repositories if applicable. --&amp;gt;
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Update&lt;/strong>: A teammate pointed out the following workaround, which is the most
elegant of them:&lt;/p>
&lt;p>&lt;a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-corecommentChar">&lt;code>core.commentChar&lt;/code>&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>Commands such as &lt;code>commit&lt;/code> and &lt;code>tag&lt;/code> that let you edit messages consider a line
that begins with this character commented, and removes them after the editor
returns (default &lt;code>#&lt;/code>).&lt;/p>
&lt;p>If set to &amp;ldquo;auto&amp;rdquo;, git-commit would select a character that is not the
beginning character of any line in existing commit messages.&lt;/p>
&lt;/blockquote>
&lt;p>And that&amp;rsquo;s exactly what I did:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% git config &lt;span style="color:#e5c07b">set&lt;/span> --global core.commentChar &lt;span style="color:#98c379">&amp;#34;auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The effect, it automatically picks &lt;code>;&lt;/code> as the comment character:&lt;/p>
&lt;pre tabindex="0">&lt;code>## Summary

&amp;lt;!-- Provide a clear and concise description of the changes.
Provide a link to the corresponding PR in other repositories if applicable. --&amp;gt;

; Please enter the commit message for your changes. Lines starting
; with &amp;#39;;&amp;#39; will be ignored, and an empty message aborts the commit.
;
; On branch master
; Your branch is up to date with &amp;#39;origin/master&amp;#39;.
;
; ------------------------ &amp;gt;8 ------------------------
; Do not modify or remove the line above.
; Everything below it will be ignored.
&lt;/code>&lt;/pre>&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>I am always forgetting whether to call them &amp;ldquo;headings&amp;rdquo; or &amp;ldquo;headers&amp;rdquo;.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>ArgoCD: deployment spec.selector: field is immutable</title><link>https://perrotta.dev/2025/06/argocd-deployment-spec.selector-field-is-immutable/</link><pubDate>Mon, 30 Jun 2025 13:04:51 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-deployment-spec.selector-field-is-immutable/</guid><description>&lt;p>When using &lt;a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD&lt;/a> to manage an app,
the Deployment manifest needs to undergo significant changes, updating its
selector labels. When trying to sync the argocd app, we get the following error:&lt;/p>
&lt;pre tabindex="0">&lt;code>one or more objects failed to apply, reason: error when patching &amp;#34;/dev/shm/3469418025&amp;#34;: Deployment.apps &amp;#34;myapp&amp;#34; is invalid: spec.selector: Invalid value: v1.LabelSelector{MatchLabels:v1.LabelSelectorRequirement(nil)}: field is immutable. Retrying attempt #2 at 11:02AM.
&lt;/code>&lt;/pre>&lt;p>This error doesn&amp;rsquo;t come directly from Argo, it is from &lt;code>kubectl apply&lt;/code>.&lt;/p>
&lt;p>There are two ways to address it:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Sync the argo app with the
&lt;a href="https://argo-cd.readthedocs.io/en/latest/user-guide/sync-options/#force-sync">&amp;ldquo;force&amp;rdquo;&lt;/a>
option enabled&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Run &lt;code>kubectl apply&lt;/code> with &lt;code>--force&lt;/code> (which is ultimately what the
aforementioned option maps to).&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>In action (&lt;code>-w&lt;/code> is short for &lt;code>--watch&lt;/code>):&lt;/p>
&lt;pre tabindex="0">&lt;code>% kubectl get endpoints -w
NAME ENDPOINTS AGE
myapp &amp;lt;none&amp;gt; 5y44d
myapp 5y44d
myapp 10.1.13.40:8080 5y44d
&lt;/code>&lt;/pre></description></item><item><title>Steam ratings</title><link>https://perrotta.dev/2025/06/steam-ratings/</link><pubDate>Mon, 30 Jun 2025 00:43:40 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/steam-ratings/</guid><description>&lt;p>The &lt;a href="https://store.steampowered.com/">Steam Summer Sale&lt;/a> is going on, as usual.&lt;/p>
&lt;p>I never understood how their rating system works. Until now:&lt;/p>
&lt;pre tabindex="0">&lt;code>95 - 100 | 500+ reviews | positive | overwhelming
85 - 100 | 50+ reviews | positive | very
80 - 100 | 1+ reviews | positive
70 - 79 | 1+ reviews | positive | mostly
40 - 69 | 1+ reviews | mixed
20 - 39 | 1+ reviews | negative | mostly
 0 - 19 | 1+ reviews | negative
 0 - 19 | 50+ reviews | negative | very
 0 - 19 | 500+ reviews | negative | overwhelming
&lt;/code>&lt;/pre>&lt;p>Basically, look for games with &amp;ldquo;overwhelmingly positive&amp;rdquo; or &amp;ldquo;very positive&amp;rdquo;
reviews.&lt;/p>
&lt;h2 id="sources">Sources&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://steamcommunity.com/discussions/forum/0/1744482869761322402/">https://steamcommunity.com/discussions/forum/0/1744482869761322402/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.reddit.com/r/Steam/comments/ivz45n/what_does_the_steam_ratings_like_very_negative_or/">https://www.reddit.com/r/Steam/comments/ivz45n/what_does_the_steam_ratings_like_very_negative_or/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Resize image to make an avatar</title><link>https://perrotta.dev/2025/06/resize-image-to-make-an-avatar/</link><pubDate>Tue, 24 Jun 2025 17:50:31 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/resize-image-to-make-an-avatar/</guid><description>&lt;p>&lt;strong>Problem statement&lt;/strong>: Given a &lt;code>.png&lt;/code> image suitable to be used as a profile
picture (an avatar in a forum, for example), convert it to 80x80, ensure its
file size is under 10KiB and keep its transparency when existing. The extension
should remain &lt;code>.png&lt;/code>.&lt;/p>
&lt;p>This kind of task is perfect for the LLM™. It took me a few round-trip prompts
to achieve the desired outcome:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% magick image.png -resize 80x80 -fuzz 10% -transparent white
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>% pngquant --quality&lt;span style="color:#56b6c2">=&lt;/span>70-85 --force --output image.png
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>magick&lt;/code> comes from &lt;a href="https://imagemagick.org/index.php">ImageMagick&lt;/a>. Most
likely you already have it installed if you&amp;rsquo;re in Linux or macOS.&lt;/p>
&lt;p>&lt;strong>Fun fact&lt;/strong>: the command used to be called &lt;code>convert&lt;/code> (it is still in my muscle
memory!) but not in newer versions of ImageMagick:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% convert
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARNING: The convert &lt;span style="color:#e5c07b">command&lt;/span> is deprecated in IMv7, use &lt;span style="color:#98c379">&amp;#34;magick&amp;#34;&lt;/span> instead of &lt;span style="color:#98c379">&amp;#34;convert&amp;#34;&lt;/span> or &lt;span style="color:#98c379">&amp;#34;magick convert&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">[&lt;/span>...&lt;span style="color:#56b6c2">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://pngquant.org/">&lt;code>pngquant&lt;/code>&lt;/a> is new to me:&lt;/p>
&lt;blockquote>
&lt;p>pngquant is a command-line utility and a library for lossy compression of PNG
images.&lt;/p>
&lt;p>The conversion reduces file sizes significantly (often as much as 70%) and
preserves full alpha transparency. Generated images are compatible with all
web browsers and operating systems.&lt;/p>
&lt;/blockquote>
&lt;p>In my little experiment:&lt;/p>
&lt;ul>
&lt;li>input: 52KB, 256 x 256 pixels&lt;/li>
&lt;li>&lt;a href="https://bbs.archlinux.org/img/avatars/73061.png?m=1750766467">output&lt;/a>: 4.1KB, 80 x 80 pixels, with transparent background&lt;/li>
&lt;/ul></description></item><item><title>M1 Macbook Air keeps disconnecting from Wi-Fi</title><link>https://perrotta.dev/2025/06/m1-macbook-air-keeps-disconnecting-from-wi-fi/</link><pubDate>Tue, 24 Jun 2025 13:34:50 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/m1-macbook-air-keeps-disconnecting-from-wi-fi/</guid><description>&lt;p>&lt;a href="https://www.reddit.com/r/mac/comments/vv5day/m1_macbook_air_keeps_disconnecting_from_wifi/">M1 Macbook air keeps disconnecting from
wifi&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>I&amp;rsquo;ve had this mac for a few months and never had this issue until today. It
will disconnect every 1 minute it&amp;rsquo;s really frustrating.&lt;/p>
&lt;/blockquote>
&lt;p>Lately I&amp;rsquo;ve been having the same issue, more or less. Also in a M1 Macbook Air.&lt;/p>
&lt;p>There&amp;rsquo;s also &lt;a href="https://discussions.apple.com/thread/255556937?sortBy=rank">this
thread&lt;/a> in the Apple
Community forums.&lt;/p>
&lt;blockquote>
&lt;p>I&amp;rsquo;ve tried forgetting the network then adding it again, checking for any
updates but it&amp;rsquo;s all up to date.&lt;/p>
&lt;/blockquote>
&lt;p>Right. Times of desperation call for desperate measures, but those don&amp;rsquo;t really
help.&lt;/p>
&lt;p>In that thread, there is a suggestion to run Wireless diagnostics: &lt;code>Option + Wi-Fi &amp;gt; &amp;quot;Open Wireless Diagnostics...&amp;quot;&lt;/code>. This is a good idea, but it also
appeared not to work in my case.&lt;/p>
&lt;p>I got reminded of a &lt;a href="https://bbs.archlinux.org/viewtopic.php?id=270326">thread&lt;/a>
I posted a few years ago in the Arch Linux forums:&lt;/p>
&lt;blockquote>
&lt;p>Whenever I turn my desktop on and log in with my primary user, internet is
usually available. I can &lt;code>sudo pacman -Syu&lt;/code>, &lt;code>ping google.com&lt;/code>, etc.&lt;/p>
&lt;p>Occasionally though, when I turn my desktop on, internet isn&amp;rsquo;t available. My
go-to &amp;ldquo;fix&amp;rdquo; (it&amp;rsquo;s more like a workaround, really) is to simply do:&lt;/p>
&lt;p>&lt;code>% systemctl restart iwd&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>&amp;hellip;which was quite similar, albeit on Linux.&lt;/p>
&lt;p>It&amp;rsquo;s just so frustrating whenever this happens, and it&amp;rsquo;s hard to even know where
to start troubleshooting. My setup is the same as always, there was no change to
ISPs, hardware, software, or anything else, really.&lt;/p>
&lt;p>There was a light at the end of the tunnel: I found this &lt;a href="https://superuser.com/questions/826338/macbook-air-constantly-drops-wifi-connection">superuser
thread&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>My MacBook Air keeps dropping wifi connection on my home network. When I
connect to my network, it remains connected for a few minutes, then it drops
the connection. I have no idea what&amp;rsquo;s the problem. I found several forums on
the internet discussing this, but none of them really gave a working solution.&lt;/p>
&lt;/blockquote>
&lt;p>Ah yes, buddy. I feel you. We are &lt;a href="https://xkcd.com/979/">soulmates&lt;/a>.&lt;/p>
&lt;p>Someone suggested the following:&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>% ping -i 0.2 192.168.1.1&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>And, to my abysmal surprise, that seems to have worked&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>. Rationale:&lt;/p>
&lt;blockquote>
&lt;p>The problem is that OS X tries to put the WiFi antenna into a power saving
mode if there&amp;rsquo;s no data being sent or received, but with some WiFi APs, this
leads to disconnecting. That ping command will ping your router every 0.2
seconds, preventing OS X from turning off the WiFi.&lt;/p>
&lt;p>This is not a brilliant solution, but it will work until Apple does something
about this.&lt;/p>
&lt;/blockquote>
&lt;p>I need to make a few more experiments before I can conclude it is a reliable
solution, but so far I am sold, as I ran out of ideas. The &lt;code>0.2s&lt;/code> interval is
too frequent though; &lt;code>0.5s&lt;/code> appears to be enough.&lt;/p>
&lt;p>The answer author suggested to wrap the script in an Automator app. This is
quite elegant, should we ever deem it as a long-term &amp;ldquo;solution&amp;rdquo;. I suppose that
a &lt;a href="https://www.hammerspoon.org/">Hammerspoon&lt;/a> spoon would also be elegant in
this context.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>It could simply be placebo, as far as I&amp;rsquo;m concerned&amp;hellip;&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Helm repository with a trailing slash</title><link>https://perrotta.dev/2025/06/helm-repository-with-a-trailing-slash/</link><pubDate>Tue, 24 Jun 2025 11:32:50 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/helm-repository-with-a-trailing-slash/</guid><description>&lt;p>&lt;a href="https://github.com/argoproj/argo-cd/issues/9857">A repository URL with a trailing slash, and the same URL without a trailing
slash, are treated as different
repos&lt;/a>. We found this out the
hard way:&lt;/p>
&lt;pre tabindex="0">&lt;code>Failed to load target state: failed to generate manifest for source 1 of 2: rpc error: code = Unknown desc = error building helm chart dependencies: failed to add helm repository https://chartmuseum.{corp intranet}/orgs/{corp}/: failed to add repository: failed to get command args to log: `helm repo add https:--chartmuseum.{corp intranet}-orgs-{corp}- https://chartmuseum.{corp intranet}/orgs/{corp}/` failed exit status 1: Error: looks like &amp;#34;https://chartmuseum.{corp intranet}/orgs/{corp}/&amp;#34; is not a valid chart repository or cannot be reached: failed to fetch https://chartmuseum.{corp intranet}/orgs/{corp}/index.yaml : 401 Unauthorized
&lt;/code>&lt;/pre>&lt;p>Let&amp;rsquo;s put aside the fact the error message REALLY likes to repeat the repo name.&lt;/p>
&lt;p>This is a repository that we&amp;rsquo;ve already configured, with proper authentication
credentials. Why would it start to fail now, all of a sudden?&lt;/p>
&lt;p>You already got spoiled in the post title. Given &lt;code>Chart.yaml&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">apiVersion&lt;/span>: v2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">name&lt;/span>: corp-postgres-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">description&lt;/span>: Corp Postgres Operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">type&lt;/span>: application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">version&lt;/span>: &lt;span style="color:#d19a66">1.1.13&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">dependencies&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">name&lt;/span>: postgres-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">repository&lt;/span>: https://chartmuseum.{corp intranet}/orgs/archive
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And also:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">apiVersion&lt;/span>: v2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">name&lt;/span>: corp-postgres-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">description&lt;/span>: Corp Postgres Operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">type&lt;/span>: application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">version&lt;/span>: &lt;span style="color:#d19a66">1.1.13&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">dependencies&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">name&lt;/span>: postgres-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">repository&lt;/span>: https://chartmuseum.{corp intranet}/orgs/archive/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>These two dependencies end up being treated differently by Argo, even though
they are effectively the same. It&amp;rsquo;s an upstream bug.&lt;/p>
&lt;p>To work around it, I decided to simply remove all trailing slashes from
helm repository dependencies. Canonicalize everything!&lt;/p>
&lt;p>A git &lt;a href="https://pre-commit.com">pre-commit.com hook&lt;/a> is a good mechanism to do so:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">repos&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">repo&lt;/span>: local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">hooks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">id&lt;/span>: helm-repo-trailing-slash
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">name&lt;/span>: Helm repositories must not contain trailing slashes in Chart.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">files&lt;/span>: Chart.yaml$
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">language&lt;/span>: pygrep
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">entry: &amp;#39;\s*repository&lt;/span>: [\w:/.]+/$&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Run &lt;code>pre-commit run -a helm-repo-trailing-slash&lt;/code>, fix all violations, and then
never think about this again.&lt;/p>
&lt;p>Should the upstream bug ever be fixed, we can remove this workaround.&lt;/p></description></item><item><title>Logseq template for working out</title><link>https://perrotta.dev/2025/06/logseq-template-for-working-out/</link><pubDate>Sun, 22 Jun 2025 02:19:09 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/logseq-template-for-working-out/</guid><description>&lt;p>Lately I&amp;rsquo;ve been tracking my gym sessions in &lt;a href="https://logseq.com/">Logseq&lt;/a>.&lt;/p>
&lt;p>This workflow has been in place for at least three months, therefore it&amp;rsquo;s stable
enough by now. Here&amp;rsquo;s the rough idea.&lt;/p>
&lt;p>First, create a &lt;code>[[Templates]]&lt;/code> page.&lt;/p>
&lt;p>How to remember whether it&amp;rsquo;s &lt;code>Templates&lt;/code> or &lt;code>Template&lt;/code>? Simple: add an
&lt;code>alias::template&lt;/code> attribute to the page. It should be the first bullet point.
Now there&amp;rsquo;s no need to remember: any of them will do.&lt;/p>
&lt;p>Then add a &lt;code>[[Gym 💪]]&lt;/code> bullet point&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> with &lt;code>alias::gym&lt;/code>. In it, add a
&lt;code>template::gym&lt;/code> attribute. Within it, add the template content. This is the part
where you should adapt it to your own desires and goals, but I&amp;rsquo;ll share mine:&lt;/p>
&lt;pre tabindex="0">&lt;code>- Location
	- [[mygym]] (mylocation1 | mylocation2)
- Defaults
	- 3-4x 8-12
- Warm-up
	- XX min what
- Upper
	- Exercise: 25 -&amp;gt; 30
- Lower
	-
- Cooldown
	- XX min what
- Protein recovery
	- XX g (what)
- Body weight
	- XX kg (gym | home)
&lt;/code>&lt;/pre>&lt;p>A brief explanation:&lt;/p>
&lt;ul>
&lt;li>location: links to the page of each gym, where I can add details such as its
Wi-Fi password, how much drinks cost there, etc.&lt;/li>
&lt;li>defaults: the baseline for the session – how many sets, how many repetitions
in each?&lt;/li>
&lt;li>warm-up: what did I do, for how many minutes?&lt;/li>
&lt;li>upper: a bucket to group upper-body exercises: arms, chest, abs, etc.&lt;/li>
&lt;li>lower: a bucket to group lower-body exercises: legs, calves, glutes, etc.&lt;/li>
&lt;li>cooldown: what did I do, for how many minutes?&lt;/li>
&lt;li>protein recovery: in grams, what did I drink or eat?&lt;/li>
&lt;li>body weight: in kilos, and where did I measure it?&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>&lt;/li>
&lt;/ul>
&lt;p>This template has served me well. The most important part is the one that
contains the exercises (upper and lower).&lt;/p>
&lt;p>Now, let&amp;rsquo;s say I am going to the gym today.&lt;/p>
&lt;p>First, I open the journal page (&lt;code>[[2025-06-22]]&lt;/code>).
Then I type in &lt;code>/template gym&lt;/code>. This inserts the template above.&lt;/p>
&lt;p>Now I click &lt;code>[[Gym 💪]]&lt;/code> to open up the gym page.&lt;/p>
&lt;p>The gym page contains a detailed explanation of my current goals and workflows.
In particular, it has an exercises reference section that looks like this (the
numbers are made up):&lt;/p>
&lt;pre tabindex="0">&lt;code>* # Exercises
* Upper
 * Biceps: 10 -&amp;gt; 12
 * Triceps: 18 -&amp;gt; 20
 * Butterfly normal: 20 -&amp;gt; 25
 * Butterfly reverse: 20 -&amp;gt; 25
 [...]
* Lower
 * Hip addiction: 17 -&amp;gt; 20
 * Hip abduction: 15 -&amp;gt; 20
&lt;/code>&lt;/pre>&lt;p>Each entry tracks the latest weight and the one before it, which makes the
progression explicit (and doubles-down as a motivation factor!).&lt;/p>
&lt;p>Now, because this is an advanced PKM, the backlink we inserted earlier with the
template shows up under &amp;ldquo;linked references&amp;rdquo; at the bottom. And this is the magic
that makes Logseq useful for this kind of tracking: all gym entries are
accessible at a glance, connected to the main &lt;code>[[Gym 💪]]&lt;/code> page.&lt;/p>
&lt;p>During the workout, I use the appropriate weight from the gym page as an input
to the corresponding daily note entry, and slowly increase it in-between sets.&lt;/p>
&lt;p>For example, let&amp;rsquo;s say that for biceps the reference entry is &lt;code>Biceps: 10 -&amp;gt; 12&lt;/code>. Then, for today&amp;rsquo;s workout, I will add an entry like &lt;code>Biceps: 12 -&amp;gt; 13 -&amp;gt; 14&lt;/code>, starting with &lt;code>12&lt;/code>, the latest reference value.&lt;/p>
&lt;p>Repeat for each exercise.&lt;/p>
&lt;p>At the end of the workout, I update the reference entries with the progress of
the day. For example, the updated entry for biceps becomes &lt;code>* Biceps: 12 -&amp;gt; 14&lt;/code>.&lt;/p>
&lt;p>I never liked to go to the gym, but now I am starting to enjoy it, because I
feel this approach brings many self-motivating benefits:&lt;/p>
&lt;ul>
&lt;li>there&amp;rsquo;s a detailed record of every single workout that I do, down to the day
and the exercise / weight in each set. These entries are psychologically
powerful, they motivate me more than smartwatches and/or gym / workouts apps&lt;/li>
&lt;li>the progression ensures I am consistent and pick up where I left off in the
previous session. There&amp;rsquo;s no need to guess any longer which weight to use, I
know exactly which one to use, and whether it was difficult or easy last time
(as I also track this information in the reference).&lt;/li>
&lt;li>reduced risk of injury as I am increasing the weights slowly, and being
mindful of the ones that incur a lot of stress and/or strain on my muscles&lt;/li>
&lt;li>ability to track goals and be realistic about them, and even estimate when
I&amp;rsquo;ll be able to reach them, based on historical progression.&lt;/li>
&lt;/ul>
&lt;p>I tried to use gym apps before, but they were never effective. They are often
complicated and bloated. The advantage of keeping the format plain and flexible
in the PKM is that it can suit all my needs. In fact, I could even bring pen and
paper to the gym instead of my smartphone if needed, as there&amp;rsquo;s absolutely no
need for internet access when updating these entries, and no lock-in whatsoever.&lt;/p>
&lt;p>There&amp;rsquo;s nothing revolutionary in my approach. Its core is merely: (i)
(annotated!) consistency and (ii) ability to shape the system to the format that
suits/fits my needs.&lt;/p>
&lt;p>Consistency is very important. Before adopting this system, I would always guess
which weight to use for each exercise. But there are too many of them, and as
such it&amp;rsquo;s quite difficult to keep track of them all in my head.&lt;/p>
&lt;p>The format flexibility is also important. The key is to shape a system to your
needs, not the other way around. With smartphone and smartwatch apps, I always
felt that I had to adapt myself to the input format the app expects, which is
painful from an UX perspective.&lt;/p>
&lt;p>And now it is time to work out again 💪&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Yes, including the emoji. Life is short to skip having fun.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>There are tiny differences, therefore I like to note down whether I used
the scale from the gym or the one at home.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Oh Shit, Git!?!</title><link>https://perrotta.dev/2025/06/oh-shit-git/</link><pubDate>Thu, 19 Jun 2025 13:55:45 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/oh-shit-git/</guid><description>&lt;p>&lt;a href="https://ohshitgit.com/">https://ohshitgit.com/&lt;/a> by Katie Sylor-Miller:&lt;/p>
&lt;blockquote>
&lt;p>Git is hard: screwing up is easy, and figuring out how to fix your mistakes is
fucking impossible. Git documentation has this chicken and egg problem where
you can&amp;rsquo;t search for how to get yourself out of a mess, unless you already
know the name of the thing you need to know about in order to fix your
problem.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>So here are some bad situations I&amp;rsquo;ve gotten myself into, and how I eventually
got myself out of them in plain english.&lt;/p>
&lt;/blockquote>
&lt;p>I love these websites created with the sole purpose of filling in the void of
tool usability.&lt;/p>
&lt;p>Other notable examples from the top of my head:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://git-send-email.io/">https://git-send-email.io/&lt;/a> by &lt;a href="https://drewdevault.com/">Drew DeVault&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://yaml-multiline.info/">https://yaml-multiline.info/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Slack: reacji channeller</title><link>https://perrotta.dev/2025/06/slack-reacji-channeller/</link><pubDate>Tue, 17 Jun 2025 11:32:50 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/slack-reacji-channeller/</guid><description>&lt;p>Consider an organization that uses &lt;a href="https://slack.com/">Slack&lt;/a>.&lt;/p>
&lt;p>There are many channels. There is chatter, everywhere, all the time. There is
noise. It&amp;rsquo;s hard to find a given thread after two or three days, lost in the sea
of scrollback message threads.&lt;/p>
&lt;p>&lt;strong>Problem statement&lt;/strong>: How to cherry-pick certain messages, intended for a
periodic review meeting?&lt;/p>
&lt;p>For example, maybe you want to collect all issues your fellow coworkers
complained about in your support channel, to file bugs/tickets about them.&lt;/p>
&lt;p>Or perhaps you want to collect all on-call and outage issues experienced during
the week.&lt;/p>
&lt;p>Or even gather future product roadmap ideas in a board somewhere.&lt;/p>
&lt;p>It is super tedious to copy and paste messages one by one. Also, to do so incurs
a non-trivial cost in terms of context switching.&lt;/p>
&lt;p>Enter &lt;a href="https://slack.com/intl/en-gb/help/articles/360000482666-Reacji-Channeller-for-Slack">Reacji
Channeler&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>With the Reacji Channeller app, you can instantly copy a message from one
public channel to another using specific reaction emoji, or &amp;lsquo;reacji&amp;rsquo;. This
comes in handy when something posted to a channel could be useful to
conversations happening elsewhere across your workspace.&lt;/p>
&lt;/blockquote>
&lt;p>It is one of these simple-but-effective clever ideas, it almost feels like
cheating.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>The benefits&lt;/strong> 👍&lt;/p>
&lt;ul>
&lt;li>Move a message automatically from one public channel to another.&lt;/li>
&lt;li>Redirect ideas and feedback or organise stray requests into relevant channels.&lt;/li>
&lt;li>Increase a message&amp;rsquo;s visibility by copying it to a channel with more members&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>For example, you can map/assign the ⭐️ (star) emoji to automatically relay
messages to the &lt;code>#idea&lt;/code> channel. Or 🐛 (insect) to &lt;code>#bugs&lt;/code>.&lt;/p>
&lt;p>And then it becomes much easier to process all these messages at once, for
upcoming review meetings. The less context switching, the better!&lt;/p>
&lt;p>✨&lt;/p></description></item><item><title>Speaking to myself</title><link>https://perrotta.dev/2025/06/speaking-to-myself/</link><pubDate>Mon, 16 Jun 2025 16:26:51 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/speaking-to-myself/</guid><description>&lt;p>Lately I&amp;rsquo;ve been stealing &lt;a href="https://simonwillison.net/">Simon Willison&lt;/a>&amp;rsquo;s
playbook of &lt;a href="https://simonwillison.net/2025/May/19/#:~:text=My%20habit%20of%20creating%20long,new%20generation%20of%20coding%20assistants">taking to oneself&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>My habit of &lt;a href="https://simonwillison.net/2022/Nov/26/productivity/#issue-thread">creating long issue
threads&lt;/a>
where I talk to myself about the features I&amp;rsquo;m planning is proving to be a good
fit for outsourcing implementation work to this new generation of coding
assistants.&lt;/p>
&lt;/blockquote>
&lt;p>I am mostly interested in leaving a paper trail of my actions and decisions
whilst debugging and investigating a problem or implementing a feature.&lt;/p>
&lt;p>The paper trail doubles down as:&lt;/p>
&lt;ul>
&lt;li>(i) documentation for my teammates, so that I don&amp;rsquo;t need to repeat myself
during code reviews;&lt;/li>
&lt;li>(ii) context for me and my teammates&amp;rsquo;&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> future selves, so that we can
understand &lt;em>why&lt;/em> I chose to do something in a certain way at the time;&lt;/li>
&lt;li>(iii) as Simon suggests, context for LLM agents so that I don&amp;rsquo;t need to repeat
myself to them.&lt;/li>
&lt;/ul>
&lt;p>I find it useful to do so in chat apps (e.g. Slack threads), in addition to bug
trackers (e.g. GitHub Issues or JIRA tickets). Be verbose! The more context the
better.&lt;/p>
&lt;p>As a side note, blog posts yield the same benefit. The more the merrier!&lt;/p>
&lt;p>&lt;strong>Reference&lt;/strong>: &lt;a href="https://simonwillison.net/2025/May/26/notes/">https://simonwillison.net/2025/May/26/notes/&lt;/a>&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Your periodic reminder that &amp;ldquo;teammates&amp;rdquo; sounds much better than
&amp;ldquo;colleagues&amp;rdquo;. Or you can use &amp;ldquo;coworkers&amp;rdquo; too. Though I tend to use
&amp;ldquo;teammates&amp;rdquo; as &amp;ldquo;coworkers in my immediate team&amp;rdquo;.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Espanso for Github PR templates</title><link>https://perrotta.dev/2025/06/espanso-for-github-pr-templates/</link><pubDate>Mon, 16 Jun 2025 14:04:36 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/espanso-for-github-pr-templates/</guid><description>&lt;p>It is super tedious to fill in &lt;a href="https://perrotta.dev/2025/05/github-pull-request-template/">github PR templates&lt;/a> manually.&lt;/p>
&lt;p>It is more efficient to use a text snippet expander such as &lt;a href="https://perrotta.dev/2025/05/espanso-hello-world/">Espanso&lt;/a>.&lt;/p>
&lt;p>I found the following trigger works well:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% espanso edit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Editing file: /Users/thiago.perrotta/Library/Application Support/espanso/match/base.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">matches&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e06c75">trigger&lt;/span>: &lt;span style="color:#98c379">&amp;#34;:github:repo1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">replace&lt;/span>: |&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Summary
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> $|$
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Jira Task
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [ ] No ticket needed (check only if level of impact is No-op)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> https://corp.atlassian.net/browse/XXX
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Level of Impact
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> Please select exactly one option. To change the level of impact, first
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> unselect the current level of impact and then select the new level of
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> impact.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [ ] 1 - High
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [ ] 2 - Medium
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [ ] 3 - Low
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [x] 4 - No-op
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Impact Analysis
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> N/A
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Test Plan
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> TODO Insert test plan here.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ## Checklist
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> Check each when they are done or confirmed to not apply. If something
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> here isn&amp;#39;t checked, this isn&amp;#39;t ready to be merged. Seriously. You are
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> making your teammates lives a lot easier by doing this consistently.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [x] Test Plan Fully Executed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> - [x] Does not require security review or security review complete&lt;/span> 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Usage:&lt;/p>
&lt;ul>
&lt;li>create a PR via the github UI&lt;/li>
&lt;li>type in &lt;code>:github:repo1&lt;/code> in the PR description text area&lt;/li>
&lt;li>the cursor will automatically move to the Summary section (that&amp;rsquo;s what &lt;code>$|$&lt;/code>
does as per &lt;a href="https://espanso.org/docs/matches/basics/#cursor-hints">docs&lt;/a>).&lt;/li>
&lt;/ul>
&lt;p>It&amp;rsquo;s much quicker to trigger that expansion than to fill in the PR template
manually every single time. Of course, I still need to update the JIRA ticket
and the test plan in each PR.&lt;/p>
&lt;p>Each repository has its own template. I use the repo name as the trigger. For
example: to trigger the template expansion for &lt;code>https://github.com/corp/foo&lt;/code>,
map it to &lt;code>:github:foo&lt;/code>.&lt;/p></description></item><item><title>Diffoscope: exclude directory metadata</title><link>https://perrotta.dev/2025/06/diffoscope-exclude-directory-metadata/</link><pubDate>Mon, 16 Jun 2025 11:58:02 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/diffoscope-exclude-directory-metadata/</guid><description>&lt;p>&lt;a href="https://perrotta.dev/2024/08/diffoscope-recursive-diffs/">Previously&lt;/a>,
&lt;a href="https://perrotta.dev/2024/08/diffoscope-recursive-diffs/">previously&lt;/a>.&lt;/p>
&lt;p>If you simply run &lt;code>diffoscope dir1/ dir2/&lt;/code>, a lot of noise could be added to the
output due to metadata such as timestamps:&lt;/p>
&lt;pre tabindex="0">&lt;code>│ --- dir1/foo.yaml
│ ├── +++ dir2/foo.yaml
│ │ ├── stat {}
│ │ │ @@ -1,8 +1,8 @@
│ │ │
│ │ │ Size: 314 Blocks: 8 IO Block: 4096 regular file
│ │ │ Device: 1,17 Links: 1
│ │ │ Access: (0644/-rw-r--r--) Uid: ( 501/thiago.perrotta) Gid: ( 20/ staff)
│ │ │
│ │ │ +Modify: 2025-06-16 09:53:55.107373563 +0000
│ │ │ -Modify: 2025-04-04 14:37:59.032398559 +0000
│ │ --- dir1/bar.yaml
│ ├── +++ dir2/bar.yaml
│ │ ├── stat {}
│ │ │ @@ -1,8 +1,8 @@
│ │ │
│ │ │ Size: 444 Blocks: 8 IO Block: 4096 regular file
│ │ │ Device: 1,17 Links: 1
│ │ │ Access: (0644/-rw-r--r--) Uid: ( 501/thiago.perrotta) Gid: ( 20/ staff)
│ │ │
│ │ │ +Modify: 2025-06-16 09:53:55.107527976 +0000
│ │ │ -Modify: 2025-03-05 13:37:47.461442994 +0000
&lt;/code>&lt;/pre>&lt;p>These timestamps are relevant in the context of &lt;a href="https://reproducible-builds.org/">reproducible
builds&lt;/a>, however we don&amp;rsquo;t particularly care
about them when we&amp;rsquo;re merely interested in diffing directory and file contents.&lt;/p>
&lt;p>Thankfully, &lt;code>diffoscope&lt;/code> has a flag to ignore these:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>diffoscope dir1/ dir2/ --exclude-directory-metadata&lt;span style="color:#56b6c2">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>SSH: hash known hosts</title><link>https://perrotta.dev/2025/06/ssh-hash-known-hosts/</link><pubDate>Sun, 15 Jun 2025 12:05:11 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/ssh-hash-known-hosts/</guid><description>&lt;p>A security / privacy tip: hash ssh hosts, especially in machines you have
access to that are in the cloud.
&lt;a href="https://github.com/thiagowfx/.dotfiles/blob/6a5bb6a20eeede82dfcbbc56ef4db91ffe2dd65d/ssh/.ssh/config#L40-L42">&lt;code>~/.ssh/config&lt;/code>&lt;/a>:&lt;/p>
&lt;pre tabindex="0">&lt;code>Host *
	# Automatically hash new host keys added to ~/.ssh/known_hosts.
	# Manually for pre-existing hosts: ssh-keygen -H
	HashKnownHosts yes
&lt;/code>&lt;/pre>&lt;p>The default is not to hash.&lt;/p>
&lt;p>As a side effect, &lt;code>~/.ssh/known_hosts&lt;/code> (sample entry):&lt;/p>
&lt;pre tabindex="0">&lt;code>|1|F1E1KeoE/eEWhi10WpGv4OdiO6Y=|3988QV0VE8wmZL7suNrYQLITLCg= sh-ed25519 [...]
&lt;/code>&lt;/pre>&lt;p>Why do this? As per &lt;a href="https://security.stackexchange.com/questions/56268/ssh-benefits-of-using-hashed-known-hosts">Security Stack Exchange&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>The only change is that if a machine is compromised, the idea is to minimize
how much usable information is given to an attacker.&lt;/p>
&lt;/blockquote>
&lt;p>To retroactively hash existing entries, run:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% ssh-keygen -H
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/Users/tperrotta/.ssh/known_hosts updated.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Original contents retained as /Users/tperrotta/.ssh/known_hosts.old
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Kindle Paperwhite: KOReader: calibre sync</title><link>https://perrotta.dev/2025/06/kindle-paperwhite-koreader-calibre-sync/</link><pubDate>Sun, 15 Jun 2025 03:49:24 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/kindle-paperwhite-koreader-calibre-sync/</guid><description>&lt;p>One of the best reasons to &lt;a href="https://perrotta.dev/2025/05/winterbreak-hello-world/">jailbreak&lt;/a> a Kindle is to leverage wireless
&lt;a href="https://calibre-ebook.com/">Calibre&lt;/a> sync via &lt;a href="http://koreader.rocks/">KOReader&lt;/a>.&lt;/p>
&lt;p>Instructions:&lt;/p>
&lt;p>&lt;strong>from Calibre&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>Click Connect/share&lt;/li>
&lt;li>Start wireless device connection&lt;/li>
&lt;li>Set &amp;ldquo;Optional fixed port&amp;rdquo; to 9090 and check off &amp;lsquo;Use a fixed port&amp;rsquo;&lt;/li>
&lt;li>Confirm&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>from KOReader&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>Click Settings &amp;gt; Calibre &amp;gt; Wireless Settings
&lt;ul>
&lt;li>Check off &amp;lsquo;Enable wireless client&amp;rsquo;&lt;/li>
&lt;li>Set inbox folder &amp;gt; &lt;code>/mnt/us/documents&lt;/code>&lt;/li>
&lt;li>Server address &amp;gt; Add the IP address + port&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> of the calibre server (visible in the calibre UI)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Click Settings &amp;gt; Calibre &amp;gt; Connect&lt;/li>
&lt;/ul>
&lt;p>At this point, the Calibre UI should change, recognizing the KOReader client.&lt;/p>
&lt;p>From there, it is trivial to send books from the Calibre library to KOReader.
Select the desired books and then click &amp;lsquo;Send to device&amp;rsquo;.&lt;/p>
&lt;p>Stefan Svartling has a great &lt;a href="https://www.youtube.com/watch?v=AQHbOTEJAak">video
tutorial&lt;/a> about this.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>There&amp;rsquo;s an &amp;ldquo;automatic&amp;rdquo; mode, however it did not work for me.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Kindle Paperwhite: add custom fonts</title><link>https://perrotta.dev/2025/06/kindle-paperwhite-add-custom-fonts/</link><pubDate>Sun, 15 Jun 2025 02:14:41 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/kindle-paperwhite-add-custom-fonts/</guid><description>&lt;p>First step, download the font you&amp;rsquo;re interested in. In this example, I used
&lt;a href="https://fonts.google.com/specimen/Literata">Literata&lt;/a>&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>The download will be a &lt;code>.zip&lt;/code> file. Extract it.&lt;/p>
&lt;p>You&amp;rsquo;re looking for &lt;code>.ttf&lt;/code> or &lt;code>.otf&lt;/code> files. I take note of the following font
files in the archive:&lt;/p>
&lt;pre tabindex="0">&lt;code>Literata-Italic-VariableFont_opsz,wght.ttf
Literata-VariableFont_opsz,wght.ttf
Literata-Black.ttf
Literata-BlackItalic.ttf
Literata-Bold.ttf
Literata-BoldItalic.ttf
Literata-ExtraBold.ttf
Literata-ExtraBoldItalic.ttf
Literata-ExtraLight.ttf
Literata-ExtraLightItalic.ttf
Literata-Italic.ttf
Literata-Light.ttf
Literata-LightItalic.ttf
Literata-Medium.ttf
Literata-MediumItalic.ttf
Literata-Regular.ttf
Literata-SemiBold.ttf
Literata-SemiBoldItalic.ttf
&lt;/code>&lt;/pre>&lt;p>Second, connect the Kindle to your laptop with a USB cable&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>.&lt;/p>
&lt;p>When using a macbook, you&amp;rsquo;ll need a USB &amp;lt;-&amp;gt; USB-C adapter / dongle.&lt;/p>
&lt;p>Open the mounted directory. There should be a top-level &lt;code>fonts/&lt;/code> directory
within it. Dump all the aforementioned font files there.&lt;/p>
&lt;p>Eject the device.&lt;/p>
&lt;p>Open a book. Select the added font. &lt;del>Profit!&lt;/del> Enjoy your pleasant read!&lt;/p>
&lt;p>An interesting note: the added font has properly showed up in
&lt;a href="http://koreader.rocks/">KOReader&lt;/a>, but not in the native Kindle Paperwhite
reader. Another reason &lt;a href="https://perrotta.dev/2025/05/winterbreak-hello-world/">to jailbreak&lt;/a>?&lt;/p>
&lt;h2 id="appendix">Appendix&lt;/h2>
&lt;p>A verbatim&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup> excerpt from the stock &lt;code>Readme.txt&lt;/code> within &lt;code>fonts/&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>You can now install your favorite fonts on your Kindle and choose one of them to read your eBooks.

Any font you install must be either an OpenType (OTF) or a TrueType (TTF) font. All other font formats are unsupported. Also, fonts are usually available as a font family and may consist of several files for different font styles - one each for Regular, Italic, Bold, BoldItalic, etc. For the best reading experience, we recommend you install all the files in the font family. Supported font files will have .ttf, .otf, or .ttc file extensions.

How to install fonts on your Kindle:

1. If the font is packaged into a compressed file (such as a ZIP file), uncompress the files using your favorite file extracting program

2. Copy the font files into the &amp;#34;fonts&amp;#34; folder on your Kindle

3. Disconnect your Kindle from the computer

4. You can now choose a custom font in addition to the Kindle fonts from the Display Settings (Aa) menu

Once you choose a custom font from the Display Settings (Aa) menu, your Kindle will render the book content using that font for most books. If the font is not able to be used for rendering the book&amp;#39;s content, your Kindle will use the default system font instead. This can happen if the font does not support the characters in the book or if the font is damaged.

Amazon respects the intellectual property of others. You are responsible for ensuring you have obtained the necessary rights and permissions to use any fonts you upload to your Kindle. By using the font upload functionality on Kindle, you agree that your use of the fonts you upload will not infringe or violate the rights of any third party, and that you will indemnify Amazon for all claims resulting from your use of the fonts you upload.

For further help, please visit: http://amzn.to/2F2DhMK
&lt;/code>&lt;/pre>&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Got this suggestion via &lt;a href="https://www.reddit.com/r/kobo/comments/1ijpu75/whats_your_favorite_font/">Reddit&lt;/a>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>The first two cables I connected did not work. Only the third one did.
Aren&amp;rsquo;t all USB cables supposed to be fungible and equivalent? Huh.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>Some blank lines were deleted, the rest is exactly as is.&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>ArgoCD: every application in unknown state</title><link>https://perrotta.dev/2025/06/argocd-every-application-in-unknown-state/</link><pubDate>Fri, 13 Jun 2025 22:34:33 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-every-application-in-unknown-state/</guid><description>&lt;p>&lt;strong>Symptom&lt;/strong>: Every single application in the Kubernetes cluster that is managed
by Argo is in &lt;code>Unknown&lt;/code> sync status. A disaster! 😱&lt;/p>
&lt;p>This has only happened in one of our clusters. More specifically, in an
&lt;a href="https://learn.microsoft.com/en-us/azure/aks/core-aks-concepts">AKS&lt;/a> cluster
(from Microsoft Azure).&lt;/p>
&lt;p>An observed effect:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% kubectl get --raw&lt;span style="color:#56b6c2">=&lt;/span>&lt;span style="color:#98c379">&amp;#39;/openapi/v2&amp;#39;&lt;/span> | head -c &lt;span style="color:#d19a66">200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Error from server &lt;span style="color:#56b6c2">(&lt;/span>ServiceUnavailable&lt;span style="color:#56b6c2">)&lt;/span>: the server is currently unable to handle the request
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aha! The Kubernetes OpenAPI server is not responding properly.
That explains why Argo is having so much trouble to figure out the state of affairs in
the cluster.&lt;/p>
&lt;p>It was quite difficult to troubleshoot this issue. There are barely any
resources about it in the open web. We filed an Azure Support ticket, but it was
completely useless. They offered to restart&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> the OpenAPI server, but that
didn&amp;rsquo;t help (of course it wouldn&amp;rsquo;t!).&lt;/p>
&lt;p>Because this is a managed Kubernetes cluster, we have limited access to it,
which includes lack of access to raw logs. The Azure portal doesn&amp;rsquo;t make it easy
but, after digging quite deep into it, eventually we found this error message in
the logs:&lt;/p>
&lt;pre tabindex="0">&lt;code> {&amp;#34;pod&amp;#34;:&amp;#34;kube-apiserver-7785d59f4f-scqmp&amp;#34;,&amp;#34;stream&amp;#34;:&amp;#34;stderr&amp;#34;,&amp;#34;containerID&amp;#34;:&amp;#34;925345f6501626aa6cd40dd187d5cf57837389eec9cb39b2292fb9ae3f66242f&amp;#34;,&amp;#34;log&amp;#34;:&amp;#34;E0512 12:01:36.876768 1 handler.go:160] Error in OpenAPI handler: failed to build merge specs: unable to merge: duplicated path \/apis\/reports.kyverno.io\/v1\/clusterephemeralreports\n&amp;#34;}
&lt;/code>&lt;/pre>&lt;p>That was the first clue! Now we know it&amp;rsquo;s related to
&lt;a href="https://kyverno.io/">Kyverno&lt;/a>.&lt;/p>
&lt;p>That error eventually led us to
&lt;a href="https://github.com/kubernetes/kubernetes/issues/122668#issuecomment-2531243040">this&lt;/a>
issue in Kubernetes:&lt;/p>
&lt;blockquote>
&lt;p>We have the same issue here, actually also triggered by installing the kyverno
reports-server with both apiservices (different groups served by the same
api-server).&lt;/p>
&lt;/blockquote>
&lt;p>Aha!&lt;/p>
&lt;p>Deleting the duplicate CRDs installed by &lt;a href="https://github.com/kyverno/reports-server">kyverno reports
server&lt;/a> has immediately resolved the
OpenAPI server unresponsiveness. It wasn&amp;rsquo;t even necessary to restart it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% kubectl delete crd ephemeralreports.reports.kyverno.io clusterephemeralreports.reports.kyverno.io clusterpolicyreports.wgpolicyk8s.io policyreports.wgpolicyk8s.io
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>customresourcedefinition.apiextensions.k8s.io &lt;span style="color:#98c379">&amp;#34;ephemeralreports.reports.kyverno.io&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>customresourcedefinition.apiextensions.k8s.io &lt;span style="color:#98c379">&amp;#34;clusterephemeralreports.reports.kyverno.io&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>customresourcedefinition.apiextensions.k8s.io &lt;span style="color:#98c379">&amp;#34;clusterpolicyreports.wgpolicyk8s.io&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>customresourcedefinition.apiextensions.k8s.io &lt;span style="color:#98c379">&amp;#34;policyreports.wgpolicyk8s.io&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And now:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ kubectl get --raw&lt;span style="color:#56b6c2">=&lt;/span>&lt;span style="color:#98c379">&amp;#39;/openapi/v2&amp;#39;&lt;/span> | head -c &lt;span style="color:#d19a66">200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;swagger&amp;#34;&lt;/span>:&lt;span style="color:#98c379">&amp;#34;2.0&amp;#34;&lt;/span>,&lt;span style="color:#98c379">&amp;#34;info&amp;#34;&lt;/span>:&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;title&amp;#34;&lt;/span>:&lt;span style="color:#98c379">&amp;#34;Kubernetes&amp;#34;&lt;/span>,&lt;span style="color:#98c379">&amp;#34;version&amp;#34;&lt;/span>:&lt;span style="color:#98c379">&amp;#34;v1.30.11&amp;#34;&lt;/span>&lt;span style="color:#56b6c2">}&lt;/span>,&lt;span style="color:#98c379">&amp;#34;paths&amp;#34;&lt;/span>:&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;/.well-known/openid-configuration/&amp;#34;&lt;/span>:&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;get&amp;#34;&lt;/span>:&lt;span style="color:#56b6c2">{&lt;/span>&lt;span style="color:#98c379">&amp;#34;description&amp;#34;&lt;/span>:&lt;span style="color:#98c379">&amp;#34;get service account issuer OpenID configuration, also known as
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>That was a tricky one! Interestingly: it has only occurred in AKS.
&lt;a href="https://aws.amazon.com/eks/">EKS&lt;/a> was fine.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;a href="https://en.wikiquote.org/wiki/The_IT_Crowd">Hello, IT. Have you tried turning it off and on
again?&lt;/a>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>ArgoCD: custom health check for StatefulSet (OnDelete)</title><link>https://perrotta.dev/2025/06/argocd-custom-health-check-for-statefulset-ondelete/</link><pubDate>Fri, 13 Jun 2025 21:40:01 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/argocd-custom-health-check-for-statefulset-ondelete/</guid><description>&lt;p>It turns out the
&lt;a href="https://github.com/argoproj/gitops-engine/blob/master/pkg/health/health_statefulset.go">built-in&lt;/a>
health check for
&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSets&lt;/a>
in ArgoCD is not comprehensive enough.&lt;/p>
&lt;p>It covers
&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#update-strategies">&lt;code>RollingUpdate&lt;/code>&lt;/a>
well enough, but &lt;code>OnDelete&lt;/code> is incomplete.&lt;/p>
&lt;p>More specifically:&lt;/p>
&lt;p>&lt;strong>Observed&lt;/strong>: whenever you push an update to an STS whose &lt;code>.spec.updateStrategy&lt;/code>
is &lt;code>OnDelete&lt;/code>, its health status stays as &lt;code>Healthy&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Expected&lt;/strong>: there should be an indication that the STS pods are not
up-to-date, and hence need to be restarted to incorporate the latest changes.&lt;/p>
&lt;p>There is &lt;a href="https://github.com/argoproj/argo-cd/issues/6527">an open bug&lt;/a>:
&lt;code>Statefulset healthcheck does not work #6527&lt;/code> for it.&lt;/p>
&lt;p>I managed to work around it by defining my own health check. This is an use case
where Gen AI is helpful, though it does not shine. I could not have Gen AI
produce a fully working health check for this scenario. Instead, I used it to
bootstrap a basic example, then had to tweak it until it worked. This has been
tested multiple times, I am reasonably confident it works well (some edge cases
could be missing though).&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-lua" data-lang="lua">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">health_status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e5c07b">nil&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Waiting for status to be reported&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">return&lt;/span> &lt;span style="color:#e06c75">health_status&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">strategy&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.spec&lt;/span>.&lt;span style="color:#e06c75">updateStrategy&lt;/span> &lt;span style="color:#56b6c2">and&lt;/span> &lt;span style="color:#e06c75">obj.spec&lt;/span>.&lt;span style="color:#e06c75">updateStrategy.type&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#98c379">&amp;#34;RollingUpdate&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.spec&lt;/span>.&lt;span style="color:#e06c75">replicas&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">readyReplicas&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">updatedReplicas&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">replicas&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#d19a66">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">current_revision&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">currentRevision&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#98c379">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">local&lt;/span> &lt;span style="color:#e06c75">update_revision&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#e06c75">obj.status&lt;/span>.&lt;span style="color:#e06c75">updateRevision&lt;/span> &lt;span style="color:#56b6c2">or&lt;/span> &lt;span style="color:#98c379">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">strategy&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#98c379">&amp;#34;OnDelete&amp;#34;&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">and&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Healthy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;All replicas are ready and updated (OnDelete strategy)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">elseif&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#d19a66">0&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Degraded&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;No replicas have been updated (OnDelete strategy): 0/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; updated. Still running an old revision!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing (OnDelete): &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; ready, &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; updated&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">and&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">==&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#e06c75">current_revision&lt;/span> &lt;span style="color:#56b6c2">~=&lt;/span> &lt;span style="color:#e06c75">update_revision&lt;/span> &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Waiting for rollout to complete: revision mismatch (&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">current_revision&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; ≠ &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">update_revision&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Healthy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;All replicas updated, ready, and revisions match&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.status&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;Progressing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">health_status.message&lt;/span> &lt;span style="color:#56b6c2">=&lt;/span> &lt;span style="color:#98c379">&amp;#34;RollingUpdate progressing: &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">ready_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">status_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; ready, &amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">updated_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#e06c75">spec_replicas&lt;/span> &lt;span style="color:#56b6c2">..&lt;/span> &lt;span style="color:#98c379">&amp;#34; updated&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">return&lt;/span> &lt;span style="color:#e06c75">health_status&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It is necessary to distinguish between &lt;code>OnDelete&lt;/code> and &lt;code>RollingUpdate&lt;/code>.&lt;/p>
&lt;p>&lt;code>OnDelete&lt;/code> should not use &lt;code>currentRevision&lt;/code> / &lt;code>update_revision&lt;/code>, as these values
don&amp;rsquo;t mean anything for that update strategy. This can be observed
&lt;a href="https://github.com/argoproj/gitops-engine/blob/f8f1b61ba3fd5fcb647563db3106977e1364de31/pkg/health/health_statefulset.go#L63">upstream&lt;/a>
as well.&lt;/p>
&lt;p>It is easy to write / tweak the health check when you look at the live STS
resource / manifest in the cluster. &lt;code>obj&lt;/code> refers to the STS manifest (&lt;code>kubectl get sts -o yaml&lt;/code>). The most relevant field is &lt;code>status:&lt;/code>.&lt;/p>
&lt;p>If you deploy ArgoCD via its helm chart, add that check for &lt;code>argocd-cm&lt;/code>. The
&lt;code>values.yaml&lt;/code> file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">argo-cd&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">cm&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e06c75">resource.customizations.health.apps_StatefulSet&lt;/span>: |&lt;span style="color:#98c379">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> health_status = {}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> [...]&lt;/span> 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This custom health check was partly inspired by a Prometheus alert we have:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">alert&lt;/span>: StatefulSetUpdateNotRolledOut
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">expr&lt;/span>: max without (revision) (kube_statefulset_status_current_revision unless kube_statefulset_status_update_revision) * (kube_statefulset_replicas != kube_statefulset_status_replicas_updated)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>How long will it take until LLMs &lt;del>steal&lt;/del> adopt this novel solution from me?&lt;/p></description></item><item><title>Slack: public chats first</title><link>https://perrotta.dev/2025/06/slack-public-chats-first/</link><pubDate>Fri, 13 Jun 2025 20:01:10 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/slack-public-chats-first/</guid><description>&lt;p>&lt;a href="https://www.mooreds.com/wordpress/archives/3706">Why Public Slack Chats are Better than Direct Messages&lt;/a> by Dan Moore:&lt;/p>
&lt;p>&lt;strong>Bad&lt;/strong>™:&lt;/p>
&lt;blockquote>
&lt;p>I&amp;rsquo;ve noticed that I sometimes use direct messages when I should be asking a
question in a public channel. Upon examination, direct messages have the
following attributes:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Less intrusive. I sometimes worry about an excessive amount of chatter
bothering other team members.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Protect my ego. When I ask a question it is admitting that I don&amp;rsquo;t know the
answer. As a &amp;ldquo;director of engineering&amp;rdquo; it can be humbling to admit
ignorance. But of course I don&amp;rsquo;t know everything! It&amp;rsquo;s just my ego talking.
However, it still stings a bit sometimes to ask publicly–it&amp;rsquo;s easier to just
side chat.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>&lt;strong>Good&lt;/strong>™:&lt;/p>
&lt;blockquote>
&lt;p>However, the benefits of posting in a public channel are many. A message in a
public channel is:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Viewable. This means that others can chime in (as opposed to just the person
I DMed). And that others can learn in the present as they read my question
and the answers.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Linkable. This means that if I want to reference the conversation (in a PR,
trello card or elsewhere), I can. Of course, I should extract info into
documentation (future me will thank past me) but for context around a
decision, a link to a slack chat can be very helpful.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Searchable. This means that others in the future who are searching for this
information can find it. Yes, slack&amp;rsquo;s search leaves something to be desired,
but if the conversation is private, that&amp;rsquo;s a guarantee that no one else will
be able to search and find it.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Vulnerable. I want everyone to feel comfortable asking questions. That leads
to better outcomes for clients and for team members. How can I expect that
behavior of others if I don&amp;rsquo;t do it myself?&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>Surprisingly, I&amp;rsquo;ve had many teammates throughout the years that are unaware of
these benefits.&lt;/p>
&lt;p>One more for &lt;strong>Bad&lt;/strong> (direct messages):&lt;/p>
&lt;ul>
&lt;li>&lt;strong>No load balancing&lt;/strong>. Risk of bothering one person instead of distributing
question load amongst the team.&lt;/li>
&lt;/ul>
&lt;p>One more for &lt;strong>Good&lt;/strong> (public messages):&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Knowledge sharing&lt;/strong>. What you ask, you learn. What you learn, your teammates
also learn. Win-win!&lt;/li>
&lt;/ul></description></item><item><title>.gitignore .claude/settings.local.json</title><link>https://perrotta.dev/2025/06/.gitignore-.claude/settings.local.json/</link><pubDate>Thu, 12 Jun 2025 22:17:43 +0200</pubDate><author>serendipity@perrotta.dev (Thiago Perrotta)</author><guid>https://perrotta.dev/2025/06/.gitignore-.claude/settings.local.json/</guid><description>&lt;p>The initial attempt:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>% cat ~/.gitignore
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.claude/settings.local.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>However, it doesn&amp;rsquo;t work when you run &lt;a href="https://www.anthropic.com/claude-code">claude
code&lt;/a> in a subdirectory of your git
repository root. &lt;code>git diff&lt;/code> still surfaces it.&lt;/p>
&lt;p>The correct form is:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">-.claude/settings.local.json
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e06c75">&lt;/span>&lt;span style="color:#98c379;font-weight:bold">+**/.claude/settings.local.json
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Add &lt;code>**&lt;/code> to include subdirectories as well.&lt;/p></description></item></channel></rss>